!function(t){var i=window.webpackHotUpdate;window.webpackHotUpdate=function(t,e){!function(t,i){if(!w[t]||!b[t])return;for(var e in b[t]=!1,i)Object.prototype.hasOwnProperty.call(i,e)&&(g[e]=i[e]);0==--y&&0===m&&A()}(t,e),i&&i(t,e)};var e,s=!0,n="0be23abf59d3d6e10556",r=1e4,h={},a=[],o=[];function l(t){var i=E[t];if(!i)return M;var s=function(s){return i.hot.active?(E[s]?-1===E[s].parents.indexOf(t)&&E[s].parents.push(t):(a=[t],e=s),-1===i.children.indexOf(s)&&i.children.push(s)):(console.warn("[HMR] unexpected require("+s+") from disposed module "+t),a=[]),M(s)},n=function(t){return{configurable:!0,enumerable:!0,get:function(){return M[t]},set:function(i){M[t]=i}}};for(var r in M)Object.prototype.hasOwnProperty.call(M,r)&&"e"!==r&&"t"!==r&&Object.defineProperty(s,r,n(r));return s.e=function(t){return"ready"===d&&p("prepare"),m++,M.e(t).then(i,function(t){throw i(),t});function i(){m--,"prepare"===d&&(v[t]||S(t),0===m&&0===y&&A())}},s.t=function(t,i){return 1&i&&(t=s(t)),M.t(t,-2&i)},s}function u(t){var i={_acceptedDependencies:{},_declinedDependencies:{},_selfAccepted:!1,_selfDeclined:!1,_disposeHandlers:[],_main:e!==t,active:!0,accept:function(t,e){if(void 0===t)i._selfAccepted=!0;else if("function"==typeof t)i._selfAccepted=t;else if("object"==typeof t)for(var s=0;s<t.length;s++)i._acceptedDependencies[t[s]]=e||function(){};else i._acceptedDependencies[t]=e||function(){}},decline:function(t){if(void 0===t)i._selfDeclined=!0;else if("object"==typeof t)for(var e=0;e<t.length;e++)i._declinedDependencies[t[e]]=!0;else i._declinedDependencies[t]=!0},dispose:function(t){i._disposeHandlers.push(t)},addDisposeHandler:function(t){i._disposeHandlers.push(t)},removeDisposeHandler:function(t){var e=i._disposeHandlers.indexOf(t);e>=0&&i._disposeHandlers.splice(e,1)},check:P,apply:T,status:function(t){if(!t)return d;c.push(t)},addStatusHandler:function(t){c.push(t)},removeStatusHandler:function(t){var i=c.indexOf(t);i>=0&&c.splice(i,1)},data:h[t]};return e=void 0,i}var c=[],d="idle";function p(t){d=t;for(var i=0;i<c.length;i++)c[i].call(null,t)}var f,g,x,y=0,m=0,v={},b={},w={};function _(t){return+t+""===t?+t:t}function P(t){if("idle"!==d)throw new Error("check() is only allowed in idle status");return s=t,p("check"),(i=r,i=i||1e4,new Promise(function(t,e){if("undefined"==typeof XMLHttpRequest)return e(new Error("No browser support"));try{var s=new XMLHttpRequest,r=M.p+""+n+".hot-update.json";s.open("GET",r,!0),s.timeout=i,s.send(null)}catch(t){return e(t)}s.onreadystatechange=function(){if(4===s.readyState)if(0===s.status)e(new Error("Manifest request to "+r+" timed out."));else if(404===s.status)t();else if(200!==s.status&&304!==s.status)e(new Error("Manifest request to "+r+" failed."));else{try{var i=JSON.parse(s.responseText)}catch(t){return void e(t)}t(i)}}})).then(function(t){if(!t)return p("idle"),null;b={},v={},w=t.c,x=t.h,p("prepare");var i=new Promise(function(t,i){f={resolve:t,reject:i}});g={};return S(0),"prepare"===d&&0===m&&0===y&&A(),i});var i}function S(t){w[t]?(b[t]=!0,y++,function(t){var i=document.createElement("script");i.charset="utf-8",i.src=M.p+""+t+"."+n+".hot-update.js",document.head.appendChild(i)}(t)):v[t]=!0}function A(){p("ready");var t=f;if(f=null,t)if(s)Promise.resolve().then(function(){return T(s)}).then(function(i){t.resolve(i)},function(i){t.reject(i)});else{var i=[];for(var e in g)Object.prototype.hasOwnProperty.call(g,e)&&i.push(_(e));t.resolve(i)}}function T(i){if("ready"!==d)throw new Error("apply() is only allowed in ready status");var e,s,r,o,l;function u(t){for(var i=[t],e={},s=i.slice().map(function(t){return{chain:[t],id:t}});s.length>0;){var n=s.pop(),r=n.id,h=n.chain;if((o=E[r])&&!o.hot._selfAccepted){if(o.hot._selfDeclined)return{type:"self-declined",chain:h,moduleId:r};if(o.hot._main)return{type:"unaccepted",chain:h,moduleId:r};for(var a=0;a<o.parents.length;a++){var l=o.parents[a],u=E[l];if(u){if(u.hot._declinedDependencies[r])return{type:"declined",chain:h.concat([l]),moduleId:r,parentId:l};-1===i.indexOf(l)&&(u.hot._acceptedDependencies[r]?(e[l]||(e[l]=[]),c(e[l],[r])):(delete e[l],i.push(l),s.push({chain:h.concat([l]),id:l})))}}}}return{type:"accepted",moduleId:t,outdatedModules:i,outdatedDependencies:e}}function c(t,i){for(var e=0;e<i.length;e++){var s=i[e];-1===t.indexOf(s)&&t.push(s)}}i=i||{};var f={},y=[],m={},v=function(){console.warn("[HMR] unexpected require("+P.moduleId+") to disposed module")};for(var b in g)if(Object.prototype.hasOwnProperty.call(g,b)){var P;l=_(b);var S=!1,A=!1,T=!1,D="";switch((P=g[b]?u(l):{type:"disposed",moduleId:b}).chain&&(D="\nUpdate propagation: "+P.chain.join(" -> ")),P.type){case"self-declined":i.onDeclined&&i.onDeclined(P),i.ignoreDeclined||(S=new Error("Aborted because of self decline: "+P.moduleId+D));break;case"declined":i.onDeclined&&i.onDeclined(P),i.ignoreDeclined||(S=new Error("Aborted because of declined dependency: "+P.moduleId+" in "+P.parentId+D));break;case"unaccepted":i.onUnaccepted&&i.onUnaccepted(P),i.ignoreUnaccepted||(S=new Error("Aborted because "+l+" is not accepted"+D));break;case"accepted":i.onAccepted&&i.onAccepted(P),A=!0;break;case"disposed":i.onDisposed&&i.onDisposed(P),T=!0;break;default:throw new Error("Unexception type "+P.type)}if(S)return p("abort"),Promise.reject(S);if(A)for(l in m[l]=g[l],c(y,P.outdatedModules),P.outdatedDependencies)Object.prototype.hasOwnProperty.call(P.outdatedDependencies,l)&&(f[l]||(f[l]=[]),c(f[l],P.outdatedDependencies[l]));T&&(c(y,[P.moduleId]),m[l]=v)}var z,R=[];for(s=0;s<y.length;s++)l=y[s],E[l]&&E[l].hot._selfAccepted&&R.push({module:l,errorHandler:E[l].hot._selfAccepted});p("dispose"),Object.keys(w).forEach(function(t){!1===w[t]&&function(t){delete installedChunks[t]}(t)});for(var B,C,L=y.slice();L.length>0;)if(l=L.pop(),o=E[l]){var O={},I=o.hot._disposeHandlers;for(r=0;r<I.length;r++)(e=I[r])(O);for(h[l]=O,o.hot.active=!1,delete E[l],delete f[l],r=0;r<o.children.length;r++){var k=E[o.children[r]];k&&((z=k.parents.indexOf(l))>=0&&k.parents.splice(z,1))}}for(l in f)if(Object.prototype.hasOwnProperty.call(f,l)&&(o=E[l]))for(C=f[l],r=0;r<C.length;r++)B=C[r],(z=o.children.indexOf(B))>=0&&o.children.splice(z,1);for(l in p("apply"),n=x,m)Object.prototype.hasOwnProperty.call(m,l)&&(t[l]=m[l]);var j=null;for(l in f)if(Object.prototype.hasOwnProperty.call(f,l)&&(o=E[l])){C=f[l];var H=[];for(s=0;s<C.length;s++)if(B=C[s],e=o.hot._acceptedDependencies[B]){if(-1!==H.indexOf(e))continue;H.push(e)}for(s=0;s<H.length;s++){e=H[s];try{e(C)}catch(t){i.onErrored&&i.onErrored({type:"accept-errored",moduleId:l,dependencyId:C[s],error:t}),i.ignoreErrored||j||(j=t)}}}for(s=0;s<R.length;s++){var F=R[s];l=F.module,a=[l];try{M(l)}catch(t){if("function"==typeof F.errorHandler)try{F.errorHandler(t)}catch(e){i.onErrored&&i.onErrored({type:"self-accept-error-handler-errored",moduleId:l,error:e,originalError:t}),i.ignoreErrored||j||(j=e),j||(j=t)}else i.onErrored&&i.onErrored({type:"self-accept-errored",moduleId:l,error:t}),i.ignoreErrored||j||(j=t)}}return j?(p("fail"),Promise.reject(j)):(p("idle"),new Promise(function(t){t(y)}))}var E={};function M(i){if(E[i])return E[i].exports;var e=E[i]={i:i,l:!1,exports:{},hot:u(i),parents:(o=a,a=[],o),children:[]};return t[i].call(e.exports,e,e.exports,l(i)),e.l=!0,e.exports}M.m=t,M.c=E,M.d=function(t,i,e){M.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:e})},M.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},M.t=function(t,i){if(1&i&&(t=M(t)),8&i)return t;if(4&i&&"object"==typeof t&&t&&t.__esModule)return t;var e=Object.create(null);if(M.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var s in t)M.d(e,s,function(i){return t[i]}.bind(null,s));return e},M.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return M.d(i,"a",i),i},M.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},M.p="build/",M.h=function(){return n},l(11)(M.s=11)}([function(t,i,e){"use strict";e.d(i,"a",function(){return s});var s=function(t){THREE.DataTextureLoader.call(this,t),this.type=THREE.UnsignedByteType};s.prototype=Object.assign(Object.create(THREE.DataTextureLoader.prototype),{constructor:s,parse:function(t){var i=function(t,i){switch(t){case 1:console.error("RGBELoader Read Error: "+(i||""));break;case 2:console.error("RGBELoader Write Error: "+(i||""));break;case 3:console.error("RGBELoader Bad File Format: "+(i||""));break;default:case 4:console.error("RGBELoader: Error: "+(i||""))}return-1},e=function(t,i,e){i=i||1024;for(var s=t.pos,n=-1,r=0,h="",a=String.fromCharCode.apply(null,new Uint16Array(t.subarray(s,s+128)));0>(n=a.indexOf("\n"))&&r<i&&s<t.byteLength;)h+=a,r+=a.length,s+=128,a+=String.fromCharCode.apply(null,new Uint16Array(t.subarray(s,s+128)));return-1<n&&(!1!==e&&(t.pos+=r+n+1),h+a.slice(0,n))},s=function(){var t=new Float32Array(1),i=new Int32Array(t.buffer);function e(e){t[0]=e;var s=i[0],n=s>>16&32768,r=s>>12&2047,h=s>>23&255;return h<103?n:h>142?(n|=31744,n|=(255==h?0:1)&&8388607&s):h<113?n|=((r|=2048)>>114-h)+(r>>113-h&1):(n|=h-112<<10|r>>1,n+=1&r)}return function(t,i,s,n){var r=t[i+3],h=Math.pow(2,r-128)/255;s[n+0]=e(t[i+0]*h),s[n+1]=e(t[i+1]*h),s[n+2]=e(t[i+2]*h)}}(),n=new Uint8Array(t);n.pos=0;var r,h,a,o,l,u,c=function(t){var s,n,r=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,h=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,a=/^\s*FORMAT=(\S+)\s*$/,o=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,l={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};if(t.pos>=t.byteLength||!(s=e(t)))return i(1,"no header found");if(!(n=s.match(/^#\?(\S+)$/)))return i(3,"bad initial token");for(l.valid|=1,l.programtype=n[1],l.string+=s+"\n";!1!==(s=e(t));)if(l.string+=s+"\n","#"!==s.charAt(0)){if((n=s.match(r))&&(l.gamma=parseFloat(n[1],10)),(n=s.match(h))&&(l.exposure=parseFloat(n[1],10)),(n=s.match(a))&&(l.valid|=2,l.format=n[1]),(n=s.match(o))&&(l.valid|=4,l.height=parseInt(n[1],10),l.width=parseInt(n[2],10)),2&l.valid&&4&l.valid)break}else l.comments+=s+"\n";return 2&l.valid?4&l.valid?l:i(3,"missing image size specifier"):i(3,"missing format specifier")}(n);if(-1!==c){var d=c.width,p=c.height,f=function(t,e,s){var n,r,h,a,o,l,u,c,d,p,f,g,x,y=e,m=s;if(y<8||y>32767||2!==t[0]||2!==t[1]||128&t[2])return new Uint8Array(t);if(y!==(t[2]<<8|t[3]))return i(3,"wrong scanline width");if(!(n=new Uint8Array(4*e*s))||!n.length)return i(4,"unable to allocate buffer space");for(r=0,h=0,c=4*y,x=new Uint8Array(4),l=new Uint8Array(c);m>0&&h<t.byteLength;){if(h+4>t.byteLength)return i(1);if(x[0]=t[h++],x[1]=t[h++],x[2]=t[h++],x[3]=t[h++],2!=x[0]||2!=x[1]||(x[2]<<8|x[3])!=y)return i(3,"bad rgbe scanline format");for(u=0;u<c&&h<t.byteLength;){if((g=(a=t[h++])>128)&&(a-=128),0===a||u+a>c)return i(3,"bad scanline data");if(g)for(o=t[h++],d=0;d<a;d++)l[u++]=o;else l.set(t.subarray(h,h+a),u),u+=a,h+=a}for(p=y,d=0;d<p;d++)f=0,n[r]=l[d+f],f+=y,n[r+1]=l[d+f],f+=y,n[r+2]=l[d+f],f+=y,n[r+3]=l[d+f],r+=4;m--}return n}(n.subarray(n.pos),d,p);if(-1!==f){switch(this.type){case THREE.UnsignedByteType:var g=f,x=THREE.RGBEFormat,y=THREE.UnsignedByteType;break;case THREE.FloatType:for(var m=f.length/4*3,v=new Float32Array(m),b=0;b<m;b++)a=v,o=3*b,l=void 0,u=void 0,l=(r=f)[(h=4*b)+3],u=Math.pow(2,l-128)/255,a[o+0]=r[h+0]*u,a[o+1]=r[h+1]*u,a[o+2]=r[h+2]*u;g=v,x=THREE.RGBFormat,y=THREE.FloatType;break;case THREE.HalfFloatType:m=f.length/4*3;var w=new Uint16Array(m);for(b=0;b<m;b++)s(f,4*b,w,3*b);g=w,x=THREE.RGBFormat,y=THREE.HalfFloatType;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type)}return{width:d,height:p,data:g,header:c.string,gamma:c.gamma,exposure:c.exposure,format:x,type:y}}}return null},setDataType:function(t){return this.type=t,this},load:function(t,i,e,s){return THREE.DataTextureLoader.prototype.load.call(this,t,function(t,e){switch(t.type){case THREE.UnsignedByteType:t.encoding=THREE.RGBEEncoding,t.minFilter=THREE.NearestFilter,t.magFilter=THREE.NearestFilter,t.generateMipmaps=!1,t.flipY=!0;break;case THREE.FloatType:case THREE.HalfFloatType:t.encoding=THREE.LinearEncoding,t.minFilter=THREE.LinearFilter,t.magFilter=THREE.LinearFilter,t.generateMipmaps=!1,t.flipY=!0}i&&i(t,e)},e,s)}})},function(t,i,e){"use strict";e.d(i,"a",function(){return n});var s=e(0);function n(t){this.parent=t;var i,e=this;this._active=!1,this.RADIUS=1e3,this.POS_X=0,this.POS_Y=0,this.POS_Z=0,this.LINK="nullMy",this.COLOR="0xffffff",this._radius=this.RADIUS,this._link=this.LINK,this._color=this.COLOR,this._shadRotZ=this.parent.ROTATION_Z,this._rotZ=0,this._x=this.POS_X,this._y=this.POS_Y,this._z=this.POS_Z,this.mesh=void 0,this.cont3d=void 0,this.cont3d1=void 0,this.textur=void 0,this.loaderHDR=void 0,this.onLoad=void 0,this.onComplete=void 0,this.init=function(){null==this.mesh&&(this.geometry=new THREE.SphereGeometry(1,32,32),this.loader=new THREE.TextureLoader,this.loaderHDR=new s.a,this.material=new THREE.MeshBasicMaterial({side:THREE.BackSide,color:16777215}),this.mesh=new THREE.Mesh(this.geometry,this.material),this.mesh.scale.set(this._radius,this._radius,this._radius),this.cont3d=new THREE.Object3D,this.cont3d1=new THREE.Object3D,this.cont3d.add(this.cont3d1),this.cont3d1.add(this.mesh),this.cont3d1.rotation.y=0,this.mesh.rotation.y=this._rotZ,this.cont3d.rotation.x=-Math.PI/2)},this.dergActiv=function(){1==this._active?null==this.cont3d.parent&&this.parent.parent.groupObject.add(this.cont3d):null!=this.cont3d.parent&&this.parent.parent.groupObject.remove(this.cont3d)},this.canvasTexture,this.linkNull=null,this.creatLink=function(){if(null!=this.linkNull)return this.linkNull;let t=document.createElement("canvas"),i=t.getContext("2d");t.height=t.width=2048;let e=t.height/26;i.fillStyle="rgba(100, 100, 100, 0.5)";let s=!0,n=!0;for(var r=0;r<26;r++){n=s;for(var h=0;h<26;h++)n&&i.fillRect(r*e,h*e,e,e),n=!n;s=!s}this.linkNull=t.toDataURL("image/png"),this.canvasTexture=new THREE.CanvasTexture(t)},this.dergLink=function(){if("null"==this._link||null==this._link){null!=this.material.map&&(this.material.map=null,this.material.needsUpdate=!0);let t=this._link+"";this.creatLink(),e.textur=this.canvasTexture,e.textur.linkMy=t,e.material.map=e.textur,e.material.needsUpdate=!0,e.parent.parent.intRend=1,e.onComplete&&e.onComplete()}else{if(this.onLoad&&this.onLoad(),0==(i=this.checkFormat(this._link))){let t=this._link+"";if(e.textur&&e.textur.linkMy&&e.textur.linkMy==t)return void(e.onComplete&&e.onComplete());this.loader.load(this._link,function(i){e.textur=i,e.textur.linkMy=t,e.material.map=i,e.material.needsUpdate=!0,e.parent.parent.intRend=1,e.onComplete&&e.onComplete()},function(t){},function(t){})}if(1==i)return}},this.checkFormat=function(t){return-1!==t.indexOf(".png")?0:-1!==t.indexOf(".jpeg")?0:-1!==t.indexOf(".jpg")?0:t.length>150?-1!==t.indexOf("png")?0:-1!==t.indexOf("jpeg")?0:-1!==t.indexOf("jpg")?0:1:1},this.render=function(){}}n.prototype={set x(t){this._x!==t&&(this._x=t,this.cont3d.position.x=t,this.parent.parent.intRend=1)},get x(){return this._x},set y(t){this._y!==t&&(this._y=t,this.cont3d.position.y=t,this.parent.parent.intRend=1)},get y(){return this._y},set z(t){this._z!==t&&(this._z=t,this.cont3d.position.z=t,this.parent.parent.intRend=1)},get z(){return this._z},set active(t){this._active!==t&&(this._active=t,this.init(),this.dergActiv())},get active(){return this._active},set radius(t){this._radius!==t&&(this._radius=t,null!=this.mesh&&this.mesh.scale.set(this._radius,this._radius,this._radius))},get radius(){return this._radius},set link(t){this._link!==t&&(this._link=t,this.init(),this.dergLink())},get link(){return this._link},set color(t){if(this._color!==t){this._color=t,this.init();var i=this._color;if("string"==typeof i&&-1!=i.indexOf("x")){var e=i.split("x");i="#"+e[1]}this.material.color=new THREE.Color(i)}},get color(){return this._color}}},function(t,i,e){"use strict";var s=e(6),n=e(8);function r(t,i,e){this.type="PMMat";this.par=t,this.visi3D=i,this.objbase=e,this.pmTexture=this.par.tex,this.ser=window.location.href;var s,n,r=window.location.href.split("?")[0].split("/");this.server="";for(var h=0;h<r.length-1;h++)this.server+=r[h]+"/";this.aOBase={},this.aO={},this.matBag=new THREE.MeshBasicMaterial({color:16711680}),this.objCesh={},this.getIDObj=function(t,i){if(null!=this.objCesh[t]){for(var e=0;e<this.objCesh[t].length;e++)if(1==this.testM(this.objCesh[t][e].userData,i))return this.objCesh[t][e]}else this.objCesh[t]=[];if(s=this.par.mat.getIDReturn(t,!0),null!=i)for(n in i)if("color"==n){var r=new THREE.Color(i[n]);s.color=r}return s.userData=i,this.objCesh[t].push(s),s},this.testM=function(t,i){if(null==t){if(null==i)return!0}else if(null!=i){for(n in!1,i){if(!t[n])return!1;if(t[n]!==i[n])return!1}return!0}return!1},this.getIDReturn=function(t){return this.matBag}}function h(t){THREE.Group.call(this),this.type="MeshCombined",this._meshes=t,this._ready=!1,this.init()}h.prototype=Object.create(THREE.Group.prototype),h.constructor=h,Object.defineProperties(h.prototype,{}),h.prototype.canAnalyze=function(){return this._meshes.reduce(function(t,i){return t&&i.geometry},!0)},h.prototype._getMaterialKey=function(t){return t.material.uuid},h.prototype.init=function(){var t=this;if(this._ready||!this.canAnalyze)return!1;var i=[],e={};return this._meshes.forEach(function(t){var i=t.geometry.uuid;e[i]||(e[i]=[]),e[i].push(t)}),Object.keys(e).forEach(function(s){var n=e[s],r=n[0].geometry;if(1!==n.length){var h={};n.forEach(function(i){var e=t._getMaterialKey(i);h[e]||(h[e]=[]),h[e].push(i)}),Object.keys(h).forEach(function(t){var e=h[t],s=e[0].material,n=e.length,a=new THREE.InstancedMesh(r,s.clone(),n);i.push(a),e.forEach(function(t,i){a.setQuaternionAt(i,t.quaternion),a.setPositionAt(i,t.position),a.setScaleAt(i,t.scale)}),a.needsUpdate()})}else i.push(n[0])}),i.forEach(function(i){return t.add(i)}),!0};var a=new THREE.MeshDepthMaterial;a.depthPacking=THREE.RGBADepthPacking,a.clipping=!0,a.defines={INSTANCE_TRANSFORM:""};var o=THREE.ShaderLib.distanceRGBA,l=THREE.UniformsUtils.clone(o.uniforms),u=new THREE.ShaderMaterial({defines:{USE_SHADOWMAP:"",INSTANCE_TRANSFORM:""},uniforms:l,vertexShader:o.vertexShader,fragmentShader:o.fragmentShader,clipping:!0});THREE.InstancedMesh=function(t,i,e){THREE.Mesh.call(this,(new d).setGeometry(t),i);var s=this;this.type="InstancedMesh",this.numInstances=e||1,this.customDepthMaterial=a,this.customDistanceMaterial=u,this.onAfterRender=function(t,i,e,n,r,h){s.geometry.update(e)}},THREE.InstancedMesh.prototype=Object.create(THREE.Mesh.prototype),THREE.InstancedMesh.constructor=THREE.InstancedMesh,Object.defineProperties(THREE.InstancedMesh.prototype,{material:{set:function(t){this._material=t,this._material.defines=this._material.defines||{},this._material.defines.INSTANCE_TRANSFORM="",this._material.needsUpdate=!0},get:function(){return this._material}},geometry:{set:function(t){t instanceof d?this._geometry=t:this._geometry.setGeometry(t)},get:function(){return this._geometry}},numInstances:{set:function(t){this._numInstances=t,this.geometry.setCount(this.numInstances)},get:function(){return this._numInstances}}}),THREE.InstancedMesh.prototype.setPositionAt=function(t,i){this.geometry.setPositionAt(t,i)},THREE.InstancedMesh.prototype.setQuaternionAt=function(t,i){this.geometry.setQuaternionAt(t,i)},THREE.InstancedMesh.prototype.setScaleAt=function(t,i){this.geometry.setScaleAt(t,i)},THREE.InstancedMesh.prototype.getPositionAt=function(t,i){return this.geometry.getPositionAt(t,i)},THREE.InstancedMesh.prototype.getQuaternionAt=function(t,i){return this.geometry.getQuaternionAt(t,i)},THREE.InstancedMesh.prototype.getScaleAt=function(t,i){return this.geometry.getScaleAt(t,i)},THREE.InstancedMesh.prototype.needsUpdate=function(){this.geometry.needsUpdate=!0,this.geometry.computeBoundingSphere()};var c;new THREE.BoxBufferGeometry(1,1,1),new THREE.MeshNormalMaterial({wireframe:!0});function d(){THREE.InstancedBufferGeometry.call(this),this.count=0;var t=this;this.boundOrigin=new THREE.Box3,this.arrTransform=[],this.gridTransform=new f(this.arrTransform),this.setCount=function(t){if(this.count=t,(this.maxInstancedCount||0)<t&&(!this.attributes.instanceQuaternion||this.attributes.instanceQuaternion.count<t)){var i={instanceQuaternion:new Float32Array(4*t),instancePosition:new Float32Array(3*t),instanceScale:new Float32Array(3*t)};this.setAttribute("instanceQuaternion",new THREE.InstancedBufferAttribute(i.instanceQuaternion,4)),this.setAttribute("instancePosition",new THREE.InstancedBufferAttribute(i.instancePosition,3)),this.setAttribute("instanceScale",new THREE.InstancedBufferAttribute(i.instanceScale,3)),this.needsUpdate=!0}for(var e=0;e<t;e++)this.arrTransform[e]=new p(this.boundOrigin);this.maxInstancedCount=t},this.setGeometry=function(t){return this.copy(t),this.boundOrigin.setFromBufferAttribute(this.attributes.position),this};var i=new THREE.Frustum,e=new THREE.Matrix4;this.arrTransformVisible=[],this.update=function(s){e.multiplyMatrices(s.projectionMatrix,s.matrixWorldInverse),i.setFromMatrix(e);var n=0;this.arrTransformVisible=[];for(var r=0;r<this.gridTransform.arrGridIndex.length;r++){var h=this.gridTransform.arrGridIndex[r];if(i.intersectsBox(h.boundingBox))for(var a=0;a<h.arrTransform.length;a++){var o=h.arrTransform[a];this.arrTransformVisible.push(o),this.setTransformAt(n++,o)}}t.maxInstancedCount=n,t.needsUpdate=!0},this.updateGrid=function(){this.gridTransform.updateGrid()}}function p(t){this.boundOrigin=t,this._boundingBox=null,this.p=new THREE.Vector3,this.s=new THREE.Vector3(1,1,1),this.q=new THREE.Quaternion,this.setP=function(t){this.p.copy(t)},this.setS=function(t){this.s.copy(t)},this.setQ=function(t){this.q.copy(t)}}function f(t){var i=this;this.arrTransform=t;var e=100;function s(t){var s="x"+Math.floor(t.x/e)+"y"+Math.floor(t.y/e)+"z"+Math.floor(t.z/e);return i.cache[s]||(i.cache[s]=new g),i.cache[s]}this.arrGridIndex=[],this.cache={},this.updateGrid=function(){this.arrGridIndex.length=0,this.cache={};for(var t=0;t<this.arrTransform.length;t++){var i=this.arrTransform[t];s(i.p).arrTransform.push(i)}for(var e in this.cache)this.cache[e].computeBoundingBox(),this.arrGridIndex.push(this.cache[e])}}function g(){this.arrTransform=[],this._boundingBox=null}d.prototype=Object.create(THREE.InstancedBufferGeometry.prototype),d.constructor=d,d.prototype.setTransformAt=function(t,i){this.attributes.instanceScale.setXYZ(t,i.s.x,i.s.y,i.s.z),this.attributes.instancePosition.setXYZ(t,i.p.x,i.p.y,i.p.z),this.attributes.instanceQuaternion.setXYZW(t,i.q.x,i.q.y,i.q.z,i.q.w)},d.prototype.setPositionAt=function(t,i){this.arrTransform[t].setP(i),this.setTransformAt(t,this.arrTransform[t])},d.prototype.setQuaternionAt=function(t,i){this.arrTransform[t].setQ(i),this.setTransformAt(t,this.arrTransform[t])},d.prototype.setScaleAt=function(t,i){this.arrTransform[t].setS(i),this.setTransformAt(t,this.arrTransform[t])},d.prototype.getPositionAt=function(t,i){return i?i.copy(this.arrTransform[t].p):this.arrTransform[t].p},d.prototype.getQuaternionAt=function(t,i){return i?i.copy(this.arrTransform[t].q):this.arrTransform[t].q},d.prototype.getScaleAt=function(t,i){return i?i.copy(this.arrTransform[t].s):this.arrTransform[t].s},d.prototype.computeBoundingSphere=function(){null===this.boundingSphere&&(this.boundingSphere=new THREE.Sphere),this.computeBoundingBox(),this.boundingBox.getBoundingSphere(this.boundingSphere),this.updateGrid()},d.prototype.computeBoundingBox=function(){null===this.boundingBox&&(this.boundingBox=new THREE.Box3),this.boundingBox.makeEmpty();for(var t=0,i=this.count;t<i;t++)this.boundingBox.union(this.getBoundingBoxAt(t))},d.prototype.getBoundingBoxAt=function(t){return this.arrTransform[t].boundingBox},Object.defineProperties(d.prototype,{needsUpdate:{set:function(t){this.attributes.instancePosition.needsUpdate=t,this.attributes.instanceQuaternion.needsUpdate=t,this.attributes.instanceScale.needsUpdate=t},get:function(){return!1}}}),p.prototype.computeBoundingBox=(c=new THREE.Matrix4,function(){return this._boundingBox||(this._boundingBox=new THREE.Box3),c.compose(this.p,this.q,this.s),this.boundingBox.copy(this.boundOrigin),this.boundingBox.applyMatrix4(c),this.boundingBox}),Object.defineProperties(p.prototype,{boundingBox:{set:function(t){this._boundingBox=t},get:function(){return this._boundingBox||this.computeBoundingBox()}}}),g.prototype.computeBoundingBox=function(){this._boundingBox||(this._boundingBox=new THREE.Box3),this.boundingBox.makeEmpty();for(var t=0,i=this.arrTransform.length;t<i;t++)this.boundingBox.union(this.arrTransform[t].boundingBox);return this.boundingBox},Object.defineProperties(g.prototype,{boundingBox:{set:function(t){this._boundingBox=t},get:function(){return this._boundingBox||this.computeBoundingBox()}}});var x,y=["#ifndef INSTANCE_TRANSFORM","vec3 transformed = vec3( position );","#else","#ifndef INSTANCE_MATRIX","mat4 _instanceMatrix = getInstanceMatrix();","#define INSTANCE_MATRIX","#endif","vec3 transformed = ( _instanceMatrix * vec4( position , 1. )).xyz;","#endif"].join("\n"),m=["#ifdef USE_COLOR","diffuseColor.rgb *= vColor;","#endif","#if defined(INSTANCE_COLOR)","diffuseColor.rgb *= vInstanceColor;","#endif"].join("\n"),v=["#ifdef USE_COLOR","varying vec3 vColor;","#endif","#if defined( INSTANCE_COLOR )","varying vec3 vInstanceColor;","#endif"].join("\n"),b=["#ifdef USE_COLOR","vColor.xyz = color.xyz;","#endif","#if defined( INSTANCE_COLOR ) && defined( INSTANCE_TRANSFORM )","vInstanceColor = instanceColor;","#endif"].join("\n"),w=["#ifdef FLIP_SIDED","objectNormal = -objectNormal;","#endif","#ifndef INSTANCE_TRANSFORM","vec3 transformedNormal = normalMatrix * objectNormal;","#else","#ifndef INSTANCE_MATRIX ","mat4 _instanceMatrix = getInstanceMatrix();","#define INSTANCE_MATRIX","#endif","#ifndef INSTANCE_UNIFORM","vec3 transformedNormal =  transposeMat3( inverse( mat3( modelViewMatrix * _instanceMatrix ) ) ) * objectNormal ;","#else","vec3 transformedNormal = ( modelViewMatrix * _instanceMatrix * vec4( objectNormal , 0.0 ) ).xyz;","#endif","#endif"].join("\n"),_=["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )","varying vec2 vUv;","uniform mat3 uvTransform;","#endif","#ifdef INSTANCE_TRANSFORM","mat3 inverse(mat3 m) {","float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2];","float a10 = m[1][0], a11 = m[1][1], a12 = m[1][2];","float a20 = m[2][0], a21 = m[2][1], a22 = m[2][2];","float b01 = a22 * a11 - a12 * a21;","float b11 = -a22 * a10 + a12 * a20;","float b21 = a21 * a10 - a11 * a20;","float det = a00 * b01 + a01 * b11 + a02 * b21;","return mat3(b01, (-a22 * a01 + a02 * a21), ( a12 * a01 - a02 * a11),","b11, ( a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),","b21, (-a21 * a00 + a01 * a20), ( a11 * a00 - a01 * a10)) / det;","}","attribute vec3 instancePosition;","attribute vec4 instanceQuaternion;","attribute vec3 instanceScale;","#if defined( INSTANCE_COLOR )","attribute vec3 instanceColor;","varying vec3 vInstanceColor;","#endif","mat4 getInstanceMatrix(){","vec4 q = instanceQuaternion;","vec3 s = instanceScale;","vec3 v = instancePosition;","vec3 q2 = q.xyz + q.xyz;","vec3 a = q.xxx * q2.xyz;","vec3 b = q.yyz * q2.yzz;","vec3 c = q.www * q2.xyz;","vec3 r0 = vec3( 1.0 - (b.x + b.z) , a.y + c.z , a.z - c.y ) * s.xxx;","vec3 r1 = vec3( a.y - c.z , 1.0 - (a.x + b.z) , b.y + c.x ) * s.yyy;","vec3 r2 = vec3( a.z + c.y , b.y - c.x , 1.0 - (a.x + b.x) ) * s.zzz;","return mat4(","r0 , 0.0,","r1 , 0.0,","r2 , 0.0,","v  , 1.0",");","}","#endif"].join("\n");function P(t,i,e){this.type="PMFilt";var s=this;this.par=t,this.visi3D=i,this.objbase=e,this.ceshGeom=new E(this),this.setObjS=function(t,i){!0,t.object.filt&&0!=t.object.filt.length?new S(this,t,i):this.finalObjS(t,i)},this.finalObjS=function(t,i){t.object.param&&(1==t.object.param.kesh&&s.ceshGeom.set(t.content3d),null!=t.object.param.sG&&1==t.object.param.sG&&s.ceshGeom.groupGeometri(t.content3d)),i()},this.dragParam=function(t,i){if(t.children)for(var e=t.children.length-1;e>=0;e--)this.dragParam(t.children[e],i);null==t.bs&&(t.castShadow=i.tOt,t.receiveShadow=i.tNa);var s=i.rO;t.iz&&t.iz.renderOrder&&(s=t.iz.renderOrder),t.renderOrder=s},this.dragPozition=function(t){var i=!1;t.object&&t.object.psm&&(i=!0,null!=t.object.psm.active&&0==t.object.psm.active&&(i=!1)),1==i?(t.content3d.position.set(t.object.psm.p[0],t.object.psm.p[1],t.object.psm.p[2]),t.content3d.rotation.set(t.object.psm.r[0],t.object.psm.r[1],t.object.psm.r[2]),t.content3d.scale.set(t.object.psm.s[0],t.object.psm.s[1],t.object.psm.s[2])):(t.content3d.position.set(0,0,0),t.content3d.rotation.set(0,0,0),t.content3d.scale.set(1,1,1))}}function S(t,i,e){this.type="StartFilt";this.par=t,this.hron=i,this.fun=e,this.hron.filt=this,this.array=[];var s,n=0;this.dragFilt=function(){n!=this.hron.object.filt.length?(s=this.hron.object.filt[n].type,n++,"mark"==s&&this.array.push(new T(this,this.hron.object.filt[n-1],this.array.length)),"material"==s&&this.array.push(new A(this,this.hron.object.filt[n-1],this.array.length))):this.par.finalObjS(this.hron,this.fun)},this.dragFilt()}function A(t,i,e){this.type="PMMaterial";this.par=t,this.obj=i,this.idArr=e,this.mat=this.par.par.par.mat.getTestTitle(i.id),null!=this.mat?(this.parsing=function(t){if(t.children)for(var i=t.children.length-1;i>=0;i--)this.parsing(t.children[i]);null!=t.material&&(t.material=this.mat)},this.parsing(t.hron.content3d),this.par.dragFilt()):this.par.dragFilt()}function T(t,i,e){this.type="PMMark";var s=this;if(this.par=t,this.obj=i,this.idArr=e,this.idKey=i.id,this.c3d=t.hron.content3d,this.arrName=[],this.arrayObj=[],"null"!=this.idKey){var n,r=!0;if(-1!=i.id.indexOf("|")){for(var h=i.id.split("|"),a=h[0].split(","),o=h[1].split(","),l=0;l<a.length;l++)this.arrName[l]={name:a[l],id:1*o[l],obCont:null};r=!1}else r=!0,this.arrName[0]={name:"null",id:i.id,obCont:null};this.parsing=function(t){if(t.children)for(var i=t.children.length-1;i>=0;i--)this.parsing(t.children[i]);if("Mesh"==t.type)if(r)n=this.arrName[0].obCont.clone(),t.parent.add(n),n.position.set(t.position.x,t.position.y,t.position.z),n.rotation.set(t.rotation.x,t.rotation.y,t.rotation.z),n.scale.set(t.scale.x,t.scale.y,t.scale.z),t.parent.remove(t);else if(t.name)for(i=this.arrName.length-1;i>=0;i--)if(-1!=t.name.indexOf(this.arrName[i].name))return n=this.arrName[i].obCont.clone(),t.parent.add(n),n.position.set(t.position.x,t.position.y,t.position.z),n.rotation.set(t.rotation.x,t.rotation.y,t.rotation.z),n.scale.set(t.scale.x,t.scale.y,t.scale.z),void t.parent.remove(t)},this.loadMMM=function(t){this.par.par.par.getId(1*t.id,function(i){t.obCont=i,s.loadMod()})},this.loadMod=function(){for(var t=0;t<this.arrName.length;t++)if(null==this.arrName[t].obCont)return void this.loadMMM(this.arrName[t]);this.parsing(this.c3d),this.par.dragFilt()},this.loadMod()}else this.par.dragFilt()}function E(t){this.type="CeshGeom";var i=this;i.kolCount=9999,this.par=t;var e,s,n={};function r(t,i,e,s){e&&i.updateMatrixWorld(),s&&t.updateMatrixWorld();var n=(new THREE.Matrix4).getInverse(i.matrixWorld);t.parent&&n.multiply(t.parent.matrixWorld),t.applyMatrix(n),i.add(t)}this.set=function(t){for(var e in n={},i.fillObjMesh(t),n)n[e].length>=2&&new M(this,t,n[e])},this.sliteGeom=new D,this.groupGeometri=function(t){n={},i.fillObjMesh(t);var h=!1;for(var a in n)if(n[a].length>=2){h=!0,this.sliteGeom.start(n[a][0].geometry.clone());for(var o=n[a].length-1;o>=0;o--)r(e=n[a][o],t),this.sliteGeom.setMesh(e),e.parent.remove(e);this.sliteGeom.final(),s=new THREE.Mesh(this.sliteGeom.creatGeom,e.material),t.add(s)}h&&i.killNull(t)},i.killNull=function(t){if(t.children)for(var e=t.children.length-1;e>=0;e--)i.killNull(t.children[e]);null!=t.geometry||null==t.children||0!=t.children.length||null==t.parent||t.parent.remove(t)},i.fillObjMesh=function(t){for(var e=function t(i){var e=[];i.updateMatrixWorld();i instanceof THREE.Mesh&&e.push(i);for(var s=0;s<i.children.length;s++)for(var n=t(i.children[s]),r=0;r<n.length;r++)e.push(n[r]);return e}(t),s=0;s<e.length;s++)e[s].geometry&&e[s].geometry.index&&e[s].geometry.index.count<i.kolCount&&(n[e[s].geometry.uuid]=n[e[s].geometry.uuid]||[],n[e[s].geometry.uuid].push(e[s]))},this.moveObject=function(t,i,e,s){r(t,i,e,s)}}function M(t,i,e){this.type="LoadTime";var s,n=this;this.par=t,this.c3d=i,this.arr=e,this.mesh=e[0],this.geom=e[0].geometry,this.mate=e[0].material;var r=!0;this.initLoad=function(){r=!1,n.mate&&null!=n.mate.idObj&&0==n.mate.loadTexure&&(r=!0),0==r?setTimeout(function(){n.initLoad()},50):n.creat()},this.creat=function(){for(var t=e.length-1;t>=0;t--)s=e[t],this.par.moveObject(s,i),s.parent.remove(s);this.meshCombined=new h(e),i.add(this.meshCombined);for(this.meshCombined._meshes,t=0;t<this.meshCombined.children.length;t++)this.meshCombined.children[t].castShadow=s.castShadow,this.meshCombined.children[t].receiveShadow=s.receiveShadow,this.meshCombined.children[t].renderOrder=s.renderOrder;this.par.killNull(i)},this.initLoad()}function D(){this.type="SliteGeom";var t;this.geometry,this.kol,this.ah=[],this.sah=0,this.sahMesh=0,this.creatGeom,this.ap=[],this.ai=[],this.auv=[],this.start=function(t){this.geometry=t,this.creatGeom=new THREE.BufferGeometry,this.sah=0,this.sahMesh=0,this.ap=[],this.ai=[],this.auv=[],this.sPosit()},this.sPosit=function(){for(var t=0;t<this.geometry.index.count;t++)null==this.ah[this.sah]&&(this.ah[this.sah]=new z),this.ah[this.sah].posOld.set(this.geometry.attributes.position.array[3*this.geometry.index.array[t]],this.geometry.attributes.position.array[3*this.geometry.index.array[t]+1],this.geometry.attributes.position.array[3*this.geometry.index.array[t]+2]),this.ah[this.sah].uv.set(this.geometry.attributes.uv.array[2*this.geometry.index.array[t]],this.geometry.attributes.uv.array[2*this.geometry.index.array[t]+1]),this.ah[this.sah].index=this.geometry.index.array[t],this.sah++},this.setMesh=function(i){t=this.sahMesh*this.sah;for(var e=0;e<this.sah;e++)this.ah[e].setMesh(i),this.ap.push(this.ah[e].pos.x,this.ah[e].pos.y,this.ah[e].pos.z),this.auv.push(this.ah[e].uv.x,this.ah[e].uv.y),this.ai.push(this.ah[e].index+t);this.sahMesh++},this.final=function(){this.creatGeom.setIndex(this.ai),this.creatGeom.setAttribute("position",new THREE.BufferAttribute(new Float32Array(this.ap),3)),this.creatGeom.setAttribute("uv",new THREE.BufferAttribute(new Float32Array(this.auv),2)),this.creatGeom.attributes.position.needsUpdate=!0,this.creatGeom.attributes.uv.needsUpdate=!0,this.creatGeom.computeVertexNormals(),this.creatGeom.attributes.normal.needsUpdate=!0,this.creatGeom.computeBoundingBox(),this.creatGeom.computeBoundingSphere()}}function z(){this.type="SliteGeom",this.pos=new THREE.Vector3,this.posOld=new THREE.Vector3,this.uv=new THREE.Vector2,this.index=0,this.setMesh=function(t){this.pos.set(this.posOld.x,this.posOld.y,this.posOld.z),this.pos.applyMatrix4(t.matrix)}}function R(t,i,e){this.type="PMFilt";var s,n,r,h=this;this.par=t,this.visi3D=i,this.objbase=e,this.setHron=function(t,i){var e,s;e=t.object.iz,s=t.content3d,i&&(s=i),null!=s&&null!=e&&1==e.a&&this.setMod(s,this.strToObj(e.str),e.st)},this.strToObj=function(t){for(var i="",e=0;e<t.length;e++)"|"==t[e]?i+='"':i+=t[e];return JSON.parse(i)},this.getIz=function(t){if(s++,null!=t.iz){var i=0;null!=t.iz.renderOrder&&(0==i&&(i={}),i.renderOrder=t.iz.renderOrder),null!=t.iz.bs&&(0==i&&(i={}),i.bs=t.iz.bs),null!=t.iz.mod&&(0==i&&(i={}),i.mod=t.iz.mod),null!=t.iz.position&&(0==i&&(i={}),i.position=t.iz.position),null!=t.iz.scale&&(0==i&&(i={}),i.scale=t.iz.scale),null!=t.iz.rotation&&(0==i&&(i={}),i.rotation=t.iz.rotation),null!=t.iz.visible&&(0==i&&(i={}),i.visible=t.iz.visible),null!=t.iz.material&&(0==i&&(i={}),i.material=t.iz.material),0!=i&&(i.sah=s),n.push(i)}else n.push(0);if(t.children&&null==t.notPar)for(var e=0;e<t.children.length;e++)this.getIz(t.children[e])},this.getMod=function(t){return s=-1,n=[],this.getIz(t),n},this.setIz=function(t,i){if(r[++s]&&0!=r[s]){if(t.iz={},null!=r[s].mod){i&&(t.iz.mod=r[s].mod);for(var e=new THREE.Object3D,n=0,a=0;a<t.parent.children.length;a++)t.parent.children[a].uuid==t.uuid&&(n=a);e.notPar=!0,t.parent.add(e),t.parent.remove(t),e.parent.children.splice(e.parent.children.length-1,1),e.parent.children.splice(n,0,e),h.par.getId(r[s].mod,function(t){e.add(t)})}null!=r[s].renderOrder&&(i&&(t.iz.renderOrder=r[s].renderOrder),t.renderOrder=r[s].renderOrder),null!=r[s].bs&&(i&&(t.iz.bs=r[s].bs),t.bs=r[s].bs),null!=r[s].position&&(i&&(t.iz.position=r[s].position),t.position.set(r[s].position.x,r[s].position.y,r[s].position.z)),null!=r[s].scale&&(i&&(t.iz.scale=r[s].scale),t.scale.set(r[s].scale.x,r[s].scale.y,r[s].scale.z)),null!=r[s].rotation&&(i&&(t.iz.rotation=r[s].rotation),t.rotation.set(r[s].rotation.x,r[s].rotation.y,r[s].rotation.z)),null!=r[s].visible&&(i&&(t.iz.visible=r[s].visible),t.visible=r[s].visible),null!=r[s].material&&t.material&&(null==t.oldName&&(t.oldName=t.material.name),i&&(t.iz.material=r[s].material),t.material=h.par.matDop.getIDObj(r[s].material))}if(t.children&&null==t.notPar)for(a=0;a<t.children.length;a++)this.setIz(t.children[a])},this.setMod=function(t,i,e){"object"==typeof i&&null!=i[0]&&(r=i,s=-1,this.setIz(t,e))},this.setMat=function(t,i,e,s){if(null!=s&&(s=!0),null!=t.material&&(null==t.oldName&&(t.oldName=t.material.name),i=this.par.mat.getIDReturn(i,s),null==e?(t.material=i,null==t.iz&&(t.iz={}),t.iz.material=i.idUz):t.oldName&&-1!=t.oldName.indexOf(e)&&(t.material=i,null==t.iz&&(t.iz={}),t.iz.material=i.idUz)),t.children&&null==t.notPar)for(var n=0;n<t.children.length;n++)this.setMat(t.children[n],i,e,s)}}THREE.ShaderChunk.begin_vertex=y,THREE.ShaderChunk.color_fragment=m,THREE.ShaderChunk.color_pars_fragment=v,THREE.ShaderChunk.color_vertex=b,THREE.ShaderChunk.defaultnormal_vertex=w,THREE.ShaderChunk.uv_pars_vertex=_;class B{constructor(t,i,e){this.type="PMTexture",this.par=t,this.param=this.par.param,this.nameType="textures",this.visi3D=i,this.objbase=e,this.loader=new THREE.TextureLoader,this.textureCache={},window.textureCache=this.textureCache}getById(t,i){if(this.textureCache[t]&&this.textureCache[t].loaded)return i&&setTimeout(()=>i(this.textureCache[t].texture),0),this.textureCache[t].texture;{const e=this.getObj(t);return this.loadTexture(e,i)}}loadTexture(t,i){if(this.textureCache[t.id]&&this.textureCache[t.id].callbacks||(this.textureCache[t.id]={callbacks:[]}),!this.textureCache[t.id].texture){let i="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAIAAAACCAYAAABytg0kAAAACXBIWXMAAB7CAAAewgFu0HU+AAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAABtJREFUeNpi+M/A8B8KGRgYGP43AAAAAP//AwA/UwZ7TELoKQAAAABJRU5ErkJggg==";t.res&&(i=t.res),t.obj&&t.obj.res&&(i=t.obj.res.src);const e=this.loader.load(mhbd.getLink(i),i=>{this.visi3D&&(this.visi3D.intRend=1),i.obj={},this.textureCache[t.id].callbacks.forEach(t=>t(i)),delete this.textureCache[t.id].callbacks,this.textureCache[t.id].loaded=!0});e.arrMat=[],e.arrRun=[],e.wrapS=e.wrapT=THREE.RepeatWrapping,t&&(e.repeat.x=t.rx,e.repeat.y=t.ry),this.textureCache[t.id].texture=e}return i&&this.textureCache[t.id].callbacks.push(i),this.textureCache[t.id].texture}updateTexture(t,i){if(this.textureCache[t.id])if(i){const i=new Image,e=window.location.href.split("/");e.pop(),i.src=e.join("/")+"/resources/data/"+t.id+"/pic."+t.type,i.crossOrigin=null,this.textureCache[t.id].texture.image=i,this.textureCache[t.id].loaded=!1,i.onload=(()=>{delete this.textureCache[t.id].callbacks,this.textureCache[t.id].loaded=!0,this.textureCache[t.id].texture.needsUpdate=!0})}else this.textureCache[t.id].texture.repeat.x=t.rx,this.textureCache[t.id].texture.repeat.y=t.ry}getObj(t){var i=this.param[this.nameType];mhbd.objectBase&&mhbd.objectBase.textures&&(i=mhbd.objectBase.textures);for(var e=0;e<i.length;e++)if(t==i[e].id){let t;return t="string"==typeof i[e].json?JSON.parse(i[e].json):i[e].json,i[e].obj=t,i[e]}return null}}function C(t,i,e){this.type="Dop";var s=this;this.par=t,this.visi3D=i,this.objbase=e,this.param=this.par.param,this.getId=function(t,i,e,n){this.par.getId(t,function(t){t.tovar=new L(s,t,n),i(t)},e)}}function L(t,i,e){var s,n;this.par=t,this.type="Tovar",this.param=this.par.param,this.c3=i,this.op20=e,this.array3D=[],this.array=[],this.setColor=function(t,i){this.array[t].index=i},this.strIz="",this.arrIz=[],this.boolIz=!1;var r=[];this.initIz=function(){if(this.c3.hron.object.iz){var t=this.c3.hron.object.iz.str.split("|").join('"');this.boolIz=!0,this.strIz=t,this.arrIz=JSON.parse(this.strIz);for(var i=0;i<this.arrIz.length;i++)if(0!=this.arrIz[i]&&null!=this.arrIz[i].material){s=null;for(var e=0;e<this.array.length;e++)this.array[e].id==this.arrIz[i].material&&(s=this.array[e],e=9999);null==s&&((s=new O(this)).tipe="mat",s.idArr=this.array.length,s.id=this.arrIz[i].material,this.array.push(s)),n=this.getNum(i),s.addChild(n)}if(this.c3.hron.object.resurs&&this.c3.hron.object.resurs.array&&0!==this.c3.hron.object.resurs.array.length){r=this.c3.hron.object.resurs.array;for(i=0;i<r.length;i++){s=null;for(e=0;e<this.array.length;e++)"res"==this.array[e].tipe&&this.array[e].id==r[i].i&&(s=this.array[e],e=9999);null==s&&((s=new O(this)).tipe="res",s.id=r[i].i,s.idArr=this.array.length,this.array.push(s)),s.addChild(JSON.parse(r[i].i1.split("|").join('"'))),1==s.children.length&&(s.index=0)}this.setCJ(this.cj)}}},this.uuidTovar="хрен его знает",this.setTovar=function(t){if(null!=t&&(null==t.uuid&&(t.uuid=this.generateRendom(2)),t.uuid!==this.uuidTovar&&(this.uuidTovar=t.uuid,t.obj.colorJSON)))for(var i=0;i<this.array.length;i++)this.array[i].setKusook(t.obj.colorJSON.array[i])},this.cj=null,this.setCJ=function(t){if(null!=t){this.cj=t;for(var i=0;i<t.array.length&&(t.array[i].type&&"mat"==t.array[i].type);i++)this.array[i]&&this.array[i].setKusook(t.array[i])}},this.setOp20=function(t){!1,null==this.op20?(this.op20=t,!0):(!0,this.op20=t)},this.setColArr=function(t){if(null==t)for(var i=0;i<this.array.length;i++)this.array[i].index=-1;else for(i=0;i<this.array.length;i++)this.array[i].index=t[i]};var h={n:0};this.getNum=function(t){return h.n=0,this.getNum2(this.c3,h,t)},this.getNum2=function(t,i,e){if(i.n==e)return t;i.n++;for(var s=0;s<t.children.length;s++)if(null!=this.getNum2(t.children[s],i,e))return t.children[s];return null},this.generateRendom=function(t){null==t&&(t=2);let i,e="",s="";for(var n=0;n<t;n++){if((s=(255&(i=4294967295*Math.random()|0)).toString(16)+(i>>8&255).toString(16)+(i>>16&255).toString(16)+(i>>24&255).toString(16)).length<8)for(var r=0;r<8-s.length+1;r++)s+="Z";e+=s,n!=t-1&&(e+="-")}return e},this.uuid=this.generateRendom(2),this.initIz()}class O{constructor(t){var i=this;this.par=t,this.param=this.par.param,this.tipe="mat",this.type="Tovar",this.children=[],this.matBase=void 0,this._index=-1,this._material=null,this.ooo=void 0,this.resur=void 0,this.rObj=void 0,this.oooArray=[],this.setKusook=function(t){this.ooo=t,null!=this.ooo&&(-1==this.ooo.ct?this.oooArray=this.ooo.array:(null,this.param.obJscenes3d&&this.param.obJscenes3d[this.ooo.ct]?i.oooArray=this.param.obJscenes3d[this.ooo.ct].json.array:mhbd.getKeyId("scenes3d",this.ooo.ct,function(t){i.oooArray=t.json.array,i.dragIndex()})),this.dragIndex())},this.addChild=function(t){"mat"==this.tipe&&(null==this.matBase&&t&&null!=t.material&&(this.matBase=t.material,this._material=t.material),this.children.push(t)),"res"==this.tipe&&this.children.push(t)};var e=null;this.dragIndex=function(){if(null!=i.ooo&&null!=i.oooArray&&null!=i.oooArray[this._index])if("res"!=this.tipe){if("mat"==this.tipe){var t=this.matBase;i.oooArray[this._index]&&-1!=i.oooArray[this._index].d3MatId&&(e=void 0,null!=i.oooArray[this._index].d3MatColor&&(e={color:i.oooArray[this._index].d3MatColor}),t=i.par.par.par.matDop.getIDObj(i.oooArray[this._index].d3MatId,e)),i.material=t}}else i.par.par.par.iz.setMod(i.par.c3,this.children[this._index],!1)},this.axz=null,this.setResur=function(t){}}set material(t){if(null==this._material||this._material.uuid!=t.uuid){this._material=t;for(var i=0;i<this.children.length;i++)null!=this.children[i].material&&(this.children[i].material=this._material)}}get material(){return this._material}set index(t){this._index!=t&&(this._index=t,this.dragIndex())}get index(){return this._index}}function I(t,i,e){this.type="PM";this.objbase=i,this.visi3D=t,this.param=e,this.plus="?1",this.loaderGLTF=new THREE.GLTFLoader,this.tex=new B(this,t,i),this.mat=new n.a(this,t,i),this.filt=new P(this,t,i),this.iz=new R(this,t,i),this.matDop=new r(this,t,i),this.dop=new C(this,t,i),this.arrayHron=[],this.getId=function(t,i,e){if(1==e)for(var s=0;s<this.arrayHron.length;s++)1==this.arrayHron[s].testId(t)&&this.arrayHron.splice(s,1);for(s=0;s<this.arrayHron.length;s++)if(1==this.arrayHron[s].testId(t))return void this.arrayHron[s].setFun(i);this.arrayHron.push(new k(this,t,i))},this.clear=function(){}}function k(t,i,e){this.type="Hron";var s,n,r=this;if(this.par=t,this.idObj=i,this.id=void 0,this.object=void 0,this.link=void 0,this.filt=void 0,this.content3d=void 0,this.param=this.par.param,this.nameType=this.param.arrayName[0],this.objBig=void 0,this.array=[],this.array.push(e),this.boolClone=!0,this.setFun=function(t){if(null!=this.content3d)return(s=1==r.boolClone?r.content3d.clone():r.content3d).hron=this,this.par.iz.setHron(this,s),this.object.param&&this.par.filt.dragParam(s,this.object.param),this.par.iz.setHron(this,s),void t(s);this.array.push(t)},this.finalLoad=function(t){this.getObj3D(t),this.content3d=t,t.name="hron_"+this.id,this.par.mat.setObjS(this.content3d,this.object,this.finalLoad1)},this.finalLoad1=function(){r.par.filt.setObjS(r,r.finalLoad2)},this.finalLoad2=function(){for(var t=0;t<r.array.length;t++)(s=1==r.boolClone?r.content3d.clone():r.content3d).hron=r,r.par.iz.setHron(r,s),r.object.param&&r.par.filt.dragParam(s,r.object.param),r.par.iz.setHron(r,s),r.array[t](s)},this.loadObject=function(){},this.start=function(){if(null==this.object&&(this.object={}),null==this.object&&(this.object={}),null==this.object.res)this.finalLoad(new THREE.Object3D);else{var t=mhbd.getLink(this.object.res.src);this.par.loaderGLTF.load(t,function(t){r.finalLoad(t.scene)})}},this.testId=function(t){return n="number"==typeof t?t:t.id,(null==this.id?this.idObj.id:this.id)==n},this.getObj3D=function(i){if(null!=i.material&&null!=i.material.roughnessMap&&t.visi3D&&(i.material.envMap=t.visi3D.cubeMap.getTexture()),null!=i){if(null!=i.children)for(var e=i.children.length-1;e>=0;e--)this.getObj3D(i.children[e]);"Default_light"==i.name&&i.parent.remove(i)}},"object"==typeof i)return r.object=i,void this.start(i);"number"==typeof i&&(this.id=i),mhbd.getKeyId("objects3d",this.id,function(t){r.object=t.json,r.start()})}function j(t){this.type="SceneSB",this.visi3D=t;this.array=[],this.object=void 0,this.array.push(new V("ambient",t)),this.array.push(new N("shadow",t)),this.array.push(new G("sky",t)),this.array.push(new X("mirror",t)),this.array.push(new U("visi3D",t)),this.array.push(new Y("effect",t)),this.array.push(new W("fog",t)),this.setObj=function(t){this.object=t;for(var i=0;i<this.array.length;i++)void 0===this.object[this.array[i].name]&&(this.object[this.array[i].name]={}),this.array[i].setBasa(this.object[this.array[i].name]);visi3D.shadowNeedsUpdate=!0}}function H(t,i){this.type="SceneBox";this.name=t,this.array=[],this.object=null,this.objArray={},this.plus=function(t,i){this.array.push(new F(t,i)),this.objArray[t.param]=this.array[this.array.length-1]},this.setValue=function(t,i,e){null==e?this.object[t]=i:this.drahKeyParam(t,i)},this.drahKey=function(t){null==this.objArray.works||0!=this.object.works?(null!=this.objArray[t]&&(1==this.objArray[t].tipP&&("object"==typeof this.objArray[t].param[t]?this.objArray[t].param[t]=this.object[t]:this.objArray[t].param[t]!=this.object[t]&&(this.objArray[t].param[t]=this.object[t])),2==this.objArray[t].tipP&&this.objArray[t].param(this.object[t])),i.intRend=1):"active"==t&&this.objArray.active.param&&(this.objArray.active.param(this.object.active),i.intRend=1)},this.drahKeyParam=function(t,e){null!=this.objArray[t]&&(1==this.objArray[t].tipP&&("object"==typeof this.objArray[t].param[t]?this.objArray[t].param[t]=e:this.objArray[t].param[t]!=e&&(this.objArray[t].param[t]=e)),2==this.objArray[t].tipP&&this.objArray[t].param(e)),i.intRend=1},this.setBasa=function(t){this.object=t;for(var i=0;i<this.array.length;i++)null==t[this.array[i].object.param]&&(t[this.array[i].object.param]=this.array[i].object.valueStart);this.drahKeys()},this.drahKeys=function(){for(var t=0;t<this.array.length;t++)this.drahKey(this.array[t].object.param)},this.plus({name:"check10",typeParam:"DCheckBox",param:"works",title:"works//false не работает",valueStart:!0})}function F(t,i){this.type="SceneGron";this.object=t,this.param=i,this.tipP=0,null!=i&&("object"==typeof i&&(this.tipP=1),"function"==typeof i&&(this.tipP=2))}function N(t,i){H.call(this,t,i),this.type="SceneBox1";this.plus({name:"check",typeParam:"DCheckBox",param:"active",title:"active",valueStart:!1},function(t){i.utility.sunActiv(t)}),this.plus({name:"slider10",typeParam:"DSliderBig",param:"mapSize",title:"mapSize",min:64,max:8192,value:2048,okrug:1,valueStart:i.SHADOW_WH},function(t){t=t||i.SHADOW_WH,i.sunLight.shadow.mapSize.width!=t&&(i.sunLight.shadow.mapSize.width=t,i.sunLight.shadow.mapSize.height=t)}),this.plus({name:"color",typeParam:"DColor",param:"color",title:"color",valueStart:i.LIGHT_COLOR},function(t){var e=t;if("string"==typeof e&&-1!=e.indexOf("x")){var s=e.split("x");e="#"+s[1]}i.sunLight.color=new THREE.Color(e)}),this.plus({name:"slider",typeParam:"DSliderBig",param:"bias",title:"bias",min:-.05,max:.05,value:0,okrug:1e4,valueStart:i.LIGHT_BIAS},i.sunLight.shadow),this.plus({name:"slider1",typeParam:"DSliderBig",param:"intensity",title:"intensity",min:0,max:5,value:1,okrug:100,valueStart:i.SHADOW_INTENSITY},i.sunLight),this.plus({name:"slider2",typeParam:"DSliderBig",param:"radius",title:"radius",min:0,max:50,value:1,valueStart:i.SHADOW_RADIUS},i.sunLight.shadow),this.plus({name:"check2",typeParam:"DCheckBox",param:"bAlphaForCoating",title:"SAMPLE_ALPHA..",value:!0,valueStart:!1},function(t){var e=i.renderer.getContext();t?e.enable(e.SAMPLE_ALPHA_TO_COVERAGE):e.disable(e.SAMPLE_ALPHA_TO_COVERAGE)}),this.plus({name:"check3",typeParam:"DCheckBox",param:"fixation",title:"fixation",value:!1,valueStart:i.utility.FIXATION},i.utility),this.plus({name:"slider4",typeParam:"DSliderBig",param:"rotationX",title:"rotationX",min:-Math.PI,max:Math.PI,okrug:100,value:0,valueStart:i.utility.ROTATION_X},i.utility),this.plus({name:"slider5",typeParam:"DSliderBig",param:"rotationZ",title:"rotationZ",min:-Math.PI,max:Math.PI,okrug:100,value:0,valueStart:i.utility.ROTATION_Z},i.utility),this.plus({name:"slider6",typeParam:"DSliderBig",param:"distance",title:"distance",min:0,max:1e4,value:0,valueStart:i.utility.DISTANCE},i.utility),this.plus({name:"slider7",typeParam:"DSliderBig",param:"cubWidth",title:"cubWidth",min:10,max:1e4,value:0,valueStart:i.utility.CUB_WIDTH},i.utility),this.plus({name:"slider8",typeParam:"DSliderBig",param:"cubHeight",title:"cubHeight",min:10,max:1e4,value:0,valueStart:i.utility.CUB_HEIGHT},i.utility),this.plus({name:"slider9",typeParam:"DSliderBig",param:"distanceUpdateShadow",title:"distUpdateShadow ",min:-1,max:500,value:0,valueStart:i.utility.distanceUpdateShadow},i.utility)}function V(t,i){H.call(this,t,i);var e=this;this.type="SceneBox2",this.plus({name:"check",typeParam:"DCheckBox",param:"active",title:"active",valueStart:!0},function(t){i.utility.ambientActiv(t)}),this.plus({name:"color",typeParam:"DColor",param:"color",title:"color",tipParam:2,valueStart:i.AMBIEN_COLOR},function(t){var s=t;if("string"==typeof s&&-1!=s.indexOf("x")){var n=s.split("x");s="#"+n[1]}e.setValue(this.object.param,s),i.ambientLight.color=new THREE.Color(s)}),this.plus({name:"slider",typeParam:"DSliderBig",param:"intensity",title:"intensity",min:0,max:5,okrug:100,valueStart:i.AMBIEN_INTENSITY},i.ambientLight)}function G(t,i){H.call(this,t,i),this.type="SceneBox3";this.plus({name:"check",typeParam:"DCheckBox",param:"active",title:"active",valueStart:!1},function(t){i.utility.sky.active=t}),this.plus({name:"color",typeParam:"DColor",param:"color",title:"color",valueStart:i.utility.sky.COLOR},i.utility.sky),this.plus({name:"contLoader",typeParam:"DVisualLoader",param:"link",title:"LoadPic",valueStart:i.utility.sky.LINK},i.utility.sky),this.plus({name:"slider",typeParam:"DSliderBig",param:"radius",title:"radius",min:10,max:15e3,okrug:1,valueStart:i.utility.sky.RADIUS},i.utility.sky)}function X(t,i){H.call(this,t,i),this.type="SceneBox5";this.plus({name:"text1",typeParam:"DLabel",param:"xz",title:"Load",valueStart:"reflect"}),this.plus({name:"contLoader",typeParam:"DVisualLoader",param:"link",title:"Load",valueStart:"null"},function(t){i.cubeMap.link=t}),this.plus({name:"sliderExp",typeParam:"DSliderBig",param:"exposure",title:"exposure",min:-10,max:10,okrug:100,valueStart:-1},function(t){i.cubeMap.exposure=t}),this.plus({name:"slider1",typeParam:"DSliderBig",param:"gamma",title:"gamma//в хдр",min:-10,max:10,okrug:100,valueStart:-1},function(t){i.cubeMap.gamma=t}),this.plus({name:"text1",typeParam:"DLabel",param:"xz",title:"Load",valueStart:"refract"}),this.plus({name:"contLoader1",typeParam:"DVisualLoader",param:"link1",title:"Load",valueStart:"null"},function(t){i.cubeMap1.link=t}),this.plus({name:"sliderExp1",typeParam:"DSliderBig",param:"exposure1",title:"exposure",min:-10,max:10,okrug:100,valueStart:-1},function(t){i.cubeMap1.exposure=t}),this.plus({name:"slider2",typeParam:"DSliderBig",param:"gamma1",title:"gamma//в хдр",min:-10,max:10,okrug:100,valueStart:-1},function(t){i.cubeMap1.gamma=t})}function U(t,i){H.call(this,t,i),this.type="SceneBox6";var e=this;this.plus({name:"check0",typeParam:"DCheckBox",param:"alwaysRender",title:"autoRender",valueStart:!1},function(t){i.alwaysRender!==t&&(i.alwaysRender=t)}),this.plus({name:"slider",typeParam:"DSliderBig",param:"fov",title:"fov",min:0,max:90,okrug:1,valueStart:i.FOV}),this.plus({name:"slider1",typeParam:"DSliderBig",param:"far",title:"far",min:100,max:5e4,okrug:1,valueStart:i.FAR},function(t){i.camera.far!=t&&(i.camera.far=t,i.camera.updateProjectionMatrix())}),this.plus({name:"slider2",typeParam:"DSliderBig",param:"minZum",title:"minZum",min:0,max:2e4,okrug:1,valueStart:0},function(t){i.minZum=t,i.minZum>i.maxZum&&(i.maxZum=i.minZum,e.setValue("maxZum",t))}),this.plus({name:"slider3",typeParam:"DSliderBig",param:"maxZum",title:"maxZum",min:0,max:2e4,okrug:1,valueStart:2e4},function(t){i.maxZum=t,i.maxZum<i.minZum&&(i.minZum=i.maxZum,e.setValue("minZum",t))}),this.plus({name:"slider4",typeParam:"DSliderBig",param:"zume",title:"powerZum",min:1,max:2e4,okrug:1,valueStart:250}),this.plus({name:"slider11",typeParam:"DSliderBig",param:"powerZum",title:"zoom",min:1,max:100,okrug:1,valueStart:50},function(t){i.position3d.powerZum!==t&&(i.position3d.powerZum=t)}),this.plus({name:"slider5",typeParam:"DSliderBig",param:"minRotationX",title:"minAngel",min:0,max:3,okrug:100,valueStart:2.5},function(t){i.minRotationX!==t&&(i.minRotationX=t)}),this.plus({name:"slider6",typeParam:"DSliderBig",param:"maxRotationX",title:"maxAngel",min:0,max:3,okrug:100,valueStart:0},function(t){i.maxRotationX!==t&&(i.maxRotationX=t)}),this.plus({name:"check1",typeParam:"DCheckBox",param:"debug",title:"debug",valueStart:!0},function(t){i.utility.debug!==t&&(i.utility.debug=t)}),this.plus({name:"check2",typeParam:"DCheckBox",param:"isDragPan",title:"isDragPan",valueStart:!0},function(t){i.position3d.isDragPan!==t&&(i.position3d.isDragPan=t)}),this.plus({name:"check3",typeParam:"DCheckBox",param:"alphaAd",title:"alpha Админ для фотки",valueStart:!1}),this.plus({name:"slider7",typeParam:"DSliderBig",param:"zume",title:"zoom",min:5,max:2e3,okrug:1,valueStart:250},function(t){i.zume=t}),this.plus({name:"slider8",typeParam:"DSliderBig",param:"rotationX",title:"rotationX",min:-Math.PI,max:Math.PI,okrug:100,valueStart:0},function(t){i.rotationX=t}),this.plus({name:"slider9",typeParam:"DSliderBig",param:"rotationZ",title:"rotationZ",min:-Math.PI,max:Math.PI,okrug:100,valueStart:0},function(t){i.rotationZ=t}),this.plus({name:"slider10",typeParam:"DSliderBig",param:"globZ",title:"globZ",min:-1e3,max:1e3,okrug:1,valueStart:0},function(t){i.yVerh=t})}function Y(t,i){H.call(this,t,i),this.type="SceneBox7";this.plus({name:"check",typeParam:"DCheckBox",param:"active",title:"active",valueStart:!1},i.efect),this.plus({name:"slider",typeParam:"DSliderBig",param:"edgeStrength",title:"edgeStrength",min:0,max:10,okrug:100,valueStart:i.efect.edgeStrength},i.efect),this.plus({name:"slider1",typeParam:"DSliderBig",param:"edgeGlow",title:"edgeGlow",min:0,max:1,okrug:100,valueStart:i.efect.edgeGlow},i.efect),this.plus({name:"slider2",typeParam:"DSliderBig",param:"edgeThickness",title:"edgeThickness",min:0,max:5,okrug:100,valueStart:i.efect.edgeThickness},i.efect),this.plus({name:"slider3",typeParam:"DSliderBig",param:"pulsePeriod",title:"pulsePeriod",min:0,max:5,okrug:100,valueStart:i.efect.pulsePeriod},i.efect),this.plus({name:"contLoader",typeParam:"DVisualLoader",param:"linkTextur",title:"linkTextur",valueStart:i.efect.linkTextur},i.efect),this.plus({name:"color",typeParam:"DColor",param:"visibleEdgeColor",title:"vEdgeColor",valueStart:i.efect.visibleEdgeColor},i.efect),this.plus({name:"color1",typeParam:"DColor",param:"hiddenEdgeColor",title:"hEdgeColor",valueStart:i.efect.hiddenEdgeColor},i.efect)}function W(t,i){H.call(this,t,i),this.type="SceneBox9";i.sbfog=new Q(i),this.plus({name:"check",typeParam:"DCheckBox",param:"active",title:"active",valueStart:!1},function(t){i.sbfog.active=t}),this.plus({name:"color1",typeParam:"DColor",param:"color",title:"outlineColor1",valueStart:i.sbfog._color},function(t){var e=t;i.sbfog.color=e}),this.plus({name:"slider1",typeParam:"DSliderBig",param:"near",title:"near",min:0,max:1e4,okrug:1,valueStart:50},i.sbfog),this.plus({name:"slider2",typeParam:"DSliderBig",param:"far",title:"far",min:0,max:2e4,okrug:1,valueStart:100},i.sbfog)}function Q(t){this._active=!1,this._color="#ffffff",this._near=50,this._far=1e3,this.visi=t,this.fog=new THREE.Fog(this._color,this._near,this._far)}Q.prototype={set active(t){this._active!=t&&(this._active=t,1==this._active?this.visi.scene.fog=this.fog:this.visi.scene.fog=null)},get active(){return this._active},set color(t){this._color!=t&&(this._color=t,this.fog.color=new THREE.Color(t))},get color(){return this._color},set near(t){this._near!=t&&(this._near=t,this.fog.near=t)},get near(){return this._near},set far(t){this._far!=t&&(this._far=t,this.fog.far=t)},get far(){return this._far}};class Z{constructor(t,i){this.type="MCPodskazka";var e=this;this.fun=i,this.key="ru",this.time=700,this.timeTween=500,this.sahSim=0,this.dCont=new DCont(t),this.dC=new DCont,this.ss="white-space: pre;",this.otstup=5,this.panel=new DPanel(this.dC),this.panel.boolLine=!1,this.panel.color="#f7f7f7",this.panel2=new DPanel,this.panel2.width=this.panel2.height=0,e.div3=this.panel2.div;var s,n;this.label=new DLabel(this.panel,this.otstup,this.otstup,"asdfasdf"),this.label.div.setAttribute("style",this.ss),this.label.fontSize=12,this.tween=new TWEEN.Tween(this.dC),this.sobOver=function(t){e.startTime(e.time,this)},this.sobOut=function(t){e.stop()},this.array=[],this.setBuuton=function(t,i,e,r){if(null!=t.uuid){n=-1;for(var h=this.array.length-1;h>=0;h--)if(this.array[h].uuid==t.uuid){n=h;break}if(-1!=n)return void(this.array[n].objText=i)}null==t.uuid&&(t.uuid=this.generateRendom(2)),this.array.push(t),t.xzIdArr=this.array.lenght,t.objText=i,s=r||"fun_mouseout",t[e||"fun_mouseover"]=this.sobOver,t[s]=this.sobOut},this.setText=function(t){this.label.text=t;for(var i=t.split("\n"),e=0,s=0;s<i.length;s++){var n=this.getTextWidth(i[s]);n>e&&(e=n)}this.label.width=e,this.panel.width=e+2*this.otstup,this.panel.height=i.length*(this.label.fontSize+3)+2*this.otstup},this.generateRendom=function(t){null==t&&(t=2);let i,e="",s="";for(var n=0;n<t;n++){if((s=(255&(i=4294967295*Math.random()|0)).toString(16)+(i>>8&255).toString(16)+(i>>16&255).toString(16)+(i>>24&255).toString(16)).length<8)for(var r=0;r<8-s.length+1;r++)s+="Z";e+=s,n!=t-1&&(e+="-")}return e};var r,h,a,o=void 0;this.getTextWidth=function(t,i){if(0!=this.sahSim)return this.sahSim*t.length;let s=1==e.label.bold?"bold ":" normal ",n=e.label.fontSize+"px ",r=e.label.fontFamily+"",h=t||e.label.text,a=i||s+n+r+"";null==o&&(o=document.createElement("canvas"));var l=o.getContext("2d");return l.font=a,l.measureText(h).width},this.start=function(t){this.obj=t,t.objText&&t.objText[this.key]&&""!=t.objText[this.key]?(this.setText(t.objText[this.key]),this.dC.alpha=0,this.dCont.add(this.dC),this.tween.stop(),this.tween.to({alpha:1},this.timeTween).start(),this.sizeWindow()):this.stop()},this.stop=function(){this.sah=Math.random(),null!=this.dC.parent&&this.dC.parent.remove(this.dC)},this.sah=0,this.startTime=function(t,i){null==t&&(t=500),this.stop(),this.sah=Math.random();var s=this.sah;setTimeout(function(){e.sah==s&&e.start(i)},t)},this.sizeWindow=function(t,i,s){var n,o,l,u;if(t&&(r=t,h=i,a=s),this.obj&&this.dC.parent){var c=this.obj.div.getBoundingClientRect();e.div3.style.borderStyle="solid",h/a/2>c.y?(this.dC.y=c.y/a+this.obj.height,l=0,u=8.7,this.panel.y=u,this.panel2.y=l):(this.dC.y=c.y-this.panel.height,l=8.7,u=0,this.panel.y=-l,this.panel2.y=this.panel.height-l),r/a/2>c.x?(this.dC.x=c.x/a,o=n=5,this.panel2.x=this.obj.width/2-o/2):(this.dC.x=c.x-this.panel.width+this.obj.width,o=n=5,this.panel2.x=this.panel.width-(o/2+this.obj.width/2)),e.div3.style.borderColor="#ffffff transparent #ffffff transparent",e.div3.style._borderColor="#000000 #000000 #000000 #000000",e.div3.style.borderWidth=l+"px "+n+"px "+u+"px "+o+"px",e.div3.style.filter="progid:DXImageTransform.Microsoft.Chroma(color='#000000')"}}}}class K{constructor(t,i){this.type="MVerh";var e,s;this.par=t,this.fun=i,this.param=this.par.param,this.dCont1=new DCont,this.par.dCont.add(this.dCont1),this.otstup=this.param.otstup,this._active=!1,this.down=function(){},this.panel,this.init=function(){null==this.dCont&&(this.dCont=new DCont,!0===window.localS.object.debug&&(this.button=new DButton(this.dCont,0,this.otstup,"TĘSTI",function(){}),this.button.height=this.param.wh,this.button.width=150,this.button.color=this.param.colorActive,new q(this)))},this.sizeWindow=function(t,i,n){t&&(e=t,i,s=n),this.button&&(this.dCont.x=e/s-this.otstup-this.button.width)}}set active(t){this._active!=t&&(this._active=t,1==this._active?(this.init(),this.dCont1.add(this.dCont)):this.dCont1.remove(this.dCont))}get active(){return this._active}set indexStep(t){if(this._indexStep!=t){this._indexStep=t,this.init();for(var i=-1,e=0;e<this.gallery.array.length;e++)if(1*this.gallery.array[e].object.tId==t){i=e;break}this.gallery.index=i}}get indexStep(){return this._indexStep}}class q{constructor(t,i){this.type="MXZ";var e=this;this.par=t,this.fun=i,this.param=this.par.param,this.otstup=this.param.otstup,this.otstup1=this.param.otstup,this.wh=this.param.wh,this.width=150,this.height=40,this.dCont=new DCont(t.dCont),this.dCont.y=this.param.wh+3*this.otstup,this.label=new DLabel(this.dCont,this.otstup,0),this.label.activMouse=!1,this.label.width=this.width-2*this.otstup,this.label.textAlign="center",1==window.localS.object.debug&&(this.label1=new DLabel(this.dCont,this.otstup,dcmParam.fontSize+2*this.otstup),this.label1.activMouse=!1,this.label1.width=this.width,this.label1.textAlign="center"),window.mxz=this,this.funFDO=function(){for(var t=0,i=0;i<e.sp.arrSplice.length;i++)1==e.sp.arrSplice[i].life&&1==e.sp.arrSplice[i].boolAree&&(t+=e.sp.arrSplice[i].arrayClass[0].arrGrani[0].area);var s=0;for(i=0;i<e.sp.worldBlok.array.length;i++)1==e.sp.worldBlok.array[i].life&&void 0!==e.sp.worldBlok.array[i].prase&&(s+=e.sp.worldBlok.array[i].prase);e.label.text=Math.round(t/1e3)+" m²",1==window.localS.object.debug&&(e.label1.text=Math.round(100*s)/100+" $")},setTimeout(function(){e.sp=facade.sp,e.sp.funFDO=e.funFDO,e.funFDO()},10)}}class J{constructor(t,i){this.type="MLeftGal";var e=this;this.par=t,this.fun=i,this.param=this.par.param,this.dCont1=new DCont,this.par.dCont.add(this.dCont1),this.otstup=this.param.otstup,this._active=!1,this.dCont=void 0,this.oInfo=void 0,this.down=function(){e.fun("indexStep",1*this.array[this.index].object.tId)},this.init=function(){if(null==this.dCont){if(this.dCont=new DCont,this.oInfo=mhbd.objectBase.three.json.three,0==window.localS.object.debug){let t=this.oInfo.array.length-1;this.oInfo.array.splice(t,1)}this.gallery=new tt(this.dCont,0,this.otstup,this.down,this),this.gallery.kolII=1,this.gallery.color=dcmParam.color1,this.gallery.color1=dcmParam.color1,this.gallery.widthPic=this.param.wb1,this.gallery.heightPic=this.param.wh,this.gallery.width=this.param.wb1,this.gallery.height=this.param.wh*this.oInfo.array.length,this.gallery.x=this.widthBig,this.gallery.y=-this.otstup,this.gallery.otstup=0,this.gallery.finalLink=this.linkF,this.gallery.boolScale=this.boolScale,this.gallery.start(this.oInfo.array),this.gallery.panel.visible=!1}},this.sizeWin=function(t,i,e){t&&(t,i,e)}}set active(t){this._active!=t&&(this._active=t,1==this._active?(this.init(),this.dCont1.add(this.dCont)):this.dCont1.remove(this.dCont))}get active(){return this._active}set indexStep(t){if(this._indexStep!=t){this._indexStep=t,this.init();for(var i=-1,e=0;e<this.gallery.array.length;e++)if(1*this.gallery.array[e].object.tId==t){i=e;break}this.gallery.index=i}}get indexStep(){return this._indexStep}}class tt extends DGallery{constructor(t,i,e,s,n){super(t,i,e,s),this.par=n,this.createZamen=function(){var t=new it(this.content,0,0,this.downBtn,this.intText,this);return t.whPic=this.whPic,t.finalLink=this.finalLink,t}}}function it(t,i,e,s,n,r){DBox.call(this,t,i,e,s),this.type="BoxXZ";var h,a,o,l=this;this.par=r,this.param=this.par.par.param,this.startLoad=function(t){this.object=t,a=mhbd.getKeyId(t.key,t.id),h=mhbd.getLink(a.icon),this.image.link=h,this.image.visible=!0,this.label.bold=!0,this.label.activMouse=!1,this.label.text=a[languages.key],this.label.visible=!0,this.panel.alpha=this.param.alpha,l.funLoad()},this.draw=function(){(o=(this._width-2*this.param.otstup)/this.image.picWidth)>(this._height-2*this.param.otstup)/this.image.picHeight&&(o=(this._height-2*this.param.otstup)/this.image.picHeight),this.image.x=0,this.image.width=this.image.height=this._height-2*this.param.otstup,this.image.x=this.param.otstup,this.image.y=(this._height-this.image.picHeight*o)/2,this.label.x=2*this.param.otstup+this.image.width,this.label.y=(this._height-this.label._fontSize)/2,this.postDraw&&this.postDraw()}}it.prototype=Object.create(DBox.prototype),it.prototype.constructor=it,Object.defineProperties(it.prototype,{activ:{set:function(t){this._activ!=t&&(this._activ=t,0==this._activ?(this.panel.color1=this._color1,this.panel.alpha=this.param.alpha):(this.panel.color1=this._color,this.panel.alpha=1.75*this.param.alpha))},get:function(){return this._activ}}});class et{constructor(t,i){this.type="MOBaza",this.typeNa="xz";this.par=t,this.fun=i,this._active=!1,this.otstup=this.par.otstup,this.otstup1=this.par.otstup1,this.wh=this.par.wh,this.width=this.par.width,this.whSize=500,this.dCont=new DCont(t.dCont),this.dCont.visible=this._active,this.object=void 0,this.postSO=void 0,this.postIn=void 0,this.init=function(){null==this.window&&(this.whSize=this.par.whSize,this.window=new DWindow(this.dCont,0,0,"xz"),this.window.width=this.width,this.window.hasMinimizeButton=!1,this.window.dragBool=!1,null!=this.postIn&&this.postIn())},this.setObject=function(t){this.object=t,this.active=!0,this.init(),null!=this.postSO&&this.postSO()},this.drag=function(){},this.clear=function(){this.active=!1}}set active(t){this._active!=t&&(this._active=t,this.dCont.visible=t)}get active(){return this._active}}class st extends et{constructor(t,i){super(t,i),this.type="MOPoint",this.typeNa="SpPointSten";var e=this;this.dCont=new DCont(t.dCont),this.button=void 0,this.slid,this.slid1,this.bool=!0,this.postIn=function(){this.window.title="Point(DEBAG)";var t=this.otstup;this.slid=new DSliderBig(this.window.content,this.otstup,t,function(t){e.bool=!1,e.object.position.x=e.slid.value,e.object.dragPost(),visi3D.intRend=1},"x",-this.whSize/2,this.whSize/2),this.slid.width=this.width-2*this.otstup,this.slid.okrug=1,this.slid.funChange=function(){e.bool=!0,e.drag()},t+=this.slid.height+this.otstup,this.slid1=new DSliderBig(this.window.content,this.otstup,t,function(t){e.bool=!1,e.object.position.y=e.slid1.value,e.object.dragPost(),visi3D.intRend=1},"y",-this.whSize/2,this.whSize/2),this.slid1.width=this.width-2*this.otstup,t+=this.slid.height+this.otstup,this.window.height=t+32,this.slid1.okrug=1,this.slid1.funChange=function(){e.bool=!0,e.drag()}},this.drag=function(){0!=e.bool&&(trace("###"),e.slid.value=Math.round(e.object.position.x),e.slid1.value=Math.round(e.object.position.y))},this.postSO=function(){this.bool=!0,this.object.arrayClass[0].funDragMenu=this.drag,this.drag()},this.clear=function(){null!=this.object&&(this.bool=!0,this.object.arrayClass[0].funDragMenu=void 0),this.active=!1},this.sizeWindow=function(t,i,e){this.dCont.x=t/e-this.width}}set index(t){this._index!=t&&(this._index=t)}}class nt extends et{constructor(t,i){super(t,i),this.type="MOTCompArrow",this.typeNa="TCompArrow";var e=this;this.dCont=new DCont(t.dCont),this.button=void 0,this.slid,this.slid1,this.bool=!0,this.postIn=function(){this.window.title="MOTCompArrow(DEBAG)";this.otstup;this.pObject=new DParamObject(this.window.content,this.otstup,this.otstup,function(){visi3D.intRend=1},1),this.pObject.width=this.window.width-2*this.otstup,this.pObject.otstup=this.otstup},this.drag=function(){0!=e.bool&&(this.pObject.addObject(e.object),this.window.height=this.pObject.w.y+this.pObject.finalHeight+this.otstup+32)},this.postSO=function(){this.bool=!0,this.drag()},this.clear=function(){null!=this.object&&(this.bool=!0),this.active=!1},this.sizeWindow=function(t,i,e){this.dCont.x=t/e-this.width}}set index(t){this._index!=t&&(this._index=t)}}class rt extends et{constructor(t,i){super(t,i),this.type="MOTCompArrow",this.typeNa="TComp3But";var e=this;this.dCont=new DCont(t.dCont),this.button=void 0,this.slid,this.slid1,this.bool=!0,this.array=[],this.postIn=function(){this.window.title="MOTCompArrow(DEBAG)",this.pObject=new DParamObject(this.window.content,this.otstup,this.otstup,function(){visi3D.intRend=1},1),this.pObject.width=this.window.width-2*this.otstup,this.pObject.otstup=this.otstup;for(var t=0;t<4;t++)this.array[t]=new DParamObject(this.window.content,this.otstup,this.otstup,function(){visi3D.intRend=1},1),this.array[t].width=this.window.width-2*this.otstup,this.array[t].otstup=this.otstup},this.drag=function(){if(0!=e.bool){this.array[0].addObject(e.object),this.array[1].addObject(e.object.button),this.array[2].addObject(e.object.button1),this.array[3].addObject(e.object.button2);for(var t=this.otstup,i=0;i<this.array.length;i++)this.array[i].w.y=t,t+=this.array[i].finalHeight+this.otstup;this.window.height=t+this.otstup+32}},this.postSO=function(){this.bool=!0,this.drag()},this.clear=function(){null!=this.object&&(this.bool=!0),this.active=!1},this.sizeWindow=function(t,i,e){this.dCont.x=t/e-this.width}}set index(t){this._index!=t&&(this._index=t)}}class ht extends et{constructor(t,i){super(t,i),this.type="MOBlok",this.typeNa="BInSten";var e=this;this.dCont=new DCont(t.dCont),this.button=void 0,this.slid,this.slid1,this.bool=!0,this.array=[],this.postIn=function(){this.window.title="MOBlok",this.array[0]=new DSliderBig(null,5,5,function(){e.object.width=this.value,e.object.render()},"width",10,500),this.window.addD(this.array[0]),this.array[1]=new DSliderBig(null,5,5,function(){e.object.height=this.value,e.object.render()},"height",10,500),this.window.addD(this.array[1]),this.array[2]=new DSliderBig(null,5,5,function(){e.object.delph=this.value,e.object.render()},"delph",10,500),this.window.addD(this.array[2])},this.drag=function(){0!=e.bool&&(this.array[0].value=e.object.width,this.array[1].value=e.object.height,this.array[2].value=e.object.delph,this.array[2].activMouse=e.object.amDelph,trace(e.object))},this.postSO=function(){this.bool=!0,this.drag()},this.clear=function(){null!=this.object&&(this.bool=!0),this.active=!1},this.sizeWindow=function(t,i,e){this.dCont.x=t/e-this.width}}set index(t){this._index!=t&&(this._index=t)}}function at(t,i,e,s,n){DSettings.call(this),this.type="DParamObject",null==dcmParam&&(dcmParam=new DCM),dcmParam.add(this);var r,h,a=this;for(var o in this.fun=s,this._x=i||0,this._y=e||0,this.cont=t,this.infoInt=-1,this.arrayLabel=[],this._height=100,this._bWindow=null==n,this._ignTypeArr=!1,this._actIgnBtn=!1,this._title="DParamObject1",this._priorityType=!1,this._isScroll=!1,this.arrayColor=[],this.oShablon=[],this.textJSON="{}",this.objJSON={},this.funMinimize,this.funKorektObj=void 0,this.parrentPLPO=void 0,this.tipRide=!1,this.oP,this.ignBtn,this.wh=dcmParam.wh,this.w,this.typeArray=[],this.typeNotArray=null,this.typeYesArray=null,this.usingShablon=[],this.hhhhh=this._height,this._bWindow?this.w=new DWindow(this.cont,this._x,this._y,this._title,function(){a.funMinimize&&(1==this.minimize?a._height=1:(a.draw(),a._height=a.finalHeight),a.funMinimize())}):this.w=new DPanel(this.cont,this._x,this._y),this.window=this.w,this.w.content.add(this.content),this.w.drag=!1,this.w.width=this.width,this.w.height=this.height,this.w.drag=!1,this._height=this.wh,this.arrType=["label","numbercolor","boolean","number","string","comboBox"],this.arrType)this.oShablon[o]=[];this.addObject=function(t,i){if(trace("@@@@@@@@@",t),null!=i&&(this.tipRide=i),this.oP=t,this.oShablon=[],0==this.usingShablon.length){trace("@@@@@@@@@",t);for(var e=0;e<this.arrType.length;e++)this.oShablon[this.arrType[e]]=[];this.generatShablon(),this.clearShablon(),this.creatToShablon(),this.startToShablon(),this.draw2(),this.setTextInput()}else this.creatUsingShablon()},this.clearShablon=function(t){var i,e,s;if(trace(t),null!=this.typeYesArray&&0==this._ignTypeArr){for(i=0;i<this.arrType.length;i++)for(r=this.oShablon[this.arrType[i]],e=0;e<r.length;e++){for(l=!0,s=0;s<this.typeYesArray.length;s++)r[e]==this.typeYesArray[s]&&(l=!1);1==l&&(r.splice(e,1),s=999,e=-1)}for(var n in this.oShablon){for(l=!0,i=0;i<this.arrType.length;i++)this.arrType[i]==n&&(l=!1);if(1==l)for(r=this.oShablon[n],i=0;i<r.length;i++){for(var a in h=!0,this.oP)if(this.oP[a]==r[i])for(s=0;s<this.typeYesArray.length;s++)a==this.typeYesArray[s]&&(h=!1,s=999);1==h&&(r.splice(i,1),i=-1)}}}if(null!=this.typeNotArray&&0==this._ignTypeArr){for(i=0;i<this.arrType.length;i++)for(r=this.oShablon[this.arrType[i]],e=0;e<r.length;e++)for(s=0;s<this.typeNotArray.length;s++)r[e]==this.typeNotArray[s]&&(r.splice(e,1),s=999,e=-1);for(var n in this.oShablon){for(l=!0,i=0;i<this.arrType.length;i++)this.arrType[i]==n&&(l=!1);if(1==l)for(r=this.oShablon[n],i=0;i<r.length;i++)for(var a in this.oP)if(this.oP[a]==r[i])for(s=0;s<this.typeNotArray.length;s++)a==this.typeNotArray[s]&&(r.splice(i,1),i=-1)}}},this.draw2=function(){this.hhhhh=this.finalHeight,null!=this.parrentPLPO&&(this.hhhhh=this.finalHeight+pl102.wh-this._otstup),0==this.infoInt&&(this.initTA(),this.textArea.y=this.finalHeight,this.hhhhh+=this.textArea.height+4),null!=this.ignBtn&&(this.ignBtn.x=this.w.width-this.ignBtn.width-3),this.w.height=this.hhhhh+(this._bWindow?dcmParam.wh:0),this._height=this.w.height,a.updateScroll()},this.generatShablon=function(){var t,i;1==this.tipRide?(t=this.oP,this.generatShablon2(t)):(i=Object.getOwnPropertyNames(Object.getPrototypeOf(this.oP)),Object.getOwnPropertyNames(this.oP),this.generatShablon2(i))},this.generatShablon2=function(t){for(var i in trace(t),t)1!=this.tipRide&&(i=t[i]),"constructor"!=i&&(n=typeof this.oP[i],n=this.addPrefix(n,i,this.oP[i]),null!=this.oP[i+"CB"]&&(n="comboBox"),this.oShablon[n]&&this.oShablon[n].push(i));for(var e in this.oP)if(null!=this.oP[e]&&"object"==typeof this.oP[e])for(var s=0;s<this.typeArray.length;s++)this.oP[e]instanceof this.typeArray[s].type&&(n=this.typeArray[s].name,null==this.oShablon[n]&&(this.oShablon[n]=[]),null!=this.typeArray[s].nameComp?(this.oShablon[n].push(e.replace("_","")),-1==this.arrType.indexOf(n)&&this.arrType.push(n)):this.oShablon[n].push(this.oP[e]));for(var n in this.oShablon)this.oShablon[n].sort()},this.component,this.arrPLPO=[],this.addComponent2=function(t,i,e){for(var s=!1,n=this.typeArray,r=0;r<n.length;r++)-1!=i.indexOf(n[r].name)&&null==n[r].nameComp&&(s=!0);1==s&&(this.component=new PLParamObject(this.content,this.otstup,0,this.down,1),this.component.otstup=this.otstup,this.arrPLPO.push(this.component),this.arrPLPO[this.arrPLPO.length-1].idArr=this.arrPLPO.length-1,this.component.parrentPLPO=this,this.component.width=this._width-2*this.otstup,this.component.funMinimize=this.funMin,null!=e&&(null!=e.title&&(this.component.title=e.title),null!=e.tipRide&&(this.component.tipRide=e.tipRide)),null!=this.dinFun&&(this.component.dinFun=this.dinFun))},this.funMin=function(t){a.funMinimize&&(a.draw(),a._height=this.hhhhh,a.funMinimize())},this.reDragObject=function(t){},this.creatToShablon=function(){for(var t in this.oShablon)for(var i=0;i<this.oShablon[t].length;i++)this.addTypeComp(t,i,this.oShablon[t][i])},this.addTypeComp=function(t,i,e){var s,n;if("boolean"==t&&(s="DCheckBox"),"numbercolor"==t&&(s="DColor"),"number"==t&&(s="DSliderBig"),"string"==t&&(s="DStringDrag"),"object"==t&&(s="DParamObject"),"comboBox"==t&&(s="DComboBox"),e&&"string"==t&&e)for(var r=0;r<this.arrayLabel.length;r++)this.arrayLabel[r]==e&&(s="DLabel");for(r=0;r<this.typeArray.length;r++)this.typeArray[r].name==t&&(s="DParamObject",null!=this.typeArray[r].nameComp&&(s=this.typeArray[r].nameComp));null==this.objComp[t+i]&&s&&(n=this.addComponent(s,t+i),this.funDragSlider(n))},this.textArea=void 0,this.initTA=function(){null==this.textArea&&(this.textArea=new DTextArea(this.w.content,2,2),this.textArea.width=this.w.width-4,this.textArea.height=75,this.textArea.fontSize=10)},this.setTextInput=function(){0==this.infoInt&&(this.objJSON=this.getObjStr(),this.textJSON=JSON.stringify(this.objJSON),this.initTA(),a.textArea.text=this.textJSON)},this.getObjStr=function(){var t,i={};for(var e in a.oShablon)for(var s=0;s<a.oShablon[e].length;s++){t=!1;for(var n=0;n<this.arrType.length;n++)this.arrType[n]==e&&(t=!0);if(0==t){for(n=0;n<this.arrComp2.length;n++)if("DParamObject"==this.arrComp2[n].type)for(var r in this.oP)this.oP[r]==this.arrComp2[n].param&&(i[r]=this.arrComp2[n].getObjStr())}else i[a.oShablon[e][s]]=a.oP[a.oShablon[e][s]]}return i},this.setObjStr=function(t){var i=JSON.parse(t);a.setObjStr2(i),a.korektObjParamMinMax(),a.funD&&a.funD()},this.setObjStr2=function(t){for(var i in t)if(null!=a.oP[i])if("object"==typeof a.oP[i])for(var e=0;e<this.arrComp2.length;e++)this.arrComp2[e].param==a.oP[i]&&this.arrComp2[e].setObjStr2(t[i]);else a.oP[i]=t[i],null!=a.objComp[i]&&(a.objComp[i].value=t[i]);this.korektObjParam()},this.korektObjParamMinMax=function(){if(0==this.usingShablon.length){if(null!=this.object&&null!=this.object.param)for(var t=0;t<this.arrComp2.length;t++)if(null!=this.object.param[this.arrComp2[t].param]&&"DSliderBig"==this.arrComp2[t].type){if(!1===slider.isDinamMinMax)return;this.omm=this.diapozon(this.oP[this.arrComp2[t].param]),this.arrComp2[t].min=this.omm.min,this.arrComp2[t].max=this.omm.max}a.korektObjParam()}},this.componentS,this.funComplit=function(t){null==t&&(t=a.compFinal),this.component=this,a.componentS=t,a.funDragSlider(this),a.setTextInput(),a.fun&&a.fun(t)},this.funD,this.funDrag=function(){a.funD&&a.funD()},this.pointObject={min:0,max:100},this.arrayNum=[-1e7,-1e6,-1e5,-1e4,-5e3,-1e3,-500,-100,-50,-1,0,1,50,100,500,1e3,5e3,1e4,1e5,1e6,1e7];var l;this.diapozon=function(t){if(0==this.usingShablon.length){this.pointObject.min=0,this.pointObject.max=10;for(var i=1;i<this.arrayNum.length-1;i++)if(this.arrayNum[i]==t)return this.pointObject.min=this.arrayNum[i-1],this.pointObject.max=this.arrayNum[i+1],this.pointObject;for(i=1;i<this.arrayNum.length-1;i++)if(this.arrayNum[i-1]<t&&this.arrayNum[i]>t)return this.pointObject.min=this.arrayNum[i-1],this.pointObject.max=this.arrayNum[i],this.pointObject;return this.pointObject}},this.omm,this.funDragSlider=function(t){if(t&&0==this.usingShablon.length&&"DSliderBig"==t.type){if(!1===t.isDinamMinMax)return;0==t.visiMinMax&&(t.visiMinMax=!0),this.omm=this.diapozon(t.value),t.min=this.omm.min,t.max=this.omm.max,t.value=t.value}},this.addPrefix=function(t,i,e){if("string"==t&&null!=e&&e.length<9){if(-1!=e.toLowerCase().indexOf("#"))return"numbercolor";if(-1!=e.toLowerCase().indexOf("0x"))return"numbercolor"}return t},this.formComp=function(t,i,e,s){var n={name:t+i,param:e,title:e};"number"==t&&(this.omm=this.diapozon(this.oP[e]),n.max=this.omm.max,n.min=this.omm.min),l=!1;for(var r=0;r<this.arrType.length;r++)this.arrType[r]==t&&(l=!0);if(0==l){for(var h in this.oP)if(this.oP[h]==e){n.title=h,n.tipRide=!1;for(var a=0;a<this.typeArray.length;a++)null!=this.typeArray[a].tipRide&&e instanceof this.typeArray[a].type&&(n.tipRide=this.typeArray[a].tipRide),null!=this.typeArray[a].typeYesArray&&e instanceof this.typeArray[a].type&&(n.typeYesArray=this.typeArray[a].typeYesArray),null!=this.typeArray[a].typeNotArray&&e instanceof this.typeArray[a].type&&(n.typeNotArray=this.typeArray[a].typeNotArray)}}else for(var o=0;o<this.typeArray.length;o++)t==this.typeArray[o].name&&null!=this.typeArray[o].typeYesArray&&(n.typeYesArray=this.typeArray[o].typeYesArray);"comboBox"==t&&(n.array=this.oP[e+"CB"][0],n.valueS=this.oP[e+"CB"][1]),s.arrComp.push(n)},this.startToShablon=function(){this.omm=this.diapozon(100);var t,i={};if(i.arrComp=[],a.object=i,1==this._priorityType&&0==this._ignTypeArr&&null!=this.typeYesArray){for(var e in o=[],this.oShablon)for(var s=0;s<this.oShablon[e].length;s++){if(t="null","string"==typeof this.oShablon[e][s])t=this.oShablon[e][s];else for(var n in this.oP)this.oP[n]==this.oShablon[e][s]&&(t=n);o.push(this.oShablon[e][s],e,t)}for(var r=0;r<this.typeYesArray.length;r++){t=this.typeYesArray[r];for(s=0;s<o.length;s+=3)t==o[s+2]&&this.formComp(o[s+1],r,o[s+2],i);0}}else for(var h in this.oShablon)for(s=0;s<this.oShablon[h].length;s++)this.formComp(h,s,this.oShablon[h][s],i);if(null!=this.typeYesArray&&0==this._ignTypeArr){var o=[];for(s=0;s<this.typeYesArray.length;s++)for(var l=0;l<i.arrComp.length;l++)if(i.arrComp[l].param==this.typeYesArray[s]){o.push(i.arrComp[l]);break}i.arrComp=o}i.param=this.oP,i.fun=this.funDrag,i.funComplit=this.funComplit,null!=this.funKorektObj&&this.funKorektObj(i),this.setObj(i)},this.creatUsingShablon=function(){for(var t=0;t<this.usingShablon.length;t++)0==this.isComp(this.usingShablon[t].tipe,this.usingShablon[t].name)&&this.addComponent(this.usingShablon[t].tipe,this.usingShablon[t].name,this.usingShablon[t]._param);var i={};i.arrComp=this.usingShablon,i.param=this.oP,i.fun=this.funDrag,i.funComplit=this.funComplit,null!=this.funKorektObj&&this.funKorektObj(i),this.setObj(i)},this.funWH=function(){this.w&&(this.w.width=this.width)},this.getObj=function(){};this.ignBtn,this.createIgnBtn=function(){1==this._bWindow&&(this.ignBtn=new DButton(this.w,0,0,"+",function(){a.ignTypeArr=!a._ignTypeArr,1==a._ignTypeArr?this.text="-":this.text="+",a.funMinimize&&(a.w.minimize&&(a.w.minimize=!1),a.draw(),a._height=this.hhhhh,a.funMinimize())}),this.ignBtn.width=this.ignBtn.height=15,this.ignBtn.visible=this._actIgnBtn,this.ignBtn.y=7)},1==this._actIgnBtn&&this.createIgnBtn(),this._heightWindow=100,this.updateScroll=function(){if(this.scrollPane&&this.isScroll){for(var t=this.finalHeight,i=0;i<this.arrComp2.length;i++)if(this.arrComp2[i].visible&&this.arrComp2[i].pLColorPickerPanel&&this.arrComp2[i].pLColorPickerPanel.visible){var e=this.arrComp2[i].y+this.arrComp2[i].pLColorPickerPanel.y+this.arrComp2[i].pLColorPickerPanel.height;e>t&&(t+=e-t);break}this.scrollPane.width=this._width,this.scrollPane.widthContent=this._width,this.scrollPane.height=this._heightWindow,this.scrollPane.heightContent=t,this.scrollPane.update(),this.hhhhh=a._heightWindow,a._height=this.hhhhh}},this.initScroll=function(){null!=this.w&&null==this.scrollPane&&(this.scrollPane=new ScrollPane(this.w.content,0,0),this.scrollPane.addContent(this.content),this.scrollPane.boolPositOtctup=!0,a.updateScroll())}}at.prototype.constructor=at,Object.defineProperties(at.prototype,{x:{set:function(t){this._x=t,this.w&&(this.w.x=this._x)},get:function(){return this._x}},y:{set:function(t){this._y=t,this.w&&(this.w.y=this._y)},get:function(){return this._y}},height:{set:function(t){},get:function(){return this._height}},heightWindow:{set:function(t){this._heightWindow=t,this.updateScroll()},get:function(){return this._heightWindow}},visible:{set:function(t){this._visible=t,this.w&&(this.w.visible=this._visible)},get:function(){return this._visible}},title:{set:function(t){this._title!=t&&(this._title=t,this.w&&(this.w.text=this._title))},get:function(){return this._title}},ignTypeArr:{set:function(t){this._ignTypeArr!=t&&(this._ignTypeArr=t,this.addObject(this.oP))},get:function(){return this._ignTypeArr}},actIgnBtn:{set:function(t){this._actIgnBtn!=t&&(this._actIgnBtn=t,this.ignBtn||this.createIgnBtn(),null!=this.ignBtn&&(this.ignBtn.visible=this._actIgnBtn))},get:function(){return this._actIgnBtn}},priorityType:{set:function(t){this._priorityType!=t&&(this._priorityType=t,this.addObject(this.oP))},get:function(){return this._priorityType}},isScroll:{set:function(t){this._isScroll!=t&&(this._isScroll=t,this.initScroll())},get:function(){return this._isScroll}}});class ot extends et{constructor(t,i){super(t,i),this.type="MOBInLes",this.typeNa="BInLes";var e=this;this.param=this.par.param,this.dCont=new DCont(t.dCont),this.button=void 0,this.slid,this.slid1,this.bool=!0,this.array=[],this.postIn=function(){this.window.title="BInLes",this.oInfo=mhbd.objectBase.three.json.three;var t=[];let i=this.getName(this.oInfo,"a5525d90-71d0a947");"a5525d90-71d0a947"==i.uuid&&(t=i.array);for(var s=0;s<i.array.length;s++)"a5525d90-71d0a947"==i.array[s].uuid&&(t=i.array[s].array);this.gallery=new lt(this.window.content,this.otstup,this.otstup,function(){e.object.sah=this.index,mxz.funFDO()}),this.gallery.kolII=3,this.gallery.widthPic=64,this.gallery.heightPic=64,this.gallery.width=this.otstup+(this.gallery.widthPic+this.otstup)*this.gallery.kolII,this.gallery.height=this.otstup+1*(this.gallery.widthPic+this.otstup),this.gallery.start(t)},this.getName=function(t,i){if(t.uuid==i)return t;if(t.array)for(var e=0;e<t.array.length;e++){if(null!=this.getName(t.array[e],i))return t.array[e]}return null},this.drag=function(){0!=e.bool&&(this.gallery.index=e.object.sah,trace(e.object))},this.postSO=function(){this.bool=!0,this.drag()},this.clear=function(){null!=this.object&&(this.bool=!0),this.active=!1},this.sizeWindow=function(t,i,e){this.dCont.x=t/e-this.width}}set index(t){this._index!=t&&(this._index=t)}}class lt extends DGallery{constructor(t,i,e,s){super(t,i,e,s),this.createZamen=function(){var t=new ut(this.content,0,0,this.downBtn,this.intText,this);return t.whPic=this.whPic,t.finalLink=this.finalLink,t}}}function ut(t,i,e,s,n,r){DBox.call(this,t,i,e,s),this.type="BoxXZ";var h,a,o=this;this.startLoad=function(t){this.object=t,a=mhbd.getKeyId(t.key,t.id),h=mhbd.getLink(a.icon),this.image.link=h,this.image.visible=!0,o.funLoad(),this.objText.ru=t.name},0==dcmParam.mobile&&(this.panel.div.removeEventListener("mouseout",this.mouseOut),this.image.image.removeEventListener("mouseout",this.mouseOut),this.panel.div.removeEventListener("mouseover",this.mouseOver),this.image.image.removeEventListener("mouseover",this.mouseOver)),this.funOut=void 0,this.funOver=void 0,this.mouseOver=function(t){o.boolOut=!1,0==o._activ?null==o.color1_1?o.panel.color1=dcmParam.compToHexArray(dcmParam.hexDec(o._color1),-30):o.panel.color1=o.color1_1:null==o.color_1?o.panel.color1=dcmParam.compToHexArray(dcmParam.hexDec(o._color),-30):o.panel.color1=o.color_1,null==o.funOver&&(o.funOver=window.mCPodskazka.sobOver),o.funOver(this)},this.mouseOut=function(t){null==o.funDragOwer?(o.finalColor(),null==o.funOut&&(o.funOut=window.mCPodskazka.sobOut),o.funOut(this)):o.funDragOwer(o)},this.finalColor=function(){0==o._activ?o.panel.color1=o._color1:o.panel.color1=o._color},0==dcmParam.mobile&&(this.panel.div.addEventListener("mouseout",this.mouseOut),this.image.image.addEventListener("mouseout",this.mouseOut),this.panel.div.addEventListener("mouseover",this.mouseOver),this.image.image.addEventListener("mouseover",this.mouseOver),window.mCPodskazka.setBuuton(o,{ru:"xzsdfsfsfsdfsdfsdf",en:"xsdfsdfsdfsdfsdfz"}))}ut.prototype=Object.create(DBox.prototype),ut.prototype.constructor=ut,Object.defineProperties(ut.prototype,{});class ct{constructor(t,i){this.type="NMBaze",this.typeNa="NMBaze";var e,s,n;this.par=t,this.fun=i,this.param=this.par.param,this.width=this.param.wh+this.param.otstup,this.height=this.param.wh+this.param.otstup,this.dCont1=new DCont(t.dCont1),this.dCont=void 0,this.postSO=void 0,this.postIn=void 0,this.bool=!0,this.init=function(){null==this.dCont&&(this.dCont=new DCont,this.panel=new DPanel(this.dCont),this.panel.width=this.width,this.panel.height=this.height,null!=this.postIn&&this.postIn(),this.sizeWindow())},this.object=void 0,this.setObject=function(t){this.object=t,this.active=!0,this.postSO&&this.postSO(),this.sizeWindow()},this.killObj=function(){if(this.object.clear){if(null!=dcmParam.getFocus())return;this.object.clear(),this.active=!1}},this.boolCTRL=!1,this.keydown=function(t,i,e){8!=i.keyCode&&46!=i.keyCode||this.killObj(),void 0!==e&&(this.boolCTRL=e)},this.keyup=function(t,i,e){void 0!==e&&(this.boolCTRL=e)},this.sizeWindow=function(t,i,r){t&&(e=t,s=i,n=r),this.dCont&&this.dCont.parent&&(1==dcmParam.mobile?(this.dCont.y=s/n-this.height,this.dCont.x=(e/n-(this.width-2*this.param.otstup))/2):(this.dCont.y=this.param.otstup,this.dCont.x=e/n-this.param.sizeBase))}}set active(t){this._active!=t&&(this._active=t,1==this._active?(this.init(),this.dCont1.add(this.dCont),this.sizeWindow()):this.dCont1.remove(this.dCont))}get active(){return this._active}}class dt extends ct{constructor(t,i){super(t,i),this.type="NMPoint0",this.typeNa="SpPointSten";var e=this;this.par=t,this.fun=i,this.otstup=this.param.otstup,this.postIn=function(){this.label=new DLabel(null,0,-20,"x"),this.label.activMouse=!1,this.input=new DInput(this.dCont,0,0," ",function(){let t=1*this.value;if(1==isNaN(t))return t=e.object.position.x,void(this.value=t);e.bool=!1,e.object.position.x=1*this.value,e.object.dragPost(),visi3D.intRend=1}),this.input.timeFun=1,this.input.add(this.label),this.label=new DLabel(null,0,-20,"y"),this.label.activMouse=!1,this.input1=new DInput(this.dCont,0,0," ",function(){let t=1*this.value;if(1==isNaN(t))return t=e.object.position.y,void(this.value=t);e.bool=!1,e.object.position.y=1*this.value,e.object.dragPost(),visi3D.intRend=1}),this.input1.timeFun=1,this.input1.add(this.label),this.button=new DButton(this.dCont,0,0," ",function(){e.object.clear(),e.clear(),visi3D.intRend=1}),this.button.width=this.button.height=this.param.wh,this.button.boolFond=!1,mhbd.getKeyId("scenes3d",36,function(t){if(e.button.link=mhbd.getLink(t.icon),0==dcmParam.mobile){let i=new DLabel(e.button,-(200-e.param.wh)/2,e.button.height,t[languages.key]);i.textAlign="center",i.width=200,i.fontSize=dcmParam.fontSizeLittel,i.activMouse=!1}});var t=this.otstup,i=this.otstup;if(0==dcmParam.mobile){let e=new DLabel(this.dCont,i,t,"Point");e.bold=!0,e.activMouse=!1,e.fontSize=2*e.fontSize,t+=e.fontSize+this.param.otstup,this.button.x=this.param.sizeBase-this.param.otstup-this.button.width,this.button.y=t,t+=this.button.height+this.param.otstup+dcmParam.fontSizeLittel;let s=new DPanel(this.dCont,this.param.otstup,t);s.color=dcmParam.colorText,s.width=this.param.sizeBase-2*this.param.otstup,s.height=2,t+=this.param.otstup+2+20,this.input.width=this.param.sizeBase-2*this.param.otstup,this.input.x=this.param.otstup,this.input.y=t,t+=55,this.input1.width=this.param.sizeBase-2*this.param.otstup,this.input1.x=this.param.otstup,this.input1.y=t,t+=40,this.panel.width=this.width=this.param.sizeBase,this.panel.height=this.height=t}else t+=20,this.input.width=this.param.wb,this.input.x=i,this.input.y=t,i+=this.param.wb+this.param.otstup,this.input1.width=this.param.wb,this.input1.x=i,this.input1.y=t,i+=this.param.wb+this.param.otstup,this.button.x=i,this.button.y=this.param.otstup,i+=this.button.width+this.param.otstup,t=this.button.height+2*this.param.otstup,this.panel.width=this.width=i,this.panel.height=this.height=t;this.panel.alpha=1.75*this.param.alpha},this.drag=function(){0!=e.bool&&(e.input.value=Math.round(e.object.position.x)+"",e.input1.value=Math.round(e.object.position.y)+"")},this.killObj=function(){if(this.object.clear&&e.button.activMouse){if(null!=dcmParam.getFocus())return;this.object.clear(),this.active=!1}},this.postSO=function(){this.bool=!0,this.object.arrayClass[0].funDragMenu=this.drag;let t=window.facade.sp,i=0;for(var s=0;s<t.arrSplice.length;s++)1==t.arrSplice[s].life&&i++;e.button.activMouse=!(i<=3),this.drag()},this.clear=function(){trace("##clear##",this.active,this.object),null!=this.object&&(this.bool=!0,this.object.arrayClass[0].funDragMenu=void 0,this.object.active=!1),this.active=!1},this.sizeWindow2=function(t,i,e){t&&(t,i,e)}}}class pt extends ct{constructor(t,i){super(t,i),this.type="NMSpliceSten",this.typeNa="SpliceSten";var e=this;this.par=t,this.fun=i,this.otstup=(this.param.wh-dcmParam.fontSize-32)/3,this.ww=120,this.lll,this.postIn=function(){var t=this.otstup,i=this.param.otstup;if(0==dcmParam.mobile){let e=new DLabel(this.panel,i,t,"Wall");e.bold=!0,e.activMouse=!1,e.fontSize=2*e.fontSize,t+=e.fontSize+this.param.otstup}if(this.button1=new DButton(this.panel,i,t," ",function(){e.object.boolAree=!1,e.drag(),visi3D.intRend=1}),this.button1.boolFond=!1,this.button1.width=this.button1.height=this.param.wh,mhbd.getKeyId("scenes3d",37,function(t){if(e.button1.link=mhbd.getLink(t.icon),0==dcmParam.mobile){let i=new DLabel(e.button1,-(200-e.param.wh)/2,e.button1.height,t[languages.key]);i.textAlign="center",i.width=200,i.fontSize=dcmParam.fontSizeLittel,i.activMouse=!1}}),this.button2=new DButton(this.panel,i,t," ",function(){e.object.boolAree=!0,e.drag(),visi3D.intRend=1}),this.button2.width=this.button2.height=this.param.wh,mhbd.getKeyId("scenes3d",38,function(t){if(e.button2.link=mhbd.getLink(t.icon),0==dcmParam.mobile){let i=new DLabel(e.button2,-(200-e.param.wh)/2,e.button2.height,t[languages.key]);i.textAlign="center",i.width=200,i.fontSize=dcmParam.fontSizeLittel,i.activMouse=!1}}),this.button2.boolFond=!1,this.button2.visible=!1,i+=this.button2.width+this.param.otstup,this.button3=new DButton(this.panel,i,t," ",function(){e.object.delim(),visi3D.intRend=1}),this.button3.boolFond=!1,this.button3.width=this.button3.height=this.param.wh,mhbd.getKeyId("scenes3d",40,function(t){if(e.button3.link=mhbd.getLink(t.icon),0==dcmParam.mobile){let i=new DLabel(e.button3,-(200-e.param.wh)/2,e.button3.height,t[languages.key]);i.textAlign="center",i.width=200,i.fontSize=dcmParam.fontSizeLittel,i.activMouse=!1}}),i+=this.button3.width+this.param.otstup,this.button=new DButton(this.panel,i,t," ",function(){e.object._addPoint1.clear(),e.clear(),visi3D.intRend=1}),this.button.boolFond=!1,this.button.width=this.button.height=this.param.wh,mhbd.getKeyId("scenes3d",36,function(t){if(e.button.link=mhbd.getLink(t.icon),0==dcmParam.mobile){let i=new DLabel(e.button,-(200-e.param.wh)/2,e.button.height,t[languages.key]);i.textAlign="center",i.width=200,i.fontSize=dcmParam.fontSizeLittel,i.activMouse=!1}}),i+=this.button.width+this.param.otstup,t+=this.param.wh+this.param.otstup,0==dcmParam.mobile){t+=dcmParam.fontSizeLittel;let e=new DPanel(this.panel,this.param.otstup,t);e.color=dcmParam.colorText,e.width=i-2*this.param.otstup,e.height=2,t+=this.param.otstup+2,this.input=new DInput(this.panel,this.param.otstup,t,"0",null),this.input.width=e.width,this.input.widthTitle=90,this.input.title="width",this.input.boolNum=!0,this.input.funEnter=this.sobb,this.input.timeFun=0,this.input.min=10,this.input.max=1e4,t+=this.param.otstup+this.input.height,this.input1=new DInput(this.panel,this.param.otstup,t,"0",null),this.input1.width=e.width,this.input1.widthTitle=90,this.input1.title="height left",this.input1.boolNum=!0,this.input1.funEnter=this.sobb,this.input1.timeFun=0,this.input1.min=30,this.input1.max=3e4,t+=this.param.otstup+this.input.height,this.input2=new DInput(this.panel,this.param.otstup,t,"0",null),this.input2.width=e.width,this.input2.widthTitle=90,this.input2.title="height right",this.input2.boolNum=!0,this.input2.funEnter=this.sobb,this.input2.timeFun=0,this.input2.min=30,this.input2.max=3e4,t+=this.param.otstup+this.input.height}this.panel.width=i,this.panel.height=t,this.width=i},this.sobb=function(){"DInput"==this.type&&("width"==this.title&&(e.object.razmeru.setWidth(1*this.value),e.postSO(),visi3D.intRend=1),"height left"==this.title&&(e.bool=!1,this.b3d.button.z=1*this.value,this.b3d.button1.z=1*this.value,this.b3d.button2.z=1*this.value,e.object.par.addObjFun(e.object.addPoint),visi3D.intRend=1),"height right"==this.title&&(e.bool=!1,this.b3d.button.z=1*this.value,this.b3d.button1.z=1*this.value,this.b3d.button2.z=1*this.value,e.object.par.addObjFun(e.object.addPoint1),visi3D.intRend=1))},this.clearObj=function(){this.object.clear(),visi3D.intRend=1},this.drag=function(){0!=e.bool&&(e.button1.visible=e.object.boolAree,e.button2.visible=!e.object.boolAree)},this.killObj=function(){if(this.object.clear&&e.button.activMouse){if(null!=dcmParam.getFocus())return;this.object.clear(),this.active=!1}},this.postSO=function(){this.bool=!0,this.object.arrayClass[0].funDragMenu=this.drag;let t=window.facade.sp,i=0;for(var s=0;s<t.arrSplice.length;s++)1==t.arrSplice[s].life&&i++;if(e.button.activMouse=!(i<=3),this.input){this.input.value=Math.round(this.object.ss3d.tCompArrow.distans);let t=this.object.sVephPoint.array[0].tComp3But.button1;this.input1.b3d=this.object.sVephPoint.array[0].tComp3But,this.input1.value=Math.round(t.z),t=this.object.sVephPoint.array[this.object.sVephPoint.array.length-1].tComp3But.button1,this.input2.b3d=this.object.sVephPoint.array[this.object.sVephPoint.array.length-1].tComp3But,this.input2.value=Math.round(t.z)}this.drag()},this.clear=function(){null!=this.object&&(this.bool=!0,this.object.arrayClass[0].funDragMenu=void 0,this.object.active=!1),this.active=!1},this.sizeWindow2=function(t,i,e){t&&(t,i,e)}}}class ft extends ct{constructor(t,i){super(t,i),this.type="NMTComp3But",this.typeNa="TComp3But";var e=this;this.par=t,this.fun=i,this.otstup=(this.param.wh-dcmParam.fontSize-32)/3,this.ww=120,this.postIn=function(){var t=this.otstup,i=this.param.otstup;this.label=new DLabel(null,0,-20,"height MIN"),this.label.activMouse=!1,this.input=new DInput(this.dCont,0,0," ",function(){let t=1*this.value;if(1==isNaN(t))return t=e.object.button1.z,void(this.value=t);e.bool=!1,e.object.button1.z=1*this.value,e.object.gronPoint.par.par.par.addObjFun(e.object.gronPoint.par.par.addPoint),visi3D.intRend=1}),this.input.width=this.ww,this.input.timeFun=1,this.input.add(this.label),i+=this.ww+this.otstup,this.label=new DLabel(null,0,-20,"height MAX"),this.label.activMouse=!1,this.input1=new DInput(this.dCont,0,0," ",function(){let t=1*this.value;if(1==isNaN(t))return t=e.object.button2.z,void(this.value=t);e.bool=!1,e.object.button2.z=1*this.value,e.object.gronPoint.par.par.par.addObjFun(e.object.gronPoint.par.par.addPoint),visi3D.intRend=1}),this.input1.width=this.ww,this.input1.timeFun=1,this.input1.add(this.label),i+=this.ww+this.otstup,this.button=new DButton(this.dCont,0,0," ",function(){e.object.gronPoint.clear(),visi3D.intRend=1,e.object.gronPoint.par.par.par.addObjFun(e.object.gronPoint.par.par.addPoint),e.clear()}),this.button.width=this.button.height=this.param.wh,this.button.boolFond=!1,mhbd.getKeyId("scenes3d",36,function(t){if(e.button.link=mhbd.getLink(t.icon),0==dcmParam.mobile){let i=new DLabel(e.button,-(200-e.param.wh)/2,e.button.height,t[languages.key]);i.textAlign="center",i.width=200,i.fontSize=dcmParam.fontSizeLittel,i.activMouse=!1}});t=this.otstup,i=this.otstup;if(0==dcmParam.mobile){let e=new DLabel(this.dCont,i,t,"Point 3d");e.width=200,e.bold=!0,e.activMouse=!1,e.fontSize=2*e.fontSize,t+=e.fontSize+this.param.otstup,this.button.x=this.param.sizeBase-this.param.otstup-this.button.width,this.button.y=t,t+=this.button.height+this.param.otstup+dcmParam.fontSizeLittel;let s=new DPanel(this.dCont,this.param.otstup,t);s.color=dcmParam.colorText,s.width=this.param.sizeBase-2*this.param.otstup,s.height=2,t+=this.param.otstup+2+20,this.input.width=this.param.sizeBase-2*this.param.otstup,this.input.x=this.param.otstup,this.input.y=t,t+=55,this.input1.width=this.param.sizeBase-2*this.param.otstup,this.input1.x=this.param.otstup,this.input1.y=t,t+=40,this.panel.width=this.width=this.param.sizeBase,this.panel.height=this.height=t}else t+=20,this.input.width=this.param.wb,this.input.x=i,this.input.y=t,i+=this.param.wb+this.param.otstup,this.input1.width=this.param.wb,this.input1.x=i,this.input1.y=t,i+=this.param.wb+this.param.otstup,this.button.x=i,this.button.y=this.param.otstup,i+=this.button.width+this.param.otstup,t=this.button.height+2*this.param.otstup,this.panel.width=this.width=i,this.panel.height=this.height=t;this.panel.alpha=1.75*this.param.alpha},this.drag=function(){0!=e.bool&&(e.input.value=Math.round(e.object.button1.z)+"",e.input1.value=Math.round(e.object.button2.z)+"")},this.postSO=function(){this.bool=!0,this.object.funDragMenu=this.drag,0==e.object.gronPoint.idArr?this.button.activMouse=!1:this.button.activMouse=!0,this.drag()},this.clear=function(){null!=this.object&&(this.bool=!0,this.object.funDragMenu=void 0),this.active=!1},this.sizeWindow2=function(t,i,e){t&&(t,i,e)}}}class gt extends ct{constructor(t,i){super(t,i),this.type="NMBlok",this.typeNa="BInSten";var e=this;this.par=t,this.fun=i,this.otstup=(this.param.wh-dcmParam.fontSize-32)/3,this.ww=120,this.array=[],this.postIn=function(){var t,i,s,n,r,h,a=this.otstup,o=this.otstup;this.label=new DLabel(null,0,-20,"width"),this.label.activMouse=!1,this.input=new DInput(this.dCont,0,0," ",null),this.input.width=this.ww,this.input.boolNum=!0,this.input.timeFun=0,this.input.min=10,this.input.max=1e4,this.input.funEnter=function(){h=e.object._parent.par,i=h.arrPosit1[1].x,s=h.arrPosit[5].x,n=i+s,r=h._distans-n,t=e.object._parent.collision.getMinMax(e.object.boxColizi,r),trace("@@@@@@===",t,r),this.value>Math.floor(t.w)&&(e.object.setPosition(t.x+t.w/2,void 0,void 0),this.value=Math.floor(t.w)),e.object.width=this.value,menuBig.setObject(e.object),facade.sp.worldBlok.wbVisiActiv.korekt(),e.object.render()},this.input.add(this.label),this.array[0]=this.input,this.label=new DLabel(null,0,-20,"height"),this.label.activMouse=!1,this.input1=new DInput(this.dCont,0,0," "),this.input1.width=this.ww,this.input1.boolNum=!0,this.input1.timeFun=0,this.input1.min=10,this.input1.max=1e4,this.input1.funEnter=function(){h=e.object._parent.par,i=h.arrPosit1[1].x,s=h.arrPosit[5].x,n=i+s,r=h._distans-n,t=e.object._parent.collision.getMinMax(e.object.boxColizi,r),this.value>Math.floor(t.h)-2&&(this.value=Math.floor(t.h)-2),e.object.height=this.value,menuBig.setObject(e.object),facade.sp.worldBlok.wbVisiActiv.korekt(),e.object.render()},this.input1.add(this.label),this.array[1]=this.input1,this.label=new DLabel(null,0,-20,"delph"),this.label.activMouse=!1,this.input2=new DInput(this.dCont,0,0," ",function(){let t=1*this.value;if(1==isNaN(t))return t=e.object.delph,void(this.value=t);e.korektNUM(this,20),e.object.delph=this.value,e.object.render()}),this.input2.width=this.ww,this.input2.boolNum=!0,this.input2.timeFun=0,this.input2.min=10,this.input2.max=1e4,this.input2.funEnter=function(){e.object.delph=this.value,e.object.render()},this.input2.add(this.label),this.input2.lll=this.label,this.array[2]=this.input2,this.button=new DButton(this.dCont,0,0," ",function(){e.object.clear(),e.clear(),visi3D.intRend=1}),this.button.width=this.button.height=this.param.wh,this.button.boolFond=!1,mhbd.getKeyId("scenes3d",36,function(t){if(e.button.link=mhbd.getLink(t.icon),0==dcmParam.mobile){let i=new DLabel(e.button,-(200-e.param.wh)/2,e.button.height,t[languages.key]);i.textAlign="center",i.width=200,i.fontSize=dcmParam.fontSizeLittel,i.activMouse=!1}}),this.button1=new DButton(this.dCont,0,0," ",function(){var t=e.object.copy();e.object.parent.addBlok(t),facade.sp.worldBlok.activeObject=t}),this.button1.width=this.button1.height=this.param.wh,this.button1.boolFond=!1,mhbd.getKeyId("scenes3d",39,function(t){if(e.button1.link=mhbd.getLink(t.icon),0==dcmParam.mobile){let i=new DLabel(e.button1,-(200-e.param.wh)/2,e.button1.height,t[languages.key]);i.textAlign="center",i.width=200,i.fontSize=dcmParam.fontSizeLittel,i.activMouse=!1}});a=this.otstup,o=this.otstup;if(0==dcmParam.mobile){let t=new DLabel(this.dCont,o,a,"Point 3d");t.width=200,t.bold=!0,t.activMouse=!1,t.fontSize=2*t.fontSize,a+=t.fontSize+this.param.otstup,this.button.x=this.param.sizeBase-this.param.otstup-this.button.width,this.button.y=a,this.button1.x=this.param.sizeBase-3*this.param.otstup-2*this.button.width,this.button1.y=a,a+=this.button.height+this.param.otstup+dcmParam.fontSizeLittel;let i=new DPanel(this.dCont,this.param.otstup,a);i.color=dcmParam.colorText,i.width=this.param.sizeBase-2*this.param.otstup,i.height=2,a+=this.param.otstup+2+20,this.input.width=this.param.sizeBase-2*this.param.otstup,this.input.x=this.param.otstup,this.input.y=a,a+=55,this.input1.width=this.param.sizeBase-2*this.param.otstup,this.input1.x=this.param.otstup,this.input1.y=a,a+=55,this.input2.width=this.param.sizeBase-2*this.param.otstup,this.input2.x=this.param.otstup,this.input2.y=a,a+=40,this.panel.width=this.width=this.param.sizeBase,this.panel.height=this.height=a}else a+=20,this.input.width=this.param.wb,this.input.x=o,this.input.y=a,o+=this.param.wb+this.param.otstup,this.input1.width=this.param.wb,this.input1.x=o,this.input1.y=a,o+=this.param.wb+this.param.otstup,this.input2.width=this.param.wb,this.input2.x=o,this.input2.y=a,o+=this.param.wb+this.param.otstup,this.button1.x=o,this.button1.y=this.param.otstup,o+=this.button1.width+this.param.otstup,this.button.x=o,this.button.y=this.param.otstup,o+=this.button.width+this.param.otstup,a=this.button.height+2*this.param.otstup,this.panel.width=this.width=o,this.panel.height=this.height=a;this.panel.alpha=1.75*this.param.alpha},this.korektNUM=function(t,i){var e=t.value;1==isNaN(1*e)&&(t.value=i),1*t.value<i&&(t.value=i)},this.drag=function(){0!=e.bool&&(this.array[0].value=e.object.width,this.array[1].value=e.object.height,this.array[2].value=e.object.delph,this.array[2].activMouse=e.object.amDelph,e.object.amDelph?this.array[2].alpha=1:this.array[2].alpha=.25)},this.postSO=function(){this.bool=!0,this.drag()},this.clear=function(){null!=this.object&&(this.bool=!0),this.active=!1},this.sizeWindow2=function(t,i,e){t&&(t,i,e)}}}class xt{constructor(t,i){this.type="MObject";var e=this;this.par=t,this.fun=i,this.param=this.par.param,this.otstup=this.param.otstup,this.otstup1=this.param.otstup,this.wh=this.param.wh,this.width=this.param.sizeBase,this.whSize=1e3,this.dCont=new DCont(t.dCont),this.dCont.y=3*this.otstup+2*this.param.wh,this.array=[],this.dCont1=new DCont(t.dCont),this.array1=[],this.dragPic=this.par.dragPic,this.array[0]=this.moPoint=new st(this,function(t,i){}),this.array[1]=this.moTCompArrow=new nt(this,function(t,i){}),this.array[2]=this.moTComp3But=new rt(this,function(t,i){}),this.array[3]=this.moBlok=new ht(this,function(t,i){}),this.array[4]=this.moBInLes=new ot(this,function(t,i){}),this.array1[this.array1.length]=new dt(this,function(t,i){}),this.array1[this.array1.length]=new pt(this,function(t,i){}),this.array1[this.array1.length]=new ft(this,function(t,i){}),this.array1[this.array1.length]=new gt(this,function(t,i){}),this.dragMenu=function(){for(var t=0;t<this.array.length;t++)this.array[t].active&&this.array[t].drag&&this.array[t].drag();for(t=0;t<this.array1.length;t++)this.array1[t].active&&this.array1[t].drag&&this.array1[t].drag()},this.clear=function(){for(var t=0;t<this.array.length;t++)this.array[t].clear();for(t=0;t<this.array1.length;t++)this.array1[t].clear()},this.setObject=function(t){if(this.clear(),1==window.localS.object.debug&&t)for(var i=0;i<this.array.length;i++)this.array[i].typeNa==t.type&&this.array[i].setObject(t);if(t)for(i=0;i<this.array1.length;i++)this.array1[i].typeNa==t.type?this.array1[i].setObject(t):this.array1[i].active=!1},this.sizeWindow=function(t,i,e){this.dCont.x=t/e-this.width-this.otstup;for(var s=0;s<this.array1.length;s++)this.array1[s].sizeWindow&&this.array1[s].sizeWindow(t,i,e)},this.keydown=function(t,i,s){for(var n=0;n<e.array.length;n++)e.array[n].keydown&&this.array[n].active&&e.array[n].keydown(t,i,s);for(n=0;n<e.array1.length;n++)e.array1[n].keydown&&this.array1[n].active&&e.array1[n].keydown(t,i,s)},this.keyup=function(t,i,s){for(var n=0;n<e.array.length;n++)e.array[n].keyup&&this.array[n].active&&e.array[n].keyup(t,i,s);for(n=0;n<e.array1.length;n++)e.array1[n].keyup&&this.array1[n].active&&e.array1[n].keyup(t,i,s)}}}class yt{constructor(){this.type="SpDebugPixi";this.content2d=new PIXI.Container,this.color=11184810,this.colorActiv=16711680,this.wL=1,this.al=1,this._alpha=1,this.contentDebag=new PIXI.Container,this.content2d.addChild(this.contentDebag);var t=new PIXI.Graphics;this.content2d.addChild(t),this.debagLine=function(t,i,e,s){this.graphics=new PIXI.Graphics,this.contentDebag.addChild(this.graphics),null==e&&(e=this.color),null==s&&(s=this.wL),this.graphics.lineStyle(s,e,s),this.graphics.moveTo(t.x,t.y),this.graphics.lineTo(i.x,i.y)},this.debagPoint=function(t,i,e,s,n){this.graphics=new PIXI.Graphics,this.contentDebag.addChild(this.graphics),i=i||5,null==e&&(e=this.color),s=s||this.wL,this.graphics.lineStyle(this.wL,e,s),this.graphics.beginFill(e,null==n?1:n),this.graphics.drawCircle(t.x,t.y,i)};var i,e,s=0,n=[];this.clearD=function(){t.clear(),s=0;for(var i=0;i<n.length;i++)n[i].visible=!1},this.clear=function(){this.clearD()},this.dText=function(t,r,h,a){var o=a||.4;null==n[s]&&(n[s]=new PIXI.Container,e=new PIXI.Text("345634634",{fontFamily:"Arial"}),n[s].addChild(e),this.content2d.addChild(n[s])),(i=n[s]).children[0].text=r+"",i.children[0].position.x=-i.children[0].width/2,i.children[0].position.y=-i.children[0].height/2,i.position.x=t.x,i.position.y=t.y,i.scale.x=o,i.scale.y=o,i.visible=!0,s++};var r={x:0,y:0},h={x:0,y:0};this.dLineParam=function(t,i,e,s,n,a){r.x=t,r.y=i,h.x=e,h.y=s,this.dLine(r,h,n,a)},this.dLine=function(i,e,s,n){null==s&&(s=this.color),null==n&&(n=this.wL),t.endFill(),t.lineStyle(n,s,this.al),t.moveTo(i.x,i.y),t.lineTo(e.x,e.y),t.endFill()},this.dPointParam=function(t,i,e,s,n){r.x=t,r.y=i,this.dPoint(r,e,s,n)},this.dPoint=function(i,e,s,n){(e=e||50)>1e6?console.warn("Большой круг рисовать не буду",e):(null==s&&(s=this.color),n=n||this.wL,t.lineStyle(n,s,this.al),t.drawCircle(i.x,i.y,e),t.endFill())},this.dLinePosition=function(i,e){t.lineStyle(2.5,e,this.al),t.moveTo(i.p.x,i.p.y),t.lineTo(i.p1.x,i.p1.y),t.moveTo(i.p1.x,i.p1.y),t.lineTo(i.p2.x,i.p2.y),t.beginFill(e,.3),t.drawCircle(i.p.x,i.p.y,2.5),t.drawCircle(i.p1.x,i.p1.y,2.5),t.drawCircle(i.p2.x,i.p2.y,2.5),t.endFill()},this.dRect=function(i,e,s,n){null==e&&(e=16777215*Math.random()),s=s||this.wL;let r=null==i.w?i.width:i.w,h=null==i.h?i.height:i.h;if(n)return t.beginFill(e,1),t.moveTo(i.x,i.y),t.lineTo(i.x+r,i.y),t.lineTo(i.x+r,i.y+h),t.lineTo(i.x,i.y+h),void t.endFill();let a={x:i.x,y:i.y},o={x:i.x+r,y:i.y},l={x:i.x+r,y:i.y+h},u={x:i.x,y:i.y+h};this.dLine(a,o,e,s),this.dLine(o,l,e,s),this.dLine(l,u,e,s),this.dLine(u,a,e,s)}}set alpha(t){this._alpha!=t&&(this._alpha=t,this.content2d.alpha=t)}get alpha(){return this._alpha}}function mt(){var t,i,e,s,n=new THREE.Vector3(0,0,0),r=new THREE.Vector3(0,0,0),h=new THREE.Vector3(0,0,0),a=new THREE.Vector3(0,0,0);this.DEG2RAD=Math.PI/180,this.RAD2DEG=180/Math.PI,this.getAngle=function(t,i){return i=i||a,t=t||a,Math.atan2(i.y-t.y,i.x-t.x)};var o,l,u,c,d,p,f,g,x,y=0;this.getAngle2=function(t,i){return i=i||a,t=t||a,(y=Math.atan2(i.y-t.y,i.x-t.x))<0&&(y+=2*Math.PI),y},this.getDistance=function(t,i){return null==t?0:(null==i&&(i=a),i=i||a,Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2)))},this.getVector=function(t,i,e){if(null==e)e=new THREE.Vector2(0,0);return t<0&&(i+=Math.PI),e.x=Math.abs(t)*Math.cos(i),e.y=Math.abs(t)*Math.sin(i),e},this.isPointInLin=function(t,e,n,a,o){return this.getTreeAngel(t,e,n),o<0&&2*Math.abs(o)>s?null:r.x<=s+o&&r.x>=-o&&Math.abs(r.y)<=a?((h=r.x<0?this.getVector(r.x,i-Math.PI):this.getVector(r.x,i)).x+=e.x,h.y+=e.y,h.z=r.y,h):null},this.testLine=function(t,i,e,s){return e>=t&&e<=i||t>=e&&t<=s},this.okrugPoint=function(t,i){null==i&&(i=100),t.x=Math.round(t.x/i)*i,t.y=Math.round(t.y/i)*i},this.okrugNumber=function(t,i){null==i&&(i=100);var e=Math.round(t*i)/i;return t=e,e},this.isInTriangle=function(t,i,e,s){var n=(t.x-s.x)*(i.y-t.y)-(i.x-t.x)*(t.y-s.y),r=(i.x-s.x)*(e.y-i.y)-(e.x-i.x)*(i.y-s.y),h=(e.x-s.x)*(t.y-e.y)-(t.x-e.x)*(e.y-s.y);return n>=0&&r>=0&&h>=0||n<=0&&r<=0&&h<=0},this.getTreeAngel=function(t,n,h,l){return i=this.getAngle(n,t),e=this.getAngle(n,h),o=this.getDistance(n,h),s=this.getDistance(t,n),this.getVector(o,e-i,r),e=this.getAngle(a,r),null==l?e:e>0?e:2*Math.PI+e},this.getTreeAngelPI2=function(t,i,e){x1=t.x-i.x,x2=e.x-i.x,y1=t.y-i.y,y2=e.y-i.y,s=Math.sqrt(x1*x1+y1*y1),d2=Math.sqrt(x2*x2+y2*y2);var n=(x1*x2+y1*y2)/(s*d2);return n>1&&(n=1),n<-1&&(n=-1),Math.acos(n)},this.isLineInTriangle=function(i,e,s,r,h){return(t=this.getPointOfIntersection(i,e,r,h))?(n.x=t.x,n.y=t.y,n.z=0,n):(t=this.getPointOfIntersection(e,s,r,h))?(n.x=t.x,n.y=t.y,n.z=1,n):!!(t=this.getPointOfIntersection(s,i,r,h))&&(n.x=t.x,n.y=t.y,n.z=2,n)};var m,v,b,w,_=new THREE.Vector2(0,0);this.getPointOfIntersection=function(t,i,e,s){return o=(t.x-i.x)*(s.y-e.y)-(t.y-i.y)*(s.x-e.x),l=(t.x-e.x)*(s.y-e.y)-(t.y-e.y)*(s.x-e.x),u=(t.x-i.x)*(t.y-e.y)-(t.y-i.y)*(t.x-e.x),d=u/o,(c=l/o)>=0&&c<=1&&d>=0&&d<=1?(p=t.x+c*(i.x-t.x),f=t.y+c*(i.y-t.y),_.x=p,_.y=f,_):null},this.korektToLine=function(t,i,e,s,n){g=this.getDistance(t,i),x=null==n?this.getAngle(t,i):n,0!=s&&(_=s<0?this.getVector(-s,x-Math.PI/2):this.getVector(s,x+Math.PI/2),t.x+=_.x,t.y+=_.y,i.x+=_.x,i.y+=_.y),_=this.getVector(e,x),i.x+=_.x,i.y+=_.y,_=this.getVector(e,x+Math.PI),t.x+=_.x,t.y+=_.y},this.getProsent3Point=function(t,i,e){return l=this.getDistance(t,i),(u=this.getDistance(t,e))/l},this.povotorOtAngel=function(t,i,e){return x=this.getAngle(t,i),g=this.getDistance(t,i),this.getVector(g,x+e)},this.testPositPoint=function(t,i,e){return null==e&&(e=100),Math.round(t.x*e)/e==Math.round(i.x*e)/e&&Math.round(t.y*e)/e==Math.round(i.y*e)/e},this.okrugAngel=function(t,i,e){var s=t;m=1,t<0&&(m=-1),v=Math.abs(t),b=Math.round(v/i)+1,w=0;for(var n=b;n>=0;n--){if(v>n*i-e&&v<n*i+e)return s=n*i*m;if(3==++w)return s}return s};var P=new vt,S=new vt,A=[];this.getLineCircleIntersectionPoints=function(t,i,e,s,n){A.length=0;var r=i.x-t.x,h=i.y-t.y,a=e.x-t.x,o=e.y-t.y,l=r*r+h*h,u=(r*a+h*o)/l,c=u*u-(a*a+o*o-s*s)/l;if(c<0)return A;var d=Math.sqrt(c),p=-u+d,f=-u-d;return P.set(t.x-r*p,t.y-h*p),this.isPointInLine(t,i,P)&&A.push(P),0==c?A:(S.set(t.x-r*f,t.y-h*f),this.isPointInLine(t,i,S)&&A.push(S),n&&2==A.length&&(m=this.getDistance(t,A[0]),v=this.getDistance(t,A[1]),m>v&&A.reverse()),A)},this.isPointInLine=function(t,i,e){var s=this.getDistance(t,i),n=this.getDistance(t,e),r=this.getDistance(i,e);return this.okrugNumber(n+r)===this.okrugNumber(s)},this.getDistancePointToLine=function(t,i,e){var s=((i.y-t.y)*e.x-(i.x-t.x)*e.y+i.x*t.y-i.y*t.x)/this.getDistance(t,i);return-this.okrugNumber(Number.isFinite(s)?s:0)},this.getCircleCircleIntersectionPoints=function(t,i,e,s){var n,r,h,a,o;return A.length=0,(h=Math.sqrt(Math.pow(Math.abs(t.x-e.x),2)+Math.pow(Math.abs(t.y-e.y),2)))>i+s?A:(a=(i*i-s*s+h*h)/(2*h),o=Math.sqrt(Math.pow(i,2)-Math.pow(a,2)),isNaN(o)?A:(n=t.x+a*(e.x-t.x)/h,r=t.y+a*(e.y-t.y)/h,P.x=n+o*(e.y-t.y)/h,P.y=r-o*(e.x-t.x)/h,A.push(P),a==i?A:(S.x=n-o*(e.y-t.y)/h,S.y=r+o*(e.x-t.x)/h,A.push(S),A)))};var T=[new vt,new vt,new vt,new vt],E=[new vt,new vt,new vt,new vt];this.isIntersectionRect=function(t,i){return T[0].set(t.x,t.y),T[1].set(t.x+t.width,t.y),T[2].set(t.x+t.width,t.y+t.height),T[3].set(t.x,t.y+t.height),E[0].set(i.x,i.y),E[1].set(i.x+i.width,i.y),E[2].set(i.x+i.width,i.y+i.height),E[3].set(i.x,i.y+i.height),this.isIntersectionFromPoint(T,E)},this.isIntersectionFromPoint=function(t,i){for(var e=0;e<t.length-2;e++)for(var s=0;s<i.length-2;s++)if(this.getPointOfIntersection(t[e],t[(e+2)%t.length],i[s],i[(s+2)%i.length]))return!0;for(e=0;e<t.length;e++)for(s=0;s<i.length;s++)if(this.getPointOfIntersection(t[e],t[(e+1)%t.length],i[s],i[(s+1)%i.length]))return!0;for(e=0;e<i.length;e+=2)if(this.contains(i[e].x,i[e].y,t))return!0;for(e=0;e<t.length;e+=2)if(this.contains(t[e].x,t[e].y,i))return!0;return!1},this.isParalel=function(t,i,e,s,n){n=n||0;var r=Math.abs(this.getAngle(t,i)%Math.PI),h=Math.abs(this.getAngle(i,t)%Math.PI),a=Math.abs(this.getAngle(e,s)%Math.PI),o=Math.abs(this.getAngle(s,e)%Math.PI);return Math.min(Math.abs(r-a),Math.abs(h-o),Math.abs(r-o),Math.abs(h-a))<=n},this.rotationPoint=function(t,i,e){var s=0,n=0;e?(s=e.x+(t.x-e.x)*Math.cos(i)-(t.y-e.y)*Math.sin(i),n=e.y+(t.y-e.y)*Math.cos(i)+(t.x-e.x)*Math.sin(i)):(s=t.x*Math.cos(i)-t.y*Math.sin(i),n=t.y*Math.cos(i)+t.x*Math.sin(i)),t.x=s,t.y=n},this.rotationPointByLength=function(t,i,e){e=e||a;var s=this.getDistance(t,e),n=this.getLenghtCircle(s),r=i*(2*Math.PI/n);this.rotationPoint(t,r,e)},this.isIntersectionTriangle=function(t,i,e,s,n,r){for(var h=!1,a=[t,i,e],o=[s,n,r],l=0;l<a.length&&!h;l++)h=this.isInTriangle(s,n,r,a[l]);for(l=0;l<o.length&&!h;l++)h=this.isInTriangle(t,i,e,o[l]);if(!h)for(l=0;l<a.length;l++)for(var u=0;u<o.length&&!h;u++)h=this.getPointOfIntersection(a[l],a[(l+1)%a.length],o[u],o[(u+1)%o.length]);return h},this.getArrPointCircle=function(t,i,e,s,n,r,h){var a,o=this.getAngle(e,t)-Math.PI,l=this.getAngle(s,t)-Math.PI;a=h||[new vt],n=n||5,!(r=r||!1)&&l<=o?l+=2*Math.PI:r&&o<=l&&(o+=2*Math.PI);var u=r?-1*(o-l):l-o,c=Math.ceil(Math.abs(u)/(2*Math.PI))*(n-1),d=u/(2*c),p=2*d,f=Math.cos(d),g=Math.sin(d),x=c-1,y=x%1/x,m=0,v=0,b=0,w=0,_=0;a[0].x=t.x+Math.cos(o)*i,a[0].y=t.y+Math.sin(o)*i;for(var P=0;P<=x;P++)m=d+o+(p*P+y*P),w=(f*(v=Math.cos(m))+g*(b=-Math.sin(m)))*i+t.x,_=(f*-b+g*v)*i+t.y,a[P+1]?(a[P+1].x=w,a[P+1].y=_):a.push(new vt(w,_));return a},this.getLenghtCircle=function(t,i,e,s,n){i||(i=e=s=a);var r=this.getAngle(e,i)-Math.PI,h=this.getAngle(s,i)-Math.PI;return r===h&&e!==s?0:(!(n=n||!1)&&h<=r?h+=2*Math.PI:n&&r<=h&&(r+=2*Math.PI),Math.PI*t*(n?r-h:h-r)/Math.PI)},this.getLengthByWidth=function(t,i){var e=new vt(0,0),s=new vt(t,0),n=this.getVector(i,.5*Math.PI);n.x=t/2;var r=this.getCenterCircle(e,s,n);return r?this.getLenghtCircle(this.getDistance(r,e),r,e,s,i>0):t},this.getCenterCircle=function(t,i,e){var s=i.x-t.x,n=i.y-t.y,r=e.x-t.x,h=e.y-t.y,a=s*(t.x+i.x)+n*(t.y+i.y),o=r*(t.x+e.x)+h*(t.y+e.y),l=2*(s*(e.y-i.y)-n*(e.x-i.x));return 0===l?null:new vt((h*a-n*o)/l,(s*o-r*a)/l)},this.getArcPoint=function(t,i,e,s,n){s=s||5;var r=this.getAngle(t,i)+90*this.DEG2RAD,h=this.getVector(e,r),a=new vt((t.x+i.x)/2,(t.y+i.y)/2);a.x+=h.x,a.y+=h.y;var o=this.getCenterCircle(t,a,i);return o?this.getArrPointCircle(o,this.getDistance(o,t),t,i,s,e>0,n):[t,i]},this.getArea=function(t){for(var i=t.length,e=0,s=i-1,n=0;n<i;s=n++)e+=t[s].x*t[n].y-t[n].x*t[s].y;return.5*e||0},this.generateUUID=function(){for(var t=[],i=0;i<256;i++)t[i]=(i<16?"0":"")+i.toString(16);return function(){var i=4294967295*Math.random()|0,e=4294967295*Math.random()|0,s=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return(t[255&i]+t[i>>8&255]+t[i>>16&255]+t[i>>24&255]+"-"+t[255&e]+t[e>>8&255]+"-"+t[e>>16&15|64]+t[e>>24&255]+"-"+t[63&s|128]+t[s>>8&255]+"-"+t[s>>16&255]+t[s>>24&255]+t[255&n]+t[n>>8&255]+t[n>>16&255]+t[n>>24&255]).toUpperCase()}}(),this.generateRendom=function(t){null==t&&(t=2);let i,e="",s="";for(var n=0;n<t;n++){if((s=(255&(i=4294967295*Math.random()|0)).toString(16)+(i>>8&255).toString(16)+(i>>16&255).toString(16)+(i>>24&255).toString(16)).length<8)for(var r=0;r<8-s.length+1;r++)s+="Z";e+=s,n!=t-1&&(e+="-")}return e},this.diffNum=function(t,i){return t>=0&&i>=0?Math.abs(t-i):t<=0&&i<=0?Math.abs(Math.abs(t)-Math.abs(i)):t<=0&&i>=0?Math.abs(t)+i:t>=0&&i<=0?t+Math.abs(i):void 0},this.getPercentNum=function(t,i,e){return((t=null!=t?t:0)-(i=null!=i?i:0))/((e=null!=e?e:100)-i)*100},this.getValueNum=function(t,i,e){return(t=null!=t?t:0)/100*((e=null!=e?e:100)-(i=null!=i?i:0))+i},this.getValueBetween=function(t,i,e){var s=Math.max(i,e),n=Math.min(i,e);return Math.max(Math.min(t,s),n)},this.contains=function(t,i,e){for(var s=!1,n=e.length,r=0,h=n-1;r<n;h=r++){if(e[r].x===t&&e[r].y===i)return!0;var a=e[r].x,o=e[r].y,l=e[h].x,u=e[h].y;o>i!=u>i&&t<(l-a)*(i-o)/(u-o)+a&&(s=!s)}return s};var M={maxX:0,minX:0,maxY:0,minY:0},D=new vt,z=[new vt,new vt,new vt,new vt],R=new vt;this.getBoundsRect=function(t,i){R.set(t.width/2,t.height/2),z[0].set(0,0),z[1].set(t.width,0),z[2].set(t.width,t.height),z[3].set(0,t.height);for(var e=0;e<z.length;e++)this.rotationPoint(z[e],i,R);M.maxX=-t.width,M.minX=t.width,M.maxY=-t.height,M.minY=t.height;for(e=0;e<z.length;e++)M.maxX=Math.max(M.maxX,z[e].x),M.minX=Math.min(M.minX,z[e].x),M.maxY=Math.max(M.maxY,z[e].y),M.minY=Math.min(M.minY,z[e].y);return D.x=M.minX,D.y=M.minY,D.width=M.maxX-M.minX,D.height=M.maxY-M.minY,D},this.getCurvatureByWidth=function(t,i){if(Math.abs(t)>2*i)return null;var e=Math.pow(Math.abs(t),2),s=Math.pow(i,2),n=Math.acos((s+s-e)/(2*s));return i*(1-Math.cos(n/2))*(t<0?-1:1)},this.getWidthByCurvature=function(t,i){return 2*i*Math.sin(Math.acos(1-2*Math.abs(t)/(2*i)))*(t<0?-1:1)};var B=function(t,i){if(C(t)&&C(i))return t===i;for(var e in t){if(t.hasOwnProperty(e)!==i.hasOwnProperty(e))return!1;switch(typeof t[e]){case"object":if(!B(t[e],i[e]))return!1;break;case"function":if(void 0===i[e]||"compare"!==e&&t[e].toString()!==i[e].toString())return!1;break;case"number":if(Number(Number(t[e]).toFixed(3))!==Number(Number(i[e]).toFixed(3)))return!1;break;default:if(t[e]!==i[e])return!1}}for(var e in i)if(t.hasOwnProperty(e)!==i.hasOwnProperty(e))return!1;return!0};function C(t){return t!==Object(t)}this.compare=B}function vt(t,i,e){this._x=t||0,this._y=i||0,this._z=e||0,this.set=function(t,i,e){this._x=t||0,this._y=i||0,void 0!==e&&(this._z=e)},this.setPoint=function(t){this._x=t.x,this._y=t.y,void 0!==t.z&&(this._z=t.z)},this.getObj=function(){var t={};return t.x=this._x,t.y=this._y,t.z=this._z,t},this.copy=function(){return new vt(this._x,this._y,this._z)}}vt.prototype={set x(t){this._x=t},get x(){return this._x},set y(t){this._y=t},get y(){return this._y},set z(t){this._z=t},get z(){return this._z}};class bt{constructor(t){this.type="KRUmnik";var i,e,s,n,r,h,a,o,l,u,c,d,p;this.par=t,this.naStart=function(){l=this.par.rect.h+this.par.rect.y,u=this.par.rect.y,s=!1,n=!1,r=!1,h=!1,0!=this.par.pS.y&&(s=!0,e=Math.abs(this.par.pS.y)%this.par.pS.h,d=1,c=1-e/this.par.pS.h,this.par.pS.y>0&&(e=((d=1)-(c=1-c))*this.par.pS.h),e>this.par.rect.h&&(e=this.par.rect.h,d=(e+c*this.par.pS.h)/this.par.pS.h),this.naVV(u,e,s,r,c,d),u+=e);for(var t=u;t<l;t+=this.par.pS.h)s=!1,n=!1,r=!1,h=!1,0==t&&0==this.par.pS.y&&(s=!0),t+(e=this.par.pS.h)>l&&(e=l-t,r=!0),t+e==l&&(r=!0),c=0,d=e/this.par.pS.h,this.naVV(t,e,s,r,c,d);this.par.arrDin.length=0;for(var i=0;i<this.par.sah;i++)this.par.arrDin[i]=this.par.array[i]},this.naVV=function(t,e,s,r,l,u){a=this.par.rect.w+this.par.rect.x,o=this.par.rect.x,0!=this.par.pS.x&&(h=!0,i=Math.abs(this.par.pS.x)%this.par.pS.w,d=1,c=1-i/this.par.pS.w,this.par.pS.x>0&&(i=((d=1)-(c=1-c))*this.par.pS.w),i>this.par.rect.w&&(i=this.par.rect.w,d=(i+c*this.par.pS.w)/this.par.pS.w),n=!1,p+i>a&&(n=!0),o+i==a&&(n=!0),this.creatNS(o,t,i,e,s,n,r,h,c,l,d,u),o+=i);for(var p=o;p<a;p+=this.par.pS.w)h=!1,p==o&&0==this.par.pS.x&&(h=!0),n=!1,p+(i=this.par.pS.w)>a&&(i=a-p,n=!0),p+i==a&&(n=!0),d=i/this.par.pS.w,this.creatNS(p,t,i,e,s,n,r,h,0,l,d,u)},this.creatNS=function(t,i,e,s,n,r,h,a,o,l,u,c){return(p=this.par.getR()).x=t,p.y=i,p.w=e,p.h=s,p.setP(t,i,e,s,n,r,h,a,o,l,u,c),p};var f,g={x:0,y:0},x={x:0,y:0},y=[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}],m={};m.tip=0,m.inBool=!1,m.inBool1=!1,m.pBool=!1,m.arrPos=[{x:0,y:0},{x:0,y:0}],m.p={x:0,y:0},m.p1={x:0,y:0},this.isRectLine=function(t,i){if(g.x=i.o.p.x,g.y=i.o.p.y,x.x=i.o.p1.x,x.y=i.o.p1.y,y[0].x=t.x,y[0].y=t.y,y[1].x=t.x+t.w,y[1].y=t.y,y[2].x=t.x+t.w,y[2].y=t.y+t.h,y[3].x=t.x,y[3].y=t.y+t.h,m.tip=0,f=g.x>x.x?this.par.calc.isPointInLin(g,x,y[0],99999999999,99999999999):this.par.calc.isPointInLin(x,g,y[0],99999999999,99999999999),m.pBool=!0,f&&f.z>0&&(m.pBool=!1),m.inBool=!1,t.x<=i.o.p.x&&t.x1>=i.o.p.x&&t.y<=i.o.p.y&&t.y1>=i.o.p.y&&(m.inBool=!0),m.inBool1=!1,t.x<=i.o.p1.x&&t.x1>=i.o.p1.x&&t.y<i.o.p1.y&&t.y1>=i.o.p1.y&&(m.inBool1=!0),1==m.inBool&&1==m.inBool1)return m.tip=3,m.p.x=i.o.p.x,m.p.y=i.o.p.y,m.p1.x=i.o.p1.x,m.p1.y=i.o.p1.y,m;let e=[];for(let t=0;t<y.length;t++){let i=this.par.calc.getPointOfIntersection(y[t],y[(t+1)%y.length],g,x);null!=i&&e.push({x:i.x,y:i.y})}if(m.tip=e.length>=2?2:e.length,e.length&&(m.arrPos[0]=e[0],1==m.inBool&&(m.arrPos[1].x=i.o.p.x,m.arrPos[1].y=i.o.p.y),1==m.inBool1&&(m.arrPos[1].x=i.o.p1.x,m.arrPos[1].y=i.o.p1.y),e.length>=2)){if(m.arrPos[0]=e[e.length-2],m.arrPos[1]=e[e.length-1],e.length>2){let t=function(t){for(var i=[],e=0;e<t.length;e++)i.some(function(i){return wt(i,t[e])})||i.push(t[e]);return i}(e);m.arrPos=t}return m.p.x=m.arrPos[0].x,m.p.y=m.arrPos[0].y,m.p1.x=m.arrPos[1].x,m.p1.y=m.arrPos[1].y,m}return m.p.x=m.arrPos[0].x,m.p.y=m.arrPos[0].y,m.p1.x=m.arrPos[1].x,m.p1.y=m.arrPos[1].y,m};var v,b,w=[],_=[],P=[],S=0,A=0,T={};T.rx=0,T.ry=0,T.ax=[],T.ay=[],T.ar=[],T.arBig=[],this.setBoxInRect=function(t,i,e){v=!1,null!=e&&(v=e),w.length=0,_.length=0,P.length=0,S=0,A=0,w[0]=0,_[0]=0,t.x<i.x&&(S=w.length,w.push((i.x-t.x)/t.w)),t.x1>i.x1&&w.push((i.x1-t.x)/t.w),t.y<i.y&&(A=_.length,_.push((i.y-t.y)/t.h)),t.y1>i.y1&&_.push((i.y1-t.y)/t.h),w.push(1),_.push(1);for(var s=0;s<T.arBig.length;s++)delete T.arBig[s];T.arBig.length=0;for(s=0;s<_.length-1;s++){null==T.arBig[s]&&(T.arBig[s]=[]);for(var n=0;n<w.length-1;n++)(W=this.par.getR()).x=t.x+t.w*w[n],W.x1=t.x+t.w*w[n+1],W.w=W.x1-W.x,W.u=t.u+(t.u1-t.u)*w[n],W.u1=t.u+(t.u1-t.u)*w[n+1],W.y=t.y+t.h*_[s],W.y1=t.y+t.h*_[s+1],W.h=W.y1-W.y,W.v=t.v+(t.v1-t.v)*_[s],W.v1=t.v+(t.v1-t.v)*_[s+1],T.arBig[s][n]=W,0==s&&(W.bool[0]=t.bool[0]),0==n&&(W.bool[3]=t.bool[3]),s==_.length-2&&(W.bool[2]=t.bool[2]),n==w.length-2&&(W.bool[1]=t.bool[1]),0==s&&(W.bool1[0]=t.bool1[0]),0==n&&(W.bool1[3]=t.bool1[3]),s==_.length-2&&(W.bool1[2]=t.bool1[2]),n==w.length-2&&(W.bool1[1]=t.bool1[1]),n==S&&s==A?1==v&&P.push(W):(P.push(W),void 0===i.tipe&&(s==A&&(n+1==S&&(W.bool1[1]=!0),n-1==S&&(W.bool1[3]=!0)),n==S&&(s+1==A&&(W.bool1[2]=!0),s-1==A&&(W.bool1[0]=!0))))}for(n=0;n<P.length;n++)this.par.arrDin.push(P[n]);return T.rx=S,T.ry=A,T.ax=w,T.ay=_,T.ar=P,T},this.finalPro=function(){this.par.minL=99999,this.par.minR=99999;for(var t=this.par.arrDin.length-1;t>=0;t--)this.finalProBox(this.par.arrDin[t]);this.par.area=0;for(t=this.par.arrDin.length-1;t>=0;t--)this.par.area+=this.par.arrDin[t].getArea(),b=!1,1==this.par.arrDin[t].boolPoli?b=!0:0==this.par.arrDin[t].boolOt&&(b=!0),1==b&&this.par.rect.x==this.par.arrDin[t].x&&this.par.minL>this.par.arrDin[t].y&&(this.par.minL=this.par.arrDin[t].y),b=!1,1==this.par.arrDin[t].boolPoli&&(b=!0,1==this.par.arrDin[t].boolNa&&(b=!1)),1==b&&0!=Math.round(this.par.arrDin[t].w)&&Math.round(this.par.rect.x+this.par.rect.w)==Math.round(this.par.arrDin[t].x+this.par.arrDin[t].w)&&(this.par.boolDebug,this.par.minR>this.par.arrDin[t].y&&(this.par.boolDebug,this.par.minR=this.par.arrDin[t].y))},this.finalProBox=function(t){0!=t.w&&0!=t.h||this.par.removeDin(t)};var E,M,D,z,R,B,C,L={x:0,y:0},O={x:0,y:0},I={x:0,y:0},k={x:0,y:0};this.getP4=function(t,i,e,s,n,r,h,a){return L.x=t,L.y=i,O.x=e,O.y=s,I.x=n,I.y=r,k.x=h,k.y=a,this.getPointOfIntersection(L,O,I,k)};var j={x:0,y:0};this.getPointOfIntersection=function(t,i,e,s){return E=(t.x-i.x)*(s.y-e.y)-(t.y-i.y)*(s.x-e.x),M=(t.x-e.x)*(s.y-e.y)-(t.y-e.y)*(s.x-e.x),D=(t.x-i.x)*(t.y-e.y)-(t.y-i.y)*(t.x-e.x),R=D/E,(z=M/E)>=0&&z<=1&&R>=0&&R<=1?(B=t.x+z*(i.x-t.x),C=t.y+z*(i.y-t.y),j.x=B,j.y=C,j):null},this.tPoint=function(t,i,e,s){return trace(t,i,e,s),t==e&&i==s};var H,F,N,V=[],G=[],X=[];this.setGeomLine=function(t){V.length=0;for(var i=0;i<this.par.arrDin.length;i++)this.setGeomLineB(this.par.arrDin[i]);t.setAttribute("position",new THREE.Float32BufferAttribute(V,3))},this.setGeom=function(t,i){F=0,null!=i&&(F=i),V.length=0,G.length=0,X.length=0,H=!1;for(var e=0;e<this.par.arrDin.length;e++)this.setGeomB(this.par.arrDin[e]);for(e=0;e<V.length;e++)if(1==isNaN(V[e])){H=!0;break}t.setAttribute("uv",new THREE.Float32BufferAttribute(G,2)),t.setAttribute("position",new THREE.Float32BufferAttribute(V,3)),t.setAttribute("normal",new THREE.Float32BufferAttribute(X,3)),t.computeBoundingBox(),H||t.computeBoundingSphere()},this.setGeomBool1=function(t,i,e){N=i/2,V.length=0,G.length=0,X.length=0;for(var s=0;s<this.par.arrDin.length;s++)this.setGB1(this.par.arrDin[s]);t.setAttribute("uv",new THREE.Float32BufferAttribute(G,2)),t.setAttribute("position",new THREE.Float32BufferAttribute(V,3)),t.setAttribute("normal",new THREE.Float32BufferAttribute(X,3)),t.computeBoundingBox(),t.computeBoundingSphere()};var U,Y,W,Q=new THREE.Vector3,Z=new THREE.Vector3,K=new THREE.Vector3;this.setGB1=function(t){!0===t.bool1[0]&&(Q.set(t.x,0,t.y),Z.set(t.x+t.w,0,t.y),K.set(0,0,1),this.drawB1()),!0===t.bool1[1]&&(Q.set(t.x+t.w,0,t.y),Z.set(t.x+t.w,0,t.y+t.h),K.set(0,0,1),this.drawB1()),!0===t.bool1[2]&&(Q.set(t.x+t.w,0,t.y+t.h),Z.set(t.x,0,t.y+t.h),K.set(0,0,1),this.drawB1()),!0===t.bool1[3]&&(Q.set(t.x,0,t.y+t.h),Z.set(t.x,0,t.y),K.set(0,0,1),this.drawB1())},this.drawB1=function(){V.push(Q.x,-N,Q.z),V.push(Q.x,N,Q.z),V.push(Z.x,-N,Z.z),G.push(0,0),G.push(0,1),G.push(1,0),X.push(K.x,K.y,K.z),X.push(K.x,K.y,K.z),X.push(K.x,K.y,K.z),V.push(Q.x,N,Q.z),V.push(Z.x,N,Z.z),V.push(Z.x,-N,Z.z),G.push(0,1),G.push(1,1),G.push(1,0),X.push(K.x,K.y,K.z),X.push(K.x,K.y,K.z),X.push(K.x,K.y,K.z),V.push(Q.x,N,Q.z),V.push(Q.x,-N,Q.z),V.push(Z.x,-N,Z.z),G.push(0,1),G.push(0,0),G.push(1,0),X.push(-1*K.x,-1*K.y,-1*K.z),X.push(-1*K.x,-1*K.y,-1*K.z),X.push(-1*K.x,-1*K.y,-1*K.z),V.push(Z.x,N,Z.z),V.push(Q.x,N,Q.z),V.push(Z.x,-N,Z.z),G.push(1,1),G.push(0,1),G.push(1,0),X.push(-1*K.x,-1*K.y,-1*K.z),X.push(-1*K.x,-1*K.y,-1*K.z),X.push(-1*K.x,-1*K.y,-1*K.z)},this.drawStroke=function(t){if(t.sides.length){const{sides:i}=t;i.forEach(i=>{const{side:e,size:s,isLeft:n,isDown:r}=i;0===e&&V.push(n?t.x+t.w:t.x+t.w-s,t.y+t.h,0,n?t.x+s:t.x,t.y+t.h,0),1===e&&V.push(t.x,r?t.y+t.h-s:t.y+t.h,0,t.x,r?t.y:t.y+s,0),2===e&&V.push(n?t.x+s:t.x,t.y,0,n?t.x+t.w:t.x+t.w-s,t.y,0),3===e&&V.push(t.x+t.w,r?t.y:t.y+s,0,t.x+t.w,r?t.y+t.h-s:t.y+t.h,0)})}},this.setGeomLineB=function(t){!0!==t.bool[0]&&!0!==t.bool1[0]||V.push(t.x,t.y,0,t.x+t.w,t.y,0),!0!==t.bool[1]&&!0!==t.bool1[1]||V.push(t.x+t.w,t.y,0,t.x+t.w,t.y+t.h,0),!0!==t.bool[2]&&!0!==t.bool1[2]||V.push(t.x+t.w,t.y+t.h,0,t.x,t.y+t.h,0),!0!==t.bool[3]&&!0!==t.bool1[3]||V.push(t.x,t.y+t.h,0,t.x,t.y,0),1==t.boolNa&&(1==t.boolPoli?V.push(t.x,t.y,0,t.x+t.w,t.y+t.h,0):V.push(t.x+t.w,t.ysetGeom,0,t.x,t.y,0))},this.setGeomB=function(t){1==(U=t).boolPoli?0==U.boolNa?(this.sGm(1,0,2),this.sGm(0,3,2)):1==U.boolOt?this.sGm(1,0,2):this.sGm(0,3,2):0==U.boolNa?(this.sGm(2,1,3),this.sGm(3,1,0)):1==U.boolOt?this.sGm(2,1,3):this.sGm(3,1,0)},this.sGm=function(t,i,e){0==F&&(this.sGmL(t,!1),this.sGmL(i,!1),this.sGmL(e,!1)),1==F&&(this.sGmL(i,!0),this.sGmL(t,!0),this.sGmL(e,!0)),2==F&&(this.sGmL(t,!1),this.sGmL(i,!1),this.sGmL(e,!1),this.sGmL(i,!0),this.sGmL(t,!0),this.sGmL(e,!0))},this.sGmL=function(t,i){1==i?X.push(0,0,1):X.push(0,0,-1),0==t&&(V.push(U.x,U.y,0),G.push(U.u,U.v)),1==t&&(V.push(U.x+U.w,U.y,0),G.push(U.u1,U.v)),2==t&&(V.push(U.x+U.w,U.y+U.h,0),G.push(U.u1,U.v1)),3==t&&(V.push(U.x,U.y+U.h,0),G.push(U.u,U.v1))},this.arrLine=[],this.arrLineCesh=[],this.clearAL=function(){this.arrLine.length=0},this.getLine=function(){return null==this.arrLineCesh[this.arrLine.length]&&(this.arrLineCesh[this.arrLine.length]={p:{x:0,y:0},p1:{x:0,y:-100}}),this.arrLine.push(this.arrLineCesh[this.arrLine.length]),this.arrLine[this.arrLine.length-1]},this.getLine1=function(){this.clearAL();for(var t=this.par.arrDin.length-1;t>=0;t--)1==this.par.arrDin[t].boolNa?(W=this.par.arrDin[t],Y=this.getLine(),1==W.boolPoli?this.setLine(W.x,W.y,W.x+W.w,W.y+W.h,Y):this.setLine(W.x,W.y+W.h,W.x+W.w,W.y,Y)):1==this.par.arrDin[t].bool[0]&&(Y=this.getLine(),this.setLine(this.par.arrDin[t].x,this.par.arrDin[t].y,this.par.arrDin[t].x+this.par.arrDin[t].w,this.par.arrDin[t].y,Y));return this.arrLine},this.setLine=function(t,i,e,s,n){n.p.x=t,n.p.y=i,n.p1.x=e,n.p1.y=s}}}function wt(t,i){var e;for(e in t)if(t[e]!==i[e])return!1;for(e in i)if(i[e]!==t[e])return!1;return!0}class _t{constructor(t){this.type="KRUColi";this.par=t,this.arrWinChesh=[];var i,e=0;this.getW=function(){return null==this.arrWinChesh[e]&&(this.arrWinChesh[e]=new Pt(this),this.arrWinChesh[e].idArr=e),e++,this.arrWinChesh[e-1]},this.korectRect=function(){e=0,this.par.arrWinDin.length=0;for(var t=0;t<this.par.arrWin.length;t++)(i=this.getW()).setRect(this.par.arrWin[t]),this.par.arrWinDin.push(i);if(null!=this.par.coliz){if(this.par.coliz.array)for(t=0;t<this.par.coliz.array.length;t++)for(var s=0;s<this.par.coliz.array[t].array.length;s++)(i=this.getW()).setShape(this.par.coliz.array[t].array[s],this.par.coliz.array[t],this.par.colizX,this.par.colizY),this.par.arrWinDin.push(i);if(this.par.coliz[0])for(t=0;t<this.par.coliz.length;t++)this.par.coliz[t].boxColizi.boolSten&&((i=this.getW()).setxywh(this.par.coliz[t].boxColizi.rectCollisMeshdy.x+this.par.colizX,this.par.coliz[t].boxColizi.rectCollisMeshdy.y+this.par.colizY,this.par.coliz[t].boxColizi.rectCollisMeshdy.width,this.par.coliz[t].boxColizi.rectCollisMeshdy.height),this.par.arrWinDin.push(i))}}}}class Pt{constructor(){this.type="KRBodyRect";this.idArr=-1,this.x=0,this.y=0,this.w=100,this.h=100,this.x1=0,this.y1=0,this.setRect=function(t){this.x=t.x,this.y=t.y,this.w=t.w,this.h=t.h,this.x1=t.x+t.w,this.y1=t.y+t.h},this.setShape=function(t,i,e,s){this.x=t.rect.x+i.position.x+e,this.y=s-i.position.y,this.w=t.rect.w,this.h=t.rect.h,this.x1=this.x+this.w,this.y1=this.y+this.h},this.setxywh=function(t,i,e,s){this.x=t,this.y=i,this.w=e,this.h=s,this.x1=t+e,this.y1=i+s}}}class St{constructor(){this.type="KRGronRect";var t,i;this.idArr=-1,this.boolForsLine=!1,this.x=0,this.y=0,this.w=1e3,this.h=1e3,this.u=0,this.v=0,this.u1=1,this.v1=1,this.area=0,this.sides=[],this.boolPoli=!0,this.boolNa=!1,this.boolOt=!1,this.bool=[!1,!1,!1,!1],this.bool1=[!1,!1,!1,!1],this.set=function(i){for(this.x=i.x,this.y=i.y,this.w=i.w,this.h=i.h,this.u=i.u,this.v=i.v,this.u1=i.u1,this.v1=i.v1,this.sides=i.sides,t=0;t<4;t++)this.bool[t]=i.bool[t],this.bool1[t]=i.bool1[t];this.area=this.w*this.h},this.setP=function(t,i,e,s,n,r,h,a,o,l,u,c){this.x=t,this.y=i,this.w=e,this.h=s,this.bool[0]=n,this.bool[1]=r,this.bool[2]=h,this.bool[3]=a,this.sides=[],this.u=o,this.v=l,this.u1=u,this.v1=c,this.area=this.w*this.h},this.clear=function(){for(t=0;t<4;t++)this.bool[t]=!1,this.bool1[t]=!1;this.sides.length=0,this.boolPoli=!0,this.boolNa=!1,this.boolOt=!1,this.boolForsLine=!1},this.getArea=function(){return i=this.w*this.h,this.boolNa&&(i/=2),i}}}class At{constructor(){this.type="KRGronLine",this.tipe="KRGronLine";var t;this.idArr=-1,this.x=0,this.y=0,this.x1=0,this.y1=0,this.w=1e3,this.h=1e3,this.area=0,this.type=0,this.angel=0,this.o=void 0,this.setLine=function(i){this.o=i,this.type=0,this.angel=this.getAngle(i.p,i.p1)*(180/Math.PI),(t=Math.round(this.angel))>=0&&t<=90&&(this.type=1),t>=-180&&t<=-90&&(this.type=1),i.p.x==i.p.x1&&(this.type=2),i.p.y==i.p.y1&&(this.type=3),this.o=i,this.x=i.p.x,this.x1=i.p1.x,i.p1.x<this.x&&(this.x=i.p1.x,this.x1=i.p.x),this.w=this.x1-this.x,this.y=i.p.y,this.y1=i.p1.y,i.p1.y<this.y&&(this.y=i.p1.y,this.y1=i.p.y),this.h=this.y1-this.y,this.area=this.w*this.h},this.clear=function(){},this.getAngle=function(t,i){return i=i||rezNull,t=t||rezNull,Math.atan2(i.y-t.y,i.x-t.x)}}}class Tt{constructor(t){this.type="KorektRect";var i,e,s,n,r,h,a,o;this.fun=t,this.boolDebug=!0,this._funRender=void 0,this.uuid=Math.random(),this.minL=-999999,this.minR=-999999,this.pS={x:0,y:0,w:200,h:200},this.area=0,this.rect={x:0,y:0,w:800,h:300},this.r={x:0,y:0,w:10,h:10,type:0},this.r1={x:0,y:0,w:10,h:10,type:0},this.array=[],this.arrayL=[],this.arrayCesh=[],this.arrDin=[],this.arrDinL=[],this.colizX=0,this.colizY=0,this.coliz=null,this.arrWin=[],this.arrWinDin=[],this.arrLine=[{p:{x:0,y:-100},p1:{x:0,y:-100}}],this.calc=new mt,this.boolVergDrag=!1,this.krUmnik=new bt(this),this.krUColi=new _t(this),this.setSten=function(t,e,s){s=s||0,i=null!=t.width?t.width:t._distans,this.rect.x=-200,this.rect.w=i- -200+s,this.rect.x1=this.rect.x+this.rect.w,this.rect.y=0,this.rect.h=t.height,this.rect.h1=t.height1},this.removeDin=function(t){for(var i=!1,e=this.arrDin.length-1;e>=0;e--)this.arrDin[e].idArr==t.idArr&&(this.arrDin.splice(e,1),i=!0);return 1==i&&t.clear(),i},this.sah=0,this.setRect=function(t){this.rect=t},this.clear=function(){this.sah=0,this.sahL=0;for(var t=0;t<this.array.length;t++)this.array[t].clear();for(t=0;t<this.arrayL.length;t++)this.arrayL[t].clear()},this.getR=function(){return null==this.array[this.sah]&&(this.array[this.sah]=new St,this.array[this.sah].idArr=this.sah),this.sah++,this.array[this.sah-1]},this.sahL=0,this.getL=function(){return null==this.arrayL[this.sahL]&&(this.arrayL[this.sahL]=new At,this.arrayL[this.sahL].idArr=this.sahL),this.sahL++,this.arrayL[this.sahL-1]},this.korektGrid=function(){this.boolVergDrag=!1,this.clear(),this.naStart(),this.reshik(),this.reshikLine(),this.finalPro(),this.render()},this.naStart=function(){this.krUmnik.naStart()},this.reshik=function(){this.krUColi.korectRect();for(var t=0;t<this.arrWinDin.length;t++)for(var i=this.arrDin.length-1;i>=0;i--)this.reshik2Old(i,this.arrDin[i],this.arrWinDin[t])},this.isRectInsideWindow=function(t,i){return t.x>=i.x&&t.x1<=i.x1&&t.y>=i.y&&t.y1<=i.y1},this.isAdjacent=function(t,i){const e=(t,i,e,s)=>e>=t&&e<=i||t>=e&&t<=s;let s=e(t.x,t.x1,i.x,i.x1),n=e(t.y,t.y1,i.y,i.y1);return(t.x1!=i.x||t.y1!=i.y)&&((t.x!=i.x1||t.y1!=i.y)&&((t.x1!=i.x||t.y!=i.y1)&&((t.x!=i.x1||t.y!=i.y1)&&!(!s||!n))))},this.getMatchEdges=((t,i)=>{const e=t.y1==i.y,s=t.y==i.y1,n=t.x1==i.x,r=t.x==i.x1,{sides:o}=t;let l,u,c,d;if(e||s){if(t.x==i.x&&t.x1==i.x1)return void o.push({size:0,side:e?0:2});if(t.x1<=i.x1&&t.x<i.x)return u=e?0:2,h=(i.x-t.x)/t.w,c=!0,l=t.w*h,void o.push({size:l,side:u,isLeft:c});if(t.x>=i.x&&t.x1>i.x1)return u=e?0:2,h=(i.x1-t.x)/t.w,a=t.w*h,c=!1,l=t.w-a,void o.push({size:l,side:u,isLeft:c});if(t.x<i.x&&(t.x1,i.x1),e&&t.y<i.y)return void o.push({size:0,side:0});if(s&&t.y1>i.y1)return void o.push({size:0,side:2})}if(n||r){if(t.y==i.y&&t.y1==i.y1)return void o.push({size:0,side:r?1:3});if(t.y1<=i.y1&&t.y<i.y)return u=r?1:3,h=(i.y-t.y)/t.h,l=t.h*h,d=!1,void o.push({size:l,side:u,isDown:d});if(t.y>=i.y&&t.y1>i.y1)return u=r?1:3,h=(i.y1-t.y)/t.h,a=t.h*h,l=t.h-a,d=!0,void o.push({side:u,size:l,isDown:d});if(r&&t.x1>i.x1)return void o.push({side:1,size:0});if(n&&t.x<i.x)return void o.push({side:3,size:0})}}),this.endCoords=function(t){t.x1=t.x+t.w,t.y1=t.y+t.h},this.rectIntersect=function(t,i){return i.y<t.y1&&i.y1>t.y&&i.x<t.x1&&i.x1>t.x},this.reshik2=function(t,i,e){if(this.endCoords(i),this.endCoords(e),this.isAdjacent(i,e)){if(this.isRectInsideWindow(i,e))return void this.arrDin.splice(t,1);if(this.getMatchEdges(i,e),!this.rectIntersect(i,e))return;return this.krUmnik.setBoxInRect(i,e),void this.arrDin.splice(t,1)}},this.testLine=function(t,i,e,s){return e>=t&&e<i||t>=e&&t<s},this.reshik2Old=function(t,i,l){if(i.x1=i.x+i.w,i.y1=i.y+i.h,l.x1=l.x+l.w,l.y1=l.y+l.h,e=this.testLine(i.x,i.x1,l.x,l.x1),s=this.testLine(i.y,i.y1,l.y,l.y1),n=!1,i.x>=l.x&&i.x1<=l.x1&&(n=!0),r=!1,i.y>=l.y&&i.y1<=l.y1&&(r=!0),1==e&&1==s){if(n&&r)return void this.arrDin.splice(t,1);if(1==r){if(i.x<l.x&&i.x1>l.x)return o=null,i.x1>l.x1&&((o=this.getR()).set(i),this.arrDin.push(o),o.x1=o.x+o.w,o.y1=o.y+o.h),h=(l.x-i.x)/i.w,i.w=i.w*h,i.u1=i.u+(i.u1-i.u)*h,i.bool1[1]=!0,i.bool[1]=!1,void(null!==o&&(h=(l.x1-o.x)/o.w,a=o.w*h,o.w=o.w-a,o.x+=a,o.u=o.u+(o.u1-o.u)*h,o.bool1[3]=!0,o.bool[3]=!1));if(i.x>l.x&&i.x<l.x1)return h=(l.x1-i.x)/i.w,a=i.w*h,i.w=i.w-a,i.x+=a,i.u=i.u+(i.u1-i.u)*h,i.bool1[3]=!0,void(i.bool[3]=!1)}if(1==n){if(i.y<l.y&&i.y1>l.y)return o=null,i.y1>l.y1&&((o=this.getR()).set(i),this.arrDin.push(o),o.x1=o.x1,o.y1=o.y1),h=(l.y-i.y)/i.h,i.h=i.h*h,i.v1=i.v+(i.v1-i.v)*h,i.bool1[2]=!0,i.bool[2]=!1,void(null!==o&&(h=(l.y1-o.y)/o.h,a=o.h*h,o.h=o.h-a,o.y+=a,o.v=o.v+(o.v1-o.v)*h,o.bool1[0]=!0,o.bool[0]=!1));if(i.y>l.y&&i.y<l.y1)return h=(l.y1-i.y)/i.h,a=i.h*h,i.h=i.h-a,i.y+=a,i.v=i.v+(i.v1-i.v)*h,i.bool1[0]=!0,void(i.bool[0]=!1)}return this.krUmnik.setBoxInRect(i,l),void this.arrDin.splice(t,1)}};var l,u={x:0,y:0},c={x:0,y:0},d={x:0,y:0,x1:0,y1:0,w:0,w:0,o:null};this.reshikLine=function(){var t,i;for(i=0;i<this.arrLine.length;i++)this.getL().setLine(this.arrLine[i]);for(i=0;i<this.sahL;i++)for(d=this.arrayL[i],t=this.arrDin.length-1;t>=0;t--)this.reshikLine1(t,this.arrDin[t],d,!1);for(t=this.arrDin.length-1;t>=0;t--)for(i=0;i<this.sahL;i++)d=this.arrayL[i],this.reshikLine2(t,this.arrDin[t],d,!0)};var p,f,g,x=new At;this.reshikLine1=function(t,i,e,s){i.x1=i.x+i.w,i.y1=i.y+i.h,e.x>=i.x1||e.x1<=i.x||e.y1<=i.y||e.y>=i.y1&&1==this.nahVerh(t,i,e)||(0!=(l=this.krUmnik.isRectLine(i,e)).tip?(this.boolVergDrag=!0,3==l.tip&&1==this.nafigRect(t,i,e)||1==l.tip&&(x.setLine(l),1==this.nafigRect(t,i,x))||2!=l.tip||(x.setLine(l),this.nafigRect(t,i,x,s))):1==l.pBool&&this.nahVerh(t,i,e))},this.reshikLine2=function(t,i,e,s){if(i.x1=i.x+i.w,i.y1=i.y+i.h,!(e.x>=i.x1||e.x1<=i.x||e.y1<=i.y||1==i.boolNa||(u.x=i.x,u.y=i.y,c.x=i.x1,c.y=i.y,1!=this.isPoints(c,e.o.p1,1e3)))){let s=calc.isPointInLin(e.o.p,e.o.p1,u,9999,9999);s&&s.z>0&&this.reshikLine1(t,i,e)}},this.isPoints=function(t,i,e){if(e){if(Math.round(t.x*e)==Math.round(i.x*e)&&Math.round(t.y*e)==Math.round(i.y*e))return!0}else if(t.x==i.x&&t.y==i.y)return!0;return!1},this.nafigRect=function(t,i,e,s){if(p=this.krUmnik.setBoxInRect(i,e,!0),1==e.type){p.arBig[p.ry][p.rx].boolPoli=!0,p.arBig[p.ry][p.rx].boolNa=!0,p.arBig[p.ry][p.rx].boolOt=!1,null!=p.arBig[p.ry][p.rx-1]&&(p.arBig[p.ry][p.rx-1].bool1[1]=!1);for(var n=0;n<p.arBig.length;n++)p.arBig[n][p.rx+1]&&this.nahVerh(null,p.arBig[n][p.rx+1],d)}if(0==e.type){p.arBig[p.ry][p.rx].boolPoli=!1,p.arBig[p.ry][p.rx].boolNa=!0,p.arBig[p.ry][p.rx].boolOt=!0,null!=p.arBig[p.ry][p.rx+1]&&(p.arBig[p.ry][p.rx+1].bool1[3]=!1);for(n=0;n<p.arBig.length;n++)p.arBig[n][p.rx-1]&&this.nahVerh(null,p.arBig[n][p.rx-1],d)}return null!=p.arBig[p.ry+1]&&(p.arBig[p.ry+1][p.rx].bool1[0]=!1),null!=p.arBig[p.ry-1]&&(this.removeDin(p.arBig[p.ry-1][p.rx]),0==p.arBig[p.ry][p.rx].h&&null!=p.arBig[p.ry+1]&&(p.arBig[p.ry+1][p.rx].bool[0]=!0)),this.arrDin.splice(t,1),!0},this.nahVerh=function(t,i,e){return f=!1,i.x<e.x&&(f=!0),g=!0,i.x1<e.x1&&(g=!1),0==f&&0==g?(this.removeDin(i),!0):1==f&&0==g?(h=(e.x-i.x)/i.w,i.w=i.w*h,i.u1=i.u+(i.u1-i.u)*h,i.bool[1]=!1,!0):0==f&&1==g?(h=(e.x1-i.x)/i.w,a=i.w*h,i.w=i.w-a,i.x+=a,i.u=i.u+(i.u1-i.u)*h,i.bool[3]=!1,!0):1==f&&1==g&&((o=this.getR()).set(i),this.arrDin.push(o),o.x1=i.x1,o.y1=i.y1,h=(e.x1-o.x)/o.w,a=o.w*h,o.w=o.w-a,o.x+=a,o.u=o.u+(o.u1-o.u)*h,o.bool[3]=!1,h=(e.x-i.x)/i.w,i.w=i.w*h,i.u1=i.u+(i.u1-i.u)*h,i.bool[1]=!1,!0)},this.finalPro=function(){this.krUmnik.finalPro()},this.setGeomLine=function(t){this.krUmnik.setGeomLine(t)},this.setGeom=function(t,i){this.krUmnik.setGeom(t,i)},this.setGeomBool1=function(t,i,e){this.krUmnik.setGeomBool1(t,i,e)},this.getLine1=function(){return this.krUmnik.getLine1()},this._funRender,this.render=function(){0!=this.boolDebug&&null!=this._funRender&&this.funRender()}}set funRender(t){this._funRender!==t&&(this._funRender=t)}get funRender(){return this._funRender}}class Et{constructor(){var t=this;this._width=100,this._height=100,this.div=document.createElement("div"),this.div.style.position="fixed",this.div.style.top="0px",this.div.style.left="0px",this.stage=new PIXI.Container,this.content2d=new PIXI.Container,this.stage.addChild(this.content2d),this.renderer=new PIXI.autoDetectRenderer(this._width,this._height,{antialias:!0,transparent:!0,preserveDrawingBuffer:!0}),this.renderer.view.style.position="fixed",this.div.appendChild(this.renderer.view),this.render=function(){t.renderer.render(t.stage)},this.sizeWindow=function(i,e){i&&(t._width=i,t._height=e),t.renderer.view.style.width=t._width+"px",t.renderer.view.style.height=t._height+"px",t.renderer.resize(t._width,t._height),t.renderer.resolution=2}}}class Mt{constructor(t,i,e){this.type="DebKR";var s=this;this.visi3D=e,this.fun=i,this._active=!1,this._otstup=5,this._width=600,this._height=600;this.dCont=new DCont(t),this.cont3d=new THREE.Object3D,this.cont3d.visible=this._active,this.pan=new DPanel(this.dCont,50,50),this.pan.width=this._width,this.pan.height=this._height,this.pan.visible=this.active,this.window=void 0;var n,r,h=0;this.sss=function(){n=(new Date).getTime();let t=r.boolDebug;r.boolDebug=!0;for(var i=0;i<s.sliItar.value;i++)r.korektGrid();r.boolDebug=t,this.saveTime()},this.save1=function(){this.fun&&this.fun("saveLocal")},this.sah=0,this.saveTime=function(){this.sah++;var t=this.sah;setTimeout(function(){s.sah==t&&s.save1()},500)},this.setObjLoc=function(t){if(r&&t){r.pS.x=t.pS.x,r.pS.y=t.pS.y,r.pS.w=t.pS.w,r.pS.h=t.pS.h,r.rect=t.rect,r.arrLine=[];for(var i=0;i<t.arrLine.length;i++){r.arrLine[i]={p:{x:t.arrLine[i].x,y:t.arrLine[i].y},p1:{x:t.arrLine[i].x1,y:t.arrLine[i].y1}}}null!=this.window&&(this.slider.value=r.pS.x,this.slider1.value=r.pS.y,this.slider2.value=r.pS.w,this.slider3.value=r.pS.h,r.arrLine[0]&&(this.sli.value=r.arrLine[0].p.x,this.sli1.value=r.arrLine[0].p.y,this.sli2.value=r.arrLine[0].p1.x,this.sli3.value=r.arrLine[0].p1.y)),this.sss()}},this.getObjLoc=function(t){t={};if(r){t.pS={},t.pS.x=r.pS.x,t.pS.y=r.pS.y,t.pS.w=r.pS.w,t.pS.h=r.pS.h,t.rect={x:r.rect.x,y:r.rect.y,w:r.rect.w,h:r.rect.h},t.arrLine=[];for(var i=0;i<r.arrLine.length;i++)t.arrLine[i]={},t.arrLine[i].x=r.arrLine[i].p.x,t.arrLine[i].y=r.arrLine[i].p.y,t.arrLine[i].x1=r.arrLine[i].p1.x,t.arrLine[i].y1=r.arrLine[i].p1.y}return t},this.init=function(){if(null==this.window){this.window=new DWindow(this.dCont),this.visi3D.groupObject.add(this.cont3d),this.cont3d.position.y=100,this.cont3d.position.z=-20,this.lineBasicMaterial=new THREE.LineBasicMaterial({color:16711680,linewidth:10}),this.plXZ=new Dt,this.lineSegments=new THREE.LineSegments(this.plXZ,this.lineBasicMaterial),this.cont3d.add(this.lineSegments),this.texture=(new THREE.TextureLoader).load("resources/image/pic.png"),this.texture.wrapS=THREE.RepeatWrapping,this.texture.wrapT=THREE.RepeatWrapping,this.texture.repeat.y=-1,this.meshBasicMaterial=new THREE.MeshBasicMaterial({color:16777215,map:this.texture}),this.plXZ2=new Dt,this.mesh=new THREE.Mesh(this.plXZ2,this.meshBasicMaterial),this.cont3d.add(this.mesh),this.window.width=200,this.slider=new DSliderBig(this.window.content,2,2,function(){r.pS.x=this.value,s.sss()},"x",-1e3,1e3),this.slider1=new DSliderBig(this.window.content,2,54,function(){r.pS.y=this.value,s.sss()},"y",-1e3,1e3),this.slider2=new DSliderBig(this.window.content,2,106,function(){r.pS.w=this.value,s.sss()},"w",10,1e3),this.slider3=new DSliderBig(this.window.content,2,158,function(){r.pS.h=this.value,s.sss()},"h",10,1e3),this.slider.width=this.slider1.width=this.slider2.width=this.slider3.width=this.window.width-4,this.slider.value=r.pS.x,this.slider1.value=r.pS.y,this.slider2.value=r.pS.w,this.slider3.value=r.pS.h,this.window.height=210,this.win=new DWindow(this.dCont,400),this.win.width=200,this.sli=new DSliderBig(this.win.content,2,2,function(){r.arrLine[0].p.x=this.value,r.arrLine[1]&&(r.arrLine[1].p.x=this.value),s.sss()},"x",-1e3,1e3),this.sli1=new DSliderBig(this.win.content,2,54,function(){r.arrLine[0].p.y=this.value,r.arrLine[1]&&(r.arrLine[1].p.y=this.value),s.sss()},"y",-1e3,1e3),this.sli2=new DSliderBig(this.win.content,2,106,function(){r.arrLine[0].p1.x=this.value,s.sss()},"x1",-1e3,1e3),this.sli3=new DSliderBig(this.win.content,2,158,function(){r.arrLine[0].p1.y=this.value,s.sss()},"y1",-1e3,1e3),this.button=new DButton(this.win.content,2,210,"revert",function(){var t=r.arrLine[0].p.x,i=r.arrLine[0].p.y;r.arrLine[0].p.x=r.arrLine[0].p1.x,r.arrLine[0].p.y=r.arrLine[0].p1.y,r.arrLine[0].p1.x=t,r.arrLine[0].p1.y=i,s.sss()}),this.sli.width=this.sli1.width=this.sli2.width=this.sli3.width=this.win.width-4,r.arrLine[0]&&(this.sli.value=r.arrLine[0].p.x,this.sli1.value=r.arrLine[0].p.y,this.sli2.value=r.arrLine[0].p1.x,this.sli3.value=r.arrLine[0].p1.y),this.win.height=262,this.win1=new DWindow(this.dCont,600),this.win1.width=200;var t=2;this.check=new DCheckBox(this.win1.content,2,t,"нафиг дебаг",function(){s.sss()}),t+=25,this.check1=new DCheckBox(this.win1.content,2,t,"нафиг геометрию",function(){s.sss()}),t+=25,this.check2=new DCheckBox(this.win1.content,2,t,"текст нах",function(){s.sss()}),t+=25,this.sliItar=new DSliderBig(this.win1.content,2,t,function(){s.sss()},"кол. итораций",1,200),this.sliItar.width=this.win1.width-4,this.sliItar.okrug=1,s.sliItar.value=1,t+=50,this.b0=new DButton(this.win1.content,2,t,"0",function(){h=0,s.sss()}),this.b1=new DButton(this.win1.content,36,t,"1",function(){h=1,s.sss()}),this.b2=new DButton(this.win1.content,70,t,"2",function(){h=2,s.sss()}),this.b0.width=this.b1.width=this.b2.width=32,t+=34,this.button=new DButton(this.win1.content,2,t,"add Random Line",function(){var t=100+r.rect.w,i=100+r.rect.h;r.arrLine.push({p:{x:Math.random()*t-50,y:Math.random()*i-50},p1:{x:Math.random()*t-50,y:Math.random()*i-50}}),s.sss()}),t+=34,this.button1=new DButton(this.win1.content,2,t,"add Random Rect",function(){var t=100+r.rect.w,i=100+r.rect.h;r.arrWin.push({w:10+200*Math.random(),h:10+200*Math.random(),x:Math.random()*t-50,y:Math.random()*i-50}),s.sss()}),t+=34,this.button.width=this.button1.width=this.win1.width-4,this.button2=new DButton(this.win1.content,2,t,"get",function(){var t=s.getObjLoc();s.input7.value=JSON.stringify(t)}),this.button2.width=50,this.button3=new DButton(this.win1.content,54,t,"set",function(){var t=JSON.parse(s.input7.value);s.setObjLoc(t)}),this.button3.width=50,this.input7=new DInput(this.win1.content,106,t,"set",function(){}),this.input7.width=90;'{"pS":{"x":0,"y":0,"w":512,"h":512},"rect":{"x":0,"y":0,"w":511.74575051828486,"h":201},"arrLine":[{"x":0,"y":156.4446821759371,"x1":138.71108815385617,"y1":160.94508654840763},{"x":138.71108815385617,"y":160.94508654840763,"x1":235.62713817319522,"y1":33.639520145255716},{"x":235.62713817319522,"y":33.639520145255716,"x1":357.09193123869557,"y1":68.55520753689578},{"x":357.09193123869557,"y":68.55520753689578,"x1":404.22045839959264,"y1":142.5449165375449},{"x":404.22045839959264,"y":142.5449165375449,"x1":511.74575051828486,"y1":166.3078961938726}]}',this.input7.value='{"pS":{"x":0,"y":0,"w":512,"h":512},"rect":{"x":0,"y":0,"w":511.74575051828486,"h":201},"arrLine":[{"x":0,"y":156.4446821759371,"x1":138.71108815385617,"y1":160.94508654840763},{"x":138.71108815385617,"y":160.94508654840763,"x1":235.62713817319522,"y1":33.639520145255716},{"x":235.62713817319522,"y":33.639520145255716,"x1":357.09193123869557,"y1":68.55520753689578},{"x":357.09193123869557,"y":68.55520753689578,"x1":404.22045839959264,"y1":142.5449165375449},{"x":404.22045839959264,"y":142.5449165375449,"x1":511.74575051828486,"y1":166.3078961938726}]}',t+=34,this.win1.height=t+34,setTimeout(function(){var t=JSON.parse(s.input7.value);s.setObjLoc(t)},500)}},this.kr,this.setKR=function(t){this.kr=t,r=t,this.init()},this.visiPixi=void 0,this.content2d=new PIXI.Container,this.content2d.position.x=50,this.content2d.position.y=50,this.debugPixi=new yt,this.content2d.addChild(this.debugPixi.content2d);var a=this.debugPixi;this.drag=function(){if(0==s.check.value){null==s.visiPixi&&(s.visiPixi=new Et,s.visiPixi.content2d.addChild(s.content2d),s.dCont.div.appendChild(s.visiPixi.div)),s.pan.width=Math.round(1*s.kr.rect.w),s.pan.height=Math.round(1*s.kr.rect.h),s.width=s.pan.width+100,s.height=s.pan.height+100,null!=s.window&&(s.window.x=300,s.window.y=s.pan.height+100,s.win.x=600,s.win.y=s.pan.height+100,s.win1.x=30,s.win1.y=s.pan.height+100),a.clear(),a.dRect(s.kr.rect,65280,4,!0),a.dRect(s.kr.rect,65280,4);for(var t=0;t<r.arrDin.length;t++)s.dragBR(r.arrDin[t]);for(t=0;t<r.arrWin.length;t++)a.dRect(r.arrWin[t],255,1);for(t=0;t<r.arrLine.length;t++)a.dPoint(r.arrLine[t].p,4,255,2),a.dLine(r.arrLine[t].p,r.arrLine[t].p1,255,2),a.dPoint(r.arrLine[t].p1,4,255,2);for(t=0;t<r.sahL;t++)s.dragLine(r.arrayL[t]);a.dPoint({x:r.rect.x,y:r.minL},10,16711680,1),a.dPoint({x:r.rect.x+r.rect.w,y:r.minR},7,16711680,1),s.dragDD(r.arrDin),s.visiPixi.render()}0==s.check1.value&&(r.setGeomLine(s.plXZ),r.setGeom(s.plXZ2,h),s.visi3D&&(s.visi3D.intRend=1));var i=(new Date).getTime()-n;s.win1.title="time= "+Math.round(i)/1e3+" сек ::"+s.kr.arrDin.length+":"+s.kr.array.length+":"+s.kr.arrayL.length};var o=[],l=[];this.dragDD=function(t){if(1!=s.check2.value){o.length=0,l.length=0;for(var i=0;i<t.length;i++)o.push(t[i].x,t[i].x1),l.push(t[i].y,t[i].y1);o.sort(function(t,i){return t-i}),l.sort(function(t,i){return t-i});for(i=o.length-1;i>=1;i--)o[i]==o[i-1]&&o.splice(i,1);for(i=l.length-1;i>=1;i--)l[i]==l[i-1]&&l.splice(i,1);for(i=l.length-1;i>=0;i--)d.x=s.kr.rect.x-15,d.y=l[i],a.dText(d,""+Math.round(l[i]));for(i=o.length-1;i>=0;i--)d.x=o[i],d.y=-8,a.dText(d,""+Math.round(o[i]))}},this.dragLine=function(t){d.x=(t.x+t.x1)/2,d.y=(t.y+t.y1)/2+10,a.dText(d,"::"+t.idArr)};var u,c,d={x:0,y:0};this.dragBR=function(t){a.dRect(t),1==t.bool[0]&&a.dLineParam(t.x,t.y,t.x+t.w,t.y,16711680,2),1==t.bool[1]&&a.dLineParam(t.x+t.w,t.y,t.x+t.w,t.y+t.h,16711680,2.5),1==t.bool[2]&&a.dLineParam(t.x+t.w,t.y+t.h,t.x,t.y+t.h,16711680,3),1==t.bool[3]&&a.dLineParam(t.x,t.y,t.x,t.y+t.h,16711680,3.5),1==t.bool1[0]&&a.dLineParam(t.x,t.y,t.x+t.w,t.y,255,2),1==t.bool1[1]&&a.dLineParam(t.x+t.w,t.y,t.x+t.w,t.y+t.h,255,2.5),1==t.bool1[2]&&a.dLineParam(t.x+t.w,t.y+t.h,t.x,t.y+t.h,255,3),1==t.bool1[3]&&a.dLineParam(t.x,t.y,t.x,t.y+t.h,255,3.5),u=1,1==s.check2.value&&(u=1),c=11184810,1==t.boolNa&&(u=5,c=16711680),1==t.boolPoli?a.dLineParam(t.x,t.y,t.x+t.w,t.y+t.h,c,u):a.dLineParam(t.x,t.y+t.h,t.x+t.w,t.y,c,u),1!=s.check2.value&&(d.x=t.x+t.w/2,d.y=t.y+t.h/2,a.dText(d,t.idArr))},this.funDrwgWG=null,this.funxz=function(){null!=this.funDrwgWG&&this.funDrwgWG(this._width,this._height)}}set active(t){this._active!=t&&(this._active=t,this.pan.visible=this.active,this.cont3d.visible=this.active,this.visi3D&&(this.visi3D.intRend=1),this.init(),this.kr&&(1==t?(this.kr.funRender=this.drag,this.drag()):this.kr.funRender=void 0))}get active(){return this._active}set width(t){this._width!=t&&(this._width=t,this.visiPixi.sizeWindow(this._width,this._height),this.funxz())}get width(){return this._width}set height(t){this._height!=t&&(this._height=t,this.visiPixi.sizeWindow(this._width,this._height),this.funxz())}get height(){return this._height}}class Dt extends THREE.BufferGeometry{constructor(){super();var t=[];this.upNull=function(){var i=1e3;t.push(-i,-i,0),t.push(-i,-i,0),t.push(-i,i,0),t.push(-i,-i,0),t.push(-i,-i,0),t.push(i,-i,0),t.push(i,-i,0),t.push(i,i,0),t.push(i,i,0),t.push(-i,i,0),t.push(-i,i,0),t.push(i,i,0),this.setAttribute("position",new THREE.Float32BufferAttribute(t,3))},this.upNull()}}class zt{constructor(t,i){this.type="SpDebug3D";this.cont3d=new THREE.Object3D,t.add(this.cont3d),this.texture=(new THREE.TextureLoader).load("resources/image/pic.png"),this.texture.wrapS=THREE.RepeatWrapping,this.texture.wrapT=THREE.RepeatWrapping,this.texture.repeat.y=-1,this.gBox=new THREE.BoxBufferGeometry(1,1,1),this.gSphere=new THREE.SphereBufferGeometry(1,32,32);var e={};e.r=new THREE.MeshBasicMaterial({color:16711680,map:this.texture}),e.g=new THREE.MeshBasicMaterial({color:65280,map:this.texture}),e.b=new THREE.MeshBasicMaterial({color:255,map:this.texture});var s={};s.r=new THREE.LineSegments(new Rt,new THREE.LineBasicMaterial({color:16711680,linewidth:10})),s.g=new THREE.LineSegments(new Rt,new THREE.LineBasicMaterial({color:65280,linewidth:10})),s.b=new THREE.LineSegments(new Rt,new THREE.LineBasicMaterial({color:255,linewidth:10})),this.cont3d.add(s.r),this.cont3d.add(s.g),this.cont3d.add(s.b),this.arrPoint=[];var n,r,h=0;this.getPoint=function(t,i){return null==this.arrPoint[h]&&(this.arrPoint[h]=new THREE.Mesh(this.gSphere,e.r),this.cont3d.add(this.arrPoint[h])),h++,this.arrPoint[h-1]},this.setPoint=function(t,i,s){n=this.getPoint(),r=e.r,null!=e[s]&&(r=e[s]),n.material.uuid!=r.uuid&&(n.material=r),n.position.set(t.x,t.y,t.z),n.scale.set(i,i,i),n.visible=!0},this.arrBox=[];var a,o=0;this.getBox=function(t,i){if(null==this.arrBox[o]){var s=new THREE.Mesh(this.gBox,e.r);this.arrBox[o]=new THREE.Object3D,this.arrBox[o].add(s),this.cont3d.add(this.arrBox[o])}return o++,this.arrBox[o-1]};new THREE.Vector3,new THREE.Vector3;this.setLine=function(t,i,e){a=s.r,null!=s[e]&&(a=s[e]),a.geometry.addLine(t,i)},this.getDist3D=function(t,i){return Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2)+Math.pow(t.z-i.z,2))},this.upDate=function(){s.r.geometry.upDate(),s.g.geometry.upDate(),s.b.geometry.upDate()},this.clear=function(){h=0;for(var t=0;t<this.arrPoint.length;t++)this.arrPoint[t].visible=!1;o=0;for(t=0;t<this.arrBox.length;t++)this.arrBox[t].visible=!1;s.r.geometry.clear(),s.g.geometry.clear(),s.b.geometry.clear()}}}class Rt extends THREE.BufferGeometry{constructor(){super();var t=[];this.upNull=function(){t.push(-.5,-.5,0),t.push(-.5,-.5,0),t.push(-.5,.5,0),t.push(-.5,-.5,0),t.push(-.5,-.5,0),t.push(.5,-.5,0),t.push(.5,-.5,0),t.push(.5,.5,0),t.push(.5,.5,0),t.push(-.5,.5,0),t.push(-.5,.5,0),t.push(.5,.5,0),this.setAttribute("position",new THREE.Float32BufferAttribute(t,3))},this.upNull(),this.clearPoint=function(){this.array.length=0},this.array=[],this.addLine=function(t,i){this.array.push(t,i)},this.clear=function(i){this.array.length=0,t.length=0,n.length=0,s.length=0},this.addTri=function(i,e,r,h,a,o,l,u){t.push(i.x,i.y,i.z),t.push(e.x,e.y,e.z),t.push(r.x,r.y,r.z),h&&(n.push(h.x,h.y,h.z),n.push(a.x,a.y,a.z),n.push(o.x,o.y,o.z),s.push(l.x,l.y),s.push(u.x,u.y))};var i,e,s=[],n=[];this.redrag=function(r){if(null==r)this.setAttribute("position",new THREE.Float32BufferAttribute(t,3));else if(this.setAttribute("position",new THREE.Float32BufferAttribute(t,3)),this.computeBoundingBox(),this.computeBoundingSphere(),0==s.length){i=this.boundingBox.max.x-this.boundingBox.min.x,e=this.boundingBox.max.y-this.boundingBox.min.y;for(var h=0;h<t.length;h+=3)n.push(r.x,r.y,r.z),s.push((t[h]-this.boundingBox.min.x)/i,(t[h+1]-this.boundingBox.min.y)/e);this.setAttribute("normal",new THREE.Float32BufferAttribute(n,3)),this.setAttribute("uv",new THREE.Float32BufferAttribute(s,2))}else this.setAttribute("normal",new THREE.Float32BufferAttribute(n,3)),this.setAttribute("uv",new THREE.Float32BufferAttribute(s,2))},this.redrag1=function(){this.setAttribute("position",new THREE.Float32BufferAttribute(t,3))},this.upDate=function(){0==this.array.length&&this.upNull(),t.length=0;for(var i=0;i<this.array.length;i+=2)t.push(this.array[i].x,this.array[i].y,this.array[i].z),t.push(this.array[i+1].x,this.array[i+1].y,this.array[i+1].z);this.setAttribute("position",new THREE.Float32BufferAttribute(t,3)),this.computeBoundingBox(),this.computeBoundingSphere()}}}function Bt(){var t=this;this.segment={x:.5,y:.5,width:100,height:100,rotation:0},this.arrPoint=[],this.arrTriangle=[],this.arrTriangleBig=[],this.arrPosition=[],this.arrUV=[],this.lengthUV=0,this.lengthPosition=0,this.lengthTriangle=0,this.centerShape=new Ct,this.areaShape=0,this.boolBig=!0,this._bound={min:new Ct,max:new Ct,center:new Ct};var i,e,s,n,r,h,a,o=new Ct,l=new Ct,u=[0,0,this.segment.width,this.segment.height],c=[new Ct,new Ct,new Ct,new Ct,new Ct,new Ct,new Ct,new Ct,new Ct],d=0,p=new Ct,f=new mt;function g(i,e){return f.getAngle(t._bound.center,i)-f.getAngle(t._bound.center,e)}this.start=function(i){t.lengthUV=0,t.lengthTriangle=0,t.lengthPosition=0;for(var e=[],s=0;s<i.length;s++)e.push(new Ct(i[s].x,i[s].y,i[s].z));if(0!==this.segment.rotation)for(s=0;s<e.length;s++)f.rotationPoint(e[s],-this.segment.rotation);if(t.arrPoint=e,t.areaShape=t.area(t.arrPoint),t.areaShape&&(t.getCenterShape(),0!=t.boolBig)){for(s=0;s<t.arrTriangleBig.length;s++)t.segmentationTriangle(t.arrTriangleBig[s]);if(0!==this.segment.rotation){var n=new Ct;for(s=0;s<t.arrPosition.length;s+=3)n.set(t.arrPosition[s],t.arrPosition[s+1]),f.rotationPoint(n,this.segment.rotation),t.arrPosition[s]=n.x,t.arrPosition[s+1]=n.y}}},this.getCenterShape=function(i){t.arrPoint=i||t.arrPoint,t.arrTriangleBig.length=0,t.arrTriangleBig=t.triangulate(t.arrPoint),t.updateCenterShape()},this.updateCenterShape=function(){var i=0,e=0;t.centerShape.set(0,0);var s=t.convex(t.arrPoint);if(0===s||-1===s)for(var n=0;n<t.arrTriangleBig.length;n++)i<(e=t.area(t.arrTriangleBig[n]))&&(i=e,t.centerShape.x=(t.arrTriangleBig[n][0].x+t.arrTriangleBig[n][1].x+t.arrTriangleBig[n][2].x)/3,t.centerShape.y=(t.arrTriangleBig[n][0].y+t.arrTriangleBig[n][1].y+t.arrTriangleBig[n][2].y)/3);else{for(n=0;n<t.arrPoint.length;n++)t.centerShape.x+=t.arrPoint[n].x,t.centerShape.y+=t.arrPoint[n].y;t.centerShape.x/=t.arrPoint.length,t.centerShape.y/=t.arrPoint.length}},this.segmentationTriangle=function(i){s=this.getBound(this.arrPoint),n=(s.min.x-s.min.x%this.segment.width-2*this.segment.width||0)+this.segment.x*this.segment.width,r=(s.min.y-s.min.y%this.segment.height-2*this.segment.height||0)+this.segment.y*this.segment.height,h=(s.max.x-s.max.x%this.segment.width+2*this.segment.width||500)+this.segment.x*this.segment.width,a=(s.max.y-s.max.y%this.segment.height+2*this.segment.height||500)+this.segment.y*this.segment.height,u[2]=this.segment.width,u[3]=this.segment.height;for(var o=n;o<h;o+=this.segment.width)for(var l=r;l<a;l+=this.segment.height){u[0]=o,u[1]=l,e=t.triangulate(t.getArrPointTriangleSegment(i,u),!1);for(var c=0;c<e.length;c++){t.arrTriangle[t.lengthTriangle++]=e[c];for(var d=0;d<e[c].length;d++)t.generatePointUV(e[c][d],u),t.arrPosition[t.lengthPosition++]=e[c][d].x,t.arrPosition[t.lengthPosition++]=e[c][d].y,t.arrPosition[t.lengthPosition++]=0}}},this.getArrPointTriangleSegment=function(e,s){for(var n=c,r=0;r<n.length;r++)n[r].x=n[r].y=1/0;d=0;for(r=0;r<3;++r)o.x=s[0],o.y=s[1],l.x=s[0]+s[2],l.y=s[1],(i=f.getPointOfIntersection(o,l,e[r],e[(r+1)%3]))&&(t.inArr(n,i)||n[d++].setPoint(i)),o.x=s[0]+s[2],o.y=s[1],l.x=s[0]+s[2],l.y=s[1]+s[3],(i=f.getPointOfIntersection(o,l,e[r],e[(r+1)%3]))&&(t.inArr(n,i)||n[d++].setPoint(i)),o.x=s[0]+s[2],o.y=s[1]+s[3],l.x=s[0],l.y=s[1]+s[3],(i=f.getPointOfIntersection(o,l,e[r],e[(r+1)%3]))&&(t.inArr(n,i)||n[d++].setPoint(i)),o.x=s[0],o.y=s[1],l.x=s[0],l.y=s[1]+s[3],(i=f.getPointOfIntersection(o,l,e[r],e[(r+1)%3]))&&(t.inArr(n,i)||n[d++].setPoint(i)),o.x=s[0],o.y=s[1],l.x=s[0]+s[2],l.y=s[1]+s[3],t.pointInSegment(e[r],o,l)&&(t.inArr(n,e[r])||n[d++].setPoint(e[r]));return o.x=s[0],o.y=s[1],f.isInTriangle(e[0],e[1],e[2],o)&&(t.inArr(n,o)||n[d++].setPoint(o)),o.x=s[0]+s[2],o.y=s[1],f.isInTriangle(e[0],e[1],e[2],o)&&(t.inArr(n,o)||n[d++].setPoint(o)),o.x=s[0]+s[2],o.y=s[1]+s[3],f.isInTriangle(e[0],e[1],e[2],o)&&(t.inArr(n,o)||n[d++].setPoint(o)),o.x=s[0],o.y=s[1]+s[3],f.isInTriangle(e[0],e[1],e[2],o)&&(t.inArr(n,o)||n[d++].setPoint(o)),n=n.slice(0,d),t.getBound(n),n.sort(g),n},this.inArr=function(t,i){for(var e=0;e<t.length;++e)if(t[e].x===i.x&&t[e].y===i.y)return!0;return!1},this.getBound=function(t){this._bound.min.set(999999,999999),this._bound.max.set(-999999,-999999);for(var i=0;i<t.length;i++)this._bound.min.x=Math.min(this._bound.min.x,t[i].x),this._bound.max.x=Math.max(this._bound.max.x,t[i].x),this._bound.min.y=Math.min(this._bound.min.y,t[i].y),this._bound.max.y=Math.max(this._bound.max.y,t[i].y);return this._bound.center.set(this._bound.max.x/2+this._bound.min.x/2,this._bound.max.y/2+this._bound.min.y/2),this._bound},this.pointInSegment=function(t,i,e){return i.x<=t.x&&t.x<=e.x&&i.y<=t.y&&t.y<=e.y},this.generatePointUV=function(i,e){i.x===e[0]?p.x=0:i.x===e[0]+e[2]?p.x=1:p.x=(i.x-e[0])%t.segment.width/t.segment.width,i.y===e[1]?p.y=0:i.y===e[1]+e[3]?p.y=1:p.y=(i.y-e[1])%t.segment.height/t.segment.height,t.arrUV[t.lengthUV++]=p.x,t.arrUV[t.lengthUV++]=p.y},this.convex=function(t){var i,e,s,n,r=t.length,h=0;if(r<3)return 0;for(i=0;i<r;i++)if(s=(i+2)%r,n=(t[e=(i+1)%r].x-t[i].x)*(t[s].y-t[e].y),(n-=(t[e].y-t[i].y)*(t[s].x-t[e].x))<0?h|=1:n>0&&(h|=2),3===h)return-1;return 0!=h?1:0},this.area=function(t){for(var i=t.length,e=0,s=i-1,n=0;n<i;s=n++)e+=t[s].x*t[n].y-t[n].x*t[s].y;return.5*e},this.snip=function(t,i,e,s,n,r){var h,a,o,l,u,c,d,p,f,g,x,y,m,v,b,w,_;if(a=t[r[i]].x,o=t[r[i]].y,l=t[r[e]].x,u=t[r[e]].y,c=t[r[s]].x,d=t[r[s]].y,Number.EPSILON>(l-a)*(d-o)-(u-o)*(c-a))return!1;for(g=c-l,x=d-u,y=a-c,m=o-d,v=l-a,b=u-o,h=0;h<n;h++)if(p=t[r[h]].x,f=t[r[h]].y,!(p===a&&f===o||p===l&&f===u||p===c&&f===d)&&(w=v*(f-o)-b*(p-a),_=y*(f-d)-m*(p-c),g*(f-u)-x*(p-l)>=-Number.EPSILON&&_>=-Number.EPSILON&&w>=-Number.EPSILON))return!1;return!0},this.triangulate=function(i,e){var s=i.length;if(s<3)return[];var n,r,h,a=[],o=[],l=[];if(t.area(i)>0)for(r=0;r<s;r++)o[r]=r;else for(r=0;r<s;r++)o[r]=s-1-r;var u=s,c=2*u;for(r=u-1;u>2;){if(c--<=0)return e?l:a;if(u<=(n=r)&&(n=0),u<=(r=n+1)&&(r=0),u<=(h=r+1)&&(h=0),t.snip(i,n,r,h,u,o)){var d,p,f,g,x;for(d=o[n],p=o[r],f=o[h],a.push([i[d],i[p],i[f]]),l.push([o[n],o[r],o[h]]),g=r,x=r+1;x<u;g++,x++)o[g]=o[x];c=2*--u}}return e?l:a}}function Ct(t,i,e){this.x=t,this.y=i,this.z=e}Ct.prototype.set=function(t,i,e){this.x=t,this.y=i,this.z=e},Ct.prototype.setPoint=function(t){this.x=t.x,this.y=t.y,this.z=t.z};class Lt{constructor(t){this.type="KLUmnik";var i;this.par=t,this.arrPointCeshM=[],this.arrPointM=[],this.aL=[],this.aR=[],this.arrL=[],this.arrR=[],this.start=function(){this.clear(),this.naRL()},this.naRL=function(){for(var t=0;t<this.par.arrLine.length;t++)i=!0,this.par.arrLine[t].p.y>this.par.offset&&this.par.arrLine[t].p1.y>this.par.offset&&(i=!1),i?this.arrL.push(this.par.arrLine[t]):this.arrR.push(this.par.arrLine[t]);this.sam(this.arrL),this.sam(this.arrR)},this.sam=function(){},this.clear=function(){this.aL.length=0,this.aR.length=0,this.arrL.length=0,this.arrR.length=0;for(var t=0;t<this.arrPointM.length;t++)this.arrPointM[t].clear()},this.getLM=function(){return null==this.arrPointCeshM[this.arrPointM.length]&&(this.arrPointCeshM[this.arrPointM.length]=new KLPoint(this),this.arrPointCeshM[this.arrPointM.length].idArr=this.arrPointM.length),this.arrPointCeshM[this.arrPointM.length].clear(),this.arrPointM.push(this.arrPointCeshM[this.arrPointM.length]),this.arrPointM[this.arrPointM.length-1]}}}class Ot{constructor(t){this.type="KorektLine";this.fun=t,this.boolDebug=!0,this.funRender=void 0,this.rect={x:0,y:0,z:0,w:300,h:300,d:0},this.offset=0,this.arrLine=[];var i=new mt;this.calc=i,this.boolVergDrag=!1,this.triangul=new Bt,this.triangul.boolBig=!1,this.klUmnik=new Lt(this),this.start=function(){for(var t=this.arrLine.length-1;t>=0;t--)this.getDist3D(this.arrLine[t].p,this.arrLine[t].p1)<.01&&this.arrLine.splice(t,1);this.korectRect(),this.korectLine(),this.korectTriang()},this.arr=[],this.arrCesh=[],this.arrPointM=[],this.arrPointCeshM=[],this.aL=[],this.aR=[],this.arTriang=[],this.aTri=[],this.aTriCesh=[],this.getTri=function(){return null==this.aTriCesh[this.aTri.length]&&(this.aTriCesh[this.aTri.length]=new jt(this),this.aTriCesh[this.aTri.length].idArr=this.aTri.length),this.aTriCesh[this.aTri.length].clear(),this.aTri.push(this.aTriCesh[this.aTri.length]),this.aTri[this.aTri.length-1]},this.getLine=function(){return null==this.arrCesh[this.arr.length]&&(this.arrCesh[this.arr.length]=new It,this.arrCesh[this.arr.length].idArr=this.arr.length),this.arrCesh[this.arr.length].clear(),this.arr.push(this.arrCesh[this.arr.length]),this.arr[this.arr.length-1]},this.getLM=function(){return null==this.arrPointCeshM[this.arrPointM.length]&&(this.arrPointCeshM[this.arrPointM.length]=new kt(this),this.arrPointCeshM[this.arrPointM.length].idArr=this.arrPointM.length),this.arrPointCeshM[this.arrPointM.length].clear(),this.arrPointM.push(this.arrPointCeshM[this.arrPointM.length]),this.arrPointM[this.arrPointM.length-1]},this.sort=function(t,i){return t.dist-i.dist},this.korectLine=function(){for(var t=0;t<this.arrCesh.length;t++)this.arrCesh[t].clear();for(t=0;t<this.arrPointM.length;t++)this.arrPointM[t].clear();this.arr.length=0,this.arrPointM.length=0,this.arTriang.length=0;for(t=0;t<this.arrLine.length;t++)this.kL(this.arrLine[t]);this.aL.length=0,this.aR.length=0,this.aTri.length=0;for(t=0;t<this.arrPointM.length;t++)this.arrPointM[t].boolP=!1;for(t=0;t<this.arrPointM.length;t++)this.arrPointM[t].p.y<0?this.aL.push(this.arrPointM[t]):this.aR.push(this.arrPointM[t]);this.aL.sort(this.sort),this.aR.sort(this.sort)};var e,s,n,r,h,a,o,l,u,c,d,p,f,g,x,y,m,v,b=[];this.korectTriang=function(){this.arrPointM.sort(this.sort),-1,this.kTri1(),this.kTPoisk4()},this.kTri1=function(){0,e=!0,this.arTriang.length=0,s=-1;for(var t=0;t<this.arrPointM.length;t++)if(0==this.arrPointM[t].boolP){s=t;break}if(-1!=s){this.arTriang.length=0,n=this.arrPointM[s],this.kTpoint(n),s=-1;for(t=0;t<this.arrPointM.length;t++)if(0==this.arrPointM[t].boolP){s=t;break}}else this.kTPoisk4()},this.kTpoint=function(t){(r=t).boolP=!0,null,this.arTriang.push(r);for(var i=0;i<r.array.length;i++){if(0==r.array[i].point.boolP)return void this.kTpoint(r.array[i].point);if(0==r.array[i].point1.boolP)return void this.kTpoint(r.array[i].point1)}this.kTPoisk(r)},this.kTPoisk=function(t){a=this.getDist3D(n.p,t.p),l=999999,u=-1;for(var i=0;i<this.arrPointM.length;i++)1!=this.arrPointM[i].boolP&&1==this.arrPointM[i].array.length&&this.arrPointM[i].p.z===t.p.z&&(o=this.getDist3D(this.arrPointM[i].p,t.p))<l&&(l=o,u=i);if(-1===u){l=999999,u=-1;for(i=0;i<this.arrPointM.length;i++)1!=this.arrPointM[i].boolP&&1==this.arrPointM[i].array.length&&this.arrPointM[i].bM===!t.bM&&(o=this.getDist3D(this.arrPointM[i].p,t.p))<l&&(l=o,u=i);-1===u?(b.push(t,n),this.kTPoisk3(this.arTriang)):l>a&&0==e?(b.push(t,n),this.kTPoisk3(this.arTriang),this.kTri1()):(e=!1,b.push(t,this.arrPointM[u]),this.kTpoint(this.arrPointM[u]))}else l>a&&0==e?(b.push(t,n),this.kTPoisk3(this.arTriang),this.kTri1()):(e=!1,b.push(t,this.arrPointM[u]),this.kTpoint(this.arrPointM[u]))},this.arTDo=[],this.kTPoisk3=function(t){this.arTDo.length=0;for(var i=0;i<this.arTriang.length;i++)this.arTDo.push(this.arTriang[i].p);this.korectTriang3(this.arTDo)},this.kTPoisk4=function(){for(var t=0;t<b.length;t+=2)for(var i=t+2;i<b.length;i+=2)if(1==this.kT4(b[t],b[t+1],b[i],b[i+1]))return b.splice(i,2),b.splice(t,2),void this.kTPoisk4()},this.kT4=function(t,i,e,s){return p=null,c=this.getDist2D(t.p,e.p),d=this.getDist2D(t.p,s.p),c<.01&&this.getDist2D(i.p,s.p)<.01&&(p=t,f=i,g=e,x=s),d<.01&&this.getDist2D(i.p,e.p)<.01&&(p=t,f=i,g=s,x=e),null!=p&&((y=this.getTri()).p.setPoint(p.p),y.p1.setPoint(f.p),y.p2.setPoint(g.p),y.setRect(this.rect),(y=this.getTri()).p2.setPoint(p.p),y.p1.setPoint(f.p),y.p.setPoint(g.p),y.setRect(this.rect),(y=this.getTri()).p.setPoint(x.p),y.p1.setPoint(f.p),y.p2.setPoint(g.p),y.setRect(this.rect),(y=this.getTri()).p2.setPoint(x.p),y.p1.setPoint(f.p),y.p.setPoint(g.p),y.setRect(this.rect),!0)},this.getDist2D=function(t,i){return Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2))},this.korectTriang3=function(t){this.triangul.start(t);for(var i=0;i<this.triangul.arrTriangleBig.length;i++)(h=this.getTri()).setP(this.triangul.arrTriangleBig[i]),h.setRect(this.rect)},this.kL=function(t){(m=this.getLine()).p.x=t.p.x,m.p.y=t.p.y,m.p.z=t.p.z,m.p1.x=t.p1.x,m.p1.y=t.p1.y,m.p1.z=t.p1.z,m.bool=!1,(m.p1.y<0||m.p.y<0)&&(m.bool=!0);for(var i=!0,e=0;e<this.arrPointM.length;e++)if(this.getDist3D(this.arrPointM[e].p,m.p)<.01){this.arrPointM[e].addLine(m,!0),i=!1;break}1==i&&((v=this.getLM()).set(m.p),v.addLine(m,!0)),i=!0;for(e=0;e<this.arrPointM.length;e++)if(this.getDist3D(this.arrPointM[e].p,m.p1)<.01){this.arrPointM[e].addLine(m,!1),i=!1;break}1==i&&((v=this.getLM()).set(m.p1),v.addLine(m,!1))},this.getDist3D=function(t,i){return Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2)+Math.pow(t.z-i.z,2))},this.korectRect=function(){this.rect.x=999999999999,this.rect.y=999999999999,this.rect.z=999999999999,this.rect.x1=-999999999999,this.rect.y1=-999999999999,this.rect.z1=-999999999999;for(var t=0;t<this.arrLine.length;t++)this.korectRectPoint(this.arrLine[t].p),this.korectRectPoint(this.arrLine[t].p1);this.rect.w=this.rect.x1-this.rect.x,this.rect.h=this.rect.y1-this.rect.y,this.rect.d=this.rect.z1-this.rect.z},this.korectRectPoint=function(t){this.rect.x>t.x&&(this.rect.x=t.x),this.rect.y>t.y&&(this.rect.y=t.y),this.rect.z>t.z&&(this.rect.z=t.z),this.rect.x1<t.x&&(this.rect.x1=t.x),this.rect.y1<t.y&&(this.rect.y1=t.y),this.rect.z1<t.z&&(this.rect.z1=t.z)};var w=[],_=[],P=[];this.setGeom=function(t,i){0,null!=i&&i,w.length=0,_.length=0,P.length=0;for(var e=0;e<this.aTri.length;e++)this.setGeomB(this.aTri[e]);t.setAttribute("normal",new THREE.Float32BufferAttribute(P,3)),t.setAttribute("uv",new THREE.Float32BufferAttribute(_,2)),t.setAttribute("position",new THREE.Float32BufferAttribute(w,3)),t.computeBoundingBox(),t.computeBoundingSphere()},this.setGeomB=function(t){w.push(t.p2.x,t.p2.y,t.p2.z),w.push(t.p1.x,t.p1.y,t.p1.z),w.push(t.p.x,t.p.y,t.p.z),_.push(t.uv2.x,t.uv2.y),_.push(t.uv1.x,t.uv1.y),_.push(t.uv.x,t.uv.y),P.push(0,1,0),P.push(0,1,0),P.push(0,1,0)}}}class It{constructor(){this.type="KLLine",this.idAr=-1,this.p=new vt,this.p1=new vt,this.point=void 0,this.point1=void 0,this.clear=function(){this.point=void 0,this.point1=void 0}}}class kt{constructor(t){this.type="KLPoint",this.idArr=-1,this.par=t,this.boolP=!1,this.p=new vt,this.pNull=new vt(0,0,0),this.dist=0,this.array=[],this.arrayBool=[],this.clear=function(){this.array.length=0,this.arrayBool.length=0,this.boolP=!1},this.bM=!1,this.set=function(t){this.bM=!0,t.y<0&&(this.bM=!1),this.p.set(t.x,t.y,t.z),this.dist=this.par.getDist3D(this.pNull,this.p)},this.addLine=function(t,i){this.array.push(t),this.arrayBool.push(i),1==i?t.point=this:t.point1=this}}}class jt{constructor(t){this.type="KLTriangul",this.idArr=-1,this.par=t,this.p=new vt,this.p1=new vt,this.p2=new vt,this.uv=new vt,this.uv1=new vt,this.uv2=new vt,this.clear=function(){},this.setP=function(t){this.p.setPoint(t[0]),this.p1.setPoint(t[1]),this.p2.setPoint(t[2])},this.setRect=function(t){this.setRectUV(this.uv,this.p,t),this.setRectUV(this.uv1,this.p1,t),this.setRectUV(this.uv2,this.p2,t)},this.setRectUV=function(t,i,e){t.x=(i.x-e.x)/e.w,t.y=(i.y-e.y)/e.h}}}class Ht{constructor(t,i,e){this.type="DebLine";var s=this;this.par=t,this.fun=i,this.dC=t,this._active=!1,this.visi3D=e,this.dCont=new DCont(this.dC);var n,r,h,a,o=void 0;this.cont3d=new THREE.Object3D,this.cont3d.visible=this._active,this.kLine,new DPanel(this.dC),this.init=function(t){if(null==this.window){t='[{"p":{"x":290.5,"y":40.5,"z":372.0433333333334},"p1":{"x":300.15056588684706,"y":40.5,"z":372.0433333333334}},{"p":{"x":187.375,"y":40.5,"z":372.04333333333335},"p1":{"x":220.82379838798767,"y":40.5,"z":372.0433333333334}},{"p":{"x":40.5,"y":40.5,"z":372.0433333333334},"p1":{"x":165.5,"y":40.5,"z":372.04333333333335}},{"p":{"x":165.5,"y":40.5,"z":372.04333333333335},"p1":{"x":187.375,"y":40.5,"z":372.04333333333335}},{"p":{"x":259.5,"y":-40.5,"z":426.04333333333335},"p1":{"x":300.15056588684706,"y":-40.5,"z":426.04333333333335}},{"p":{"x":-40.5,"y":-40.5,"z":426.04333333333335},"p1":{"x":5.124999999999993,"y":-40.5,"z":426.04333333333335}},{"p":{"x":5.124999999999993,"y":-40.5,"z":0},"p1":{"x":5.125,"y":-40.5,"z":0}}]';this.visi3D.groupObject.add(this.cont3d),this.texture=(new THREE.TextureLoader).load("resources/image/pic.png"),this.texture.wrapS=THREE.RepeatWrapping,this.texture.wrapT=THREE.RepeatWrapping,this.texture.repeat.y=-1,this.meshBasicMaterial=new THREE.MeshBasicMaterial({color:16777215,map:this.texture}),this.plXZ2=new Ft,this.mesh=new THREE.Mesh(this.plXZ2,this.meshBasicMaterial),this.cont3d.add(this.mesh),this.spD3D=new zt(this.cont3d,"resources/image/pic.png"),this.window=new DWindow(this.dCont,0,0,"xz"),this.window.width=800,this.window.height=400,trace("#########window###########",800,400,this.window),this.content2d=new PIXI.Container,this.content2d.position.x=50,this.content2d.position.y=50,this.debugPixi=new yt,this.content2d.addChild(this.debugPixi.content2d),n=this.debugPixi,s.visiPixi=new Et,s.visiPixi.content2d.addChild(s.content2d),this.window.content.div.appendChild(s.visiPixi.div),s.visiPixi.sizeWindow(this.window.width,this.window.height),s.kLine=h=new Ot,trace("############kLine####@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@##",s.kLine,h),r=JSON.parse(t),h.arrLine=r,setTimeout(function(){s.init2()},500)}},this.plXZ,this.plXZ1,this.init2=function(){null==a&&((a=new DWindow(this.window,2,this.window.height,"triang")).width=222,new DButton(a.content,2,2,"drag",function(){s.drag()}),new DButton(a.content,2,34,"test1",function(){r=JSON.parse('[{"p":{"x":165.5,"y":9.499999999999998,"z":98.8666666666667},"p1":{"x":232.6404404010741,"y":9.499999999999998,"z":98.86666666666667}},{"p":{"x":76.69814663718,"y":9.499999999999998,"z":98.8666666666667},"p1":{"x":165.5,"y":9.499999999999998,"z":98.86666666666669}},{"p":{"x":66.60000000000002,"y":9.499999999999998,"z":98.86666666666667},"p1":{"x":76.69814663718,"y":9.499999999999998,"z":98.8666666666667}},{"p":{"x":146.5,"y":-9.499999999999996,"z":103.51111111111112},"p1":{"x":232.6404404010741,"y":-9.499999999999996,"z":103.51111111111112}},{"p":{"x":38.73333333333335,"y":-9.499999999999996,"z":103.51111111111112},"p1":{"x":66.8454950680748,"y":-9.499999999999996,"z":103.51111111111112}},{"p":{"x":38.73333333333335,"y":-9.499999999999996,"z":0},"p1":{"x":38.73333333333335,"y":-9.499999999999996,"z":0}}]'),h.arrLine=r,s.drag()}),new DButton(a.content,2,68,"test2",function(){r=JSON.parse('[{"p":{"x":334.25531914893617,"y":30,"z":59.25},"p1":{"x":334.25531914893617,"y":30,"z":100}},{"p":{"x":334.25531914893617,"y":30,"z":59.25},"p1":{"x":400,"y":30,"z":54.773402674591374}},{"p":{"x":334.25531914893617,"y":30,"z":54.773402674591374},"p1":{"x":334.25531914893617,"y":30,"z":59.25}},{"p":{"x":300,"y":30,"z":0},"p1":{"x":334.25531914893617,"y":30,"z":0}},{"p":{"x":334.25531914893617,"y":30,"z":0},"p1":{"x":334.25531914893617,"y":30,"z":54.773402674591374}},{"p":{"x":400,"y":30,"z":54.773402674591374},"p1":{"x":460,"y":30,"z":50.68796433878157}},{"p":{"x":200,"y":30,"z":0},"p1":{"x":300,"y":30,"z":0}},{"p":{"x":100,"y":30,"z":0},"p1":{"x":200,"y":30,"z":0}},{"p":{"x":0,"y":30,"z":0},"p1":{"x":100,"y":30,"z":0}},{"p":{"x":275.531914893617,"y":-30,"z":41.25},"p1":{"x":275.531914893617,"y":-30,"z":100}},{"p":{"x":275.531914893617,"y":-30,"z":41.25},"p1":{"x":300,"y":-30,"z":39.58395245170877}},{"p":{"x":275.531914893617,"y":-30,"z":39.58395245170877},"p1":{"x":275.531914893617,"y":-30,"z":41.25}},{"p":{"x":200,"y":-30,"z":0},"p1":{"x":275.531914893617,"y":-30,"z":0}},{"p":{"x":275.531914893617,"y":-30,"z":0},"p1":{"x":275.531914893617,"y":-30,"z":39.58395245170877}},{"p":{"x":300,"y":-30,"z":39.58395245170875},"p1":{"x":400,"y":-30,"z":32.774888558692425}},{"p":{"x":400,"y":-30,"z":32.77488855869241},"p1":{"x":460,"y":-30,"z":28.689450222882623}},{"p":{"x":100,"y":-30,"z":0},"p1":{"x":200,"y":-30,"z":0}},{"p":{"x":0,"y":-30,"z":0},"p1":{"x":100,"y":-30,"z":0}}]'),h.arrLine=r,s.drag()}),new DButton(a.content,2,100,"test3",function(){r=JSON.parse('[{"p":{"x":334.25531914893617,"y":30,"z":59.25},"p1":{"x":334.25531914893617,"y":30,"z":100}},{"p":{"x":334.25531914893617,"y":30,"z":59.25},"p1":{"x":400,"y":30,"z":54.773402674591374}},{"p":{"x":334.25531914893617,"y":30,"z":54.773402674591374},"p1":{"x":334.25531914893617,"y":30,"z":59.25}},{"p":{"x":300,"y":30,"z":0},"p1":{"x":334.25531914893617,"y":30,"z":0}},{"p":{"x":334.25531914893617,"y":30,"z":0},"p1":{"x":334.25531914893617,"y":30,"z":54.773402674591374}},{"p":{"x":400,"y":30,"z":54.773402674591374},"p1":{"x":460,"y":30,"z":50.68796433878157}},{"p":{"x":200,"y":30,"z":0},"p1":{"x":300,"y":30,"z":0}},{"p":{"x":100,"y":30,"z":0},"p1":{"x":200,"y":30,"z":0}},{"p":{"x":0,"y":30,"z":0},"p1":{"x":100,"y":30,"z":0}},{"p":{"x":275.531914893617,"y":-30,"z":41.25},"p1":{"x":275.531914893617,"y":-30,"z":100}},{"p":{"x":275.531914893617,"y":-30,"z":41.25},"p1":{"x":300,"y":-30,"z":39.58395245170877}},{"p":{"x":275.531914893617,"y":-30,"z":39.58395245170877},"p1":{"x":275.531914893617,"y":-30,"z":41.25}},{"p":{"x":200,"y":-30,"z":0},"p1":{"x":275.531914893617,"y":-30,"z":0}},{"p":{"x":275.531914893617,"y":-30,"z":0},"p1":{"x":275.531914893617,"y":-30,"z":39.58395245170877}},{"p":{"x":300,"y":-30,"z":39.58395245170875},"p1":{"x":400,"y":-30,"z":32.774888558692425}},{"p":{"x":400,"y":-30,"z":32.77488855869241},"p1":{"x":460,"y":-30,"z":28.689450222882623}},{"p":{"x":100,"y":-30,"z":0},"p1":{"x":200,"y":-30,"z":0}},{"p":{"x":0,"y":-30,"z":0},"p1":{"x":100,"y":-30,"z":0}}]'),h.arrLine=r,s.drag()}),this.drag())},this.setArrLine=function(t){trace(t),h.arrLine=t,s.drag()},this.drag=function(){this.saveTime(),h.start(),n.clear(),n.dRect(h.rect,65280,.5),s.window.width=Math.round(1*h.rect.w+100),s.window.height=Math.round(1*h.rect.h+100)+32,s.width=s.window.width+100,s.height=s.window.height+100,s.spD3D.clear();for(var t=0;t<h.arrLine.length;t++)s.spD3D.setPoint(h.arrLine[t].p,10,"r"),s.spD3D.setPoint(h.arrLine[t].p1,10,"r"),s.spD3D.setLine(h.arrLine[t].p,h.arrLine[t].p1,"b");for(t=0;t<h.aL.length;t++);if(0!=h.arTDo.length){n.dLine(h.arTDo[0],h.arTDo[h.arTDo.length-1],255,5),n.dText(h.arTDo[0],t+":",255,.5);for(t=1;t<h.arTDo.length;t++)n.dLine(h.arTDo[t-1],h.arTDo[t],255,1+.2*t),n.dText(h.arTDo[t],t+":",255,.5)}var i=h.aTri;for(t=0;t<i.length;t++)n.dLine(i[t].p,i[t].p1,void 0,1),n.dLine(i[t].p1,i[t].p2,void 0,1),n.dLine(i[t].p2,i[t].p,void 0,1),n.dText(i[t].p,Math.round(100*i[t].uv.y)/100+":",255,.5);h.setGeom(s.plXZ2),s.visiPixi.render(),s.spD3D.upDate()},this.drag111=function(t,i,e,s){var r={x:t.p.x,y:t.p.y-10+i};n.dText(r,s+":"+t.idArr+":!"+Math.round(t.p.x/10),16711680,.5),r.y+=10,n.debagPoint(r,2,e)},this.save1=function(){i("saveLocal")},this.sah=0,this.saveTime=function(){this.sah++;var t=this.sah;setTimeout(function(){s.sah==t&&s.save1()},500)},this.setObjLoc=function(t){o&&null==r&&o.setObj(t),this.init2()},this.getObjLoc=function(t){return o.getObj(t)},this.funDrwgWG=null,this.funxz=function(){null!=this.funDrwgWG&&this.funDrwgWG(this._width,this._height)}}set active(t){this._active!=t&&(this.par.visi3D&&(this.par.visi3D.intRend=1),this._active=t,this.init(),this.window.visible=this.active,this.cont3d.visible=this.active)}get active(){return this._active}set width(t){this._width!=t&&(this._width=t,this.visiPixi.sizeWindow(this._width,this._height),this.funxz())}get width(){return this._width}set height(t){this._height!=t&&(this._height=t,this.visiPixi.sizeWindow(this._width,this._height),this.funxz())}get height(){return this._height}}class Ft extends THREE.BufferGeometry{constructor(){super();var t=[];this.upNull=function(){var i=1e3;t.push(-i,-i,0),t.push(-i,-i,0),t.push(-i,i,0),t.push(-i,-i,0),t.push(-i,-i,0),t.push(i,-i,0),t.push(i,-i,0),t.push(i,i,0),t.push(i,i,0),t.push(-i,i,0),t.push(-i,i,0),t.push(i,i,0),this.setAttribute("position",new THREE.Float32BufferAttribute(t,3))},this.upNull()}}class Nt{constructor(t,i,e,s){this.type="DDebug1",this.typeNa="xz";var n,r,h,a=this;this._otstup=5,this._otstup1=15,this._collisi=null,this.dc=t,this.window=new DWindow(null,0,0,"DDebug Тесты 2д ректов и линий"),this.panel=new DPanel(this.window.content,this._otstup1,this._otstup1),this.dCont=new DCont(this.panel),this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.dCont.div.appendChild(this.canvas),this.draw=function(){this.ctx.clearRect(0,0,r,h);for(var t=0;t<this._collisi.arrRect.length;t++){this.dBox(this._collisi.arrRect[t].rectCollisMeshdy,1,"#000f71",.5);let i=t+" "+Math.round(this._collisi.arrRect[t].rectCollisMeshdy.x)+" "+Math.round(this._collisi.arrRect[t].rectCollisMeshdy.y);this.drawText(this._collisi.arrRect[t].rectCollisMeshdy.x,this._collisi.arrRect[t].rectCollisMeshdy.y-5,i,10,"#000f71")}for(t=0;t<this._collisi.arrLine.length;t++){this.drawLine(this._collisi.arrLine[t].p.x,this._collisi.arrLine[t].p.y,this._collisi.arrLine[t].p1.x,this._collisi.arrLine[t].p1.y,2,"#ff0000");let i=t+" "+Math.round(this._collisi.arrLine[t].p.x)+" "+Math.round(this._collisi.arrLine[t].p.y);this.drawText(this._collisi.arrLine[t].p.x,this._collisi.arrLine[t].p.y-5,i,10,"#ff0000")}this.drawCollLine()},this.drawCollLine=function(){n=this._collisi.colozi.collLine,this.dBox(n.sRect,2,"#ff0000",.5,!0),this.dBox(n.boxHH,2,"#00ff00",.5,!0);for(var t=0;t<n.array.length;t++)this.dBox(n.array[t],1,"#00ff00",.5,!0);for(t=0;t<n.apb.length;t++)this.dBox(n.apb[t],.5,"#000ff0",.5,!0);this.dBox(n.boxWW,2,"#000ff0",.5,!0),this.dBox(n.boxPP,4,"#f00ff0",.2,!0)},this.dBox=function(t,i,e,s,n){this.drawBox(t.x,t.y,t.width||t.w,t.height||t.h,i,e,s,n)},this.drawBox=function(t,i,e,s,n,r,h,a){if(void 0!==a)return this.drawLine(t,i,t+e,i,n,r),this.drawLine(t,i+s,t+e,i+s,n,r),this.drawLine(t,i,t,i+s,n,r),void this.drawLine(t+e,i,t+e,i+s,n,r);this.ctx.beginPath(),this.ctx.lineWidth=null==n?"1":1*n,this.ctx.strokeStyle=null==r?"#128ece":r,this.ctx.globalAlpha=null==h?.5:h,this.ctx.moveTo(t,i),this.ctx.lineTo(t+e,i),this.ctx.lineTo(t+e,i+s),this.ctx.lineTo(t,i+s),this.ctx.lineTo(t,i),this.ctx.fillStyle=r,this.ctx.moveTo(t,i),this.ctx.lineTo(t+e,i),this.ctx.lineTo(t+e,i+s),this.ctx.lineTo(t,i+s),this.ctx.lineTo(t,i),this.ctx.fill(),this.ctx.stroke(),this.ctx.closePath()},this.drawText=function(t,i,e,s,n){this.ctx.beginPath(),this.ctx.strokeStyle=null==n?"#000000":n,this.ctx.fillStyle=null==n?"#000000":n;let r="30px Arial";s&&(r=s+"px Arial"),this.ctx.font=r,this.ctx.fillText(e,t,i),this.ctx.fill(),this.ctx.stroke(),this.ctx.closePath()},this.drawLine=function(t,i,e,s,n,r){this.ctx.beginPath(),this.ctx.lineWidth=null==n?"1":1*n,this.ctx.strokeStyle=null==r?"#128ece":r,this.ctx.moveTo(t,i),this.ctx.lineTo(e,s),this.ctx.fill(),this.ctx.stroke(),this.ctx.closePath()},this.drag=function(){a.drag1()},this.drag1=function(){r=this._collisi.world.width,h=this._collisi.world.height,this.window.width=r+2*this._otstup1,this.window.height=h+2*this._otstup1+32,this.panel.width=r,this.panel.height=h,this.canvas.width!=r&&(this.canvas.width=r),this.canvas.height!=h&&(this.canvas.height=h),this.wPlus&&(this.wPlus.x=this.window.width+this._otstup,this.wPlus.y=0),this.draw()},this.wPlus;var o=[],l=[],u=[];this.setArr=function(t,i){l=t,u=i,this.wPlus=new DWindow(this.window,0,0,"Dop menu"),this.wPlus.width=150;for(var e=this._otstup,s=0;s<l.length;s++)o[s]=new DButton(this.wPlus.content,this._otstup+(this._otstup+32)*s,e,""+s,function(){this.color==dcmParam.colorActive?a.collisi=null:a.collisi=a.getColi(this.ooo,0)}),o[s].idArr=s,o[s].width=o[s].height=32,o[s].ooo=l[s],this.wPlus.addD(o[s],1)},this.dragColi=function(){if(this.wPlus)for(var t=0;t<o.length;t++)this._collisi?this.getColi(o[t].ooo,0).uuid==this._collisi.uuid?o[t].color=dcmParam.colorActive:o[t].color=dcmParam.color:o[t].colorActive=dcmParam.color},this.getColi=function(t,i){return null==u[i]?t:this.getColi(t[u[i]],i+1)}}set collisi(t){this._collisi!==t&&(this._collisi&&(this._collisi.funDedug=void 0),this._collisi=t,null!=this.window.parent&&this.window.parent.remove(this.window),this._collisi&&(this.dc.add(this.window),this._collisi.funDedug=this.drag,this.drag()),this.dragColi())}get collisi(){return this._collisi}}class Vt{constructor(t,i){this.type="MDebag";var e=this;this.par=t,this.fun=i,this.param=this.par.param,this.otstup=this.param.otstup,this.otstup1=this.param.otstup,this.wh=this.param.wh,this.width=this.param.sizeBase,this.dCont=new DCont(t.dCont),this.array=[],this.dragPic=this.par.dragPic,window.dDebug,this.init=function(){window.dDebug=this.dDebug=new DDebug(this.dCont,0,0,"3dplaner_v2",this.param),setTimeout(function(){t.dCont.add(dDebug)},10);var i=dDebug.getDDcont();this.button=new DButton(i,2,0,"DebLine",function(){this.parent.remove(this),e.initDebLine()}),this.button.width=200,this.button1=new DButton(i,2,32,"DebKR",function(){e.initDebKR()}),this.button1.width=200,this.button2=new DButton(i,2,64,"DDebug Collisi 2d",function(){e.initDDebug()}),this.button2.width=200;var s=new DSliderBig(i,300,0,function(){facade.mast1=this.value,facade.fun_rotationZ(),visi3D.intRend=1},"mastab",1,50);s.width=222;var n=new DSliderBig(i,300,50,function(){facade.maxMast=this.value,facade.fun_rotationZ(),visi3D.intRend=1},"max",1,7);n.width=222;var r=new DSliderBig(i,300,100,function(){let t=facade.sp._mast;facade._mastYmn=this.value,facade.sp.mast=t+.002,facade.sp.mast=t,facade.fun_rotationZ(),visi3D.intRend=1},"mastabPlus",.5,5);r.width=222,setTimeout(function(){s.value=facade.mast1,n.value=facade.maxMast,r.value=facade._mastYmn},100)},this.initDDebug=function(){this.button2.parent.remove(this.button2);var t=new DCont(this.dCont);e.dDebug1=new Nt(t),e.dDebug1.setArr(e.par.par.view.facade.sp.arrSplice,["windows","collision"]),e.dDebug1.collisi=e.par.par.view.facade.sp.arrSplice[2].windows.collision,e.par.par.view.facade.sp.addObjFun(e.par.par.view.facade.sp.arrSplice[2])},this.initDebKR=function(){this.button1.parent.remove(this.button1);var t=new DCont(this.dCont);e.debKR=new Mt(t,function(t,i){},visi3D);var i=this.par.par.view.facade.korektRect;e.debKR.setKR(i),e.debKR.active=!0},this.initDebLine=function(){e.debLine=new Ht(this.dCont,function(t,i){},visi3D),e.debLine.active=!0},this.init(),this.sizeWindow=function(t,i,e){window.dDebug&&window.dDebug.sizeWindow(t,i,e)}}}class Gt{constructor(t,i){this.type="Menu";var e,s,n,r=this;this.par=t,this.fun=i,this.param=this.par.param,this.dCont=new DCont(t.dCont),this.array=[],window.menuBig=this,this.init=function(){this.array[this.array.length]=this.mVerh=new K(this,function(t,i,e){r.fun(t,i,e)}),this.array[this.array.length]=this.mLeftGal=new J(this,function(t,i,e){r.fun(t,i,e)}),this.array[this.array.length]=window.mCPodskazka=new Z(this.dCont,function(t,i,e){}),this.array[this.array.length]=this.mObject=new xt(this,function(t,i){r.fun(t,i)}),1==window.localS.object.debug&&(this.array[this.array.length]=this.mDebag=new Vt(this,function(t,i){})),this.array[this.array.length]=window.dragPic=this.dragPic=new Xt(this.par.dCont),window.mCPodskazka.sahSim=7.2,this.mLeftGal.active=!0,this.mVerh.active=!0,this.dCont.remove(mCPodskazka.dCont),this.dCont.add(mCPodskazka.dCont)},this.setObject=function(t){this.mObject.setObject(t)},this.setSob=function(t,i,e){},this.keydown=function(t,i,e){for(var s=0;s<r.array.length;s++)r.array[s].keydown&&r.array[s].keydown(t,i,e)},this.keyup=function(t,i,e){for(var s=0;s<r.array.length;s++)r.array[s].keyup&&r.array[s].keyup(t,i,e)},this.sizeWindow=function(t,i,r){t&&(e=t,s=i,n=r);for(var h=0;h<this.array.length;h++)this.array[h].sizeWindow&&this.array[h].sizeWindow(e,s,n)},this.init()}set indexStep(t){this._indexStep!=t&&(this._indexStep=t,this.mLeftGal.indexStep=this._indexStep)}get indexStep(){return this._indexStep}}function Xt(t){var i=this;this.type="DDragPic",this.fun=void 0,this.dC=t,this._width=100,this._height=100,this._active=!1,this.otstup=2,this.otstup2=10,this.dCont=new DCont,this.fUp=void 0,this.object=void 0,this._x=0,this._y=0,this.pointZdvig={x:0,y:0},this.whBase=null,this.image=new DImage(this.dCont,0,0),this.image.div.style.pointerEvents="none",this.dCont.div.style.pointerEvents="none",this.dCont.div.style.userSelect="none",this.image.div.style.userSelect="none",this.array=[];var e=void 0;this.scale=1,this.devas=dcmParam.mobile;this.oSc={x:0,y:0,x:1},this.tween=void 0,window.TWEEN&&(this.tween=new TWEEN.Tween(this.dCont)),this.start=function(t,i,s,n,r){null!=this.whBase&&(t=this.whBase),1==this.active&&(this.active=!1),console.warn("dd>>>"),this.image.link=i,this.image.width=t,this.image.height=t,this.image.x=-t/2,this.image.y=-t/2,this.fUp=n,e=void 0,this.dCont.alpha=0,this.dC.add(this.dCont),this.object=s,this.link=i,this.active=!0,this.fXYS(this.dC,this.oSc,!0),this.dCont.x=dcmParam.globXY.x/this.oSc.s,this.dCont.y=dcmParam.globXY.y/this.oSc.s,dcmParam.addFunMove(this.mousemove),this.tween&&this.tween.to({alpha:1},500).start()},this.fXYS=function(t,e,s){null!=s&&(e.x=0,e.y=0,e.s=1),e.x*=t._scale,e.y*=t._scale,e.s*=t._scale,e.x+=t.position._x,e.y+=t.position._y,0==t.visible&&(e.y+=99999),null!=t.parent&&i.fXYS(t.parent,e)},this.arrFunUp=[],this.addFunAp=function(t){this.arrFunUp.push(t)},this.mouseup=function(t){if(null!=e)for(var s=0;s<i.arrFunUp.length;s++)i.arrFunUp[s](t);i.stop()},this.stop=function(){i.fUp&&i.fUp(),i.active=!1,console.warn("dd<<<"),dcmParam.removeFunMove(i.mousemove),i.dCont&&i.dCont.parent&&i.dCont.parent.remove(i.dCont),i.object=void 0,e=void 0},this.mousemove=function(t){null==e&&(e=0==i.devas?{x:t.clientX,y:t.clientY}:{x:t.touches[0].clientX,y:t.touches[0].clientY}),0==i.devas?(i._x=t.clientX,i._y=t.clientY):(i._x=t.touches[0].clientX,i._y=t.touches[0].clientY),i.dCont.x=i._x/i.oSc.s+i.pointZdvig.x,i.dCont.y=i._y/i.oSc.s+i.pointZdvig.y,null==i.tween&&i.dCont.alpha<1&&(i.dCont.alpha+=.1)},this.getDistance=function(t,i){return null==t?0:(null==i&&(i=rezNull),i=i||rezNull,Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2)))},0==i.devas?document.addEventListener("mouseup",i.mouseup):document.addEventListener("touchend",i.mouseup),this.mouseup1=function(t){i.mouseStop(),null!=i.fClik&&i.fClik()},this.pointNull={x:0,y:0},this.getDistance=function(t,i){return Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2))},this.sp,this.point={x:0,y:0},this.posit={x:0,y:0},this.mousemove1=function(t){var s,n;null==e&&(e=0==i.devas?{x:t.clientX,y:t.clientY}:{x:t.touches[0].clientX,y:t.touches[0].clientY},i.sp=e),0==i.devas?(s=t.clientX-e.x,n=t.clientY-e.y,i.posit.x=t.clientX,i.posit.y=t.clientY):(s=t.touches[0].clientX-e.x,n=t.touches[0].clientY-e.y,i.posit.x=t.touches[0].clientX,i.posit.y=t.touches[0].clientY),i.point.x=s,i.point.y=n;var r=i.getDistance(i.point,i.pointNull);if(i.fDDD&&i.fDDD(),r>i.dist)return i.fClik=void 0,i.mouseStop(),void(null!=i.fDrag&&i.fDrag())},this.mouseStop=function(){e=void 0,0==i.devas?document.removeEventListener("mouseup",i.mouseup1):document.removeEventListener("touchend",i.mouseup1),dcmParam.removeFunMove(i.mousemove1)},this.dist=0,this.fClik=0,this.fDrag=0,this.fDDD=void 0,this.testDrag=function(t,s,n,r){e=void 0,this.dist=t,this.fClik=s,this.fDrag=n,this.fDDD=r,0==this.devas?document.addEventListener("mouseup",i.mouseup1):document.addEventListener("touchend",i.mouseup1),dcmParam.addFunMove(this.mousemove1)},Object.defineProperty(this,"active",{set:function(t){this._active!=t&&(this._active=t,1==t?0==this.devas?document.addEventListener("mouseup",this.mouseup):document.addEventListener("touchend",this.mouseup):(this.object=void 0,0==this.devas?document.removeEventListener("mouseup",this.mouseup):document.removeEventListener("touchend",this.mouseup)))},get:function(){return this._active}})}function Ut(t){var i=this;this.type="SpPoint",this.tipe="SpPoint",this.stage=t,this._life=!0,this.size2=10,this.size3=.001,this._uuid=calc.generateUUID(),this.arrSHronBaza=[],this.arrSHron=[],this.arrPol=[],this.arrIdSten=[],this.arrSten=[],this.arrayClass=[];var e,s,n=0;function r(t,i){if(t)for(var e=0;e<t.arrSHron.length;e++)i.push(t.arrSHron[e].sten)}function h(t,i){if(t)for(var e=0;e<t.arrSHron.length;e++)t.arrSHron[e].sten._addPoint&&i.push(t.arrSHron[e].sten._addPoint),t.arrSHron[e].sten._addPoint1&&i.push(t.arrSHron[e].sten._addPoint1)}function a(t){for(var i=0;i<t.length;i++){for(var e=!1,s=0;s<t.length;s++)if(i!==s&&t[s].uuid===t[i].uuid){e=!0;break}e&&t.splice(i--,1)}}this.creatSHron=function(){for(var t=0;t<this.arrSHronBaza.length;t++)if(0==this.arrSHronBaza[t].life)return this.arrSHronBaza[t].life=!0,this.arrSHronBaza[t];return this.arrSHronBaza.push(new Yt(this)),this.arrSHronBaza[this.arrSHronBaza.length-1]},this.addSplice=function(t,n){s=99999;for(var r=0;r<this.arrSHron.length;r++)this.arrSHron[r].sten.idArr==t.idArr&&(s=r);99999==s&&((e=this.creatSHron()).sten=t,e.storona=n,this.arrSHron.push(e),i.arrIdSten.push(t.idArr),1==n?t.addPoint=this:t.addPoint1=this,this.life=!0,this.drag()),this.stage.render(),null!=i.doFunRend&&i.doFunRend()},this.removeSplice=function(t){console.warn("remove``@@@@",this.idArr),s=-1;for(var e=0;e<this.arrSHron.length;e++)this.arrSHron[e].sten.idArr==t.idArr&&(s=e);if(-1!=s){var n=this.arrSHron[s];return this.arrSHron.splice(s,1),n.clear(),this.arrIdSten.splice(s,1),this.drag(),n}return this.stage.render(),null!=i.doFunRend&&i.doFunRend(),null},this.addPol=function(t){this.arrPol.push(t),this.stage.render()},this.removePol=function(t){for(var i=null,e=0;e<this.arrPol.length;e++)t.idArr==this.arrPol[e].idArr&&(this.arrPol.splice(e,1),null==i&&(i=0),i++,t.removePoint(this),e=0);return 0==this.arrSHron.length&&0==this.arrPol.length&&this.clear(),this.stage.render(),i},this._heightNew=0,this.dragHeight,this.drag=function(){n=this.arrSHron.length;for(var t=0;t<n;t++)this.arrSHron[t].sten.calculateOld=this.arrSHron[t].sten.calculate,this.arrSHron[t].sten.calculate=!0,this.arrSHron[t].sten.height>this._heightNew&&(this._heightNew=this.arrSHron[t].sten.height);this.setPointNotDrag(this.position);for(var i=this.getConectedPoint(),e=0;e<i.length;e++)i[e].korektSH();this.dragView();for(t=0;t<n;t++)this.arrSHron[t].sten.calculate=this.arrSHron[t].sten.calculateOld,this.arrSHron[t].sten.drag();for(e=0;e<this.arrPol.length;e++)this.arrPol[e].drag(),this.arrPol[e].height>this._heightNew&&(this._heightNew=this.arrPol[e].height);this.dragHeight&&this.dragGG(),this.stage.render()},this.dragGG=function(){this._heightNew=0;for(var t=0;t<n;t++)this.arrSHron[t].sten.height>this._heightNew&&(this._heightNew=this.arrSHron[t].sten.height);for(var i=0;i<this.arrPol.length;i++)this.arrPol[i].height>this._heightNew&&(this._heightNew=this.arrPol[i].height);this.dragHeight&&this.dragHeight()},this.dragView=function(){for(var t=0;t<this.arrayClass.length;t++)this.arrayClass[t].drag&&this.arrayClass[t].drag()};var o=!1;this.korektSH=function(){if(!o){o=!0,f(!0);for(var t=0;t<this.arrSHron.length;t++)this.arrSHron[t].korektAngel();this.arrSHron.sort(g);for(t=0;t<this.arrSHron.length;t++)this.stage.spCalc.korektSHObject(this,t);f(!1),o=!1}};var l,u,c,d,p=null;function f(t){if(t)p=i.arrSHron.slice(),i.arrSHron=i.arrSHron.filter(function(t){var i=0===t.sten.tip?t.sten._delph/2:t.sten._delph;return t.sten.visible=t.sten._distans>i,t.sten.visible});else{i.arrSHron=p;for(var e=0;e<i.arrSHron.length;e++){var s=0===i.arrSHron[e].sten.tip?i.arrSHron[e].sten._delph/2:i.arrSHron[e].sten._delph;i.arrSHron[e].sten.visible=i.arrSHron[e].sten._distans>s}p=null}}function g(t,i){return t.rotation-i.rotation}this.setPointNotDrag=function(t){n=i.arrSHron.length,i.position._x=t.x,i.position._y=t.y;for(var e=0;e<n;e++){var s=i.arrSHron[e].sten.calculate;i.arrSHron[e].sten.calculate=!0,1==i.arrSHron[e].storona?(i.arrSHron[e].sten.position._x=t.x,i.arrSHron[e].sten.position._y=t.y):(i.arrSHron[e].sten.position1._x=t.x,i.arrSHron[e].sten.position1._y=t.y),i.arrSHron[e].sten.drag(),i.arrSHron[e].sten.calculate=s}},this.getConectedPoint=function(t){t=t||[this];for(var i=[],e=0;e<t.length;e++)h(t[e],i);return a(i),i},this.getConectedSten=function(t){t=t||[this];for(var i=[],e=0;e<t.length;e++)r(t[e],i);return a(i),i},this.funDragVokrug,this.dragVokrug=function(){for(var t=this.getConectedPoint(),i=this.getConectedSten(t),e=0;e<t.length;e++)t[e].korektSH(),t[e].dragView();for(e=0;e<i.length;e++)i[e].drag();this.funDragVokrug&&this.funDragVokrug(t,i)},this.doFunRend,this.drawposit=function(){null!=i.doFunRend&&i.doFunRend(),i.calculate||i.drag()},this.position=new PositionFun(0,0,this.drawposit),this.restart=function(){},this.clear=function(){if(this.life){if(2==this.arrSHron.length){this.arrStep=[];var t=this.stage.spCalc.getSten2AddPoint(this.arrSHron[0].sten,this),i=this.stage.spCalc.getSten2AddPoint(this.arrSHron[1].sten,this);if(-1!=this.getClonSten(-1,t,i))e=this.removeSplice(this.arrSHron[1].sten),s=this.removeSplice(this.arrSHron[0].sten),e.sten.clear(),s.sten.clear();else{t=this.arrSHron[0].sten._addPoint.idArr==this.idArr?this.arrSHron[0].sten._addPoint1:this.arrSHron[0].sten._addPoint;var e=this.removeSplice(this.arrSHron[1].sten),s=this.removeSplice(this.arrSHron[0].sten);e.sten._addPoint.idArr==this.idArr?(t.addSplice(e.sten,!0),1===e.sten.tip&&1===s.sten.tip&&e.sten.lineRange.p2.setPoint(s.sten._addPoint1.position)):(t.addSplice(e.sten,!1),1===e.sten.tip&&1===s.sten.tip&&e.sten.lineRange.p2.setPoint(s.sten._addPoint.position)),e.sten.addPoint1.drag(),e.sten.addPoint.drag(),this.life=!1,s.sten.clear()}}else{this.arrStep=[];for(var n=this.arrSHron.length-1;n>=0;n--){null!=(s=this.removeSplice(this.arrSHron[n].sten)).sten&&(s.sten.addPoint.idArr!=this.idArr&&s.sten.addPoint1.idArr!=this.idArr||(s.life=!1,s.sten.clear()))}}for(var r=0;r<this.arrayClass.length;r++)"function"==typeof this.arrayClass[r].clear&&this.arrayClass[r].clear();for(n=0;n<this.arrPol.length;n++)this.arrPol[n]&&this.removePol(this.arrPol[n]);this.life=!1,this.stage.render()}},this.clearFree=function(){0==this.arrSHron.length&&0==this.arrPol.length&&this.clear()},this.getClonSten=function(t,i,e){if(i&&e)for(var s=0;s<this.stage.arrSplice.length;s++){var n=this.stage.arrSplice[s];if(n.life&&(n.idArr!==t&&n.addPoint&&n.addPoint1)){if(n.addPoint.idArr===i.idArr&&n.addPoint1.idArr===e.idArr)return s;if(n.addPoint1.idArr===i.idArr&&n.addPoint.idArr===e.idArr)return s}}return-1},this.slitie=function(t){if(0!=this.life&&0!=t.life){for(var i=null,e=t.arrSHron.length-1;e>=0;e--)for(var s=0;s<this.arrSHron.length;s++)if(this.arrSHron[s].sten.idArr==t.arrSHron[e].sten.idArr&&this.arrSHron[s].sten._distans<2){i=this.arrSHron[s].sten;break}if(i){var n={};for(e=t.arrSHron.length-1;e>=0;e--)i.idArr==t.arrSHron[e].sten.idArr&&(n.sten=t.arrSHron[e].sten,n.storona=t.arrSHron[e].storona);t.removeSplice(i);for(e=this.arrSHron.length-1;e>=0;e--)i.idArr==this.arrSHron[e].sten.idArr&&(n.sten=this.arrSHron[e].sten,n.storona=this.arrSHron[e].storona);this.removeSplice(i)}var r=[];for(e=t.arrSHron.length-1;e>=0;e--)r.push(t.arrSHron[e]);for(e=0;e<r.length;e++)t.removeSplice(r[e].sten);for(e=0;e<r.length;e++)this.addSplice(r[e].sten,r[e].storona);i&&i.clear(),t.clear()}},this.arrDistRadom=[],this.miniDist=-1,this.miniId=-1,this.miniOkSlit=-1,this.testDistRadom=function(t){this.arrDistRadom=[],this.miniDist=1e17,this.miniId=-1,this.miniOkSlit=-1;for(var i=0;i<this.stage.arrPoint.length;i++){if(t){for(var e=!1,s=0;s<t.length;s++)if(t[s].idArr==this.stage.arrPoint[i].idArr){e=!0;break}if(e)continue}this.idArr==i?this.arrDistRadom.push(-1):0==this.stage.arrPoint[i].life?this.arrDistRadom.push(-1):(this.arrDistRadom.push(calc.getDistance(this.position,this.stage.arrPoint[i].position)),this.miniDist>this.arrDistRadom[this.arrDistRadom.length-1]&&(this.miniDist=this.arrDistRadom[this.arrDistRadom.length-1],this.miniId=i,this.miniDist<aidPointStatic.radius&&(this.miniOkSlit=i)))}},this.isGroup=function(t){for(var i=0;i<this.arrSHron.length;i++){if(this.arrSHron[i].sten.addPoint&&this.arrSHron[i].sten.addPoint.idArr==this.idArr&&this.arrSHron[i].sten.addPoint1&&this.arrSHron[i].sten.addPoint1.idArr==t)return!0;if(this.arrSHron[i].sten.addPoint1&&this.arrSHron[i].sten.addPoint1.idArr==this.idArr&&this.arrSHron[i].sten.addPoint&&this.arrSHron[i].sten.addPoint.idArr==t)return!0}return!1},this.finaldrag=function(){for(var t=this.arrSHron.slice(),i=t.length-1;i>=0;i--)for(var e=0;e<this.arrSHron.length;e++)if(this.arrSHron[e].sten.idArr==t[i].sten.idArr){t[i].sten.life&&this.stage.korektSplice.paralelSten(t[i].sten);break}},this.rectangle=new Rectangle,this.getRect=function(){return this.rectangle.x=this.position.x-10,this.rectangle.y=this.position.y-10,this.rectangle.width=20,this.rectangle.height=20,this.rectangle},this.compare=function(t){return l=!0,u=this.getObj(),c=t,calc.getDistance(u.position,c.position)>.1&&(l=!1),l},this.rememberState=function(){(d=this.getObj()).life=this.life},this.saveChanges=function(){d&&(!this.compare(d)||(this.life,d.life)),d=null};var x=new Rectangle(-1/0,-1/0,1/0,1/0);this.getBoundRect=function(){return x.x=this.position.x-this.size3,x.y=this.position.y-this.size3,x.width=2*this.size3,x.height=2*this.size3,x}}function Yt(t){this.life=!0,this.sten=void 0,this.storona=!0,this.aidPoint=t,this.rotation=0,this.bp=0,this.bp1=0,this.linePosition=new LinePosition,this.korektAngel=function(){this.linePosition.p.setPoint(this.aidPoint.position),1==this.storona?this.linePosition.p1.setPoint(this.sten.position1):this.linePosition.p1.setPoint(this.sten.position),this.linePosition.angel=calc.getAngle(this.linePosition.p,this.linePosition.p1),this.rotation=this.linePosition.angel+Math.PI},this.clear=function(){this.life=!1}}function Wt(){var t,i,e,s,n=new THREE.Vector3(0,0,0),r=new THREE.Vector3(0,0,0),h=new THREE.Vector3(0,0,0),a=new THREE.Vector3(0,0,0);this.DEG2RAD=Math.PI/180,this.RAD2DEG=180/Math.PI,this.getAngle=function(t,i){return i=i||a,t=t||a,Math.atan2(i.y-t.y,i.x-t.x)};var o,l,u,c,d,p,f,g,x,y=0;this.getAngle2=function(t,i){return i=i||a,t=t||a,(y=Math.atan2(i.y-t.y,i.x-t.x))<0&&(y+=2*Math.PI),y},this.getDistance=function(t,i){return null==t?0:(null==i&&(i=a),i=i||a,Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2)))},this.getVector=function(t,i,e){if(null==e)e=new THREE.Vector2(0,0);return t<0&&(i+=Math.PI),e.x=Math.abs(t)*Math.cos(i),e.y=Math.abs(t)*Math.sin(i),e},this.isPointInLin=function(t,e,n,a,o){return this.getTreeAngel(t,e,n),o<0&&2*Math.abs(o)>s?null:r.x<=s+o&&r.x>=-o&&Math.abs(r.y)<=a?((h=r.x<0?this.getVector(r.x,i-Math.PI):this.getVector(r.x,i)).x+=e.x,h.y+=e.y,h.z=r.y,h):null},this.okrugPoint=function(t,i){null==i&&(i=100),t.x=Math.round(t.x/i)*i,t.y=Math.round(t.y/i)*i},this.okrugNumber=function(t,i){null==i&&(i=100);var e=Math.round(t*i)/i;return t=e,e},this.isInTriangle=function(t,i,e,s){var n=(t.x-s.x)*(i.y-t.y)-(i.x-t.x)*(t.y-s.y),r=(i.x-s.x)*(e.y-i.y)-(e.x-i.x)*(i.y-s.y),h=(e.x-s.x)*(t.y-e.y)-(t.x-e.x)*(e.y-s.y);return n>=0&&r>=0&&h>=0||n<=0&&r<=0&&h<=0},this.getTreeAngel=function(t,n,h,l){return i=this.getAngle(n,t),e=this.getAngle(n,h),o=this.getDistance(n,h),s=this.getDistance(t,n),this.getVector(o,e-i,r),e=this.getAngle(a,r),null==l?e:e>0?e:2*Math.PI+e},this.getTreeAngelPI2=function(t,i,e){x1=t.x-i.x,x2=e.x-i.x,y1=t.y-i.y,y2=e.y-i.y,s=Math.sqrt(x1*x1+y1*y1),d2=Math.sqrt(x2*x2+y2*y2);var n=(x1*x2+y1*y2)/(s*d2);return n>1&&(n=1),n<-1&&(n=-1),Math.acos(n)},this.isLineInTriangle=function(i,e,s,r,h){return(t=this.getPointOfIntersection(i,e,r,h))?(n.x=t.x,n.y=t.y,n.z=0,n):(t=this.getPointOfIntersection(e,s,r,h))?(n.x=t.x,n.y=t.y,n.z=1,n):!!(t=this.getPointOfIntersection(s,i,r,h))&&(n.x=t.x,n.y=t.y,n.z=2,n)};var m,v,b,w,_=new THREE.Vector2(0,0);this.getPointOfIntersection=function(t,i,e,s){return o=(t.x-i.x)*(s.y-e.y)-(t.y-i.y)*(s.x-e.x),l=(t.x-e.x)*(s.y-e.y)-(t.y-e.y)*(s.x-e.x),u=(t.x-i.x)*(t.y-e.y)-(t.y-i.y)*(t.x-e.x),d=u/o,(c=l/o)>=0&&c<=1&&d>=0&&d<=1?(p=t.x+c*(i.x-t.x),f=t.y+c*(i.y-t.y),_.x=p,_.y=f,_):null},this.korektToLine=function(t,i,e,s,n){g=this.getDistance(t,i),x=null==n?this.getAngle(t,i):n,0!=s&&(_=s<0?this.getVector(-s,x-Math.PI/2):this.getVector(s,x+Math.PI/2),t.x+=_.x,t.y+=_.y,i.x+=_.x,i.y+=_.y),_=this.getVector(e,x),i.x+=_.x,i.y+=_.y,_=this.getVector(e,x+Math.PI),t.x+=_.x,t.y+=_.y},this.getProsent3Point=function(t,i,e){return l=this.getDistance(t,i),(u=this.getDistance(t,e))/l},this.povotorOtAngel=function(t,i,e){return x=this.getAngle(t,i),g=this.getDistance(t,i),this.getVector(g,x+e)},this.testPositPoint=function(t,i,e){return null==e&&(e=100),Math.round(t.x*e)/e==Math.round(i.x*e)/e&&Math.round(t.y*e)/e==Math.round(i.y*e)/e},this.okrugAngel=function(t,i,e){var s=t;m=1,t<0&&(m=-1),v=Math.abs(t),b=Math.round(v/i)+1,w=0;for(var n=b;n>=0;n--){if(v>n*i-e&&v<n*i+e)return s=n*i*m;if(3==++w)return s}return s};var P=new Zt,S=new Zt,A=[];this.getLineCircleIntersectionPoints=function(t,i,e,s,n){A.length=0;var r=i.x-t.x,h=i.y-t.y,a=e.x-t.x,o=e.y-t.y,l=r*r+h*h,u=(r*a+h*o)/l,c=u*u-(a*a+o*o-s*s)/l;if(c<0)return A;var d=Math.sqrt(c),p=-u+d,f=-u-d;return P.set(t.x-r*p,t.y-h*p),this.isPointInLine(t,i,P)&&A.push(P),0==c?A:(S.set(t.x-r*f,t.y-h*f),this.isPointInLine(t,i,S)&&A.push(S),n&&2==A.length&&(m=this.getDistance(t,A[0]),v=this.getDistance(t,A[1]),m>v&&A.reverse()),A)},this.isPointInLine=function(t,i,e){var s=calc.getDistance(t,i),n=calc.getDistance(t,e),r=calc.getDistance(i,e);return calc.okrugNumber(n+r)===calc.okrugNumber(s)},this.getDistancePointToLine=function(t,i,e){var s=((i.y-t.y)*e.x-(i.x-t.x)*e.y+i.x*t.y-i.y*t.x)/calc.getDistance(t,i);return-calc.okrugNumber(Number.isFinite(s)?s:0)},this.getCircleCircleIntersectionPoints=function(t,i,e,s){var n,r,h,a,o;return A.length=0,(h=Math.sqrt(Math.pow(Math.abs(t.x-e.x),2)+Math.pow(Math.abs(t.y-e.y),2)))>i+s?A:(a=(i*i-s*s+h*h)/(2*h),o=Math.sqrt(Math.pow(i,2)-Math.pow(a,2)),isNaN(o)?A:(n=t.x+a*(e.x-t.x)/h,r=t.y+a*(e.y-t.y)/h,P.x=n+o*(e.y-t.y)/h,P.y=r-o*(e.x-t.x)/h,A.push(P),a==i?A:(S.x=n-o*(e.y-t.y)/h,S.y=r+o*(e.x-t.x)/h,A.push(S),A)))};var T=[new Zt,new Zt,new Zt,new Zt],E=[new Zt,new Zt,new Zt,new Zt];this.isIntersectionRect=function(t,i){return T[0].set(t.x,t.y),T[1].set(t.x+t.width,t.y),T[2].set(t.x+t.width,t.y+t.height),T[3].set(t.x,t.y+t.height),E[0].set(i.x,i.y),E[1].set(i.x+i.width,i.y),E[2].set(i.x+i.width,i.y+i.height),E[3].set(i.x,i.y+i.height),this.isIntersectionFromPoint(T,E)},this.isRectS=function(t,i){return 1==this.colisiLine2D(t.x,t.x+(null==t.w?t.width:t.w),i.x,i.x+(null==i.w?i.width:i.w))&&1==this.colisiLine2D(t.y,t.y+(null==t.h?t.height:t.h),i.y,i.y+(null==i.h?i.height:i.h))},this.colisiLine2D=function(t,i,e,s){return e>=t&&e<=i||t>=e&&t<=s},this.isRectPoint=function(t,i){return i.x>=t.x&&i.y>=t.y&&i.x<=t.x+(null==t.w?t.width:t.w)&&i.y<=t.y+(null==t.h?t.height:t.h)};var M=new Zt,D=new Zt;this.isRectLine=function(t,i,e){return 1==this.isRectPoint(t,i)||(1==this.isRectPoint(t,e)||(M.set(t.x,t.y),D.set(t.x+(null==t.w?t.width:t.w),t.y),null!=this.getPointOfIntersection(M,D,i,e)||(M.set(t.x+(null==t.w?t.width:t.w),t.y),D.set(t.x+(null==t.w?t.width:t.w),t.y+(null==t.h?t.height:t.h)),null!=this.getPointOfIntersection(M,D,i,e)||(M.set(t.x+(null==t.w?t.width:t.w),t.y+(null==t.h?t.height:t.h)),D.set(t.x,t.y+(null==t.h?t.height:t.h)),null!=this.getPointOfIntersection(M,D,i,e)||(M.set(t.x,t.y+(null==t.h?t.height:t.h)),D.set(t.x,t.y),null!=this.getPointOfIntersection(M,D,i,e))))))},this.isIntersectionFromPoint=function(t,i){for(var e=0;e<t.length-2;e++)for(var s=0;s<i.length-2;s++)if(calc.getPointOfIntersection(t[e],t[(e+2)%t.length],i[s],i[(s+2)%i.length]))return!0;for(e=0;e<t.length;e++)for(s=0;s<i.length;s++)if(calc.getPointOfIntersection(t[e],t[(e+1)%t.length],i[s],i[(s+1)%i.length]))return!0;for(e=0;e<i.length;e+=2)if(calc.contains(i[e].x,i[e].y,t))return!0;for(e=0;e<t.length;e+=2)if(calc.contains(t[e].x,t[e].y,i))return!0;return!1},this.isParalel=function(t,i,e,s,n){n=n||0;var r=Math.abs(calc.getAngle(t,i)%Math.PI),h=Math.abs(calc.getAngle(i,t)%Math.PI),a=Math.abs(calc.getAngle(e,s)%Math.PI),o=Math.abs(calc.getAngle(s,e)%Math.PI);return Math.min(Math.abs(r-a),Math.abs(h-o),Math.abs(r-o),Math.abs(h-a))<=n},this.rotationPoint=function(t,i,e){var s=0,n=0;e?(s=e.x+(t.x-e.x)*Math.cos(i)-(t.y-e.y)*Math.sin(i),n=e.y+(t.y-e.y)*Math.cos(i)+(t.x-e.x)*Math.sin(i)):(s=t.x*Math.cos(i)-t.y*Math.sin(i),n=t.y*Math.cos(i)+t.x*Math.sin(i)),t.x=s,t.y=n},this.rotationPointByLength=function(t,i,e){e=e||a;var s=calc.getDistance(t,e),n=calc.getLenghtCircle(s),r=i*(2*Math.PI/n);calc.rotationPoint(t,r,e)},this.isIntersectionTriangle=function(t,i,e,s,n,r){for(var h=!1,a=[t,i,e],o=[s,n,r],l=0;l<a.length&&!h;l++)h=calc.isInTriangle(s,n,r,a[l]);for(l=0;l<o.length&&!h;l++)h=calc.isInTriangle(t,i,e,o[l]);if(!h)for(l=0;l<a.length;l++)for(var u=0;u<o.length&&!h;u++)h=calc.getPointOfIntersection(a[l],a[(l+1)%a.length],o[u],o[(u+1)%o.length]);return h},this.getArrPointCircle=function(t,i,e,s,n,r,h){var a,o=calc.getAngle(e,t)-Math.PI,l=calc.getAngle(s,t)-Math.PI;a=h||[new Zt],n=n||5,!(r=r||!1)&&l<=o?l+=2*Math.PI:r&&o<=l&&(o+=2*Math.PI);var u=r?-1*(o-l):l-o,c=Math.ceil(Math.abs(u)/(2*Math.PI))*(n-1),d=u/(2*c),p=2*d,f=Math.cos(d),g=Math.sin(d),x=c-1,y=x%1/x,m=0,v=0,b=0,w=0,_=0;a[0].x=t.x+Math.cos(o)*i,a[0].y=t.y+Math.sin(o)*i;for(var P=0;P<=x;P++)m=d+o+(p*P+y*P),w=(f*(v=Math.cos(m))+g*(b=-Math.sin(m)))*i+t.x,_=(f*-b+g*v)*i+t.y,a[P+1]?(a[P+1].x=w,a[P+1].y=_):a.push(new Zt(w,_));return a},this.getLenghtCircle=function(t,i,e,s,n){i||(i=e=s=a);var r=calc.getAngle(e,i)-Math.PI,h=calc.getAngle(s,i)-Math.PI;return r===h&&e!==s?0:(!(n=n||!1)&&h<=r?h+=2*Math.PI:n&&r<=h&&(r+=2*Math.PI),Math.PI*t*(n?r-h:h-r)/Math.PI)},this.getLengthByWidth=function(t,i){var e=new Zt(0,0),s=new Zt(t,0),n=calc.getVector(i,.5*Math.PI);n.x=t/2;var r=calc.getCenterCircle(e,s,n);return r?calc.getLenghtCircle(calc.getDistance(r,e),r,e,s,i>0):t},this.getCenterCircle=function(t,i,e){var s=i.x-t.x,n=i.y-t.y,r=e.x-t.x,h=e.y-t.y,a=s*(t.x+i.x)+n*(t.y+i.y),o=r*(t.x+e.x)+h*(t.y+e.y),l=2*(s*(e.y-i.y)-n*(e.x-i.x));return 0===l?null:new Zt((h*a-n*o)/l,(s*o-r*a)/l)},this.getArcPoint=function(t,i,e,s,n){s=s||5;var r=calc.getAngle(t,i)+90*calc.DEG2RAD,h=calc.getVector(e,r),a=new Zt((t.x+i.x)/2,(t.y+i.y)/2);a.x+=h.x,a.y+=h.y;var o=calc.getCenterCircle(t,a,i);return o?calc.getArrPointCircle(o,calc.getDistance(o,t),t,i,s,e>0,n):[t,i]},this.getArea=function(t){for(var i=t.length,e=0,s=i-1,n=0;n<i;s=n++)e+=t[s].x*t[n].y-t[n].x*t[s].y;return.5*e||0},this.generateUUID=function(){for(var t=[],i=0;i<256;i++)t[i]=(i<16?"0":"")+i.toString(16);return function(){var i=4294967295*Math.random()|0,e=4294967295*Math.random()|0,s=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return(t[255&i]+t[i>>8&255]+t[i>>16&255]+t[i>>24&255]+"-"+t[255&e]+t[e>>8&255]+"-"+t[e>>16&15|64]+t[e>>24&255]+"-"+t[63&s|128]+t[s>>8&255]+"-"+t[s>>16&255]+t[s>>24&255]+t[255&n]+t[n>>8&255]+t[n>>16&255]+t[n>>24&255]).toUpperCase()}}(),this.generateRendom=function(t){null==t&&(t=2);let i,e="",s="";for(var n=0;n<t;n++){if((s=(255&(i=4294967295*Math.random()|0)).toString(16)+(i>>8&255).toString(16)+(i>>16&255).toString(16)+(i>>24&255).toString(16)).length<8)for(var r=0;r<8-s.length+1;r++)s+="Z";e+=s,n!=t-1&&(e+="-")}return e},this.diffNum=function(t,i){return t>=0&&i>=0?Math.abs(t-i):t<=0&&i<=0?Math.abs(Math.abs(t)-Math.abs(i)):t<=0&&i>=0?Math.abs(t)+i:t>=0&&i<=0?t+Math.abs(i):void 0},this.getPercentNum=function(t,i,e){return((t=null!=t?t:0)-(i=null!=i?i:0))/((e=null!=e?e:100)-i)*100},this.getValueNum=function(t,i,e){return(t=null!=t?t:0)/100*((e=null!=e?e:100)-(i=null!=i?i:0))+i},this.getValueBetween=function(t,i,e){var s=Math.max(i,e),n=Math.min(i,e);return Math.max(Math.min(t,s),n)},this.contains=function(t,i,e){for(var s=!1,n=e.length,r=0,h=n-1;r<n;h=r++){if(e[r].x===t&&e[r].y===i)return!0;var a=e[r].x,o=e[r].y,l=e[h].x,u=e[h].y;o>i!=u>i&&t<(l-a)*(i-o)/(u-o)+a&&(s=!s)}return s};var z={maxX:0,minX:0,maxY:0,minY:0},R=new Zt,B=[new Zt,new Zt,new Zt,new Zt],C=new Zt;this.getBoundsRect=function(t,i){C.set(t.width/2,t.height/2),B[0].set(0,0),B[1].set(t.width,0),B[2].set(t.width,t.height),B[3].set(0,t.height);for(var e=0;e<B.length;e++)this.rotationPoint(B[e],i,C);z.maxX=-t.width,z.minX=t.width,z.maxY=-t.height,z.minY=t.height;for(e=0;e<B.length;e++)z.maxX=Math.max(z.maxX,B[e].x),z.minX=Math.min(z.minX,B[e].x),z.maxY=Math.max(z.maxY,B[e].y),z.minY=Math.min(z.minY,B[e].y);return R.x=z.minX,R.y=z.minY,R.width=z.maxX-z.minX,R.height=z.maxY-z.minY,R},this.getCurvatureByWidth=function(t,i){if(Math.abs(t)>2*i)return null;var e=Math.pow(Math.abs(t),2),s=Math.pow(i,2),n=Math.acos((s+s-e)/(2*s));return i*(1-Math.cos(n/2))*(t<0?-1:1)},this.getWidthByCurvature=function(t,i){return 2*i*Math.sin(Math.acos(1-2*Math.abs(t)/(2*i)))*(t<0?-1:1)};var L=function(t,i){if(O(t)&&O(i))return t===i;for(var e in t){if(t.hasOwnProperty(e)!==i.hasOwnProperty(e))return!1;switch(typeof t[e]){case"object":if(!L(t[e],i[e]))return!1;break;case"function":if(void 0===i[e]||"compare"!==e&&t[e].toString()!==i[e].toString())return!1;break;case"number":if(Number(Number(t[e]).toFixed(3))!==Number(Number(i[e]).toFixed(3)))return!1;break;default:if(t[e]!==i[e])return!1}}for(var e in i)if(t.hasOwnProperty(e)!==i.hasOwnProperty(e))return!1;return!0};function O(t){return t!==Object(t)}this.compare=L}function Qt(t,i){this.p=t||new Zt,this.p1=i||new Zt,this.p2=new Zt,this.status=0,this.perpendik=!0,this.angel=0,this.set=function(t,i){this.p=t||0,this.p1=i||0}}function Zt(t,i,e){this._x=0,this._y=0,this._z=0,null!=t&&(this._x=t),null!=i&&(this._y=i),null!=e&&(this._z=e),this.set=function(t,i,e){this._x=t||0,this._y=i||0,void 0!==e&&(this._z=e)},this.setPoint=function(t){this._x=t.x,this._y=t.y,void 0!==t.z&&(this._z=t.z)},this.getObj=function(){var t={};return t.x=this._x,t.y=this._y,t.z=this._z,t},this.copy=function(){return new Zt(this._x,this._y,this._z)}}function Kt(t,i,e,s){this._x=t||0,this._y=i||0,this._z=0,this.fun="function"==typeof e?e:s,this.set=function(t,i,e){this._x=t||0,this._y=i||0,null!=e&&(this._z=e),this.fun&&this.fun()},this.setPoint=function(t){this._x=t.x,this._y=t.y,null!=t.z&&(this._z=t.z),this.fun&&this.fun()},this.getObj=function(){var t={};return t.x=this._x,t.y=this._y,t.z=this._z,t},this.copy=function(){return new Kt(this._x,this._y,this._z)}}function qt(t,i,e,s,n){this._x=t||0,this._y=i||0,this._width=void 0!==e?e:100,this._height=void 0!==s?s:100,this.angel=0,this.p=new Zt,this.fun,this.set=function(t,i,e,s){this._x=t||0,this._y=i||0,this._width=void 0!==e?e:100,this._height=void 0!==s?s:100},this.setRect=function(t){this._x=t.x,this._y=t.y,this._width=t.width,this._height=t.height,this.p.setPoint(t.p),this.angel=t.angel}}function Jt(t){var i,e,s,n=this;this.type="Splice",this.tipe="Splice",this.stage=t,this.idArr=-1,this._life=!0,this._delph=20,this.delphMin=1,this.delphMax=1e7,this._tip=0,this.arrOpor=[],this._uuid=t.spCalc.generateUUID(),this.arrayClass=[],this.arrPosit=[new Zt,new Zt,new Zt,new Zt,new Zt,new Zt],this.arrPosit1=[new Zt,new Zt,new Zt,new Zt,new Zt,new Zt],this.bolPosit=!1,this.bolPosit1=!1,this._addPoint,this._addPoint1,this._rotation=0,this._distans=0,this._oporPointVisi=!0,this.rectangle=new qt,this.drawposit=function(){n.drag()},this.position=new Kt(0,0,this.drawposit),this.position1=new Kt(0,0,this.drawposit),this._distans0=0,this._distans1=0,this.dL0=0,this.dL1=0,this.dR0=0,this.dR1=0,this.updateDistans01=function(){if(1===this.tip){this.lineRange.korectPoint2(this._delph/2,this.arrPosit[5],this.arrPosit1[5]),this._distans0=0;for(var t=1;t<this.lineRange.sahAngel;t++)this._distans0+=calc.getDistance(this.lineRange.arrPosit[t-1],this.lineRange.arrPosit[t]);this.lineRange.korectPoint2(this._delph/2,this.arrPosit[0],this.arrPosit1[0]),this._distans1=0;for(t=1;t<this.lineRange.sahAngel;t++)this._distans1+=calc.getDistance(this.lineRange.arrPosit[t-1],this.lineRange.arrPosit[t])}else this.dL0=this.arrPosit[0].x,this.dL0<this.arrPosit[1].x&&(this.dL0=this.arrPosit[1].x),this.dL1=this.arrPosit1[5].x,this.dL1<this.arrPosit1[4].x&&(this.dL1=this.arrPosit1[4].x),this.dR0=this.arrPosit[5].x,this.dR0<this.arrPosit[4].x&&(this.dR0=this.arrPosit[4].x),this.dR1=this.arrPosit1[0].x,this.dR1<this.arrPosit1[1].x&&(this.dR1=this.arrPosit1[1].x),this._distans0=this._distans+this.dL0+this.dL1,this._distans1=this._distans+this.dR0+this.dR1},this.clear=function(){this.arrState.length=0,this.addPoint&&(this.addPoint.removeSplice(this),this.addPoint.clearFree()),this.addPoint1&&(this.addPoint1.removeSplice(this),this.addPoint1.clearFree()),this.addPoint=void 0,this.addPoint1=void 0,r("clear"),this.postClear&&this.postClear(),this.life=!1,this.stage.render()};function r(t,i,e,s,r){for(var h=0;h<n.arrayClass.length;h++)"function"==typeof n.arrayClass[h][t]&&n.arrayClass[h][t](i,e,s,r)}this.dividedSten=function(t,n){if(!t||t instanceof Ut){if(t&&0==t.life)return t;if(null==t){var a=position2dFlor.getLocalIsStage();0==this._tip?(h=calc.isPointInLin(this.position,this.position1,a,9e6,9e6),(t=this.stage.craetPoint()).position.x=h.x,t.position.y=h.y):1==this._tip&&((t=this.stage.craetPoint()).position.x=a.x,t.position.y=a.y,s=this.isPointInLin(t.position),t.position.x=s.x,t.position.y=s.y)}if(r("beforDivid"),0==this._tip)(i=this.addPoint1).removeSplice(this),t.addSplice(this,!1),(e=this.stage.craetSplice()).setSten(this),t.addSplice(e,!0),i.addSplice(e,!1),t.drag();else if(1==this._tip){var o=this.lineRange.getLR(t.position,0),l=this.lineRange.getLR(t.position,1);(i=this.addPoint1).removeSplice(this),t.addSplice(this,!1),this.lineRange.setLR(o),(e=this.stage.craetSplice()).setSten(this),t.addSplice(e,!0),i.addSplice(e,!1),e.lineRange.setLR(l),t.position.x+=1e-6,t.dragVokrug()}return r("afterDivid",e),this.stage.render(),1==n?e:t}},this.restartTip=function(){1==this._tip&&(this.lineRange||(this.lineRange=new LineRange(40)),0==this.arrOpor.length&&this.arrOpor.push(new Zt),this.lineRange.p.setPoint(this.position),this.lineRange.p1.setPoint(this.position1),this.lineRange.upDate(),this.arrOpor[0].setPoint(this.lineRange.p2)),2==this._tip&&(this.arrOpor[0]||(this.arrOpor[0]=new Zt),this.arrOpor[1]||(this.arrOpor[1]=new Zt))},this._setAllParam=function(t,i){for(var e=0;e<n.arrayClass.length;e++)t in n.arrayClass[e]&&(n.arrayClass[e][t]=i)},this._callAllFun=r,this.isPointInLin=function(t,i,e,s){i=void 0===i?9e6:i,e=void 0===e?9e6:e;var n=null;if(0==this._tip)if(s){n=calc.isPointInLin(this.position,this.position1,t,i,0);var h=new Zt;h.setPoint(t),n&&h.setPoint(n),n||(n=calc.getDistance(this.position,h)<calc.getDistance(this.position1,h)?this.position:this.position1)}else n=calc.isPointInLin(this.position,this.position1,t,i,e);else 1==this._tip?n=this.lineRange.getPointInLineRange(t,i,e,s):window.console.warn("хз как isPointInLin",this._tip);return r("isPointInLin",t,i,e,n),n},this.getBoundRect=this.getRect=function(){if(this.rectangle.x=1/0,this.rectangle.y=1/0,this.rectangle.width=-1/0,this.rectangle.height=-1/0,0==this._tip){for(var t=0;t<this.arrPosit.length;t++)x(-this.arrPosit[t].x,this.arrPosit[t].y,!1);for(t=0;t<this.arrPosit1.length;t++)x(this.arrPosit1[t].x+this._distans,this.arrPosit1[t].y,!1)}else if(1==this._tip){this.lineRange.korectPoint2(this._delph/2),x(this.lineRange.arrPosit[0].x,this.lineRange.arrPosit[0].y,!0);for(t=1;t<this.lineRange.sahAngel;t++)x(this.lineRange.arrPosit[t].x,this.lineRange.arrPosit[t].y,!0);for(1==this.bolPosit1&&(x(this.arrPosit1[4].x,this.arrPosit1[4].y,!0),x(this.arrPosit1[3].x,this.arrPosit1[3].y,!0),x(this.arrPosit1[2].x,this.arrPosit1[2].y,!0),x(this.arrPosit1[1].x,this.arrPosit1[1].y,!0),x(this.arrPosit1[0].x,this.arrPosit1[0].y,!0)),this.lineRange.korectPoint2(-this._delph/2),t=this.lineRange.sahAngel-1;t>=0;t--)x(this.lineRange.arrPosit[t].x,this.lineRange.arrPosit[t].y,!0);1==this.bolPosit&&(x(this.arrPosit[0].x,this.arrPosit[0].y,!0),x(this.arrPosit[1].x,this.arrPosit[1].y,!0),x(this.arrPosit[2].x,this.arrPosit[2].y,!0),x(this.arrPosit[3].x,this.arrPosit[3].y,!0),x(this.arrPosit[4].x,this.arrPosit[4].y,!0))}else window.console.warn("хз как getRect",this._tip);return this.rectangle.width=this.rectangle.width-this.rectangle.x,this.rectangle.height=this.rectangle.height-this.rectangle.y,r("getRect",this.rectangle),this.rectangle},this.isColLine=function(t,i){if(0==this._tip)return calc.getPointOfIntersection(this.position,this.position1,t,i);if(1==this._tip){this.lineRange.korectPoint2(0);for(var e=1;e<this.lineRange.sahAngel-1;e++)if(calc.getPointOfIntersection(this.lineRange.arrPosit[e],this.lineRange.arrPosit[e+1],t,i))return!0}else window.console.warn("хз как isColLine",this._tip);return!1};var h,a=[new Zt,new Zt,new Zt,new Zt];this.isColRect=function(t){if(a[0].set(t.x,t.y),a[1].set(t.x+t.width,t.y),a[2].set(t.x+t.width,t.y+t.height),a[3].set(t.x,t.y+t.height),calc.isInTriangle(a[0],a[1],a[2],this.position))return!0;if(calc.isInTriangle(a[0],a[3],a[2],this.position))return!0;if(calc.isInTriangle(a[0],a[1],a[2],this.position1))return!0;if(calc.isInTriangle(a[0],a[3],a[2],this.position1))return!0;for(var i=0;i<a.length;i++)if(this.isColLine(a[i],a[(i+1)%a.length]))return!0;return!1},this.arrState=[],this.rememberState=function(){this.startObj=this.getObj(),calc.compare(this.startObj,this.arrState[this.arrState.length-1]||{})||this.arrState.push(this.startObj)},this.getLastState=function(){return this.arrState.pop()},this.saveChanges=function(){return h=!1},this.compareLastState=function(){};var o,l,u,c,d,p=new Zt,f=new Zt,g=new Zt;function x(t,i,e){0==e?(p.x=t,p.y=i,u=calc.getDistance(g,p),c=calc.getAngle(g,p),d=c+n._rotation,calc.getVector(u,d,f),f.x+=n.position.x,f.y+=n.position.y,o=f.x,l=f.y):(o=t,l=i),n.rectangle.x=Math.min(n.rectangle.x,o),n.rectangle.y=Math.min(n.rectangle.y,l),n.rectangle.width=Math.max(n.rectangle.width,o),n.rectangle.height=Math.max(n.rectangle.height,l)}function y(t,i){if(t)for(var e=0;e<t.arrSHron.length;e++)t.arrSHron[e].sten._addPoint&&i.push(t.arrSHron[e].sten._addPoint),t.arrSHron[e].sten._addPoint1&&i.push(t.arrSHron[e].sten._addPoint1)}function m(t,i){if(t)for(var e=0;e<t.arrSHron.length;e++)i.push(t.arrSHron[e].sten)}function v(t){for(var i=0;i<t.length;i++){for(var e=!1,s=0;s<t.length;s++)if(i!==s&&t[s].uuid===t[i].uuid){e=!0;break}e&&t.splice(i--,1)}}function b(t){var i=[];if(t)for(var e=0;e<t.arrSHron.length;e++){var s=t.arrSHron[e].sten;i.push(s.uuid)}return i}this.dragVokrug=function(){var t=[],i=[];y(this._addPoint,t),y(this._addPoint1,t),v(t);for(var e=0;e<t.length;e++)m(t[e],i);v(i);for(e=0;e<i.length;e++)i[e].calculate=!0;for(e=0;e<t.length;e++)t[e].drag();for(e=0;e<t.length;e++)t[e].drag();for(e=0;e<i.length;e++)i[e].calculate=!1,i[e].drag()},this.getArrConectedSplice=function(){var t={};return t.arr=b(this.addPoint),t.arr1=b(this.addPoint1),t}}function $t(t,i,e){this._x=t||0,this._y=i||0,this._z=e||0,this.set=function(t,i,e){this._x=t||0,this._y=i||0,void 0!==e&&(this._z=e)},this.setPoint=function(t){this._x=t.x,this._y=t.y,void 0!==t.z&&(this._z=t.z)},this.getObj=function(){var t={};return t.x=this._x,t.y=this._y,t.z=this._z,t},this.copy=function(){return new $t(this._x,this._y,this._z)}}function ti(){var t=this;this.drawArc=function(i,e,s,n,r,h,a,o){if(o){var l=e;e=s,s=l,l=h,h=-((h=a)||0),a=-((a=l)||0),n=-(n||0)}e=e.copy(),s=s.copy();var u=t.getCenterCircle(e,s,n);if(u){var c=n>0?-1:1;t.moveLineByCircle(e,s,u,(h||0)*c,(a||0)*c);var d=calc.getAngle(e,u)-Math.PI,p=calc.getAngle(s,u)-Math.PI,f=calc.getDistance(u,e)+(r||0);i.arc(u.x,u.y,f,d,p,n>0)}},this.getCenterCircle=function(i,e,s){var n=t.getPerpendPoint(i,e,s);return calc.getCenterCircle(i,n,e)};var i=new $t;this.getPerpendPoint=function(t,e,s){var n=calc.getAngle(t,e)+90*calc.DEG2RAD;return calc.getVector(s,n,i),i.x+=(t.x+e.x)/2,i.y+=(t.y+e.y)/2,i.x=calc.okrugNumber(i.x),i.y=calc.okrugNumber(i.y),i},this.moveLineByCircle=function(t,i,e,s,n){calc.rotationPointByLength(t,s,e),calc.rotationPointByLength(i,n,e)},this.movePoint=function(t,i,e){var s=calc.getAngle(t,e),n=calc.getVector(i,s);t.x+=n.x,t.y+=n.y},this.drawLine=function(i,e,s,n,r){t.movePoint(e,-s/2,n),calc.rotationPointByLength(e,r,n),i.moveTo(e.x,e.y),calc.rotationPointByLength(e,-r,n),t.movePoint(e,s,n),calc.rotationPointByLength(e,r,n),i.lineTo(e.x,e.y),calc.rotationPointByLength(e,-r,n),t.movePoint(e,-s/2,n)},this.drawLineCurv=function(i,e,s,n,r,h){var a=e.copy(),o=h||0;calc.rotationPointByLength(a,r,n),t.movePoint(a,-s/2+o,n),i.moveTo(a.x,a.y),t.movePoint(a,s,n),i.lineTo(a.x,a.y),t.movePoint(a,-s/2+o,n),calc.rotationPointByLength(a,-r,n)},this.getCurvPositionSten=function(t,i,e){var s=t.lineRange.getPositionByLength(i);return{position:s,angel:t.lineRange.getAngleByPoint(s,e),curvature:calc.okrugNumber(t.lineRange.getCurvatureByWidth(e))}},this.convertCurvePosBlok=function(t,i,e){var s=new $t((t=t.copy()).x+e/2,t.y);return calc.rotationPoint(s,i,t),calc.rotationPoint(t,-i,s),t}}function ii(){var t=new THREE.Vector2(0,0),i=new THREE.Vector2(0,0),e=new THREE.Vector2(0,0),s=new THREE.Vector2(0,0),n=new THREE.Vector2(0,0),r=new THREE.Vector2(0,0),h=new THREE.Vector2(0,0),a=new THREE.Vector2(0,0);this.stickBox=function(o,l,u){if(o){t.x=o.x,t.y=o.y,i.x=o.x+o.width,i.y=o.y,e.x=o.x+o.width,e.y=o.y+o.height,s.x=o.x,s.y=o.y+o.height;for(var c=0;c<l.length;c++)n.x=l[c].x,n.y=l[c].y,r.x=l[c].x+l[c].width,r.y=l[c].y,h.x=l[c].x+l[c].width,h.y=l[c].y+l[c].height,a.x=l[c].x,a.y=l[c].y+l[c].height,this.getDistance(t,a)<=u&&(o.x=l[c].x,o.y=l[c].y+l[c].height),this.getDistance(t,h)<=u&&(o.x=l[c].x+l[c].width,o.y=l[c].y+l[c].height),this.getDistance(t,r)<=u&&(o.x=l[c].x+l[c].width,o.y=l[c].y),this.getDistance(i,h)<=u&&(o.x=l[c].x+l[c].width-o.width,o.y=l[c].y+l[c].height),this.getDistance(i,a)<=u&&(o.x=l[c].x-o.width,o.y=l[c].y+l[c].height),this.getDistance(i,n)<=u&&(o.x=l[c].x-o.width,o.y=l[c].y),this.getDistance(e,r)<=u&&(o.x=l[c].x+l[c].width-o.width,o.y=l[c].y-o.height),this.getDistance(e,n)<=u&&(o.x=l[c].x-o.width,o.y=l[c].y-o.height),this.getDistance(e,a)<=u&&(o.x=l[c].x-o.width,o.y=l[c].y+l[c].height-o.height),this.getDistance(s,n)<=u&&(o.x=l[c].x,o.y=l[c].y-o.height),this.getDistance(s,r)<=u&&(o.x=l[c].x+l[c].width,o.y=l[c].y-o.height),this.getDistance(s,h)<=u&&(o.x=l[c].x+l[c].width,o.y=l[c].y+l[c].height-o.height)}},this.findMinPosition=function(t,i){for(var e,s=1/0,n={x:0,y:0},r=0;r<t.length;r++)s>(e=this.getDistance(t[r],i))&&(s=e,n.x=t[r].x,n.y=t[r].y);return n},this.getAngle=function(t,i){return 180*Math.atan2(i.y-t.y,i.x-t.x)/Math.PI},this.isPutIn=function(t,i,e,s,n,r,h,a){return t<=n&&t+e>=n+h&&e>=h&&i<=r&&i+s>=r+a&&s>=a},this.isCollisionRectangle=function(t,i,e,s,n,r,h,a){return t<n+h&&i<r+a&&t+e>n&&i+s>r},this.getDistance=function(t,i,e){return t&&i?Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2)):0},this.getDistance3D=function(t,i,e){return Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2)+Math.pow(t.z-i.z,2))}}function ei(t){this.par=t;var i=this.sRect=new si,e=new si,s=this.boxHH=new si,n=this.boxWW=new si,r=this.boxPP=new si;this.otstup=5,this.array=[],this.arrayCesh=[];var h=0;this.ap=[],this.apCesh=[],this.apb=[];var a,o,l,u=0;this.getA=function(){return null==this.arrayCesh[h]&&(this.arrayCesh[h]=new si),this.arrayCesh[h].clear(),h++,this.arrayCesh[h-1]},this.getPoint=function(){return null==this.apCesh[u]&&(this.apCesh[u]={x:0,y:0,z:0,b:!1}),u++,this.apCesh[u-1]};var c={x:0,y:0},d={x:0,y:0},p={x:0,y:0};this.dragActiv=function(){if(h=0,a=this.par.par.arrLine,i.b=!1,i.x=this.par.activBox._x,i.y=this.par.activBox._y,i.width=this.par.activBox.width,i.height=this.par.activBox.height,i.x1=i.x+i.width,i.y1=i.y+i.height,s.setBox(i),n.setBox(i),r.setBox(i),this.apb.length=0,this.array.length=0,0==this.startPoisk(i,this.array))return!1;if(this.poiskHH(s,this.array),this.poiskWW(n,this.array),this.isColisi(s),this.isColisi(n),0==s.b||0==n.b){if(0==s.b&&0==n.b){return Math.abs(i.x-n.x)<Math.abs(i.y-s.y)?r.setBox(n):r.setBox(s),!1}return 0==s.b&&r.setBox(s),0==n.b&&r.setBox(n),!1}return!0},this.isColisi=function(t){if(t.b=!1,1!=this.startPoisk(t))if(0!=this.isRectToBox(t,this.par.bigBox,!0)){for(var i=0;i<this.par.arrBox.length;i++)if(this.par.arrBox[i].uuid!=this.par.activBox.uuid&&1==this.isRectToBox(t,this.par.arrBox[i]))return void(t.b=!0);t.b=!1}else t.b=!0;else t.b=!0},this.isRectToBox=function(t,i,e){return 1==e?t.x>i.x&&t.x1<i.x+i.width&&t.y>i.y&&t.y1<i.y+i.height:1==this.testLineXZ3(t.x,t.x1,i.x,i.x+i.width)&&1==this.testLineXZ3(t.y,t.y1,i.y,i.y+i.height)},this.poiskWW=function(t,i){u=0;let e,s=this.getPoint(),n=this.getPoint();s.x=0,s.y=t.y,s.z=0,n.x=this.par.bigBox.width,n.y=t.y,n.z=0,this.ap.length=0,this.ap.push(s);for(var r=0;r<a.length;r++)if(e=calc.getPointOfIntersection(s,n,a[r].p,a[r].p1)){let t=this.getPoint();t.x=e.x,t.y=e.y,this.ap.push(t),e=calc.isPointInLin(a[r].p,a[r].p1,s,9999999,99999999),t.z=e.z}this.ap.push(n),this.apb.length=0;for(r=1;r<this.ap.length;r++)if(this.ap[r].z<0){let t=this.getA();t.x=this.ap[r-1].x,t.x1=this.ap[r].x,t.width=t.x1-t.x,t.y=this.ap[r].y,t.y1=this.ap[r].y+5,t.height=5,this.apb.push(t)}let h=99999999,o=99999999,l=99999999,c=99999999;for(r=0;r<this.apb.length;r++)this.apb[r].width+2*this.otstup>t.width&&(l=this.apb[r].x+this.otstup,h>(o=Math.abs(t.x-l))&&(h=o,c=l),l=this.apb[r].x1-this.otstup-t.width,h>(o=Math.abs(t.x-l))&&(h=o,c=l));return 99999999!=h&&(t.x=c,t.x1=c+t.width,!0)},this.poiskHH=function(t,i){let e=!1;for(var s=0;s<i.length;s++)t.x<i[s].line.p.x&&t.x1>i[s].line.p.x&&t.y<i[s].line.p.y&&(l=i[s].line.p.y-t.y+this.otstup,t.y+=l,t.y1+=l,e=!0),t.x<i[s].line.p1.x&&t.x1>i[s].line.p1.x&&t.y<i[s].line.p1.y&&(l=i[s].line.p1.y-t.y+this.otstup,t.y+=l,t.y1+=l,e=!0);for(s=0;s<i.length;s++)c.x=t.x,c.y=t.y,d.x=t.x,d.y=t.y+9999999999,(p=calc.getPointOfIntersection(c,d,i[s].line.p,i[s].line.p1))&&t.y<p.y+this.otstup&&(t.y=p.y+this.otstup,t.y1=t.y+t.height,e=!0),c.x=t.x1,c.y=t.y,d.x=t.x1,d.y=t.y+9999999999,(p=calc.getPointOfIntersection(c,d,i[s].line.p,i[s].line.p1))&&t.y<p.y+this.otstup&&(t.y=p.y+this.otstup,t.y1=t.y+t.height,e=!0);return e},this.startPoisk=function(t,i){t.x1=t.x+t.width,t.y1=t.y+t.height;let s=!1;for(var n=0;n<a.length;n++)if(e.setPP1(a[n]),e.line=a[n],1==this.testLineXZ2(t.x,t.x+t.x1,e.x,e.x1)&&t.y<e.y1&&1==this.testBB(t,e)){if(s=!0,!i)return s;(o=this.getA()).setBox(e),i.push(o)}return s};var f,g={x:0,y:0},x={x:0,y:0},y={x:0,y:0},m={x:0,y:0};this.onBox=function(t){g.x=t.x,g.y=t.y,x.x=t.x1,x.y=t.y,y.x=t.x1,y.y=t.y1,m.x=t.x,m.y=t.y1},this.testBB=function(t,i){return this.onBox(t),!!((f=calc.isPointInLin(i.line.p,i.line.p1,g,9999999999,999999999))&&f.z>0)||(!!((f=calc.isPointInLin(i.line.p,i.line.p1,x,9999999999,999999999))&&f.z>0)||(!!((f=calc.isPointInLin(i.line.p,i.line.p1,y,9999999999,999999999))&&f.z>0)||!!((f=calc.isPointInLin(i.line.p,i.line.p1,m,9999999999,999999999))&&f.z>0)))},this.testLineXZ2=function(t,i,e,s){return e>=t&&e<=i||t>=e&&t<=s},this.testLineXZ3=function(t,i,e,s){return e>t&&e<i||t>e&&t<s};var v,b,w=[],_=[];this.getRey=function(t,i,e,s){v=s,w.length=0,this.pr(t,i,this.par.bigBox);for(var n=0;n<this.par.arrBox.length;n++)this.isIgnor(this.par.arrBox[n])||this.pr(t,i,this.par.arrBox[n],e);for(n=0;n<a.length;n++)this.plys(t,calc.getPointOfIntersection(t,i,a[n].p,a[n].p1),e);return w.sort(this.sort),w},this.sort=function(t,i){return t.d-i.d},this.isIgnor=function(t){if(null!=v)for(var i=0;i<v.length;i++)if(v[i].uuid==t.uuid)return!0;return!1},this.getP=function(){return null==_[w.length]&&(_[w.length]={x:0,y:0,d:0}),w.push(_[w.length]),_[w.length-1]},this.pr=function(t,i,e,s){this.onBox2(e,s),this.plys(t,calc.getPointOfIntersection(t,i,g,x)),this.plys(t,calc.getPointOfIntersection(t,i,x,y)),this.plys(t,calc.getPointOfIntersection(t,i,y,m)),this.plys(t,calc.getPointOfIntersection(t,i,m,g))},this.plys=function(t,i,e){i&&((b=this.getP()).x=i.x,b.y=i.y,e&&(b.y=e-i.y),b.d=calc.getDistance(t,i))},this.onBox2=function(t,i){null==i?(g.x=t.x,g.y=t.y,x.x=t.x+t.width,x.y=t.y,y.x=t.x+t.width,y.y=t.y+t.height,m.x=t.x,m.y=t.y+t.height):(g.x=t.x,g.y=i-t.y,x.x=t.x+t.width,x.y=i-t.y,y.x=t.x+t.width,y.y=i-(t.y+t.height),m.x=t.x,m.y=i-(t.y+t.height))}}function si(){this.x=0,this.y=0,this.width=100,this.height=100,this.x1=100,this.y1=100,this.line=null,this.b=!1,this.clear=function(){this.x=0,this.y=0,this.width=100,this.height=100,this.x1=100,this.y1=100,this.line=null},this.setPP1=function(t){t.p.y<t.p1.y?(this.x=t.p.x,this.y=t.p.y,this.x1=t.p1.x,this.y1=t.p1.y):(this.x=t.p.x,this.y=t.p1.y,this.x1=t.p1.x,this.y1=t.p.y),this.width=this.x1-this.x,this.height=this.y1-this.y},this.setBox=function(t){this.b=t.b,this.x=t.x,this.y=t.y,this.x1=t.x1,this.y1=t.y1,this.width=t.width,this.height=t.height,this.line=t.line}}function ni(t){this.par=t;var i=this;this.collUtil=new ii,this.collLine=new ei(this),this.activBox={},this.arrBox=[],this.collisionBox=[],this._isCollisionAvtive=!1,this.dragBox,this.disStick=15,this.bigBox={x:0,y:0,width:100,height:100},this.tempBox={x:0,y:0,width:100,height:100},this.isStick=!1,this.hideBox=[],this.offsetHideBox=0,this.arrPointX=[],this.arrPointY=[],this.fun=null,this.funErr=null;var e,s=!0;function n(t,i){return i=i||100,Math.round(t/i)*i}this.activ=!0,this.stopDrawDebug,this.correct=function(t){if(!this.activ)return!0;if(s=!0,this.checkArrPoint(),this.isStick&&this.stick(),e=!0,this.bigBox&&this.checkBigBox(),this.moveBoxFromCollStop(),this.collisionBox=this.getCollisionBox(this.activBox,this.arrBox,this.activBox),0==this.collisionBox.length?(this._isCollisionAvtive=!1,this.isInBigBox(this.activBox)||(this.funErr&&this.funErr(this.activBox),s=!1),e=!1):this._isCollisionAvtive=!0,e){var i=[];this.findPosition1(i),this.removePositFromHard(i),0==i.length&&this.findPosition2(i),0==i.length&&(this.funErr&&this.funErr(this.activBox),s=!1);var n=this.collUtil.findMinPosition(i,this.activBox);t?(this.dragBox.x=n.x,this.dragBox.y=n.y):(this.activBox.x=n.x,this.activBox.y=n.y)}if(this.collLine.dragActiv(),1==this.collLine.dragActiv()){if(null!=window.facade&&0==facade.boolLoad)return!1}else this.activBox.x=this.collLine.boxPP.x,this.activBox.y=this.collLine.boxPP.y;return s},this.getCollStop=function(t,i){if(this.activBox.coliziStop){if(t)return i?this.activBox.coliziStop.x:this.activBox.coliziStop.x+this.activBox.coliziStop.width;if(i)return this.activBox.coliziStop.y;var e=Math.max(this.activBox.coliziStop.height,this.activBox.height);return 0==this.activBox.coliziStop.height&&(e=0),this.activBox.coliziStop.y+e}return!1},this.moveBoxFromCollStop=function(){var t=this.getCollStop(!0,!0);if(!1!==t){var i=this.getCollStop(!0,!1),e=this.getCollStop(!1,!0),s=this.getCollStop(!1,!1);this.activBox.x+this.activBox.width>i&&(this.activBox.x=i-this.activBox.width),this.activBox.x<t&&(this.activBox.x=t),this.activBox.y+this.activBox.height>s&&(this.activBox.y=s-this.activBox.height),this.activBox.y<e&&(this.activBox.y=e)}},this.stick=function(){this.collUtil.stickBox(this.activBox,this.arrBox,this.disStick)},this.redactBox=function(t){this.activBox=t,this.arrBox.push(t);var i=this.correct();return this.arrBox.pop(),this.activBox=null,i},this.removePositFromHard=function(t){var i=this.getCollStop(!0,!0);if(!1!==i)for(var e=this.getCollStop(!0,!1),s=this.getCollStop(!1,!0),r=this.getCollStop(!1,!1),h=0;h<t.length;h++)t[h]&&n(t[h].y)<n(s)?t.splice(h--,1):t[h]&&n(t[h].y)>n(r)&&t.splice(h--,1),t[h]&&n(t[h].x)<n(i)?t.splice(h--,1):t[h]&&n(t[h].x)>n(e)&&t.splice(h--,1),Math.abs(Math.abs(r)-Math.abs(s))>0&&t[h]&&t[h].y+t[h].height>r&&t.splice(h--,1)},this.findPosition2=function(t){for(var i=[],e=0;e<this.collisionBox.length;e++){this.seeArrBox=[],this.findLevel=0,i=this.freePosition(this.activBox,this.collisionBox[e],this.arrBox);for(var s=0;s<i.length;s++)t.push(i[s])}},this.findPosition1=function(t){var i={};i.x=this.activBox.x,i.y=this.activBox.y,i.width=this.activBox.width,i.height=this.activBox.height,i.offset=0,this.activBox.offset&&(i.offset=this.activBox.offset);for(var e=0;e<this.collisionBox.length;e++){var s=this.getAngleBox(i,this.collisionBox[e]);this.moveBoxFromCollBox(i,this.collisionBox[e],s),this.isInBigBox(i,2)&&0==this.getCollisionBox(i,this.arrBox,this.activBox).length&&t.push(i)}},this.moveBoxFromCollBox=function(t,i,e){var s={},n={};n.x=i.x+i.width/2,n.y=i.y+i.height/2,s.x=i.x-(i.offset||0),s.y=i.y-(i.offset||0);var r=this.getAngle(n,s);s.x=i.x+i.width+(i.offset||0),s.y=i.y+i.height+(i.offset||0);var h=this.getAngle(n,s);s.x=i.x+i.width+(i.offset||0),s.y=i.y-(i.offset||0);var a=this.getAngle(n,s);s.x=i.x-(i.offset||0),s.y=i.y+i.height+(i.offset||0);var o=this.getAngle(n,s);e>=a&&e<h&&(t.x=i.x-t.width-(t.offset||0)-(i.offset||0)),e>=h&&e<o&&(t.y=i.y-t.height-(t.offset||0)-(i.offset||0)),e>=r&&e<a&&(t.y=i.y+i.height+(t.offset||0)+(i.offset||0)),(e>=o||e<r)&&(t.x=i.x+i.width+(t.offset||0)+(i.offset||0))},this.getAngleBox=function(t,i){var e={},s={};return e.x=t.x+t.width/2,e.y=t.y+t.height/2,s.x=i.x+i.width/2,s.y=i.y+i.height/2,this.getAngle(e,s)},this.maxLevel=1,this.findLevel=0,this.seeArrBox=[],this.freePosition=function(t,i,e){this.findLevel++,this.seeArrBox.push(i);for(var s=this.getPositionBox(t,i),n=[],r=[],h=[],a=0;a<s.length;a++)if(this.isInBigBox(s[a],2)){0==(h=this.getCollisionBox(s[a],e,t)).length&&n.push(s[a]);for(var o=0;o<h.length;o++)r.indexOf(h[o])<0&&r.push(h[o])}if(this.activBox.coliziStop&&this.removePositFromHard(n),0==n.length){if(this.findLevel>this.maxLevel)return n;for(a=0;a<r.length;a++)if(!this.equalsBox(this.seeArrBox,r[a])){var l=this.freePosition(t,r[a],e);for(o=0;o<l.length;o++)n.indexOf(l[o])<0&&n.push(l[o])}}return this.findLevel--,n},this.getPositionBox=function(t,i){return[this.getBox(i.x-t.width-(t.offset||0)-(i.offset||0),t.y,t.width,t.height,t.offset,t.offset,t.offset,t.offset),this.getBox(i.x+i.width+(t.offset||0)+(i.offset||0),t.y,t.width,t.height,t.offset,t.offset,t.offset,t.offset),this.getBox(t.x,i.y-t.height-(t.offset||0)-(i.offset||0),t.width,t.height,t.offset,t.offset,t.offset,t.offset),this.getBox(t.x,i.y+i.height+(t.offset||0)+(i.offset||0),t.width,t.height,t.offset,t.offset,t.offset,t.offset),this.getBox(i.x-t.width-(t.offset||0)-(i.offset||0),i.y-t.height-(t.offset||0)-(i.offset||0),t.width,t.height,t.offset,t.offset,t.offset,t.offset),this.getBox(i.x+i.width+(t.offset||0)+(i.offset||0),i.y-t.height-(t.offset||0)-(i.offset||0),t.width,t.height,t.offset,t.offset,t.offset,t.offset),this.getBox(i.x+i.width+(t.offset||0)+(i.offset||0),i.y+i.height+(t.offset||0)+(i.offset||0),t.width,t.height,t.offset,t.offset,t.offset,t.offset),this.getBox(i.x-t.width-(t.offset||0)-(i.offset||0),i.y+i.height+(t.offset||0)+(i.offset||0),t.width,t.height,t.offset,t.offset,t.offset,t.offset)]},this.getBox=function(t,i,e,s,n){return{x:t||0,y:i||0,width:e||0,height:s||0,offset:n||0,offset:n||0,offset:n||0,offset:n||0}},this.upData=function(){null!=this.activBox&&(this.collisionBox=this.getCollisionBox(this.activBox,this.arrBox,this.activBox),this.collisionBox.length>0?this._isCollisionAvtive=!0:this._isCollisionAvtive=!1)},this.updateWorld=function(){for(var t=0;t<this.arrBox.length;t++)this.activBox=this.arrBox[t],!this.correct()&&this.fun&&this.fun(t)},this.getCollisionBox=function(t,i,e){null==i&&(i=this.arrBox);var s,n=[];if(!t)return n;for(var r=0;r<i.length;r++)t!=(s=i[r])&&e!=s&&(this.offsetBox&&this.offsetBox==s||null!=s.visible&&0==s.visible||this.collUtil.isCollisionRectangle(t.x-(t.offset||0),t.y-(t.offset||0),t.width+(t.offset||0)+(t.offset||0),t.height+(t.offset||0)+(t.offset||0),s.x-(s.offset||0),s.y-(s.offset||0),s.width+(s.offset||0)+(s.offset||0),s.height+(s.offset||0)+(s.offset||0))&&n.push(s));for(r=0;r<this.hideBox.length;r++)t!=(s=this.hideBox[r])&&e!=s&&(this.offsetBox&&this.offsetBox==s||null!=s.visible&&0==s.visible||this.collUtil.isCollisionRectangle(t.x-(t.offset||0),t.y-(t.offset||0),t.width+(t.offset||0)+(t.offset||0),t.height+(t.offset||0)+(t.offset||0),s.x-(s.offset||0),s.y-(s.offset||0),s.width+(s.offset||0)+(s.offset||0),s.height+(s.offset||0)+(s.offset||0))&&n.push(s));return n},this.checkArrPoint=function(){},this.clearArrPoint=function(){this.arrPointX=[],this.arrPointY=[],this.hideBox=[]},this.checkBigBox=function(){for(var t=0;t<this.arrBox.length;t++)this.isInBigBox(this.arrBox[t])||(this.isCollisionBigBox(this.arrBox[t])?(this.arrBox[t].x-(this.arrBox[t].offset||0)<this.bigBox.x&&(this.arrBox[t].x=this.bigBox.x+(this.arrBox[t].offset||0)),this.arrBox[t].y-(this.arrBox[t].offset||0)<this.bigBox.y&&(this.arrBox[t].y=this.bigBox.y+(this.arrBox[t].offset||0)),this.arrBox[t].x+this.arrBox[t].width+(this.arrBox[t].offset||0)>this.bigBox.x+this.bigBox.width&&(this.arrBox[t].x=this.bigBox.x+this.bigBox.width-(this.arrBox[t].width+(this.arrBox[t].offset||0))),this.arrBox[t].y+this.arrBox[t].height+(this.arrBox[t].offset||0)>this.bigBox.y+this.bigBox.height&&(this.arrBox[t].y=this.bigBox.y+this.bigBox.height-(this.arrBox[t].height+(this.arrBox[t].offset||0)))):this.activBox&&(this.activBox,this.arrBox[t]))},this.isInBigBox=function(t,i){return!t||(!this.bigBox||this.collUtil.isPutIn(this.bigBox.x,this.bigBox.y,this.bigBox.width,this.bigBox.height,t.x-(t.offset||0)+(i||0),t.y-(t.offset||0)+(i||0),t.width+(t.offset||0)+(t.offset||0)-(i||0),t.height+(t.offset||0)+(t.offset||0)-(i||0)))},this.isCollisionBigBox=function(t){return!!t&&(!!this.bigBox&&this.collUtil.isCollisionRectangle(this.bigBox.x,this.bigBox.y,this.bigBox.width,this.bigBox.height,t.x-(t.offset||0),t.y-(t.offset||0),t.width+(t.offset||0)+(t.offset||0),t.height+(t.offset||0)+(t.offset||0)))},this.equalsBox=function(t,i){for(var e=0;e<t.length;e++)if(t[e].x==i.x&&t[e].y==i.y&&t[e].width==i.width&&t[e].height==i.height)return!0;return!1},this.getAngle=function(t,i){return 180*Math.atan2(i.y-t.y,i.x-t.x)/Math.PI},this.correctShahY=function(t){},this.offsetRect=0,this.checkRect=function(t,e,s){var n=!1,r=0,h=0,a={},o=i.getBox(t.x,t.y,t.width,t.height);switch(null==t.offset&&(n=!0,t.offset=this.offsetRect||0),e=parseInt(e)){case 0:var l=this.activBox;this.offsetBox=l,this.activBox=t,this.arrBox.push(t),this.correct(),this.arrBox.pop(),this.activBox=l,this.offsetBox=!1;break;case 1:a={x:t.x+t.width,y:t.y+t.height},!1!==(h=this.findAllBoxVect(a,e,t)).y&&t.y<=h.y&&(r=Math.abs(t.y-h.y),t.y=h.y,t.height-=Math.abs(r)),!1!==h.x&&t.x<=h.x&&(r=Math.abs(t.x-h.x),t.x=h.x,t.width-=Math.abs(r));break;case 2:a={x:t.x,y:t.y+t.height},!1===(h=this.findAllBoxVect(a,e,t)).y||isNaN(h.y)||t.y<=h.y&&(r=Math.abs(t.y-h.y),t.y=h.y,t.height-=Math.abs(r)),!1===h.x||isNaN(h.x)||t.x+t.width>=h.x&&(r=Math.abs(t.x+t.width-h.x),t.width-=Math.abs(r));break;case 3:a={x:t.x,y:t.y},!1===(h=this.findAllBoxVect(a,e,t)).y||isNaN(h.y)||t.y+t.height>=h.y&&(r=Math.abs(t.y+t.height-h.y),t.height-=Math.abs(r)),!1!==h.x&&t.x+t.width>=h.x&&(r=Math.abs(t.x+t.width-h.x),t.width-=Math.abs(r));break;case 4:a={x:t.x+t.width,y:t.y},!1===(h=this.findAllBoxVect(a,e,t)).y||isNaN(h.y)||t.y+t.height>=h.y&&(r=Math.abs(t.y+t.height-h.y),t.height-=Math.abs(r)),!1===h.x||isNaN(h.x)||t.x<=h.x&&(r=Math.abs(t.x-h.x),t.x=h.x,t.width-=Math.abs(r));break;default:console.warn("curs не определен",e)}if(s){var u=(t.y+s)%s;t.y=t.y-u,e>0&&(t.height=t.height-(-u||(t.height+s)%s))}return n&&delete t.offset,parseInt(t.x)===parseInt(o.x)&&parseInt(t.width)===parseInt(o.width)},this.findAllBoxVect=function(t,e,s){for(var n=[],r=[],h=[],a=0;a<this.arrBox.length;a++)this.arrBox[a]!=this.activBox&&this.checkBoxCurs(t.x,t.y,this.arrBox[a],e)&&n.push(this.arrBox[a]);this.sortBoxXY(r,h,n,e,s),r.sort(function(t,s){return i.sortBoxCursor(t,s,e,!0)}),h.sort(function(t,s){return i.sortBoxCursor(t,s,e,!1)});var o={x:0,y:0};switch(e){case 1:if(r[0])o.x=r[0].x+r[0].width+(r[0].offset||0)+(s.offset||0);else o.x=i.bigBox.x+(s.offset||0),0!=(l=this.getCollStop(!0,!0))&&(o.x=l);return h[0]?o.y=h[0].y+h[0].height+(h[0].offset||0)+(s.offset||0):o.y=i.bigBox.y+(s.offset||0),o;case 2:if(r[0])o.x=r[0].x-(r[0].offset||0)-(s.offset||0);else o.x=i.bigBox.x+i.bigBox.width-(s.offset||0),0!=(l=this.getCollStop(!0,!1))&&(o.x=l);return h[0]?o.y=h[0].y+h[0].height+(h[0].offset||0)+(s.offset||0):o.y=i.bigBox.y+(s.offset||0),o;case 3:if(r[0])o.x=r[0].x-(r[0].offset||0)-(s.offset||0);else o.x=i.bigBox.x+i.bigBox.width-(s.offset||0),0!=(l=this.getCollStop(!0,!1))&&(o.x=l);return h[0]?o.y=h[0].y-(h[0].offset||0)-(s.offset||0):o.y=i.bigBox.y+i.bigBox.height-(s.offset||0),o;case 4:var l;if(r[0])o.x=r[0].x+r[0].width+(r[0].offset||0)+(s.offset||0);else o.x=i.bigBox.x+(s.offset||0),0!=(l=this.getCollStop(!0,!0))&&(o.x=l);return h[0]?o.y=h[0].y-(h[0].offset||0)-(s.offset||0):o.y=i.bigBox.y+i.bigBox.height-(s.offset||0),o}},this.sortBoxXY=function(t,i,e,s,n){for(var r=0,h=0,a=0;a<e.length;a++)1==s&&(n.x+n.width+(n.offset||0)<=e[a].x+e[a].width+(e[a].offset||0)?(r=1,h=0):n.y+n.height+(n.offset||0)<=e[a].y+e[a].height+(e[a].offset||0)?(r=0,h=1):(h=n.x-(n.offset||0)-(e[a].x+e[a].width+(e[a].offset||0)),r=n.y-(n.offset||0)-(e[a].y+e[a].height+(e[a].offset||0)))),2==s&&(n.x-(n.offset||0)>=e[a].x-(e[a].offset||0)?(r=1,h=0):n.y+n.height+(n.offset||0)<=e[a].y+e[a].height+(e[a].offset||0)?(r=0,h=1):(r=n.x+n.width+(n.offset||0)-(e[a].x-(e[a].offset||0)),h=e[a].y+e[a].height+(e[a].offset||0)-(n.y-(n.offset||0)))),3==s&&(n.x-(n.offset||0)>=e[a].x-(e[a].offset||0)?(r=1,h=0):n.y-(n.offset||0)>=e[a].y-(e[a].offset||0)?(r=0,h=1):(r=n.x+n.width+(n.offset||0)-e[a].x-(e[a].offset||0),h=n.y+n.height+(n.offset||0)-e[a].y-(e[a].offset||0))),4==s&&(n.x+n.width+(n.offset||0)<=e[a].x+e[a].width+(e[a].offset||0)?(r=1,h=0):n.y-(n.offset||0)>=e[a].y-(e[a].offset||0)?(r=0,h=1):(r=e[a].x+e[a].width+(e[a].offset||0)-(n.x-(n.offset||0)),h=n.y+n.height+(n.offset||0)-e[a].y-(e[a].offset||0))),r<h?t.push(e[a]):i.push(e[a])},this.sortBoxCursor=function(t,i,e,s){switch(e){case 1:return s?t.x+t.width+(t.offset||0)>i.x+i.width+(i.offset||0)?-1:t.x+t.width+(t.offset||0)<i.x+i.width+(i.offset||0)?1:0:t.y+t.height+(t.offset||0)>i.y+i.height+(i.offset||0)?-1:t.y+t.height+(t.offset||0)<i.y+i.height+(i.offset||0)?1:0;case 2:return s?t.x-(t.offset||0)<i.x-(i.offset||0)?-1:t.x-(t.offset||0)>i.x-(i.offset||0)?1:0:t.y+t.height+(t.offset||0)>i.y+i.height+(i.offset||0)?-1:t.y+t.height+(t.offset||0)<i.y+i.height+(i.offset||0)?1:0;case 3:return s?t.x-(t.offset||0)<i.x-(i.offset||0)?-1:t.x-(t.offset||0)>i.x-(i.offset||0)?1:0:t.y-(t.offset||0)<i.y-(i.offset||0)?-1:t.y-(t.offset||0)>i.y-(i.offset||0)?1:0;case 4:return s?t.x+t.width+(t.offset||0)>i.x+i.width+(i.offset||0)?-1:t.x+t.width+(t.offset||0)<i.x+i.width+(i.offset||0)?1:0:t.y-(t.offset||0)<i.y-(i.offset||0)?-1:t.y-(t.offset||0)>i.y-(i.offset||0)?1:0}},this.checkBoxCurs=function(t,i,e,s){switch(s){case 1:return!(e.x>=t)&&!(e.y>=i-1);case 2:return!(e.x+e.width<=t)&&!(e.y>=i);case 3:return!(e.x+e.width<=t)&&!(e.y+e.height<=i);case 4:return!(e.x>=t)&&!(e.y+e.height<=i)}},this.getRey=function(t,i){return this.collLine.getRey(t,i)}}function ri(t){var i=this;this.par=t,this.funDell,this.funDedug=null,this.uuid=Math.random(),this.arrLine=[],this.world=new ai(0,0,400,300),null==x&&new li,this.colozi=new ni(this),this.colozi.bigBox=this.world,this.colozi.fun=function(t){null!=i.funDell&&i.funDell(t)};var e,s=[];this.arrRect=s,this.addRect=function(t){e=9999999;for(var n=0;n<s.length;n++)if(s[n].idRandom==t.idRandom){e=n;break}if(9999999==e){t.rectartID(),s.push(t),this.colozi.arrBox.push(t.rectCollisMeshdy),this.colozi.activBox=t.rectCollisMeshdy;var r=this.colozi.correct();return r||i.removeRect(t),r}},this.removeRect=function(t,i){e=9999999;for(var n=0;n<s.length;n++)if(s[n].idRandom==t.idRandom){e=n;break}9999999!=e&&(this.colozi.arrBox.splice(e,1),e=s.splice(e,1),null==i&&this.removeRect(e,!0))},this.addRectStatic=function(t){for(var i=0;i<this.colozi.hideBox.length;i++)if(this.colozi.hideBox[i]==t)return;this.colozi.hideBox.push(t)},this.removeRectStatic=function(t){for(var i=0;i<this.colozi.hideBox.length;i++)if(this.colozi.hideBox[i]==t)return void this.colozi.hideBox.splice(i,1)},this.clearNa=function(){if(0!=s.length)for(var t=0;t<s.length;t++)x.isState(this.world,s[t]),x.isState(s[t],this.world)},this.update=function(){this.colozi.updateWorld(),this.funDedug&&this.funDedug()},this.testRect=function(t){return this.colozi.redactBox(t.rectCollisMeshdy)},this.isCollisionBigBox=function(t){return this.colozi.isCollisionBigBox(t.rectCollisMeshdy)},this.clear=function(){for(;0!==this.arrRect.length;)this.removeRect(this.arrRect[this.arrRect.length-1])},this.getRey=function(t,i){return this.colozi.getRey(t,i)};var n,r,h,a,o,l,u,c,d={x:0,y:0,x1:0,y1:0,w:1,h:1};this.getMinMax=function(t,i){d.x=this.world.x,d.x1=this.world.x+this.world.width,d.y=this.world.y,d.y1=this.world.y+this.world.height,null!=i&&(d.x1=i),h=t.rectCollisMeshdy.x,a=t.rectCollisMeshdy.x+t.rectCollisMeshdy.width,n=t.rectCollisMeshdy.y,r=t.rectCollisMeshdy.y+t.rectCollisMeshdy.height;for(var e=0;e<s.length;e++)s[e].idRandom!=t.idRandom&&(u=s[e].rectCollisMeshdy.x,c=s[e].rectCollisMeshdy.x+s[e].rectCollisMeshdy.width,o=s[e].rectCollisMeshdy.y,l=s[e].rectCollisMeshdy.y+s[e].rectCollisMeshdy.height,1==this.colisiLine2D(n,r,o,l)&&(h>u?d.x<c&&(d.x=c):d.x1>u&&(d.x1=u)),1==this.colisiLine2D(h,a,u,c)&&(n>o?d.y<l&&(d.y=l):d.y1>o&&(d.y1=o)));return d.w=d.x1-d.x,d.h=d.y1-d.y,d},this.colisiLine2D=function(t,i,e,s){return e>=t&&e<=i||t>=e&&t<=s}}function hi(t,i,e,s,n){this._x=t||0,this._y=i||0,this.uuid=Math.random(),this.width=e||100,this.height=s||100,this.fun=n}function ai(t,i,e,s,n){var r=this;this.fun=n,this.x=t||0,this.y=i||0,this.sx=t||0,this.sy=i||0,this.width=e||100,this.height=s||100,this.position=new oi(0,0,function(){r.rectCollisMeshdy.x=this.x+r.sx,r.rectCollisMeshdy.y=this.y+r.sy,r.rectCollisMeshdy.width=r.width,r.rectCollisMeshdy.height=r.height}),this.__x=t||0,this.__y=i||0,this.rectCollisMeshdy=new hi(this.x,this.y,this.width,this.height,function(){r.__x=r.rectCollisMeshdy.x-r.sx,r.__y=r.rectCollisMeshdy.y-r.sy,r.fun&&r.fun()}),this.arrKri=[0,0,0,0],this.kolPoint=0,this.peresek=!1,this.idRandom=Math.random(),this.uuid=Math.random(),this.rectartID=function(){this.idRandom=Math.round(1e16*Math.random())/1e16},this.parent,this.set=function(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.position.x=t.position.x,this.position.y=t.position.y,this.idRandom=t.idRandom};var h=new oi;this.getPoint=function(t){return 0==t&&h.set(this.__x,this.y+this.position.y),1==t&&h.set(this.__x+this.width,this.y+this.position.y),2==t&&h.set(this.__x+this.width,this.y+this.position.y+this.height),3==t&&h.set(this.__x,this.y+this.position.y+this.height),4==t&&h.set(this.__x,this.y+this.position.y),h}}function oi(t,i,e){this._x=t||0,this._y=i||0,this.fun=e,this.set=function(t,i){this.x=t,this.y=i}}function li(){var t,i;x=this,this.getAngle=function(t,i){return Math.atan2(i.y-t.y,i.x-t.x)},this.getDistance=function(t,i){return t&&i?Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2)):0},this.getVector=function(t,i){var e=new THREE.Vector2(0,0);return e.x=Math.abs(t)*Math.cos(i),e.y=Math.abs(t)*Math.sin(i),e},this.isPutIn=function(t,i){return t.x+t.position.x<=i.x+i.position.x&&t.x+t.position.x+t.width>=i.x+i.position.x+i.width&&t.y+t.position.y<=i.x+i.position.y&&t.y+t.position.y+t.height>=i.y+i.position.y+i.height},this.isPointInRect=function(t,i){return t.x>i.x+i.position.x&&t.x<i.x+i.position.x+i.width&&t.y>i.y+i.position.y&&t.y<i.y+i.position.y+i.height?1:0},this.rectInRect=function(e,s){for(t=0,i=0;i<4;i++)1==s.arrKri[i]&&t++;return!(e.width<s.width)&&(!(e.height<s.height)&&((1==t||2==t)&&(1==t&&(1==s.arrKri[0]&&(s.position.x=e.x-e.position.x-s.x+e.width-s.width,s.position.y=e.y-e.position.y-s.y+e.height-s.height),1==s.arrKri[1]&&(s.position.x=e.x-e.position.x-s.x,s.position.y=e.y-e.position.y-s.y+e.height-s.height),1==s.arrKri[2]&&(s.position.x=e.x-e.position.x-s.x,s.position.y=e.y-e.position.y-s.y),1==s.arrKri[3]&&(s.position.x=e.x-e.position.x-s.x+e.width-s.width,s.position.y=e.y-e.position.y-s.y)),2==t&&(1==s.arrKri[0]&&1==s.arrKri[1]&&(s.position.y=e.y-e.position.y-s.y+e.height-s.height),1==s.arrKri[1]&&1==s.arrKri[2]&&(s.position.x=e.x-e.position.x-s.x),1==s.arrKri[2]&&1==s.arrKri[3]&&(s.position.y=e.y-e.position.y-s.y),1==s.arrKri[3]&&1==s.arrKri[0]&&(s.position.x=e.x-e.position.x-s.x+e.width-s.width)),!0)))};var e,s,n,r,h,a,o,l=new oi,u=new oi,c=new oi,d=new oi;this.isLineRect=function(t,i){var e,s;for(e=0;e<4;e++)for(l.x=t.getPoint(e).x,l.y=t.getPoint(e).y,u.x=t.getPoint(e+1).x,u.y=t.getPoint(e+1).y,s=0;s<4;s++)if(c.x=i.getPoint(s).x,c.y=i.getPoint(s).y,d.x=i.getPoint(s+1).x,d.y=i.getPoint(s+1).y,null!=this.getPointOfIntersection(l,u,c,d)&&0==this.testRadom(t,i))return!0;return!1},this.testRadom=function(t,i){return t.getPoint(0).x>i.getPoint(0).x&&this.numOkr(t.getPoint(0).x)==this.numOkr(i.getPoint(1).x)||(t.getPoint(1).y>i.getPoint(1).y&&this.numOkr(t.getPoint(0).y)==this.numOkr(i.getPoint(2).y)||(this.numOkr(t.getPoint(1).x)==this.numOkr(i.getPoint(0).x)||this.numOkr(t.getPoint(2).y)==this.numOkr(i.getPoint(0).y)))};var p=new oi(0,0);this.getPointOfIntersection=function(t,i,l,u){return e=(t.x-i.x)*(u.y-l.y)-(t.y-i.y)*(u.x-l.x),s=(t.x-l.x)*(u.y-l.y)-(t.y-l.y)*(u.x-l.x),n=(t.x-i.x)*(t.y-l.y)-(t.y-i.y)*(t.x-l.x),h=n/e,(r=s/e)>=0&&r<=1&&h>=0&&h<=1?(a=t.x+r*(i.x-t.x),o=t.y+r*(i.y-t.y),p.x=a,p.y=o,p):null},this.isState=function(t,i){var e=0;i.kolPoint=0;for(var s=0;s<4;s++)i.arrKri[s]=this.isPointInRect(i.getPoint(s),t),1==i.arrKri[s]&&i.kolPoint++;return 0!=i.kolPoint&&(e=1),4==i.kolPoint&&(e=2),e},this.numOkr=function(t){return Math.round(1*t)/1}}function ui(t,i){var e=this;this.type="Windows",this.sten=t,this.par=t,this._height=this.sten._height,this._life=!1,this._tip=this.sten.tip,this._boolMinH=this.par._boolMinH;var s=t.stage.visi3D;this._delph=this.sten._delph,this.arrBlok=[],this.idRandom=Math.random(),this.windowsCollision=new ci(this),this.collision=this.windowsCollision.collision,this.content3d=new THREE.Object3D,this.par.cont3dSten.add(this.content3d),this.content3d.visible=!this._boolMinH,this._col3d=t.col3d,this._col3d1=t.col3d1,this.notColosiOne=!1,this.pressBlock=new di,this.isPress=!0,this.isCompensateMove=!0,this.updateCollisionStop=function(t){e.windowsCollision.updateCollisionStop(t)},this.onUpdateBlokPosition=function(t){e.windowsCollision.onUpdateBlokPosition(t)},this.renderDo=function(){this.par.par.addObjFun(this.par)},this.osX=[],this.osY=[];var n=[];this.dragOsi=function(t){this.osX.length=0,this.osY.length=0,n.length=0;for(var i=0;i<this.arrBlok.length;i++)t&&t.uuid==this.arrBlok[i].uuid||this.osX.push(this.arrBlok[i].boxColizi.rectCollisMeshdy.x,this.arrBlok[i].boxColizi.rectCollisMeshdy.x+this.arrBlok[i].boxColizi.rectCollisMeshdy.width);for(i=0;i<this.par.par.arrSplice.length;i++)1==this.par.par.arrSplice[i].life&&this.par.par.arrSplice[i].windows.dragOsiYYY(n);this.arrKill(this.osX),this.arrKill(n);for(i=0;i<this.par.par.arrSplice.length;i++)1==this.par.par.arrSplice[i].life&&(this.par.par.arrSplice[i].windows.osY=n)},this.dragOsiYYY=function(t){for(var i=0;i<this.arrBlok.length;i++)t.push(this.arrBlok[i].heightSten-this.arrBlok[i].boxColizi.rectCollisMeshdy.y,this.arrBlok[i].heightSten-(this.arrBlok[i].boxColizi.rectCollisMeshdy.y+this.arrBlok[i].boxColizi.rectCollisMeshdy.height))},this.arrKill=function(t){for(var i=0;i<t.length;i++)for(var e=t.length-1;e>=i+1;e--)t[i]==t[e]&&t.splice(e,1)},this.clearYBig=function(){for(var t=0;t<this.par.par.arrSplice.length;t++)1==this.par.par.arrSplice[t].life&&(this.par.par.arrSplice[t].windows.osX.length=0)};var r,h,a,o,l=[],u=[];this.ot=15,this.korectOsi=function(t,i){l.length=0,u.length=0,a=999,r=t.x+i.rect[0],h=t.x+i.rect[0]+i.rect[3];for(var e=0;e<this.osX.length;e++)(o=Math.abs(this.osX[e]-r))<this.ot&&o<a&&(a=o,r=this.osX[e],t.x=r-i.rect[0],r&&(u[0]=r)),(o=Math.abs(this.osX[e]-h))<this.ot&&o<a&&(a=o,h=this.osX[e],t.x=h-(i.rect[0]+i.rect[3]),h&&(u[0]=h));a=999,r=t.y+i.rect[2],h=t.y+i.rect[2]+i.rect[5];for(e=0;e<this.osY.length;e++)(o=Math.abs(this.osY[e]-r))<this.ot&&o<a&&(a=o,r=this.osY[e],t.y=r-i.rect[2]),(o=Math.abs(this.osY[e]-h))<this.ot&&o<a&&(a=o,h=this.osY[e],t.y=h-(i.rect[2]+i.rect[5]));r=t.x+i.rect[0],h=t.x+i.rect[0]+i.rect[3];for(e=0;e<this.osX.length;e++)(o=Math.abs(this.osX[e]-r))<1&&(u[0]=this.osX[e]),(o=Math.abs(this.osX[e]-h))<1&&(u[1]=this.osX[e]);r=t.y+i.rect[2],h=t.y+i.rect[2]+i.rect[5];for(e=0;e<this.osY.length;e++)(o=Math.abs(this.osY[e]-r))<1&&(l[0]=this.osY[e]),(o=Math.abs(this.osY[e]-h))<1&&(l[1]=this.osY[e]);wH3D.clear();for(e=0;e<2;e++)l[e]&&wH3D.setYSP(l[e],1);for(e=0;e<2;e++)u[e]&&wH3D.setXSP(u[e],i.parent.par)},this.addBlok=function(t){t.parent===this&&this.removeBlok(t);t.parent&&t.parent!==this&&t.parent.removeBlok(t),t.depth=this.sten.delph;for(var i=0;i<this.arrBlok.length;i++)if(this.arrBlok[i].idArr===t.idArr)return!1;e.updateCollisionStop(t);var s=this.windowsCollision.addBlok(t);return s&&(this.arrBlok.push(t),t.parent=this,this.content3d.add(t.content3d),function(t){var i=p(e.sten._rotation),s=p(t.oldStenRotation);0===i&&(i-=1e-4);Math.abs(i)===Math.PI&&(i+=1e-4);0===s&&(s-=1e-4);Math.abs(s)===Math.PI&&(s+=1e-4);(!(i>0&&s>0||i<0&&s<0)||calc.diffNum(i,s)>=Math.PI)&&(t.mirrorx*=-1,t.mirrory*=-1);t.oldStenRotation=e.sten._rotation}(t),this.draw()),s},this.press=function(t){if(t&&this.isPress)return t.resetSize(),this.pressBlock.press(t,this)},this.removeBlok=function(t){let i=-1;for(var s=0;s<this.arrBlok.length;s++)if(this.arrBlok[s].idArr===t.idArr){i=s;break}return-1!==i&&(this.arrBlok.splice(i,1),this.content3d.remove(t.content3d),this.windowsCollision.removeBlok(t),t.parent=void 0,t.oldStenRotation=e.sten._rotation,this.draw(),t.resetSize(),!0)},this.getArrDurka=function(){for(var t=e.pressBlock.getFreeArrBlokInWindow(e,null,-1),i=[],s=0;s<t.length;s++)i.push(t[s].x,t[s].x+t[s].width);return i},this.startDrag2d=function(t){rulitObject.startDrag2d(t),rulitObject.startBlok(t),!0===bigMenu.clikAB.activ&&(bigMenu.clikAB.activ=!1)},this.dMin=0,this.dMax=0,this.dist=0,this.updateDur=function(){},this.drag=function(){},this.dragPost=function(){this.draw()},this.draw=function(){s.intRend=1,0!=t._distans&&(this.delph=this.sten.delph,this.isCompensateMove&&function(){null===x&&y();if(calc.getDistance(g,e.sten.position1)>0)return g.setPoint(e.sten.position1),void y();var t;if(0===e.sten.tip){if(t=d(e.sten._distans-x),y(),0!==t)for(var i=0;i<e.arrBlok.length;i++);}else if(t=d(e.sten.lineRange.getLenght()-x),y(),0===calc.getDistance(f,e.sten.position)&&0===calc.getDistance(g,e.sten.position1)&&(t*=.5),0!==t)for(var i=0;i<e.arrBlok.length;i++)e.arrBlok[i].windowLength+=t;f.setPoint(e.sten.position)}(),this.rashotDist(),this.windowsCollision.collision.arrLine=this.par.sVephPoint.arrOsi,this.windowsCollision.drag(),this.updateDur())},this.rashotDist=function(){if(this.dMin=9999999,this.dMax=9999999,0===this.sten.tip)for(var t=0;t<6;t++)this.dMin=Math.min(this.dMin,this.sten.arrPosit[t].x),this.dMax=Math.min(this.dMax,this.sten.arrPosit1[t].x);else{var i=this.sten.lineRange.getLenght();for(t=0;t<6;t++)this.dMin=Math.min(this.dMin,-this.sten.lineRange.getLengthPoint(this.sten.arrPosit[t])),this.dMax=Math.min(this.dMax,this.sten.lineRange.getLengthPoint(this.sten.arrPosit1[t])-i)}this.dist=this.sten._distans+this.dMin+this.dMax},this.getObj=function(){for(var t={array:[]},i=0;i<this.arrBlok.length;i++)t.array.push(this.arrBlok[i].getObj());return t},this.setObj=function(t){e.isPress=!1;for(var i=0;i<t.array.length;i++){trace(i,t.array[i]);let e=this.par.par.worldBlok.getBlok(t.array[i].id);e&&(e.init(),this.addBlok(e),e.setObj(t.array[i]))}e.isPress=!0},this.getInfo=function(){let t=[];for(var i=0;i<this.arrBlok.length;i++)t.push(this.arrBlok[i].getInfoObj());return t},this.clear=function(){for(;e.arrBlok.length>0;)e.removeBlok(e.arrBlok[0])};var c=[];function d(t,i){return i=i||100,parseInt(t*i)/i}function p(t){return t>Math.PI/2&&(t-=2*Math.PI),t+=Math.PI/2}this.beforDivid=function(){if(0!==this.arrBlok.length){for(var t=0;t<this.arrBlok.length;t++)c.push(this.arrBlok[t]);this.clear()}},this.afterDivid=function(t){var i;0!==c.length&&(c.forEach(function(s){0===e.sten.tip?(i=e.sten._distans,s.position.x>i?(i=s.position.x-i,s.position._x=i,s.boxColizi.position.x=s.position._x,t.windows.addBlok(s)):e.addBlok(s)):(i=e.sten.lineRange.getLenght(),s.windowLength>i?(i=s.windowLength-i,s.windowLength=i,t.windows.addBlok(s)):e.addBlok(s))}),c.length=0)};var f=new pi,g=new pi,x=null;function y(){x=0===e.sten.tip?e.sten._distans:e.sten.lineRange.getLenght()}}function ci(t){var i=this;this.par=t,this.wind=t,this.sten=this.wind.sten,this.arrBlok=this.wind.arrBlok;var e,s=new ti;function n(t){0===i.sten.tip||(t.boxCurvColizi.width=i.sten.lineRange.getLengthByWidth(t.width))}function r(t){t.windowLength=t.boxCurvColizi.__x,t.position._z=t.boxCurvColizi.__y}function h(t){var e=s.getCurvPositionSten(i.sten,t.windowLength||0,t.width),n=s.convertCurvePosBlok(e.position,e.angel,t.width);t.angel=e.angel,t.position._x=n.x,t.position._y=n.y,t.boxColizi.position.x=t.position._x,t.dragObj2()}this.collision=new ri(this),this.collision.world.width=100,this.curvCollision=new ri,this.curvCollision.world.width=100,this.collision.colozi.activ=0===this.sten.tip,this.curvCollision.colozi.activ=!(0===this.sten.tip),this.collision.funDell=function(t){i.arrBlok[t]&&i.wind.removeBlok(i.arrBlok[t])},this.curvCollision.funDell=function(t){i.arrBlok[t]&&i.wind.removeBlok(i.arrBlok[t])},this.addBlok=function(t){i.updateCollisionStop(t),n(t);var e=this.collision.addRect(t.boxColizi),s=this.curvCollision.addRect(t.boxCurvColizi);return 1===i.sten.tip&&s&&(r(t),h(t)),0===this.sten.tip?e:s},this.removeBlok=function(t){this.collision.removeRect(t.boxColizi),this.curvCollision.removeRect(t.boxCurvColizi)},this.onUpdateBlokPosition=function(t){0===i.sten.tip?i.collision.testRect(t.boxColizi):1===i.sten.tip&&(n(t),i.curvCollision.testRect(t.boxCurvColizi),r(t),h(t))},this.updateSizeColisWorld=function(){e=calc.getDistance(i.sten.position,i.sten.position1),i.collision.world.width=e,i.collision.world.height=i._height,i.sten.lineRange&&(i.curvCollision.world.width=i.sten.lineRange.getLenght(),i.curvCollision.world.height=i._height),this.collision.world.height=this.wind._height||100,this.curvCollision.world.height=this.wind._height||100},this.updateCollisionStopBlok=function(){for(var t=0;t<i.arrBlok.length;t++)i.updateCollisionStop(i.arrBlok[t])},this.updateCollisionStop=function(t){var e=t.coliziStop;e.width=0===i.sten.tip?calc.getDistance(i.sten.position,i.sten.position1):i.sten.lineRange.getLenght(),e.width+=i.wind.dMin+i.wind.dMax,e.width-=2*t.collisionOffset,e.x=Math.abs(i.wind.dMin),e.x+=t.collisionOffset,1==t.inOgr&&(e.y=t.org1,e.height=this.sten._height-t.org-30)},this.updatePosType=function(){if(0===this._tip){this.curvCollision.colozi.activ=!1;for(var t=0;t<this.arrBlok.length;t++)this.arrBlok[t].position.x=void 0!==this.arrBlok[t].windowLength?this.arrBlok[t].windowLength:this.arrBlok[t].position.x;this.collision.colozi.activ=!0}else{this.collision.colozi.activ=!1;for(t=0;t<this.arrBlok.length;t++)this.arrBlok[t].windowLength=this.arrBlok[t].position.x;this.curvCollision.colozi.activ=!0;var i=this.wind.arrBlok.filter(function(t){return!("curvature"in t.blokKont.unik)});for(t=0;t<i.length;t++)this.wind.removeBlok(i[t])}},this.drag=function(){this.updateSizeColisWorld(),this.updateCollisionStopBlok(),this.isChangedTip&&(this.isChangedTip=!1,this.updatePosType()),0===this.sten.tip?function(){i.collision.update();for(var t=0;t<i.arrBlok.length;t++){var e=i.arrBlok[t];e&&(e.angel=0,e.dragObj2())}}():1===this.sten.tip&&function(){for(var t=0;t<i.arrBlok.length;t++)n(i.arrBlok[t]);i.curvCollision.update();for(var t=0;t<i.arrBlok.length;t++){var e=i.arrBlok[t];e&&(r(e),h(e))}}()}}function di(){var t=30;function i(i,r,h){var a=[];0===i.arrBlok.length?a.push(new Rectangle(0,0,n(i),0)):a=0===i.sten.tip?function(t,i){for(var s=0,r=0,h=[],a=t.arrBlok.slice().sort(e),o=0;o<a.length;o++)a[o]!==i&&(r=a[o].position.x,h.push(new Rectangle(s,0,r-s,0)),s=r+a[o].width);return h.push(new Rectangle(s,0,n(t)-s,0)),h}(i,r):function(t,i){for(var e=0,r=0,h=[],a=t.arrBlok.slice().sort(s),o=0;o<a.length;o++)a[o]!==i&&(r=a[o].windowLength,h.push(new Rectangle(e,0,r-e,0)),e=r+t.sten.lineRange.getLengthByWidth(a[o].width));return h.push(new Rectangle(e,0,n(t)-e,0)),h}(i,r);for(var o=0;o<a.length;o++){var l=a[o];if(0===l.x){var u=Math.abs(i.dMin);l.x=u,l.width-=u}l.width===n(i)-l.x&&(l.width-=Math.abs(i.dMax))}return a.filter(function(e){var s=e.width;return 0!==i.sten.tip&&(s=i.sten.lineRange.getWidthByLengthTo(s)),s>=(void 0!==h?h:t)})}function e(t,i){return t.position.x-i.position.x}function s(t,i){return t.windowLength-i.windowLength}function n(t){return 0===t.sten.tip?t.sten._distans:t.sten.lineRange.getLenght()}this.press=function(t,e,s){var n=function(t,i){var e=position2dFlor.getLocaPosition(pl102.global),s=t.sten.isPointInLin(e,1e5,1e5),n=new pi;0===t.sten.tip?n.x=null!=s?calc.getDistance(s,t.sten.position):i.position.x:n.x=null!=s?t.sten.lineRange.getLengthPoint(s):i.windowLength;return n}(e,t),r=i(e,t);r.sort(function(t,i){return Math.min(calc.diffNum(t.x,n.x),calc.diffNum(t.x+t.width,n.x))-Math.min(calc.diffNum(i.x,n.x),calc.diffNum(i.x+i.width,n.x))});var h=r[0];if(!h)return!1;h.x=h.x+.5,h.width=h.width-1;var a=h.x;return 0!==e.sten.tip&&function(t,i){i.width=t.sten.lineRange.getWidthByLengthTo(i.width),i.x=t.sten.lineRange.getWidthByLengthTo(i.x)}(e,h),t.updBreadthRect(h),!s&&h.width<t.width?(t.width=h.width,t.windowLength=a,t.position._x=h.x,t.boxColizi.position.x=t.position._x,!0):void 0},this.getFreeArrBlokInWindow=i}function pi(t,i,e){this._x=t||0,this._y=i||0,this._z=e||0,this.set=function(t,i,e){this._x=t||0,this._y=i||0,void 0!==e&&(this._z=e)},this.setPoint=function(t){this._x=t.x,this._y=t.y,void 0!==t.z&&(this._z=t.z)},this.getObj=function(){var t={};return t.x=this._x,t.y=this._y,t.z=this._z,t},this.copy=function(){return new pi(this._x,this._y,this._z)}}Ut.prototype={set uuid(t){this._uuid!==t&&(this.funUpdateUuid&&this.funUpdateUuid(this._uuid,t),this._uuid=t)},get uuid(){return this._uuid},getObj:function(){var t={};return t.type=this.type,t.idArr=this.idArr,t.position=this.position.getObj(),t},setObj:function(t){this.position.setPoint(t.position)},restart:function(t){},set life(t){if(this._life!=t){this._life=t;for(var i=0;i<this.arrayClass.length;i++)null!=this.arrayClass[i].life&&(this.arrayClass[i].life=this._life)}},get life(){return this._life}},Zt.prototype={set x(t){this._x=t},get x(){return this._x},set y(t){this._y=t},get y(){return this._y},set z(t){this._z=t},get z(){return this._z}},Kt.prototype={set x(t){this._x=t,this.fun&&this.fun()},get x(){return this._x},set y(t){this._y=t,this.fun&&this.fun()},get y(){return this._y},set z(t){this._z=t,this.fun&&this.fun()},get z(){return this._z}},qt.prototype={set x(t){this._x!==t&&(this._x=t)},get x(){return this._x},set y(t){this._y!==t&&(this._y=t)},get y(){return this._y},set width(t){this._width!==t&&(this._width=t)},get width(){return this._width},set height(t){this._height!==t&&(this._height=t)},get height(){return this._height}},Jt.prototype={set uuid(t){this._uuid!==t&&(this.funUpdateUuid&&this.funUpdateUuid(this._uuid,t),this._uuid=t)},get uuid(){return this._uuid},getObj:function(){var t={};if(t.type=this.type,t.idArr=this.idArr,t.delph=this.delph,t.tip=this.tip,t.position=this.addPoint?this.addPoint.position.getObj():this.position.getObj(),t.position1=this.addPoint1?this.addPoint1.position.getObj():this.position1.getObj(),t.connected=this.getArrConectedSplice(),this.lineRange&&(t.position2=this.lineRange.p2.getObj()),0!=this.tip){t.arrOpor=[];for(var i=0;i<this.arrOpor.length;i++)t.arrOpor.push({x:this.arrOpor[i].x,y:this.arrOpor[i].y})}return t.uuid=this.uuid,t},setObj:function(t){if(void 0!==t.uuid&&(this.uuid=t.uuid),this.clear(),void 0!==t.delph&&(this._delph=t.delph),void 0!==t.position&&this.position.setPoint(t.position),void 0!==t.position1&&this.position1.setPoint(t.position1),void 0!==t.connected&&(this.connected=t.connected),this.stage.stenInPoint(this),void 0!==t.curve&&(this.tip=t.curve?1:0),void 0!==t.tip&&(this.tip=t.tip),t.position2&&1===this.tip&&(this.lineRange.setTwoPoint(this.position,this.position1),this.lineRange.setCurvFromPoint(t.position2)),null!=t.arrOpor)for(var i=0;i<t.arrOpor.length;i++)this.arrOpor[i]||(this.arrOpor[i]=new Zt),this.arrOpor[i].set(t.arrOpor[i].x,t.arrOpor[i].y);null!=this._addPoint&&this._addPoint.drag(),null!=this._addPoint1&&this._addPoint1.drag(),this.life=!0,this.drag()},setSten:function(t){void 0!==t.tip&&(this.tip=t.tip),void 0!==t.lineRange&&void 0!==this.lineRange&&this.lineRange.setLR(t.lineRange),void 0!==t.position&&this.position.setPoint(t.position),void 0!==t.position1&&this.position1.setPoint(t.position1),void 0!==t.delph&&(this.delph=t.delph)},restart:function(t){},compare:function(t,i){return rez=!0,s1=t.getObj(),s2=i,t.delph!=s2.delph&&(rez=!1),calc.getDistance(s1.position,s2.position)>.1&&(rez=!1),s1.position2&&s2.position2&&calc.getDistance(s1.position2,s2.position2)>.1&&(rez=!1),t.tip!=s2.tip&&(rez=!1),rez},drag:function(){this._rotation=this.stage.spCalc.getAngle(this.position,this.position1),this._distans=this.stage.spCalc.getDistance(this.position,this.position1),1==this.tip&&(this.lineRange.p.setPoint(this.position),this.lineRange.p1.setPoint(this.position1),this.lineRange.upDate(),this.arrOpor[0].set(this.lineRange.pint90.x,this.lineRange.pint90.y)),this.calculate||(this._callAllFun("drag"),this.funDragOne&&this.funDragOne())},clone:function(t){var i=this.stage.craetSplice(),e=this.stage.craetPoint(),s=this.stage.craetPoint();e.position.set(this.position.x,this.position.y),s.position.set(this.position1.x,this.position1.y);var n=this.getObj();return function t(i){void 0!==i.uuid&&(i.uuid=calc.generateUUID());for(var e in i)"object"==typeof i[e]&&t(i[e])}(n),n.uuid=i.uuid,i.setObj(n),i.addPoint.removeSplice(i),i.addPoint1.removeSplice(i),e.addSplice(i,!0),s.addSplice(i,!1),t&&(e.position.x+=t.x,e.position.y+=t.y,s.position.x+=t.x,s.position.y+=t.y),i},set addPoint(t){this._addPoint!=t&&(this._addPoint=t,null!=this._addPoint1&&null!=this._addPoint&&this._addPoint1.idArr==this._addPoint.idArr&&this.clear())},get addPoint(){return this._addPoint},set addPoint1(t){this._addPoint1!=t&&(this._addPoint1=t,null!=this._addPoint&&null!=this._addPoint1&&this._addPoint.idArr==this._addPoint1.idArr&&this.clear())},get addPoint1(){return this._addPoint1},set delph(t){this._delph!=t&&(this._delph=t,this._setAllParam("delph",this._delph),null!=this._addPoint&&this._addPoint.drag(),null!=this._addPoint1&&this._addPoint1.drag())},get delph(){return this._delph},set tip(t){this._tip!=t&&(this._tip=t,this.calculate=!0,this.restartTip(),this._setAllParam("tip",this._tip),null!=this._addPoint&&this._addPoint.drag(),null!=this._addPoint1&&this._addPoint1.drag(),this.calculate=!1,this.drag())},get tip(){return this._tip},set life(t){this._life!=t&&(this._life=t,this._setAllParam("life",this._life))},get life(){return this._life},set activMouse(t){this._activMouse!=t&&(this._activMouse=t,this._setAllParam("activMouse",this._activMouse))},get activMouse(){return this._activMouse},set oporPointVisi(t){this._oporPointVisi!=t&&(this._oporPointVisi=t,this._setAllParam("oporPointVisi",this._oporPointVisi))},get oporPointVisi(){return this._oporPointVisi},set distans0(t){if(this._distans0!==t){var i=this.position.copy(),e=this.position1.copy();calc.korektToLine(i,e,(t-this._distans0)/2,0),this.addPoint&&(this.addPoint.position.setPoint(i),this.addPoint1.position.setPoint(e),this.addPoint.dragVokrug(),this.addPoint1.dragVokrug())}},get distans0(){return this.updateDistans01(),this._distans0},set distans1(t){if(this._distans1!==t){var i=this.position.copy(),e=this.position1.copy();calc.korektToLine(i,e,(t-this._distans1)/2,0),this.addPoint&&(this.addPoint.position.setPoint(i),this.addPoint1.position.setPoint(e),this.addPoint.dragVokrug(),this.addPoint1.dragVokrug())}},get distans1(){return this.updateDistans01(),this._distans1},set visible(t){this._visible!==t&&(this._visible=t,this._setAllParam("visible",this._visible))},get visible(){return this._visible}},$t.prototype={set x(t){this._x=t},get x(){return this._x},set y(t){this._y=t},get y(){return this._y},set z(t){this._z=t},get z(){return this._z}},ni.prototype={set isCollisionAvtive(t){this._isCollisionAvtive=t},get isCollisionAvtive(){return this.upData(),this._isCollisionAvtive}},ri.prototype={set width(t){this.world.width=t,this.clearNa()},get width(){return this.world.width}},hi.prototype={set x(t){this._x=t,this.fun&&this.fun()},get x(){return this._x},set y(t){this._y=t,this.fun&&this.fun()},get y(){return this._y}},oi.prototype={set x(t){this._x=t,this.fun&&this.fun()},get x(){return this._x},set y(t){this._y=t,this.fun&&this.fun()},get y(){return this._y}},ui.prototype={set life(t){this._life!==t&&(this._life=t)},get life(){return this._life},set boolMinH(t){this._boolMinH!==t&&(this._boolMinH=t,this.content3d.visible=!this._boolMinH)},get boolMinH(){return this._boolMinH},set delph(t){if(this._delph!==t){this._delph=t;for(var i=0;i<this.arrBlok.length;i++)this.arrBlok[i].depth=t;this.draw()}},get delph(){return this._delph},set height(t){this._height!==t&&(this._height=t,this.draw())},get height(){return this._height},set col3d(t){this._col3d!=t&&(this._col3d=t)},get col3d(){return this._col3d},set col3d1(t){this._col3d1!=t&&(this._col3d1=t)},get col3d1(){return this._col3d1},set activ(t){this._activ!==t&&(this._activ=t)},get activ(){return this._activ},set tip(t){this._tip!==t&&(this._tip=t,this.windowsCollision.tip=t)},get tip(){return this._tip}},ci.prototype={set tip(t){this._tip!==t&&(this._tip=t,this.isChangedTip=!0)},get tip(){return this._tip}},pi.prototype={set x(t){this._x=t},get x(){return this._x},set y(t){this._y=t},get y(){return this._y},set z(t){this._z=t},get z(){return this._z}};class fi extends THREE.BufferGeometry{constructor(){super();var t=[];this.upNull=function(){t.push(-.5,-.5,0),t.push(-.5,-.5,0),t.push(-.5,.5,0),t.push(-.5,-.5,0),t.push(-.5,-.5,0),t.push(.5,-.5,0),t.push(.5,-.5,0),t.push(.5,.5,0),t.push(.5,.5,0),t.push(-.5,.5,0),t.push(-.5,.5,0),t.push(.5,.5,0),this.setAttribute("position",new THREE.Float32BufferAttribute(t,3))},this.upNull(),this.clearPoint=function(){this.array.length=0},this.array=[],this.addLine=function(t,i){this.array.push(t,i)},this.clear=function(i){this.array.length=0,t.length=0,n.length=0,s.length=0},this.addTri=function(i,e,r,h,a,o,l,u){t.push(i.x,i.y,i.z),t.push(e.x,e.y,e.z),t.push(r.x,r.y,r.z),h&&(n.push(h.x,h.y,h.z),n.push(a.x,a.y,a.z),n.push(o.x,o.y,o.z),s.push(l.x,l.y),s.push(u.x,u.y))};var i,e,s=[],n=[];this.redrag=function(r){if(null==r)this.setAttribute("position",new THREE.Float32BufferAttribute(t,3));else if(this.setAttribute("position",new THREE.Float32BufferAttribute(t,3)),this.computeBoundingBox(),this.computeBoundingSphere(),0==s.length){i=this.boundingBox.max.x-this.boundingBox.min.x,e=this.boundingBox.max.y-this.boundingBox.min.y;for(var h=0;h<t.length;h+=3)n.push(r.x,r.y,r.z),s.push((t[h]-this.boundingBox.min.x)/i,(t[h+1]-this.boundingBox.min.y)/e);this.setAttribute("normal",new THREE.Float32BufferAttribute(n,3)),this.setAttribute("uv",new THREE.Float32BufferAttribute(s,2))}else this.setAttribute("normal",new THREE.Float32BufferAttribute(n,3)),this.setAttribute("uv",new THREE.Float32BufferAttribute(s,2));this.computeBoundingBox(),this.computeBoundingSphere(),this.computeVertexNormals()},this.redrag1=function(){this.setAttribute("position",new THREE.Float32BufferAttribute(t,3))},this.upDate=function(){0==this.array.length&&this.upNull(),t.length=0;for(var i=0;i<this.array.length;i+=2)t.push(this.array[i].x,this.array[i].y,this.array[i].z),t.push(this.array[i+1].x,this.array[i+1].y,this.array[i+1].z);this.setAttribute("position",new THREE.Float32BufferAttribute(t,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this.computeVertexNormals()}}}var gi,xi=0;class yi{constructor(t){this.type="TCont";this.tCont="xz",this.object3d=new THREE.Object3D,this.object3d.tCont=this,this.children=[],this._parent=void 0,this._scale=1,this._x=0,this._y=0,this.uuid=xi+"_"+Math.random(),xi++,this.dragBigXZ=function(){},null!=t&&(null==t.tCont?t.add(this.object3d):t.object3d.add(this.object3d))}add(t){if(null==t)return null;for(var i=0;i<this.children.length;i++)this.children[i].uuid==t&&(remove(this.children[i]),i=0);this.children.push(t),this.object3d.add(t.object3d),t.parent=this,t.testVisi()}remove(t){if(null==t)return null;for(var i,e=0;e<this.children.length;e++)if(this.children[e].uuid==t.uuid)return(i=this.children.splice(e,1))[0].parent.object3d.remove(i[0].object3d),i[0].parent=void 0,i[0];return null}set x(t){this.object3d.position.x=t}get x(){return this.object3d.position.x}set y(t){this.object3d.position.y=t}get y(){return this.object3d.position.y}set scale(t){this._scale!=t&&(this._scale=t,this.object3d.scale(this._scale,1,this._scale))}get scale(){return this._scale}set parent(t){this._parent=t}get parent(){return this._parent}set alpha(t){this.parameter.alpha!=t&&(this.parameter.alpha=t,this.div.style.opacity=this.parameter.alpha)}get alpha(){return this.parameter.alpha}set visible(t){this._visible!=t&&(this._visible=t,this.object3d.visible=this._visible)}get visible(){return this.parameter.visible}}class mi{constructor(){var t=this;this.type="TVector",this.time=0,this._wh=50,this._sah=2,this._zdvig=2,this._canvas,this.funUp=void 0,this._boolMat=!0,this.dinFun=void 0,this.bitmapData=new Pi(225,225,[0,0,0,0],function(){t.upDate(),t.dinFun&&t.dinFun()}),this._canvas=this.bitmapData.canvas,this.bloks=new bi(this),this.points=new vi(this),this.setLink=function(i,e){t.dinFun=e,this.bitmapData.load(i,!0)},this.upDate=function(){var t=(new Date).getMilliseconds();this.bloks.upDate(),this.points.upDate(),this.time=(new Date).getMilliseconds()-t,null!=this.funUp&&this.funUp()}}set canvas(t){this._canvas=t}get canvas(){return this._canvas}set wh(t){this._wh!=Math.round(t)&&(this._wh=Math.round(t),this.upDate())}get wh(){return this._wh}set sah(t){this._sah!=t&&(this._sah=t,this.upDate())}get sah(){return this._sah}set zdvig(t){this._zdvig!=t&&(this._zdvig=t,this.upDate())}get zdvig(){return this._zdvig}set boolMat(t){this._boolMat!=t&&(this._boolMat=t,this.points._boolMat=t,this.upDate())}get boolMat(){return this._boolMat}}class vi{constructor(t){this.par=t,this.array=[],this.arrayTriangle=[];var i=[],e=0;this._boolMat=!0,this.ts=new Si,this.getP=function(){return e==i.length&&i.push({x:0,y:0}),i[++e-1]},this.clear=function(){this.array=[],this.arrayTriangle=[],this.ts.segment.width=2*this.par.wh,this.ts.segment.height=2*this.par.wh,e=0},this.upDate=function(){this.clear();for(var t=0;t<this.par.bloks.array.length;t++)for(var i=0;i<this.par.bloks.array[t].attIJBig.length;i++)this.startGron(this.par.bloks.array[t].attIJBig[i],this.par.bloks.array[t].i,this.par.bloks.array[t].j)},this.startGron=function(t,i,e){if(!(t.length<5)){for(var s,n=[],r=0;r<t.length;r+=2)(s=this.getP()).x=t[r],s.y=t[r+1],n.push(s);1==this._boolMat&&this.sGMat(n);for(r=0;r<n.length;r++)n[r].x+=i,n[r].y+=e;this.ts.arrPosition=[],this.ts.start(n);var h=[];for(r=0;r<this.ts.arrPosition.length;r+=9)h.push(this.ts.arrPosition[r],this.ts.arrPosition[r+1]),h.push(this.ts.arrPosition[r+3],this.ts.arrPosition[r+1+3]),h.push(this.ts.arrPosition[r+6],this.ts.arrPosition[r+1+6]);this.arrayTriangle.push(h),this.array.push(n)}},this.sGMat=function(t){for(var i=0;i<t.length-2;i++)this.sGMat2(t,i)};var s,n;this.sGMat2=function(t,i){if(!(this.getDistance(t[i],t[i+1])>10||Math.abs(this.getDistancePointToLine(t[i],t[i+2],t[i+1]))>1)){s=[];for(var e=0;e<100&&!((n=i+e+2)>=t.length-3);e++)if(s.push(n-1),1==this.sGMat3(t,t[i],s,t[n])){for(var r=s.length-2;r>=0;r--)t.splice(s[r],1);e=999999;break}}},this.sGMat3=function(t,i,e,s){for(var n=!1,r=0;r<e.length;r++)if(Math.abs(this.getDistancePointToLine(i,t[e[r]],s))>this.par._zdvig){n=!0;break}return n},this.getDistance=function(t,i){return null==t?0:(null==i&&(i=rezNull),i=i||rezNull,Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2)))},this.getDistancePointToLine=function(t,i,e){var s=((i.y-t.y)*e.x-(i.x-t.x)*e.y+i.x*t.y-i.y*t.x)/this.getDistance(t,i),n=0;return 0==isNaN(s)&&(n=-s),n}}}class bi{constructor(t){this.par=t,this.array=[],this.arrGron=[],this.arrGronMin=[];var i,e,s,n=t.bitmapData,r=0,h=0;this.clear=function(){this.array=[];for(var t=0;t<this.arrGron.length;t++)this.arrGron[t].clear()},this.getGron=function(t,i,e,s){return r==this.arrGron.length&&(this.arrGron.push(new wi(this)),this.arrGron[r].idArr=r),this.arrGron[r].start(t,i,e,s),this.array.push(this.arrGron[r]),r++,this.arrGron[r-1]},this.getGMin=function(){return h==this.arrGronMin.length&&(this.arrGronMin.push(new _i(this)),this.arrGronMin[h].idArr=h),h++,this.arrGronMin[h-1]},this.upDate=function(){var a,o;this.clear(),r=0,h=0,i=n.width,e=n.height,s=null;for(var l=0;l<i-t._wh;l+=t._wh){l+(a=t._wh+1)>=i-t._wh+1&&(a=i-l);for(var u=0;u<e-t._wh;u+=t._wh)u+(o=t._wh+1)>=e-t._wh+1&&(o=e-u),s=this.getGron(l,u,a,o)}null==s&&(s=this.getGron(0,0,i,e))}}}class wi{constructor(t){this.par=t,this.idArr=-1,this.array=[],this.status=0,this.i,this.j,this.w,this.h;var i,e=t.par.bitmapData;this.clear=function(){0!=this.array.length&&(this.array=[])},this.start=function(s,n,r,h){this.i=s,this.j=n,this.w=r,this.h=h;for(var a=0;a<r;a++){this.array[a]=[];for(var o=0;o<h;o++)(i=t.getGMin()).start(a+s,o+n,e.getPixel(a+s,o+n)),this.array[a][o]=i}this.testSt(),1==this.status&&this.poisk()},this.testSt=function(){this.status=0,this.attIJBig=[];for(var t=0;t<this.w;t++)for(var i=0;i<this.h;i++)if(0!=this.array[t][i].suma){this.status=1,t=999,i=999;break}if(0!=this.status){for(this.status=2,t=0;t<this.w;t++)for(i=0;i<this.h;i++)if(0==this.array[t][i].suma){this.status=1,t=999,i=999;break}1!=this.status&&(this.attIJBig=[[0,0,this.w-1,0,this.w-1,this.h-1,0,this.h-1,0,0]])}};var s=0;this.attIJ=[],this.attIJ2=[],this.attIJBig=[],this.poisk=function(){if(this.poiskOpok(),this.attIJ=[],this.attIJBig=[],s=-1,this.poiskLine(),this.attIJBig.length>=2){this.slivanie();for(var t=this.attIJBig.length-1;t>=0;t--)this.attIJBig[t].length}},this.slivanie=function(){for(var t=0;t<this.attIJBig.length;t++)this.slivanieMa(this.attIJBig[t],t)},this.slivanieMa=function(t,i){if(t[1]-1>0&&0!=this.array[t[0]][t[1]-1].suma)for(var e=1;e<this.h;e++)if(t[1]-e>=0&&1==this.array[t[0]][t[1]-e].opor){var s=this.array[t[0]][t[1]-e].konur;if(-1!=s){for(var n=0;n<t.length;n++)this.attIJBig[s].push(t[n]);return this.attIJBig[i]=[],void this.rjynehNa(i,s)}}},this.rjynehNa=function(t,i){var e,s;for(e=0;e<this.w;e++)for(s=0;s<this.h;s++)this.array[e][s].konur==t&&(this.array[e][s].konur=i)};var n=r={i:0,y:0,x:0,y:0,error:0},r={i:0,y:0,x:0,y:0,error:0};this.poiskLine=function(){-1!=s&&this.attIJBig.push(this.attIJ),s++;for(var t=0;t<this.w;t++)for(var i=0;i<this.h;i++)if(0!=this.array[t][i].suma&&1==this.array[t][i].opor&&-1==this.array[t][i].proshli)return 0,0,this.poiskOFkonur2(t,i,s),this.array[t][i].proshli=5,this.attIJ=[],this.getPoisk(t,i),-999==r.i?(this.poiskLine(),!1):(this.attIJ.push(t,i),this.array[t][i].konur=s,this.attIJ2=[],this.attIJ2.push(t,i),n.i=1*r.i,n.j=1*r.j,n.x=1*r.x,n.y=1*r.y,n.error=0,this.poiskOF(r.i,r.j),!0);return!1},this.poiskOFkonur2=function(t,i,e){-1==this.array[t][i].proshli2&&(this.array[t][i].proshli2=1,this.getPoisk(t,i,"proshli2"),-999!=r.x&&(this.array[r.i][r.j].konur2=e,this.poiskOFkonur2(r.i,r.j,e)),this.getPoisk(t,i,"proshli2"),-999!=r.x&&(this.array[r.i][r.j].konur2=e,this.poiskOFkonur2(r.i,r.j,e)),0)},this.poiskOF=function(t,i){if(-999!=t)if(this.attIJ2.push(t,i),this.array[t][i].konur=s,this.array[t][i].proshli=1,this.getPoisk(t,i),-999!=r.x){var e=!1;r.x==n.x&&r.y==n.y&&(e=!0),this.array[t][i].oporNum>=3&&(n.error=999999999),0==e&&n.error++,1==this.array[r.i][r.j].oporSuper&&(n.error=999999999),n.error<this.par.par._sah?this.poiskOF(r.i,r.j):(this.array[r.i][r.j].proshli=4,n.i=1*r.i,n.j=1*r.j,n.x=1*r.x,n.y=1*r.y,n.error=0,this.attIJ.push(t,i),this.array[r.i][r.j].konur=s,this.poiskOF(r.i,r.j),this.array[t][i].proshli=4)}else this.testOdinokih()};var h,a,o,l,u,c,d,p;this.getPoisk=function(t,i,e){r.x=-999;var s=e||"proshli";p=0,d=-999,l=-999,o=-999,c=-999,u=-999;for(var n=-1;n<2;n++)if(-1!=(h=t+n)&&h<=this.w-1)for(var f=-1;f<2;f++)a=i+f,0==n&&0==f||-1!=a&&a<=this.h-1&&0!=this.array[h][a].suma&&1==this.array[h][a].opor&&-1==this.array[h][a][s]&&(p++,this.array[h][a].oporNum>d&&(d=this.array[h][a].oporNum,o=h,l=a,u=n,c=f));if(r.i=o,r.j=l,r.x=u,r.y=c,1==this.array[t][i].krai){if(t<this.w-1&&null!=this.array[t+1][i]&&0!=this.array[t+1][i].suma&&1==this.array[t+1][i].opor&&-1==this.array[t+1][i][s]&&this.array[t+1][i].oporNum>=d)return r.i=t+1,r.j=i,r.x=1,void(r.y=0);if(t>0&&null!=this.array[t-1][i]&&0!=this.array[t-1][i].suma&&1==this.array[t-1][i].opor&&-1==this.array[t-1][i][s]&&this.array[t-1][i].oporNum>=d)return r.i=t-1,r.j=i,r.x=-1,void(r.y=0);if(null!=this.array[t][i+1]&&0!=this.array[t][i+1].suma&&1==this.array[t][i+1].opor&&-1==this.array[t][i+1][s]&&this.array[t][i+1].oporNum>=d)return r.i=t,r.j=i+1,r.x=0,void(r.y=1);if(null!=this.array[t][i-1]&&0!=this.array[t][i-1].suma&&1==this.array[t][i-1].opor&&-1==this.array[t][i-1][s]&&this.array[t][i-1].oporNum>=d)return r.i=t,r.j=i-1,r.x=0,void(r.y=-1)}},this.testAll=function(){for(var t=-1,i=0,e=9999,r=-1,h=-1,a=Math.sqrt(Math.pow(1*this.attIJ[0]-n.i,2)+Math.pow(1*this.attIJ[1]-n.j,2)),o=0;o<this.w;o++)for(var l=0;l<this.h;l++)this.array[o][l].konur2==s&&(0,-1==this.array[o][l].proshli&&(t=Math.sqrt(Math.pow(n.i-o,2)+Math.pow(n.j-l,2)))<a&&(e>t&&(e=t,r=o,h=l),i++));return 0!=i&&(n.i=r,n.j=h,n.x=0,n.y=0,n.error=0,this.attIJ.push(r,h),this.array[r][h].konur=s,this.array[r][h].proshli=4,this.poiskOF(r,h),!0)},this.testOdinokih=function(){if(1!=this.testAll()){var t=0,i=0,e=!0;if(this.attIJ2.length>=5){e=!1;for(var s=2;s<this.attIJ2.length;s+=2)this.attIJ2[s]!=this.attIJ2[0]&&(t=1),this.attIJ2[s+1]!=this.attIJ2[1]&&(i=1);0==t&&(e=!0),0==i&&(e=!0)}if(1==e)for(s=0;s<this.attIJ2.length;s+=2)this.array[this.attIJ2[s]][this.attIJ2[s+1]].opor=!1,this.array[this.attIJ2[s]][this.attIJ2[s+1]].proshli=-1;else this.attIJ.push(1*this.attIJ[0],1*this.attIJ[1]);this.poiskLine()}},this.poiskOpok=function(){for(var t=-1,i=0;i<this.w;i++){t=-1;for(var e=0;e<this.h;e++)this.array[i][e].suma!=t&&(this.array[i][e].opor=!0,this.array[i][e].oporNum++,t=this.array[i][e].suma);t=-1;for(e=this.h-1;e>=0;e--)this.array[i][e].suma!=t&&(this.array[i][e].opor=!0,this.array[i][e].oporNum++,t=this.array[i][e].suma)}for(e=0;e<this.h;e++){t=-1;for(i=0;i<this.w;i++)this.array[i][e].suma!=t&&(this.array[i][e].opor=!0,this.array[i][e].oporNum++,t=this.array[i][e].suma)}for(e=0;e<this.h;e++){t=-1;for(i=this.w-1;i>=0;i--)this.array[i][e].suma!=t&&(this.array[i][e].opor=!0,this.array[i][e].oporNum++,t=this.array[i][e].suma)}for(e=0;e<this.h;e++)for(i=0;i<this.w;i++)0!=this.array[i][e].suma&&1==this.array[i][e].opor&&this.killOO(i,e);for(e=0;e<this.h;e++)t=-1,this.array[0][e].suma!=t&&(this.array[0][e].krai=!0,this.array[0][e].oporNum++),this.array[this.w-1][e].suma!=t&&(this.array[this.w-1][e].krai=!0,this.array[this.w-1][e].oporNum++);for(i=0;i<this.w;i++)t=-1,this.array[i][0].suma!=t&&(this.array[i][0].krai=!0,this.array[i][0].oporNum++),this.array[i][this.h-1].suma!=t&&(this.array[i][this.h-1].krai=!0,this.array[i][this.h-1].oporNum++);0!=this.array[0][0].suma&&(this.array[0][0].oporNum+=10),0!=this.array[this.w-1][0].suma&&(this.array[this.w-1][0].oporNum+=10),0!=this.array[this.w-1][this.h-1].suma&&(this.array[this.w-1][this.h-1].oporNum+=10),0!=this.array[0][this.h-1].suma&&(this.array[0][this.h-1].oporNum+=10),this.array[0][7].oporNum+=10,t=11;for(e=0;e<this.h;e++)this.array[0][e].suma;this.poiskOpokwwww()},this.poiskOpokwwww=function(){},this.killOO=function(t,i){this.getPoisk(t,i),1==p&&(this.array[t][i].suma=0,this.array[t][i].opor=!1)}}}class _i{constructor(t){this.par=t,this.idArr=-1,this.startColor,this.a,this.i,this.j,this.suma=0,this.opor=!1,this.oporSuper=!1,this.proshli=-1,this.oporNum=0,this.krai=!1,this.konur=-1,this.konur2=-1,this.proshli2=-1,this.start=function(t,i,e){this.suma=0,this.opor=!1,this.oporSuper=!1,this.proshli=-1,this.krai=!1,this.konur2=-1,this.proshli2=-1,this.i=t,this.j=i,this.oporNum=0,e[3]>200&&(this.suma=1)}}}function Pi(t,i,e,s){var n=this;this.type="TBitmapData",this.fun=s,this._width=null!=t?t:100,this._height=null!=i?i:100,this._color=null!=e?e:[0,0,0,255],this._widthVisi=100,this._heightVisi=100,this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.load=function(t,i){var e=new Image;e.crossOrigin="Anonymous",e.onload=function(){n.width=e.width,n.height=e.height,i&&n.clear(),n.ctx.drawImage(e,0,0),n.imgData=n.ctx.getImageData(0,0,n.width,n.height),n.fun&&n.fun()},e.src=t},this.setCanvas=function(t,i){n.canvas=t,n.ctx=i,n.imgData=n.ctx.getImageData(0,0,n.canvas.width,n.canvas.height),n.upDate()},this.setImage=function(t){this._width=t.width,this._height=t.height,this.canvas.width=this._width,this.canvas.height=this._height,this.ctx.clearRect(0,0,this._width,this._width),this.ctx.drawImage(t,0,0),this.imgData=this.ctx.getImageData(0,0,t.width,t.height)},this.setImage2=function(t,i){this._width=t.width,this._height=t.height,this.canvas.width=this._width*i,this.canvas.height=this._height*i,this.ctx.clearRect(0,0,this._width,this._width),this.ctx.drawImage(t,0,0,this._width,this._height,0,0,this._width*i,this._height*i),this.imgData=this.ctx.getImageData(0,0,t.width,t.height)},this.getData=function(){return this.canvas.toDataURL()},this.arrRgba=[0,0,0,0],this.getPixel=function(t,i){return this.arrRgba[0]=this.imgData.data[4*(i*this.imgData.width+t)+0],this.arrRgba[1]=this.imgData.data[4*(i*this.imgData.width+t)+1],this.arrRgba[2]=this.imgData.data[4*(i*this.imgData.width+t)+2],this.arrRgba[3]=this.imgData.data[4*(i*this.imgData.width+t)+3],this.arrRgba[0]=this.arrRgba[0]?this.arrRgba[0]:0,this.arrRgba[1]=this.arrRgba[1]?this.arrRgba[1]:0,this.arrRgba[2]=this.arrRgba[2]?this.arrRgba[2]:0,this.arrRgba[3]=this.arrRgba[3]?this.arrRgba[3]:0,this.arrRgba},this.getAlphaPixel=function(t,i){return this.getPixel(t,i)[3]},this.setPixelDin=function(t,i,e){var s=this.ctx.createImageData(1,1);s.data[0]=e[0],s.data[1]=e[1],s.data[2]=e[2],s.data[3]=e[3],this.ctx.putImageData(s,t,i)},this.setPixel=function(t,i,e){this.imgData.data[4*(i*this.imgData.width+t)+0]=e[0],this.imgData.data[4*(i*this.imgData.width+t)+1]=e[1],this.imgData.data[4*(i*this.imgData.width+t)+2]=e[2],this.imgData.data[4*(i*this.imgData.width+t)+3]=e[3]},this.addPixel=function(t,i,e){this.setPixel(t,i,this.blendColors(this.getPixel(t,i),e))},this.addImgData=function(t,i,e,s,n,r,h,a,o){for(var l={imgData:t,arrRgba:[]},u=0,c=0,d=i;d<s;d++){for(var p=e;p<n;p++){var f=this.getPixel.call(l,d,p);this.addPixel(r+u,h+c,f),c++}c=0,u++}},this.addBitmapData=function(t,i,e,s,n,r,h,a,o){1==arguments.length?(i=e=0,s=t.imgData.width,n=t.imgData.height,r=h=0):3==arguments.length?(r=i,h=e,i=e=0,s=t.imgData.width,n=t.imgData.height):9==arguments.length?console.warn("todo dWidth, dHeight"):console.error("не правильные аргументы",arguments.length),this.addImgData(t.imgData,i,e,s,n,r,h)},this.upDate=function(){this.ctx.putImageData(this.imgData,0,0)},this.changeWH=function(t,i){var e=this.ctx.getImageData(0,0,this.canvas.width,this.canvas.height);this.canvas.width=null!=t?t:this._width,this.canvas.height=null!=i?i:this._height,this.clear(),this.ctx.putImageData(e,0,0),this.imgData=this.ctx.getImageData(0,0,this._width,this._height),this.widthVisi=this._widthVisi,this.heightVisi=this._heightVisi},this.setColor=function(t){t||(t=this._color),this.ctx.fillStyle="rgba("+t[0]+","+t[1]+","+t[2]+","+t[3]/255+")"},this.setPixelTempData=function(t,i,e){this.tempData.data[4*(i*this.tempWidth+t)+0]=e[0],this.tempData.data[4*(i*this.tempWidth+t)+1]=e[1],this.tempData.data[4*(i*this.tempWidth+t)+2]=e[2],this.tempData.data[4*(i*this.tempWidth+t)+3]=e[3]},this.tempData=[],this.tempWidth=100;var r,h,a=1,o=1;this.compress=function(t,i,e){t=Math.round(t),i=Math.round(i),t>this._width&&(t=this._width),i>this._height&&(i=this._height),a=this._width/t,o=this._height/i,a-=a%1,o-=o%1,this.tempWidth=t,this.tempData=this.ctx.createImageData(t,i),r=(this._width+2)/t,h=(this._height+2)/i;for(var s=0;s<t;s++)for(var n=0;n<i;n++)this.setPixelTempData(s,n,this.getPixelMerge(Math.round(s*r),Math.round(n*h)));this.width=t,this.height=i,this.imgData=this.tempData,this.upDate(),e&&e(this)},this.getPixelMerge=function(t,i){var e=this.getPixel(t,i);this.tempPixel[0]=e[0],this.tempPixel[1]=e[1],this.tempPixel[2]=e[2],this.tempPixel[3]=e[3];for(var s,n=1,r=1,h=0;h<a;h++)t+(h+1)<this._width?(s=this.getPixel(t+(h+1),i),this.tempPixel[0]+=s[0]*r,this.tempPixel[1]+=s[1]*r,this.tempPixel[2]+=s[2]*r,this.tempPixel[3]+=s[3]*r,n++):(this.tempPixel[0]+=e[0]*r,this.tempPixel[1]+=e[1]*r,this.tempPixel[2]+=e[2]*r,this.tempPixel[3]+=e[3]*r,n++),t-(h+1)>0?(s=this.getPixel(t-(h+1),i),this.tempPixel[0]+=s[0]*r,this.tempPixel[1]+=s[1]*r,this.tempPixel[2]+=s[2]*r,this.tempPixel[3]+=s[3]*r,n++):(this.tempPixel[0]+=e[0]*r,this.tempPixel[1]+=e[1]*r,this.tempPixel[2]+=e[2]*r,this.tempPixel[3]+=e[3]*r,n++);r=1;for(var l=0;l<o;l++)i+(l+1)<this._height?(s=this.getPixel(t,i+(l+1)),this.tempPixel[0]+=s[0]*r,this.tempPixel[1]+=s[1]*r,this.tempPixel[2]+=s[2]*r,this.tempPixel[3]+=s[3]*r,n++):(this.tempPixel[0]+=e[0]*r,this.tempPixel[1]+=e[1]*r,this.tempPixel[2]+=e[2]*r,this.tempPixel[3]+=e[3]*r,n++),i-(l+1)>0?(s=this.getPixel(t,i-(l+1)),this.tempPixel[0]+=s[0]*r,this.tempPixel[1]+=s[1]*r,this.tempPixel[2]+=s[2]*r,this.tempPixel[3]+=s[3]*r,n++):(this.tempPixel[0]+=e[0]*r,this.tempPixel[1]+=e[1]*r,this.tempPixel[2]+=e[2]*r,this.tempPixel[3]+=e[3]*r,n++);return this.tempPixel[0]=this.tempPixel[0]/n,this.tempPixel[1]=this.tempPixel[1]/n,this.tempPixel[2]=this.tempPixel[2]/n,this.tempPixel[3]=this.tempPixel[3]/n,this.tempPixel},this.tempPixel=[],this.clear=function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.imgData=this.ctx.getImageData(0,0,1,1)},this.width=this._width,this.height=this._height,this.setColor(),this.ctx.fillRect(0,0,this._width,this._height),this.imgData=this.ctx.getImageData(0,0,this.canvas.width,this.canvas.height),this.changeWH(),this.blendColors=function(){for(var t=[],i=0;i<arguments.length;i++)t.push(arguments[i]);for(var e,s,n,r,h=[0,0,0,0];s=t.shift();)void 0===s[3]&&(s[3]=255),n=s[3]/255,(r=h[3]/255)&&n?((e=[0,0,0,0])[3]=1-(1-n)*(1-r),e[0]=Math.round(s[0]*n/e[3]+h[0]*r*(1-n)/e[3]),e[1]=Math.round(s[1]*n/e[3]+h[1]*r*(1-n)/e[3]),e[2]=Math.round(s[2]*n/e[3]+h[2]*r*(1-n)/e[3])):e=n?s:h,h=e;return e[3]=255*e[3],e}}function Si(){var t=this;this.segment={x:.5,y:.5,width:100,height:100,rotation:0},this.arrPoint=[],this.arrTriangle=[],this.arrTriangleBig=[],this.arrPosition=[],this.arrUV=[],this.lengthUV=0,this.lengthPosition=0,this.lengthTriangle=0,this.centerShape=new Ai,this.areaShape=0,this._bound={min:new Ai,max:new Ai,center:new Ai};var i,e,s,n,r,h,a,o,l,u,c,d,p,f,g=new Ai,x=new Ai,y=[0,0,this.segment.width,this.segment.height],m=[new Ai,new Ai,new Ai,new Ai,new Ai,new Ai,new Ai,new Ai,new Ai],v=0,b=new Ai;function w(i,e){return t.getAngle(t._bound.center,i)-t.getAngle(t._bound.center,e)}this.start=function(i){t.lengthUV=0,t.lengthTriangle=0,t.lengthPosition=0;for(var e=[],s=0;s<i.length;s++)e.push(new Ai(i[s].x,i[s].y));if(0!==this.segment.rotation)for(s=0;s<e.length;s++)t.rotationPoint(e[s],-this.segment.rotation);if(t.arrPoint=e,t.areaShape=t.area(t.arrPoint),t.areaShape){t.getCenterShape();for(s=0;s<t.arrTriangleBig.length;s++)t.segmentationTriangle(t.arrTriangleBig[s]);if(0!==this.segment.rotation){var n=new Ai;for(s=0;s<t.arrPosition.length;s+=3)n.set(t.arrPosition[s],t.arrPosition[s+1]),t.rotationPoint(n,this.segment.rotation),t.arrPosition[s]=n.x,t.arrPosition[s+1]=n.y}}},this.getCenterShape=function(i){t.arrPoint=i||t.arrPoint,t.arrTriangleBig.length=0,t.arrTriangleBig=t.triangulate(t.arrPoint),t.updateCenterShape()},this.updateCenterShape=function(){var i=0,e=0;t.centerShape.set(0,0);var s=t.convex(t.arrPoint);if(0===s||-1===s)for(var n=0;n<t.arrTriangleBig.length;n++)i<(e=t.area(t.arrTriangleBig[n]))&&(i=e,t.centerShape.x=(t.arrTriangleBig[n][0].x+t.arrTriangleBig[n][1].x+t.arrTriangleBig[n][2].x)/3,t.centerShape.y=(t.arrTriangleBig[n][0].y+t.arrTriangleBig[n][1].y+t.arrTriangleBig[n][2].y)/3);else{for(n=0;n<t.arrPoint.length;n++)t.centerShape.x+=t.arrPoint[n].x,t.centerShape.y+=t.arrPoint[n].y;t.centerShape.x/=t.arrPoint.length,t.centerShape.y/=t.arrPoint.length}},this.segmentationTriangle=function(i){s=this.getBound(this.arrPoint),n=(s.min.x-s.min.x%this.segment.width-2*this.segment.width||0)+this.segment.x*this.segment.width,r=(s.min.y-s.min.y%this.segment.height-2*this.segment.height||0)+this.segment.y*this.segment.height,h=(s.max.x-s.max.x%this.segment.width+2*this.segment.width||500)+this.segment.x*this.segment.width,a=(s.max.y-s.max.y%this.segment.height+2*this.segment.height||500)+this.segment.y*this.segment.height,y[2]=this.segment.width,y[3]=this.segment.height;for(var o=n;o<h;o+=this.segment.width)for(var l=r;l<a;l+=this.segment.height){y[0]=o,y[1]=l,e=t.triangulate(t.getArrPointTriangleSegment(i,y),!1);for(var u=0;u<e.length;u++){t.arrTriangle[t.lengthTriangle++]=e[u];for(var c=0;c<e[u].length;c++)t.generatePointUV(e[u][c],y),t.arrPosition[t.lengthPosition++]=e[u][c].x,t.arrPosition[t.lengthPosition++]=e[u][c].y,t.arrPosition[t.lengthPosition++]=0}}},this.getArrPointTriangleSegment=function(e,s){for(var n=m,r=0;r<n.length;r++)n[r].x=n[r].y=1/0;v=0;for(r=0;r<3;++r)g.x=s[0],g.y=s[1],x.x=s[0]+s[2],x.y=s[1],(i=t.getPointOfIntersection(g,x,e[r],e[(r+1)%3]))&&(t.inArr(n,i)||n[v++].setPoint(i)),g.x=s[0]+s[2],g.y=s[1],x.x=s[0]+s[2],x.y=s[1]+s[3],(i=t.getPointOfIntersection(g,x,e[r],e[(r+1)%3]))&&(t.inArr(n,i)||n[v++].setPoint(i)),g.x=s[0]+s[2],g.y=s[1]+s[3],x.x=s[0],x.y=s[1]+s[3],(i=t.getPointOfIntersection(g,x,e[r],e[(r+1)%3]))&&(t.inArr(n,i)||n[v++].setPoint(i)),g.x=s[0],g.y=s[1],x.x=s[0],x.y=s[1]+s[3],(i=t.getPointOfIntersection(g,x,e[r],e[(r+1)%3]))&&(t.inArr(n,i)||n[v++].setPoint(i)),g.x=s[0],g.y=s[1],x.x=s[0]+s[2],x.y=s[1]+s[3],t.pointInSegment(e[r],g,x)&&(t.inArr(n,e[r])||n[v++].setPoint(e[r]));return g.x=s[0],g.y=s[1],t.isInTriangle(e[0],e[1],e[2],g)&&(t.inArr(n,g)||n[v++].setPoint(g)),g.x=s[0]+s[2],g.y=s[1],t.isInTriangle(e[0],e[1],e[2],g)&&(t.inArr(n,g)||n[v++].setPoint(g)),g.x=s[0]+s[2],g.y=s[1]+s[3],t.isInTriangle(e[0],e[1],e[2],g)&&(t.inArr(n,g)||n[v++].setPoint(g)),g.x=s[0],g.y=s[1]+s[3],t.isInTriangle(e[0],e[1],e[2],g)&&(t.inArr(n,g)||n[v++].setPoint(g)),n=n.slice(0,v),t.getBound(n),n.sort(w),n},this.inArr=function(t,i){for(var e=0;e<t.length;++e)if(t[e].x===i.x&&t[e].y===i.y)return!0;return!1},this.getBound=function(t){this._bound.min.set(999999,999999),this._bound.max.set(-999999,-999999);for(var i=0;i<t.length;i++)this._bound.min.x=Math.min(this._bound.min.x,t[i].x),this._bound.max.x=Math.max(this._bound.max.x,t[i].x),this._bound.min.y=Math.min(this._bound.min.y,t[i].y),this._bound.max.y=Math.max(this._bound.max.y,t[i].y);return this._bound.center.set(this._bound.max.x/2+this._bound.min.x/2,this._bound.max.y/2+this._bound.min.y/2),this._bound},this.pointInSegment=function(t,i,e){return i.x<=t.x&&t.x<=e.x&&i.y<=t.y&&t.y<=e.y},this.generatePointUV=function(i,e){i.x===e[0]?b.x=0:i.x===e[0]+e[2]?b.x=1:b.x=(i.x-e[0])%t.segment.width/t.segment.width,i.y===e[1]?b.y=0:i.y===e[1]+e[3]?b.y=1:b.y=(i.y-e[1])%t.segment.height/t.segment.height,t.arrUV[t.lengthUV++]=b.x,t.arrUV[t.lengthUV++]=b.y},this.convex=function(t){var i,e,s,n,r=t.length,h=0;if(r<3)return 0;for(i=0;i<r;i++)if(s=(i+2)%r,n=(t[e=(i+1)%r].x-t[i].x)*(t[s].y-t[e].y),(n-=(t[e].y-t[i].y)*(t[s].x-t[e].x))<0?h|=1:n>0&&(h|=2),3===h)return-1;return 0!=h?1:0},this.area=function(t){for(var i=t.length,e=0,s=i-1,n=0;n<i;s=n++)e+=t[s].x*t[n].y-t[n].x*t[s].y;return.5*e},this.snip=function(t,i,e,s,n,r){var h,a,o,l,u,c,d,p,f,g,x,y,m,v,b,w,_;if(a=t[r[i]].x,o=t[r[i]].y,l=t[r[e]].x,u=t[r[e]].y,c=t[r[s]].x,d=t[r[s]].y,Number.EPSILON>(l-a)*(d-o)-(u-o)*(c-a))return!1;for(g=c-l,x=d-u,y=a-c,m=o-d,v=l-a,b=u-o,h=0;h<n;h++)if(p=t[r[h]].x,f=t[r[h]].y,!(p===a&&f===o||p===l&&f===u||p===c&&f===d)&&(w=v*(f-o)-b*(p-a),_=y*(f-d)-m*(p-c),g*(f-u)-x*(p-l)>=-Number.EPSILON&&_>=-Number.EPSILON&&w>=-Number.EPSILON))return!1;return!0},this.triangulate=function(i,e){var s=i.length;if(s<3)return[];var n,r,h,a=[],o=[],l=[];if(t.area(i)>0)for(r=0;r<s;r++)o[r]=r;else for(r=0;r<s;r++)o[r]=s-1-r;var u=s,c=2*u;for(r=u-1;u>2;){if(c--<=0)return e?l:a;if(u<=(n=r)&&(n=0),u<=(r=n+1)&&(r=0),u<=(h=r+1)&&(h=0),t.snip(i,n,r,h,u,o)){var d,p,f,g,x;for(d=o[n],p=o[r],f=o[h],a.push([i[d],i[p],i[f]]),l.push([o[n],o[r],o[h]]),g=r,x=r+1;x<u;g++,x++)o[g]=o[x];c=2*--u}}return e?l:a},this.getAngle=function(t,i){return i=i||rezNull,t=t||rezNull,Math.atan2(i.y-t.y,i.x-t.x)},this.rotationPoint=function(t,i,e){var s=0,n=0;e?(s=e.x+(t.x-e.x)*Math.cos(i)-(t.y-e.y)*Math.sin(i),n=e.y+(t.y-e.y)*Math.cos(i)+(t.x-e.x)*Math.sin(i)):(s=t.x*Math.cos(i)-t.y*Math.sin(i),n=t.y*Math.cos(i)+t.x*Math.sin(i)),t.x=s,t.y=n},this.isInTriangle=function(t,i,e,s){var n=(t.x-s.x)*(i.y-t.y)-(i.x-t.x)*(t.y-s.y),r=(i.x-s.x)*(e.y-i.y)-(e.x-i.x)*(i.y-s.y),h=(e.x-s.x)*(t.y-e.y)-(t.x-e.x)*(e.y-s.y);return n>=0&&r>=0&&h>=0||n<=0&&r<=0&&h<=0};var _=new THREE.Vector2(0,0);this.getPointOfIntersection=function(t,i,e,s){return o=(t.x-i.x)*(s.y-e.y)-(t.y-i.y)*(s.x-e.x),l=(t.x-e.x)*(s.y-e.y)-(t.y-e.y)*(s.x-e.x),u=(t.x-i.x)*(t.y-e.y)-(t.y-i.y)*(t.x-e.x),d=u/o,(c=l/o)>=0&&c<=1&&d>=0&&d<=1?(p=t.x+c*(i.x-t.x),f=t.y+c*(i.y-t.y),_.x=p,_.y=f,_):null}}function Ai(t,i){this.x=t,this.y=i}function Ti(){this.type="TStyle";gi=this,this.gBox=new THREE.BoxBufferGeometry(1,1,1),this.gCylinder=new THREE.CylinderBufferGeometry(1,1,1,16,1),this.gStrelka=new THREE.CylinderBufferGeometry(1,0,1,16,1),this.wh=32,this._gage=1,this._color="#008CBA",this._color1="#666666",this._colorText="#ffffff",this._colorText1="#999999",this._fontSize=16,this._fontFamily="Arial",this._bold=!0,this._italic=!1,this._otstup=2,this.font=new Ei(this),this.objMat={},this.getMat=function(t){return null==this.objMat[t]&&(this.objMat[t]=new THREE.MeshPhongMaterial({color:t})),this.objMat[t]},this.mobile=!1,this.array=[],this.add=function(t){this.array.push(t)},this.addFont=function(t){this.font.ng=t}}Object.defineProperties(Pi.prototype,{width:{set:function(t){var i=this._width;this._width=t,this.changeWH(),i<this._width&&(this.setColor(),this.ctx.fillRect(i,0,this._width,this._height)),this.widthVisi=this._widthVisi},get:function(){return this._width}},height:{set:function(t){var i=this._height;this._height=t,this.changeWH(),i<this._height&&(this.setColor(),this.ctx.fillRect(0,i,this._width,this._height)),this.heightVisi=this._heightVisi},get:function(){return this._height}},widthVisi:{set:function(t){this._widthVisi=t},get:function(){return this._widthVisi}},heightVisi:{set:function(t){this._heightVisi=t},get:function(){return this._heightVisi}}}),Ai.prototype.set=function(t,i){this.x=t,this.y=i},Ai.prototype.setPoint=function(t){this.x=t.x,this.y=t.y},Object.defineProperties(Ti.prototype,{});class Ei{constructor(t){var i;this.par=t,this.tv=new mi,this._whText=200,this._whTextPlus=Math.round(this._whText+this._whText/8),this.tv._wh=40,this.ng=void 0,this.tv.bitmapData.width!=this._whTextPlus&&(this.tv.bitmapData.width=this._whTextPlus),this.tv.bitmapData.height!=this._whTextPlus&&(this.tv.bitmapData.height=this._whTextPlus),this.object={},this.setObj=function(t){i="",1==t._italic&&(i+="italic "),1==t._bold&&(i+="bold "),i+=this._whText+"px "+t._fontFamily,null==this.object[i]&&(this.object[i]=new Mi(this,i)),this.object[i].setObj(t)}}}class Mi{constructor(t,i){var e,s,n,r,h,a;this.par=t,this.key=i,this.arSimvol=[],this.arrSN=[],this.arrSim=[],this.arrkol=[],this.setObj=function(i){for(e=i.cont3d.children.length-1;e>=0;e--)i.cont3d.remove(i.cont3d.children[e]);for(n=0,this.arrSN=i._text.split("\n"),r=0,h=0,s=0;s<this.arrSN.length;s++)for(this.arrSim[s]=[],this.arrkol[s]=0,e=0;e<this.arrSN[s].length;e++)null==this.arSimvol[this.arrSN[s][e]]&&(this.arSimvol[this.arrSN[s][e]]=new Di(this,this.arrSN[s][e])),a=this.arSimvol[this.arrSN[s][e]].getMesh(i.material),i.cont3d.add(a),this.arrSim[s].push(a),null!=t.ng?i.cont3d.children[r].position.y=-t._whText-t._whText*s*1.1:i.cont3d.children[r].position.y=0-t._whText*s*1.1,0!=e?(i.cont3d.children[r].position.x=i.cont3d.children[r-1].position.x+i.cont3d.children[r-1].w+this.par._whText/200,i._widthGeom=i.cont3d.children[r].position.x+i.cont3d.children[r].w,this.arrkol[s]=i._widthGeom):(i.cont3d.children[r].position.x=0,i._widthGeom=0,this.arrkol[s]=i.cont3d.children[r].w),i._widthGeom>h&&(h=i._widthGeom),r++;if("left"!=i._textAlign&&this.arrSN.length>=2)for(s=0;s<this.arrSN.length;s++)for(n=0,"center"==i._textAlign&&(n=(h-this.arrkol[s])/2),"right"==i._textAlign&&(n=h-this.arrkol[s]),e=0;e<this.arrSim[s].length;e++)this.arrSim[s][e].position.x+=n;i._widthGeom=h,i._heightGeom=t._whText+t._whText*(this.arrSN.length-1)*1.1}}}class Di{constructor(t,i){this.par=t,this.key=i,this.array=[];var e,s=this.par.par._whText,n=this.par.par._whTextPlus;if(null==t.par.ng){var r=this.par.par.tv.bitmapData,h=r.ctx,a=this.par.par.tv;h.clearRect(0,0,n,n);this.par.key;h.font=this.par.key,h.fillText(i,0,s-s/8),r.imgData=h.getImageData(0,0,n,n),a.upDate(),this.geometry=new zi(a.points.arrayTriangle,a.points.array,this.par.par.par._gage)," "==i&&(this.geometry.boundingBox.max.x=s/2)}else this.geometry=new THREE.TextGeometry(i,{font:t.par.ng,size:s,height:1,curveSegments:4,bevelThickness:1,bevelSize:1,bevelEnabled:!0}),this.geometry.computeBoundingBox(),this.geometry.computeBoundingSphere()," "==i&&(this.geometry.boundingBox.max.x=s/2);this.getMesh=function(t){for(e=0;e<this.array.length;e++)if(null==this.array[e].parent)return this.array[e].material.uuid!=t.uuid&&(this.array[e].material=t),this.array[e];return this.array.push(new THREE.Mesh(this.geometry,t)),this.array[this.array.length-1].w=this.geometry.boundingBox.max.x,this.array[this.array.length-1]}}}function zi(t,i,e){var s;THREE.BufferGeometry.call(this),this.arrPosition=[];var n,r,h=e,a=t,o=i;this.update=function(){for(this.arrPosition=[],t=0;t<a.length;t++)for(n=a[t].length,r=0;r<n;r+=6)this.arrPosition.push(a[t][r],-a[t][r+1],h),this.arrPosition.push(a[t][r+2],-a[t][r+1+2],h),this.arrPosition.push(a[t][r+4],-a[t][r+1+4],h),this.arrPosition.push(a[t][r],-a[t][r+1],h),this.arrPosition.push(a[t][r+4],-a[t][r+1+4],h),this.arrPosition.push(a[t][r+2],-a[t][r+1+2],h),this.arrPosition.push(a[t][r+4],-a[t][r+1+4],0),this.arrPosition.push(a[t][r+2],-a[t][r+1+2],0),this.arrPosition.push(a[t][r],-a[t][r+1],0),this.arrPosition.push(a[t][r+4],-a[t][r+1+4],0),this.arrPosition.push(a[t][r],-a[t][r+1],0),this.arrPosition.push(a[t][r+2],-a[t][r+1+2],0);for(t=0;t<o.length;t++)for(n=o[t].length-1,r=0;r<n;r++)this.arrPosition.push(o[t][r].x,-o[t][r].y,0),this.arrPosition.push(o[t][r+1].x,-o[t][r+1].y,0),this.arrPosition.push(o[t][r+1].x,-o[t][r+1].y,h),this.arrPosition.push(o[t][r].x,-o[t][r].y,0),this.arrPosition.push(o[t][r+1].x,-o[t][r+1].y,h),this.arrPosition.push(o[t][r+1].x,-o[t][r+1].y,0),this.arrPosition.push(o[t][r].x,-o[t][r].y,0),this.arrPosition.push(o[t][r+1].x,-o[t][r+1].y,h),this.arrPosition.push(o[t][r].x,-o[t][r].y,h),this.arrPosition.push(o[t][r].x,-o[t][r].y,0),this.arrPosition.push(o[t][r].x,-o[t][r].y,h),this.arrPosition.push(o[t][r+1].x,-o[t][r+1].y,h);s=new Float32Array(3*this.arrPosition.length),this.setAttribute("position",new THREE.BufferAttribute(s,3)),n=this.arrPosition.length;for(var t=0;t<n;t++)s[t]=this.arrPosition[t];this.attributes.position.needsUpdate=!0,this.computeVertexNormals(),this.computeBoundingBox(),this.computeBoundingSphere()},this.serAA=function(t,i){a=t,o=i,this.update()},this.update()}zi.prototype=Object.create(THREE.BufferGeometry.prototype),zi.prototype.constructor=zi;class Ri extends yi{constructor(t,i,e,s){super(t),this.x=i,this.y=e,this._widthGeom=100,this._heightGeom=100,this._width=100,this._gage=gi._gage,this._colorText1=gi._colorText1,this._textAlign="left",this._material=gi.getMat(this._colorText1),this.cont3d=new THREE.Object3D,this.object3d.add(this.cont3d),this.geometry=void 0,this._text=s||"",this._fontSize=gi._fontSize,this._fontFamily=gi._fontFamily,this._bold=gi._bold,this._italic=gi._italic;var n=this._fontSize/gi.font._whText;this.cont3d.scale.set(n,n,this._gage),this.drag=function(){gi.font.setObj(this),this._width=this._widthGeom*this._fontSize/gi.font._whText},this.drag(),this.dragColor=function(){for(var t=0;t<this.cont3d.children.length;t++)this.cont3d.children[t].material=this._material}}set width(t){this._width!=t&&(this._width=t)}get width(){return this._widthGeom*(this._fontSize/gi.font._whText)}set height(t){this._height!=t&&(this._height=t)}get height(){return this._heightGeom*(this._fontSize/gi.font._whText)}set gage(t){if(this._gage!=t){this._gage=t;var i=this._gage/gi.font._whText;this.cont3d.scale.set(i,i,this._gage),this._width=this._widthGeom*this._fontSize/gi.font._whText}}get gage(){return this._gage}set fontSize(t){if(this._fontSize!=t){this._fontSize=t;var i=this._fontSize/gi.font._whText;this.cont3d.scale.set(i,i,this._gage),this._width=this._widthGeom*this._fontSize/gi.font._whText}}get fontSize(){return this._fontSize}set textAlign(t){this._textAlign!=t&&(this._textAlign=t,this.drag())}get textAlign(){return this._textAlign}set fontFamily(t){if(this._fontFamily!=t){this._fontFamily=t;this._fontFamily;this.drag()}}get fontFamily(){return this._fontFamily}set bold(t){if(this._bold!=t){this._bold=t;this._bold;this.drag()}}get bold(){return this._bold}set italic(t){if(this._italic!=t){this._italic=t;this._italic;this.drag()}}get italic(){return this._italic}set text(t){this._text!=t&&(this._text=t,this.drag())}get text(){return this._text}set material(t){this._material.uuid!=t.uuid&&(this._material=t,this.dragColor())}get material(){return this._material}set colorText1(t){this._colorText1!=t&&(this._colorText1=t,this.material=gi.getMat(this._colorText1))}get colorText1(){return this._colorText1}}class Bi{constructor(t,i,e,s,n,r,h,a){this.type="TCompArrow";var o,l,u=this;this.c3d=t,this.fun=i,this.gB=e,e||(this.gB=new THREE.BoxBufferGeometry(1,1,1)),this._material=s||new THREE.MeshBasicMaterial({color:0}),this._material1=n||new THREE.MeshBasicMaterial({color:11184810}),this._material2=r||new THREE.MeshBasicMaterial({color:16711680}),this._material3=void 0,h&&(this._material3=h),this._bMat3=!1,this._mast=1,this._boolText=!0,this._activeButton=!1,this._life=!0,this._gage=.2,this._fontSize=12,this._distans=0,this._otstup=15,this._bDurka=!0,this._bVerh=!0,this._bRotation=!0,this._bRotZ=0,this._zdvih=0,this._radius=1,this.dragss=function(){u.drag()},this.drag=function(){let t=this._distans;if(0==this._distans)return;o=this.tLabel.width,1!=this._bRotZ&&3!=this._bRotZ||(o=this._fontSize*this._mast),this.c3dL.position.x=-this.tLabel.width/2;let i=(t-o-2*this._otstup)/2;this.c3dLabel.position.x=t/2,1==this._bDurka?(this.a[1].visible=!0,this.c3dLabel.position.y=this._zdvih*this._mast,this.a[0].scale.y=i,this.a[0].position.x=i/2,this.a[1].scale.y=i,this.a[1].position.x=t-i/2):(this.a[1].visible=!1,this.a[0].scale.y=t,this.a[0].position.x=t/2,1==this._bRotZ||3==this._bRotZ?(l=this.tLabel.width/2+this._otstup,1==this._bVerh?this.c3dLabel.position.y=l:this.c3dLabel.position.y=-l):1==this._bVerh?this.c3dLabel.position.y=this._fontSize+this._zdvih*this._mast:this.c3dLabel.position.y=-this._fontSize+this._zdvih*this._mast),this.a[0].position.y=this._zdvih,this.a[1].position.y=this._zdvih,null!=this.a[5]&&(this.a[5].position.x=t),1==this._activeButton&&(this.a[2].scale.set(this._fontSize*this._mast,this.tLabel.width,2),this.a[3].scale.set(this._fontSize*this._mast+2,this.tLabel.width+this._otstup,.2))},this.position=new Ci(0,0,0,this.dragss),this.position1=new Ci(0,0,0,this.dragss),this.content3d=new THREE.Object3D,this.c3d.add(this.content3d),this.c3dLabelYY=new THREE.Object3D,this.c3dLabel=new THREE.Object3D,this.c3dL=new THREE.Object3D,this.content3d.add(this.c3dLabel),this.c3dLabel.add(this.c3dLabelYY),this.c3dLabelYY.add(this.c3dL),this.tLabel=void 0,this.a=[],this.init=function(){this.a[0]=new THREE.Mesh(this.gB,this._material),this.a[0].rotation.z=Math.PI/2,this.content3d.add(this.a[0]),this.a[1]=new THREE.Mesh(this.gB,this._material),this.a[1].rotation.z=Math.PI/2,this.content3d.add(this.a[1]),this.a[2]=new THREE.Mesh(this.gB,this._material),this.a[2].rotation.z=Math.PI/2,this.c3dLabel.add(this.a[2]),this.a[2].visible=!1,this.a[2].objGlob=this,this.a[2].layers.set(31),this.a[3]=new THREE.Mesh(this.gB,this._material1),this.a[3].rotation.z=Math.PI/2,this.c3dLabel.add(this.a[3]),this.a[3].visible=!1,this.tLabel=new Ri(this.c3dL,0,0,"Text"),this.c3dLabel.rotation.x=Math.PI,this.tLabel.gage=this._gage,this.tLabel.fontSize=this._fontSize*this._mast,this.c3dL.position.y=this._fontSize*this._mast/2,this.c3dL.position.x=-this.tLabel.width/2,this.tLabel.material=a||this._material},this.dragMat=function(){0==this._active?this.a[3].material=this._material1:this.a[3].material=this._material2},this.getDistance=function(t,i){return Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2)+Math.pow(t.z-i.y,2))},this.dragText=function(){this.tLabel.text=Math.round(this._distans)+""},this.init()}set zdvih(t){this._zdvih!=t&&(this._zdvih=t,null==this.a[4]&&(this.a[4]=new THREE.Mesh(this.gB,this._material),this.content3d.add(this.a[4]),this.a[5]=new THREE.Mesh(this.gB,this._material),this.content3d.add(this.a[5])),0==this._zdvih?this.a[4].visible=this.a[5].visible=!1:(this.a[4].visible=this.a[5].visible=!0,this.a[4].scale.y=this._zdvih,this.a[5].scale.y=this._zdvih,this.a[4].position.y=this._zdvih/2,this.a[5].position.y=this._zdvih/2),this.drag())}get zdvih(){return this._zdvih}set boolText(t){this._boolText!=t&&(this._boolText=t,this.c3dL.visible=t)}get boolText(){return this._boolText}set radius(t){this._radius!=t&&(this._radius=t,this.a[0].scale.x=t,this.a[0].scale.z=t,this.a[1].scale.x=t,this.a[1].scale.z=t)}get radius(){return this._radius}set life(t){this._life!=t&&(this._life=t,this._life?this.c3d.add(this.content3d):this.c3d.remove(this.content3d))}get life(){return this._life}set otstup(t){this._otstup!=t&&(this._otstup=t,this.drag())}get otstup(){return this._otstup}set bMat3(t){this._bMat3!=t&&(this._bMat3=t,this._material3&&(this._bMat3?(this.a[0].material=this._material3,this.a[1].material=this._material3):(this.a[0].material=this._material,this.a[1].material=this._material)))}get bMat3(){return this._bMat3}set active(t){this._active!=t&&(this._active=t,this.dragMat(),visi3D.intRend=1)}get active(){return this._active}set mast(t){this._mast!=t&&(this._mast=t,this.tLabel.fontSize=this._fontSize*this._mast,this.c3dL.position.y=this._fontSize*this._mast/2,this.drag())}get mast(){return this._mast}set fontSize(t){this._fontSize!=t&&(this._fontSize=t,this.tLabel.fontSize=this._fontSize*this._mast,this.c3dL.position.y=this._fontSize*this._mast/2,this.drag())}get fontSize(){return this._fontSize}set distans(t){this._distans!=t&&(this._distans=t,this.dragText(),this.drag())}get distans(){return this._distans}set activeButton(t){this._activeButton!=t&&(this._activeButton=t,this.a[2].visible=t,this.a[3].visible=t,t?visi3D.addChildMouse(this.a[2]):visi3D.removeChildMouse(this.a[2]),this.drag())}get activeButton(){return this._activeButton}set bDurka(t){this._bDurka!=t&&(this._bDurka=t,this.drag())}get bDurka(){return this._bDurka}set bVerh(t){this._bVerh!=t&&(this._bVerh=t,this.drag())}get bVerh(){return this._bVerh}set bRotation(t){this._bRotation!=t&&(this._bRotation=t,1==this._bRotation?this.c3dLabel.rotation.z=0:this.c3dLabel.rotation.z=Math.PI)}get bRotation(){return this._bRotation}set bRotZ(t){this._bRotZ!=t&&(this._bRotZ=t,this.c3dLabelYY.rotation.z=Math.PI/2*t,this.drag())}get bRotZ(){return this._bRotZ}}function Ci(t,i,e,s){this._x=t||0,this._y=i||0,this._z="function"!=typeof e&&e||0,this.fun="function"==typeof e?e:s,this.set=function(t,i,e){this._x=t||0,this._y=i||0,this._z=e||0,this.fun&&this.fun()},this.setPoint=function(t){this._x=t.x,this._y=t.y,this._z=t.z,this.fun&&this.fun()},this.getObj=function(){var t={};return t.x=this._x,t.y=this._y,t.z=this._z,t},this.copy=function(){return new Ci(this._x,this._y,this._z)}}Ci.prototype={set x(t){this._x=t,this.fun&&this.fun()},get x(){return this._x},set y(t){this._y=t,this.fun&&this.fun()},get y(){return this._y},set z(t){this._z=t,this.fun&&this.fun()},get z(){return this._z}};class Li{constructor(t,i){this.type="SS3D";var e=this;this.par=t,this._height=t._height,this._life=t._life,this._boolMinH=t._boolMinH,this._active=!1,this._mast=t._mast;this.aVKol=0,this._mashtabText=8,this._distans=0,this._delph=0,this._rotation=0,this._lineOpor=this.par._lineOpor,this._color=this.par._color,this._color1=this.par._color1,this._color2=this.par._color2,this._color3=this.par._color3,this._color4=this.par._color4,this._boolLitel=!0,this.korektRect=this.par.par.par.korektRect,this.korektLine=this.par.par.par.korektLine,this.cont3d=new THREE.Object3D,this.par.cont3dSten.add(this.cont3d),this.cont3dL=new THREE.Object3D,this.par.cont3dSten.add(this.cont3dL),this.cont3d.objClik=this.par,e.tLabel,1==window.localS.object.debug&&setTimeout(function(){e.tLabel=new Ri(e.cont3d,10,0,"id:"+e.par.idArr),e.tLabel.fontSize=18,e.tLabel.cont3d.position.z=e._height-40,e.tLabel.cont3d.position.y=-30,e.tLabel.cont3d.position.x=30,e.tLabel.cont3d.rotation.y=Math.PI},10),this.tCompArrow=new Bi(this.cont3d,function(t,i){},null,window.pm.matDop.getIDObj(24),window.pm.matDop.getIDObj(6),window.pm.matDop.getIDObj(7),window.pm.matDop.getIDObj(26),window.pm.matDop.getIDObj(27)),this.tCompArrow.content3d.visible=this._lineOpor,this.tCompArrow.activeButton=!0,this.tCompArrow.sten=this.par,this.tCompArrow.bDurka=!1,this.tCompArrow.bDurka=!1,this.tCompArrow.bRotation=!1,this.tCompArrow.radius=5,this.tCompArrow.boolText=!1,this.tCompArrow.mast=this._mast,setTimeout(function(){visi3D.objShadow(e.tCompArrow.content3d,!1),visi3D.intRend=1},0);parseInt("11100001000",2),parseInt("00011111111",2);this.pS={x:0,y:0,w:100,h:100},this.dragPost=function(){this.draw1()};var s,n,r,h,a,o,l=0;1==this.par.par.param.mobile&&(l=-10),this.draw1=function(){if(this._distans=this.par._distans,this._delph=this.par._delph,this._rotation=this.par._rotation,this.cont3d.position.z=-this._height,this.tCompArrow.content3d.position.z=-this.cont3d.position.z-this.par.par.minH-10+l,this.tCompArrow.content3d.position.y=-this.par._delph/2,s=this.par.arrPosit[4].x,n=this.par.arrPosit1[1].x,this.tCompArrow.content3d.position.x=-s,this.tCompArrow.distans=this._distans+(s+n),this.cont3d.visible=this.par.par._boolMax,this.cont3dL.visible=!this.par.par._boolMax,1==this.par.par._boolMax?(this.drawGrani(),this.drawVerg()):(this.drawLittel(),this.par.par.addObjFun1(this.par)),e.tLabel){var t="id:"+e.par.idArr+" x "+Math.round(e.par.position.x)+" y "+Math.round(e.par.position.y);e.tLabel.text=t}},this.drawLittel=function(){},this.vergLittel=new ki(this),this.arrGrani=[],this.arrGrani[0]=new Oi(this,0),this.arrGrani[1]=new Oi(this,1);for(var u=0;u<this.arrGrani.length;u++)this.arrGrani[u].idArr=u;this.arrGrani[0].boolInvert=!0,this.arrGrani[1].boolInvert=!0;for(u=0;u<this.arrGrani.length;u++)this.arrGrani[u].cont3d1.visible=!this._boolMinH;this.arrGrani[0].arr[2].vergLittel=this.vergLittel,this.aMlR=[{l:0,r:0},{l:0,r:0},{l:0,r:0}],this.app=[{x:-1e4,y:0,z:0},{x:1e4,y:0,z:0}],this.app1=[{x:-1e4,y:0,z:0},{x:1e4,y:0,z:0}],this.hhh,this.drawVerg=function(){this.hhh=this.height,this.aMlR[0].l=this.hhh,this.aMlR[0].r=this.hhh,this.aMlR[1].l=this.hhh,this.aMlR[1].r=this.hhh,this.arrGrani[0].dragGeometry(this.aMlR[0],!0),this.arrGrani[1].dragGeometry(this.aMlR[1],!0),(r=this.aMlR[0].l)<this.aMlR[1].l&&(r=this.aMlR[1].l),this.aMlR[2].l=r,(r=this.aMlR[0].r)<this.aMlR[1].r&&(r=this.aMlR[1].r),this.aMlR[2].r=r,this.aMlR[2].r==this.hhh&&(this.aMlR[2].r=0),this.aMlR[2].l==this.hhh&&(this.aMlR[2].l=0),this.app[0].y=this.app[1].y=this.aMlR[2].l,this.app1[0].y=this.app1[1].y=this.aMlR[2].r,this.arrGrani[0].dragGMin(this.app,this.app1),this.arrGrani[1].dragGMin(this.app,this.app1),this.vergLittel.setGrani(this.arrGrani[0],this.arrGrani[1])},this.drawGrani=function(){this.arrGrani[0].dragPost(),this.arrGrani[1].dragPost()},this.setMat=function(t,i,s,n,r,a){1==h&&e.par.par.addObjFun(e.par)},this.setMat1=function(t,i,s,n,r){h=!1,t&&(this.arrGrani[2]._material.uuid==t.uuid&&1!=r||(this.arrGrani[2].material=t)),s.d3Width===this.arrGrani[2].d3Width&&this.arrGrani[2].d3Height===s.d3Height||(this.arrGrani[2].d3Width=s.d3Width,this.arrGrani[2].d3Height=s.d3Height,h=!0),i&&(this.arrGrani[3]._material.uuid==i.uuid&&1!=r||(this.arrGrani[3].material=i,this.arrGrani[3].d3Width=n.d3Width,this.arrGrani[3].d3Height=n.d3Height)),n.d3Width===this.arrGrani[3].d3Width&&this.arrGrani[3].d3Height===n.d3Height||(this.arrGrani[3].d3Width=n.d3Width,this.arrGrani[3].d3Height=n.d3Height,h=!0),1==h&&e.par.par.addObjFun(e.par)},this.redrahHHH=function(){a=this._height,0,this.arrGrani[0].h=this.arrGrani[1].h=a,this.arrGrani[1].y=this.arrGrani[0].y=0},this.redrahHHH(),this.testMaterial=function(){},this.testMaterial(),this.objShadow=function(t,i){if(null==i&&(i=!0),o=!0,t.material&&1==t.material.transparent&&t.material.opacity<1&&(o=!1),1==o&&(t.castShadow=i,t.receiveShadow=i),null!=t.children)for(var e=0;e<t.children.length;e++)null!=t.children?this.objShadow(t.children[e],i):(o=!0,t.children[e].material&&1==t.material.transparent&&t.material.opacity<1&&(o=!1),1==o&&(t.children[e].castShadow=i,t.children[e].receiveShadow=i))},this.objShadow(this.cont3d,!0)}set height(t){this._height!=t&&(this._height=t,this.redrahHHH())}get height(){return this._height}set mast(t){this._mast!=t&&(this._mast=t,this.tCompArrow.mast=this._mast)}get mast(){return this._mast}set boolMinH(t){if(this._boolMinH!=t){this._boolMinH=t;for(var i=0;i<this.arrGrani.length;i++)this.arrGrani[i].cont3d1.visible=!this._boolMinH;this.vergLittel.boolMinH=this._boolMinH}}get boolMinH(){return this._boolMinH}set active(t){this._active!=t&&(this._active=t,this.vergLittel.active=this._active)}get active(){return this._active}set life(t){this._life!=t&&(this._life=t)}get life(){return this._life}set lineOpor(t){this._lineOpor!=t&&(this._lineOpor=t,this.tCompArrow.content3d.visible=this._lineOpor)}get lineOpor(){return this._lineOpor}}class Oi{constructor(t,i,e,s){this.type="SGrani",this.par=t,this.sahTextur=i,this.y=0,this.h=300,this.arrPosit=this.par.par.arrPosit,this.arrPosit1=this.par.par.arrPosit1,this._distans=0,this._material=e,this._renderOrder=0,this.korektRect=this.par.korektRect,this.cont3d1=new THREE.Object3D,this.par.cont3d.add(this.cont3d1),this.cont3d=new THREE.Object3D,this.cont3d1.add(this.cont3d),this.boolVergDrag=!1,this.idArr=s,this.rect={x:0,y:0,w:800,h:300},this.boolInvert=!1,this.area=0,this.d3Width=512,this.d3Height=512,this.arrP=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.arrPGlob=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.arr=[];for(var n=0;n<5;n++)this.arr[n]=new Ii(this),this.arr[n].idArr=n,this.arr[n].setName("gronSten",n,this.idArr);var r,h,a;this.clearAL=function(){for(var t=0;t<5;t++)this.arr[t].clearAL()};var o=new THREE.Vector3,l=new THREE.Vector3;this.invertToGlob=function(){r=this.par._rotation,o.x=t.par.position._x,o.y=t.par.position._y;for(var i=0;i<this.arrP.length;i++)a=calc.getAngle(l,this.arrP[i]),h=calc.getDistance(l,this.arrP[i]),calc.getVector(h,a+r,this.arrPGlob[i]),this.arrPGlob[i].x+=o.x,this.arrPGlob[i].y+=o.y},this.dragPost=function(){this._distans=this.par.par._distans,0==this.sahTextur&&(this.arrP[0].set(-this.arrPosit[2].x,this.arrPosit[2].y,0),this.arrP[1].set(-this.arrPosit[1].x,this.arrPosit[1].y,0),this.arrP[2].set(-this.arrPosit[0].x,this.arrPosit[0].y,0),this.arrP[3].set(this.arrPosit1[5].x+this._distans,this.arrPosit1[5].y,0),this.arrP[4].set(this.arrPosit1[4].x+this._distans,this.arrPosit1[4].y,0),this.arrP[5].set(this.arrPosit1[3].x+this._distans,this.arrPosit1[3].y,0)),1==this.sahTextur&&(this.arrP[5].set(this.arrPosit1[2].x+this._distans,this.arrPosit1[2].y,0),this.arrP[4].set(this.arrPosit1[1].x+this._distans,this.arrPosit1[1].y,0),this.arrP[3].set(this.arrPosit1[0].x+this._distans,this.arrPosit1[0].y,0),this.arrP[2].set(-this.arrPosit[5].x,this.arrPosit[5].y,0),this.arrP[1].set(-this.arrPosit[4].x,this.arrPosit[4].y,0),this.arrP[0].set(-this.arrPosit[3].x,this.arrPosit[3].y,0)),this.sahW=0;for(var t=0;t<5;t++)this.arr[t].setPosit(this.arrP[t],this.arrP[t+1]),0==this.arr[t].dist?0!=this.arr[t].mesh.visible&&(this.arr[t].mesh.visible=!1):1!=this.arr[t].mesh.visible&&(this.arr[t].mesh.visible=!0),this.arr[t].rendSahTextur=this.sahTextur;if(0==this.sahTextur)for(t=0;t<5;t++)this.arr[t].pS.y=0,this.arr[t].pS.w=this.d3Width,this.arr[t].pS.h=this.d3Height,this.arr[t].pS.x=this.sahW,t>=2&&(this.sahW+=this.arr[t].dist);if(1==this.sahTextur)for(t=4;t>=0;t--)t<=1&&(this.sahW+=this.arr[t].dist),this.arr[t].pS.y=0,this.arr[t].pS.w=this.d3Width,this.arr[t].pS.h=this.d3Height,this.arr[t].pS.x=-this.sahW;1==this.boolInvert&&this.invertToGlob()},this.setGrani1=function(t){t.arr[3].redragP(),t.arr[4].redragP(),t.arr[3].rendSahTextur=this.sahTextur,t.arr[4].rendSahTextur=this.sahTextur,t.arr[3].pS.x=this.sahW,t.arr[4].pS.x=this.sahW+t.arr[3].dist,this.arr[0].redragP(),this.arr[1].redragP(),this.arr[0].rendSahTextur=t.sahTextur,this.arr[1].rendSahTextur=t.sahTextur,this.arr[0].pS.x=-this.arr[0].dist-t.sahW,this.arr[1].pS.x=-this.arr[0].dist-this.arr[1].dist-t.sahW},this.sahW=0;var u,c,d=[],p=[];this.dragGeometry=function(t,i){if(this.area=0,0!=this.h){this.cont3d.visible=!0,this.korektRect.boolDebug=!0,this.boolVergDrag=!1,this.korektRect.colizY=0;for(var e=0;e<5;e++)2==this.par.par.idArr&&1==this.idArr&&2==e&&(this.korektRect.boolDebug=!0),0!=this.arr[e].dist&&(2==e&&(this.korektRect.colizX=-this.arrP[e].x,p=d,p=this.par.par.sVephPoint.getOsi(this.idArr),this.arr[e].setNaRect(0,this.par.par.windows.arrBlok,this.h,this.y,null,this.arrP[e].x,p),this.area=this.korektRect.area,99999!==this.korektRect.minL&&this.korektRect.minL!=this.korektRect.rect.y&&(t.l=this.korektRect.minL),99999!==this.korektRect.minR&&this.korektRect.minR!=this.korektRect.rect.y&&(t.r=this.korektRect.minR)),1==this.arr[e].boolVergDrag&&(this.boolVergDrag=!0)),this.korektRect.boolDebug=!1}else this.cont3d.visible=!1},this.dragGMin=function(t,i){this.korektRect.colizY=0,this.korektRect.boolDebug=!1;for(var e=0;e<5;e++)0!=this.arr[e].dist&&(2!=e&&(this.arr[e].clearAL(),this.arr[e].getLine(),u=this.y,c=this.h,0==(c=u=e<3?this.par.par.sVephPoint.getOsi(3):this.par.par.sVephPoint.getOsi(2))&&(u=this.y,c=this.h),c=-(c-this.par.par.par._height),this.arr[e].setNaRect(0,null,c,u,null,0)),1==this.arr[e].boolVergDrag&&(this.boolVergDrag=!0)),this.korektRect.boolDebug=!1}}set material(t){if(this._material!==t){this._material=t;for(var i=0;i<5;i++)this.arr[i].material=t}}get material(){return this._material}set renderOrder(t){if(this._renderOrder!==t){this._renderOrder=t;for(var i=0;i<this.arr.length;i++)this.arr[i].mesh.renderOrder=t}}get renderOrder(){return this._renderOrder}}class Ii{constructor(t){this.type="GronSten",this.par=t,this.geometry=new fi,this.rendSahTextur=0,this.idArr=-1,this._material=t._material,this.vergLittel=void 0,this.mesh=new THREE.Mesh(this.geometry,this._material),this.mesh.rotation.x=Math.PI/2,this.cont3d=new THREE.Object3D,this.par.cont3d.add(this.cont3d),this.cont3d.add(this.mesh),this.p=new THREE.Vector3,this.p1=new THREE.Vector3,this.arrLine=[],this.arrLineCesh=[],this.setName=function(t,i,e){this.mesh.name=t,this.mesh.idArr=i,this.mesh.idArrPar=e},this.clearAL=function(){this.arrLine.length=0},this.getLine=function(){return null==this.arrLineCesh[this.arrLine.length]&&(this.arrLineCesh[this.arrLine.length]={p:{x:0,y:0},p1:{x:0,y:-100}}),this.arrLine.push(this.arrLineCesh[this.arrLine.length]),this.arrLine[this.arrLine.length-1]},this.arrLine1=[],this.arrLineCesh1=[],this.clearAL1=function(){this.arrLine1.length=0},this.getLine1=function(){return null==this.arrLineCesh1[this.arrLine1.length]&&(this.arrLineCesh1[this.arrLine1.length]={p:{x:0,y:0,z:0},p1:{x:0,y:-100,z:0}}),this.arrLine1.push(this.arrLineCesh1[this.arrLine1.length]),this.arrLine1[this.arrLine1.length-1]},this.arrLine2=[],this.arrLineCesh2=[],this.clearAL2=function(){this.arrLine2.length=0},this.getLine2=function(){return null==this.arrLineCesh2[this.arrLine2.length]&&(this.arrLineCesh2[this.arrLine2.length]={p:{x:0,y:0,z:0},p1:{x:0,y:-100,z:0}}),this.arrLine2.push(this.arrLineCesh2[this.arrLine2.length]),this.arrLine2[this.arrLine2.length-1]};var i,e,s,n,r=new THREE.Vector3,h=new THREE.Vector3,a=new THREE.Vector3,o=new THREE.Vector3,l={p:r,p1:h};this.isLocalToGlob=function(t,n){return s=!1,1!=this.par.sahTextur||4!=this.idArr&&3!=this.idArr||(s=!0),0!=this.par.sahTextur||0!=this.idArr&&1!=this.idArr||(s=!0),1==s?(this.par.arrPGlob[this.idArr],e=this.par.arrPGlob[this.idArr+1]):(e=this.par.arrPGlob[this.idArr],this.par.arrPGlob[this.idArr+1]),a.x=t.x-e.x,a.y=t.y-e.y,calc.getAngle(o,a),i=calc.getDistance(o,a),calc.getVector(i,0,r),r.z=this.par.par.par._height+t.z,a.x=n.x-e.x,a.y=n.y-e.y,calc.getAngle(o,a),i=calc.getDistance(o,a),calc.getVector(i,0,h),h.z=this.par.par.par._height+n.z,l},this.rect={x:0,y:0,w:700,h:300},this.dist=0,this.angel=0,this.pS={x:0,y:0,w:1e3,h:100},this.setPosit=function(t,i){this.p=t,this.p1=i,this.setPRed()},this.redragP=function(){n=this.p,this.p=this.p1,this.p1=n,this.setPRed()},this.setPRed=function(){this.angel=calc.getAngle(this.p,this.p1),this.dist=calc.getDistance(this.p,this.p1),this.cont3d.position.x=this.p.x,this.cont3d.position.y=this.p.y,this.cont3d.rotation.z=this.angel},this.boolVergDrag=!1,this.old_x,this.old_coliz,this.old_h,this._y,this._nGeom,this._xSm,this.setNaRect=function(t,i,e,s,n,r,h){this.boolVergDrag=!1,this.old_x=t,this.old_coliz=i,this.old_h=e,this._y=s,this._nGeom=n,this._xSm=r,0,null!=r&&r,this.rect.y=s,this.rect.h=e,this.rect.w=this.dist,this.par.korektRect.rect=this.rect,this.par.korektRect.coliz=i,this.par.korektRect.arrLine=h||[],this.par.korektRect.pS=this.pS,this.par.korektRect.korektGrid(),this.par.korektRect.setGeom(this.geometry,this.rendSahTextur),this.korektLine(),this.boolVergDrag=this.par.korektRect.boolVergDrag,void 0!==this.vergLittel&&this.vergLittel.drawWindow(this.par.korektRect,r)};var u,c,d;this.korektLine=function(){if(!(this.par.par.idArr>=2)&&(this.clearAL1(),this.clearAL2(),0!=this.dist&&2==this.idArr)){u=this.par.korektRect.getLine1();for(var t=0;t<u.length;t++)(c=this.getLine1()).p.x=u[t].p.x+this.p.x,c.p.z=u[t].p.y,c.p.y=this.p.y,c.p1.x=u[t].p1.x+this.p.x,c.p1.z=u[t].p1.y,c.p1.y=this.p.y}},this.point=new THREE.Vector3,this.pNull=new THREE.Vector3,this.povorot=function(t,i,e){d=t.x,calc.getVector(d,-e,this.point),this.point.x+=i.x,this.point.y+=i.y}}set material(t){this._material!==t&&(this._material=t,this.mesh.material=this._material)}get material(){return this._material}}class ki{constructor(t,i){this.type="VergPoint",this.par=t,this.geometry=new fi;var e=this.geometry;this.rendSahTextur=0,this._active=!1,this._boolMinH=t._boolMinH,this.korektLine=this.par.korektLine,this.mesh=new THREE.Mesh(this.geometry),this.par.cont3d.add(this.mesh),this.normalPosit=new THREE.Vector3(0,1,0),this.mat=t.par.par.arrMat[2],this.mat1=t.par.par.arrMat[3],this.arrPoint=[];var s=0;this.getPoint=function(t,i,e){return null==this.arrPoint[s]&&(this.arrPoint[s]=new THREE.Vector3),this.arrPoint[s].set(t,i,e),s++,this.arrPoint[s-1]},this.triangulateShape=this.par.par.par.triangulateShape3D;var n,r,h,a,o,l,u,c,d,p,f,g=this.par.par._delph/2,x=[],y=[],m=[];this.svp=void 0,this.arrDin=[],this.setGrani=function(t,i){if(g=this.par.par._delph/2,null==this.svp&&(this.svp=this.par.par.sVephPoint),x.length=0,y.length=0,m.length=0,s=0,this.arrDin.length=0,u=this.par.par.arrPosit[5].x,d=this.par.par.arrPosit[1].x,c=this.par.par.arrPosit1[1].x,p=this.par.par.arrPosit1[5].x,0!=this.svp.arrOsi.length){if(this.svp.arrOsi.length>=2){for(var n=0;n<this.svp.arrOsi.length-1;n++)0==n?(this.arrDin.push(this.getPoint(this.svp.arrOsi1[n].p.x-d,g,this.svp.arrOsi[n].p.y)),this.arrDin.push(this.getPoint(this.svp.arrOsi[n].p1.x,g,this.svp.arrOsi[n].p1.y)),this.arrDin.push(this.getPoint(this.svp.arrOsi[n].p1.x,-g,this.svp.arrOsi[n].p1.y)),this.arrDin.push(this.getPoint(this.svp.arrOsi1[n].p.x-d,g,this.svp.arrOsi[n].p.y)),this.arrDin.push(this.getPoint(this.svp.arrOsi[n].p1.x,-g,this.svp.arrOsi[n].p1.y)),this.arrDin.push(this.getPoint(this.svp.arrOsi2[n].p.x-u,-g,this.svp.arrOsi2[n].p.y))):(this.arrDin.push(this.getPoint(this.svp.arrOsi[n].p.x,g,this.svp.arrOsi[n].p.y)),this.arrDin.push(this.getPoint(this.svp.arrOsi[n].p1.x,g,this.svp.arrOsi[n].p1.y)),this.arrDin.push(this.getPoint(this.svp.arrOsi[n].p1.x,-g,this.svp.arrOsi[n].p1.y)),this.arrDin.push(this.getPoint(this.svp.arrOsi[n].p.x,-g,this.svp.arrOsi[n].p.y)),this.arrDin.push(this.getPoint(this.svp.arrOsi[n].p.x,g,this.svp.arrOsi[n].p.y)),this.arrDin.push(this.getPoint(this.svp.arrOsi[n].p1.x,-g,this.svp.arrOsi[n].p1.y)));this.arrDin.push(this.getPoint(this.svp.arrOsi[n].p.x,g,this.svp.arrOsi[n].p.y)),this.arrDin.push(this.getPoint(this.svp.arrOsi[n].p1.x+p,g,this.svp.arrOsi[n].p1.y)),this.arrDin.push(this.getPoint(this.svp.arrOsi[n].p1.x+c,-g,this.svp.arrOsi[n].p1.y)),this.arrDin.push(this.getPoint(this.svp.arrOsi[n].p.x,-g,this.svp.arrOsi[n].p.y)),this.arrDin.push(this.getPoint(this.svp.arrOsi[n].p.x,g,this.svp.arrOsi[n].p.y)),this.arrDin.push(this.getPoint(this.svp.arrOsi[n].p1.x+c,-g,this.svp.arrOsi[n].p1.y))}else{n=0;this.arrDin.push(this.getPoint(this.svp.arrOsi1[n].p.x-d,g,this.svp.arrOsi[n].p.y)),this.arrDin.push(this.getPoint(this.svp.arrOsi[n].p1.x+p,g,this.svp.arrOsi[n].p1.y)),this.arrDin.push(this.getPoint(this.svp.arrOsi[n].p1.x+c,-g,this.svp.arrOsi[n].p1.y)),this.arrDin.push(this.getPoint(this.svp.arrOsi1[n].p.x-d,g,this.svp.arrOsi[n].p.y)),this.arrDin.push(this.getPoint(this.svp.arrOsi[n].p1.x+c,-g,this.svp.arrOsi[n].p1.y)),this.arrDin.push(this.getPoint(this.svp.arrOsi2[n].p.x-u,-g,this.svp.arrOsi2[n].p.y))}this.drahKontur(),e.setAttribute("position",new THREE.Float32BufferAttribute(x,3)),e.setAttribute("normal",new THREE.Float32BufferAttribute(m,3)),e.setAttribute("uv",new THREE.Float32BufferAttribute(y,2)),e.computeBoundingBox(),e.computeBoundingSphere()}},this.drahKontur=function(){n=99999999,h=99999999,r=-99999999,a=-99999999;for(var t=0;t<this.arrDin.length;t++)n>this.arrDin[t].x&&(n=this.arrDin[t].x),h>this.arrDin[t].y&&(h=this.arrDin[t].y),r<this.arrDin[t].x&&(r=this.arrDin[t].x),a<this.arrDin[t].y&&(a=this.arrDin[t].y);o=r-n,l=a-h,f=this.par._height-50;for(t=0;t<this.arrDin.length;t+=3)0==this._boolMinH?(x.push(this.arrDin[t].x,this.arrDin[t].y,this.arrDin[t].z),x.push(this.arrDin[t+1].x,this.arrDin[t+1].y,this.arrDin[t+1].z),x.push(this.arrDin[t+2].x,this.arrDin[t+2].y,this.arrDin[t+2].z)):(x.push(this.arrDin[t].x,this.arrDin[t].y,f),x.push(this.arrDin[t+1].x,this.arrDin[t+1].y,f),x.push(this.arrDin[t+2].x,this.arrDin[t+2].y,f)),y.push((this.arrDin[t].x-n)/o,(this.arrDin[t].y-h)/l),y.push((this.arrDin[t+1].x-n)/o,(this.arrDin[t+1].y-h)/l),y.push((this.arrDin[t+2].x-n)/o,(this.arrDin[t+2].y-h)/l),m.push(0,1,0),m.push(0,1,0),m.push(0,1,0)},this.drahThree=function(){this.triangulateShape.start(this.arrDin)},this.drawWindow=function(t,i){},this.dragMat=function(){!0!==this._active?this.mesh.material=this.mat:this.mesh.material=this.mat1}}set material(t){this._material!==t&&(this._material=t,this.mesh.material=this._material)}get material(){return this._material}set boolMinH(t){this._boolMinH!=t&&(this._boolMinH=t,this.setGrani())}get boolMinH(){return this._boolMinH}set active(t){this._active!=t&&(this._active=t,this.dragMat())}get active(){return this._active}}class ji{constructor(t,i,e,s,n,r,h){this.type="TComp3But";this.c3d=t,this.fun=i,this._mast=1,this.gB=e,this.uuid=calc.generateRendom(2),e||(this.gB=new THREE.BoxBufferGeometry(10,10,10)),this.gB1=s,s||(this.gB1=new THREE.BoxBufferGeometry(1,10,1)),this._material=n||new THREE.MeshBasicMaterial({color:255}),this._material1=r||new THREE.MeshBasicMaterial({color:65280}),this._material2=h||new THREE.MeshBasicMaterial({color:16711680}),this._boolKill=!1,this._life=!0,this._otstup=10,this._otstupZ=3,this._scale=5,this.content3d=new THREE.Object3D,this.c3d.add(this.content3d),this.content3d.objGlob=this,this.dragFun=null,this.button=null,this.button1=null,this.button2=null,this.drag=function(){this.button.drag(),this.button1.drag(),this.button2.drag()},this.arrButton=[],this.init=function(){this.button=new Hi(this,this.gB,this._material,this._material1),this.button1=new Hi(this,this.gB1,this._material,this._material1),this.button2=new Hi(this,this.gB1,this._material,this._material1),this.button.idArr=0,this.button1.idArr=1,this.button2.idArr=2,this.arrButton.push(this.button,this.button1,this.button2),this.button1.mesh.position.x=this._otstup,this.button2.mesh.position.x=this._otstup,this.button2.rotationZ=Math.PI,this.button.mesh.scale.set(this._scale,this._scale,this._scale),this.button1.mesh.scale.set(this._scale,this._scale,this._scale),this.button2.mesh.scale.set(this._scale,this._scale,this._scale)},this.dragMat=function(){for(var t=0;t<this.arrButton.length;t++)this.arrButton[t].dragMat()},this.init()}set mast(t){if(this._mast!=t){this._mast=t;let i=this._mast*facade._mastYmn;this.button.mast=i,this.button1.mast=i,this.button2.mast=i,this.button1.mesh.position.x=this._otstup*i,this.button2.mesh.position.x=this._otstup*i}}get mast(){return this._mast}set scale(t){this._scale!=t&&(this._scale=t,this.button.setScale(this._scale),this.button1.setScale(this._scale),this.button2.setScale(this._scale))}get scale(){return this._scale}set life(t){this._life!=t&&(this._life=t,this._life?this.c3d.add(this.content3d):this.c3d.remove(this.content3d))}get life(){return this._life}set boolKill(t){this._boolKill!=t&&(this._boolKill=t,this.dragMat())}get boolKill(){return this._boolKill}set otstup(t){this._otstup!=t&&(this._otstup=t,this.button1.mesh.position.x=this._otstup*this._mast,this.button2.mesh.position.x=this._otstup*this._mast,this.drag())}get otstup(){return this._otstup}set otstupZ(t){this._otstupZ!=t&&(this._otstupZ=t,this.drag())}get otstupZ(){return this._otstupZ}}class Hi{constructor(t,i,e,s){this.type="TCBut";this.notZbros=!1,this._z=0,this._rotationX=0,this._rotationZ=0,this._mast=t._mast,this._active=!1,this.par=t,this.gB=i,this.mat=e,this.mat1=s,this.content3d=new THREE.Object3D,this.par.content3d.add(this.content3d),this.content3d1=new THREE.Object3D,this.content3d.add(this.content3d1),this.mesh=new THREE.Mesh(i,e),this.mesh.rotation.z=-Math.PI/2,this.content3d1.add(this.mesh),this.mesh.button=this,this.drag=function(){this.content3d.position.z=-this._z-this.par._otstupZ,this.par.dragFun&&this.par.dragFun()},this.dragMat=function(){1==this.par._boolKill?this.mesh.material=this.par._material2:0==this._active?this.mesh.material=this.mat:this.mesh.material=this.mat1},this.scal=1,this.setScale=function(t){this.scal=t,this.mesh.scale.set(this.scal*this._mast,this.scal*this._mast,this.scal*this._mast)}}set mast(t){this._mast!=t&&(this._mast=t,this.mesh.scale.set(this.scal*this._mast,this.scal*this._mast,this.scal*this._mast),visi3D.intRend=1)}get mast(){return this._mast}set active(t){this._active!=t&&(1==this.notZbros&&(t=!0),this._active=t,this.dragMat(),visi3D.intRend=1)}get active(){return this._active}set z(t){this._z!=t&&(this._z=t,this.content3d.position.z=-this._z-this.par._otstupZ,this.drag())}get z(){return this._z}set rotationX(t){this._rotationX!=t&&(this._rotationX=t,this.content3d1.rotation.y=t,this.drag())}get rotationX(){return this._rotationX}set rotationZ(t){this._rotationZ!=t&&(this._rotationZ=t,this.content3d.rotation.z=t,this.drag())}get rotationZ(){return this._rotationZ}}class Fi{constructor(t,i){this.type="SVephPoint";var e;this.par=t,this._mast=t._mast,this.fun=i,this.array=[],this.arrayCesh=[],this._activeVisi=!1,this.c3d=this.par.cont3dSten,this.content3d=new THREE.Object3D,this.sGPoint=void 0,this.fGPoint=void 0,this._hPoint=300,this.cont3dL=new THREE.Object3D,this.cont3dL.position.y=-.5,this.content3d.add(this.cont3dL),this.sob=function(t,i){},this.getPoint=function(){for(var t=0;t<this.arrayCesh.length;t++)if(0==this.arrayCesh[t].active)return this.arrayCesh[t].active=!0,this.arrayCesh[t];let i=new Ni(this,this.sob);return i.idArr=this.arrayCesh.length,this.arrayCesh.push(i),i.active=!0,i},this.draw1=function(){this.drawKorektArray();let t=this.get2Sten(!0);if(t){let i=t.addPoint;if(this.sGPoint){let t=calc.getTreeAngel(this.par.addPoint1.position,this.par.addPoint.position,i.position);this.sGPoint.tComp3But.button2.rotationZ=t}}this.drawBig()},this.disttt,this.drawBig=function(){this.clearOsi();for(var t=0;t<this.array.length-1;t++){let i={x:0,y:0,z:0},e={x:0,y:0,z:0},s={x:0,y:0,z:0},n=!1,r=!1;0==t&&(n=!0),this.array[t].drag(),i.x=this.array[t].point.x,i.y=this.array[t].point.y,e.x=this.array[t+1].point1.x,e.y=this.array[t+1].point1.y,s.x=this.array[t].point1.x,s.y=this.array[t].point1.y,t==this.array.length-2&&(e.x=this.par._distans,r=!0),this.array[t].korectXY();let h=calc.getDistance(i,e),a=calc.getAngle(i,e);this.disttt=h,this.array[t].tCompArrow.distans=h,this.array[t].tCompArrow.content3d.rotation.y=a,this.array[t].tCompArrow.bMat3=0==a,this.array[t].tComp3But.button1.rotationX=a,this.array[t+1].tComp3But.button2.rotationX=-a,this.plus3Point(i,e,s,n,r)}},this.sGPoint=this.getPoint(),this.sGPoint.bForst=!0,this.sGPoint.tComp3But.button.mesh.scale.z=27,this.drawKorektArray=function(){let t=this.get2Sten(!1);if(t){null==this.fGPoint?this.fGPoint=t.sVephPoint.sGPoint:t.sVephPoint.sGPoint.uuid!=this.fGPoint.uuid&&(this.fGPoint=t.sVephPoint.sGPoint),this.sGPoint.idAp=-1,this.array.length=0,void 0!==this.sGPoint&&this.array.push(this.sGPoint),this.arrGP.sort(function(t,i){return t.prosent-i.prosent});for(var i=0;i<this.arrGP.length;i++)this.array.push(this.arrGP[i]),this.arrGP[i].idAp=i;void 0!==this.fGPoint&&this.array.push(this.fGPoint)}},this.get2Sten=function(t){if(1==t){if(this.par.addPoint)for(var i=this.par.addPoint.arrSHron.length-1;i>=0;i--)if(this.par.addPoint.arrSHron[i].sten.uuid!=this.par.uuid)return this.par.addPoint.arrSHron[i].sten}else if(this.par.addPoint1)for(i=this.par.addPoint1.arrSHron.length-1;i>=0;i--)if(this.par.addPoint1.arrSHron[i].sten.uuid!=this.par.uuid)return this.par.addPoint1.arrSHron[i].sten;return null},this.arrGP=[],this.addGP=function(t){this.removeGP(t),this.arrGP.push(t)},this.removeGP=function(t){for(var i=-1,e=0;e<this.arrGP.length;e++)if(this.arrGP[e].uuid==t.uuid){i=e;break}if(-1!=i){let t=this.arrGP.splice(i,1)[0];t.life=!1;for(e=this.array.length-1;e>=0;e--)this.array[e].uuid==t.uuid&&this.array.splice(e,1);return t}return null},this.addPointCenter=function(t){for(var i=-1,e=0;e<this.array.length-1;e++)if(this.array[e].uuid==t.uuid){i=e;break}if(-1==i)return null;let s=this.array[i],n=this.array[i+1],r=s.prosent,h=n.prosent;i==this.array.length-2&&(h=1);let a=r+(h-r)/2,o=s.point.y,l=o+(n.point1.y-o)/2,u=this.getPoint();return u.prosent=a,u.tComp3But.button.z=l,u.tComp3But.button1.z=l,u.tComp3But.button2.z=l,this.addGP(u),this.par.par.addObjFun(this.par.addPoint),this.drawBig(),u},this.arrOsi=[],this.arrOsi1=[],this.arrOsi2=[],this.arrOsiCesh=[],this.getCeshOsi=function(){for(var t=0;t<this.arrOsiCesh.length;t++)if(0==this.arrOsiCesh[t].a)return this.arrOsiCesh[t].a=!0,this.arrOsiCesh[t];let i={p:{x:0,y:0},p1:{x:600,y:310},a:!0};return this.arrOsiCesh.push(i),i};var s,n,r=[];this.getOsi=function(t){return 1==t?this.arrOsi1:0==t?this.arrOsi2:3==t?this.arrOsi1[0]?this.arrOsi1[0].p.y:0:2==t?this.arrOsi1[this.arrOsi1.length-1]?this.arrOsi1[this.arrOsi1.length-1].p1.y:0:r},this.clearOsi=function(){this.arrOsi.length=0,this.arrOsi1.length=0,this.arrOsi2.length=0;for(var t=0;t<this.arrOsiCesh.length;t++)this.arrOsiCesh[t].a=!1},this.plus3Point=function(t,i,r,h,a){if((e=this.getCeshOsi()).p.x=t.x,e.p.y=this.par._height-t.y,e.p1.x=i.x,e.p1.y=this.par._height-i.y,this.arrOsi.length>=1&&this.arrOsi[this.arrOsi.length-1]&&this.arrOsi[this.arrOsi.length-1].p1.y!==e.p.y){let t=this.getCeshOsi();t.p.x=this.arrOsi[this.arrOsi.length-1].p1.x,t.p.y=this.arrOsi[this.arrOsi.length-1].p1.y,t.p1.x=e.p.x,t.p1.y=e.p.y,this.arrOsi.push(t)}this.arrOsi.push(e),s=this.par.arrPosit[5].x,n=this.par.arrPosit1[1].x,1+(s+n)/this.par._distans,(e=this.getCeshOsi()).p.x=s+t.x,e.p.y=this.par._height-t.y,e.p1.x=s+i.x,e.p1.y=this.par._height-i.y,this.arrOsi1.push(e),1==h&&(e.p.x=0),1==a&&(e.p1.x+=n),s=this.par.arrPosit[1].x,n=this.par.arrPosit1[5].x,1+(s+n)/this.par._distans,(e=this.getCeshOsi()).p.x=s+t.x,e.p.y=this.par._height-t.y,e.p1.x=s+i.x,e.p1.y=this.par._height-i.y,this.arrOsi2.push(e),1==h&&(e.p.x=0),1==a&&(e.p1.x+=n)},this.setObj=function(t){if(null!=t){this.sGPoint.setObj(t.sGPoint);for(var i=0;i<t.arrGP.length;i++){let e=this.getPoint();e.setObj(t.arrGP[i]),this.addGP(e)}}},this.getObj=function(){var t={};t.sGPoint=this.sGPoint.getObj(),t.arrGP=[];for(var i=0;i<this.arrGP.length;i++)t.arrGP.push(this.arrGP[i].getObj());return t},this.activeVephPoint=this.par._activeVephPoint}set mast(t){if(this._mast!=t){this._mast=t;for(var i=0;i<this.arrayCesh.length;i++)this.arrayCesh[i].mast=t}}get mast(){return this._mast}set activeVephPoint(t){this._activeVephPoint!=t&&(this._activeVephPoint=t,1==this._activeVephPoint?this.c3d.add(this.content3d):this.c3d.remove(this.content3d))}get activeVephPoint(){return this._activeVephPoint}}class Ni{constructor(t,i){this.type="GronPoint";this.par=t,this.fun=i,this.idArr=-1,this.idAp=-1,this._mast=this.par._mast,this._mastYM=2,this.bProsent=!0,this.prosent=0,this.boolKill=!1,this.point={x:0,y:0,z:0},this.point1={x:0,y:0,z:0},this.bForst=!1,this.uuid=calc.generateRendom(2),this._life=!0,this.c3d=this.par.content3d,this.content3d=new THREE.Object3D,this.par.content3d.add(this.content3d),this.tComp3But=new ji(this.content3d,function(t,i){},this.par.par.par.sphereGeometry,this.par.par.par.coneGeometry,window.pm.matDop.getIDObj(6),window.pm.matDop.getIDObj(7),window.pm.matDop.getIDObj(23));var e=this.par._hPoint;this.tComp3But.button.z=e,this.tComp3But.button1.z=e,this.tComp3But.button2.z=e,this.tComp3But.gronPoint=this,this.tComp3But.scale=13*this.par.par.par.param.mastab,this.tComp3But.otstup=20*this.par.par.par.param.mastab,this.tComp3But.otstupZ=20*this.par.par.par.param.mastab,this.tComp3But.mast=this._mast*facade._mastYmn,this.tCompArrow=new Bi(this.content3d,function(t,i){},null,window.pm.matDop.getIDObj(24),window.pm.matDop.getIDObj(6),window.pm.matDop.getIDObj(7),window.pm.matDop.getIDObj(26),window.pm.matDop.getIDObj(27)),this.tCompArrow.content3d.visible=this._lineOpor,this.tCompArrow.otstup=2,this.tCompArrow.activeButton=!0,this.tCompArrow.gPoint=this,this.tCompArrow.gPoint=this,this.tCompArrow.boolText=!1,this.tCompArrow.mast=this._mast;this.par.par.par.param.mobile,this.tCompArrow.bRotation=!1,this.drag=function(){this.tComp3But.content3d.position.x=this.par.par._distans*this.prosent,this.tCompArrow.content3d.position.x=this.par.par._distans*this.prosent,this.point.x=this.tComp3But.content3d.position.x,this.point1.x=this.tComp3But.content3d.position.x,this.point.y=this.tComp3But.button1.z,this.point1.y=this.tComp3But.button2.z,this.tCompArrow.content3d.position.z=-this.point.y-this.tComp3But.otstupZ,this.korectXY()},this.kill=function(){this.par.removeGP(this)},this.posit={x:0,y:0,z:0},this.korectXY=function(){if(null==this.par.par.addPoint)return;if(null==this.par.par.addPoint1)return;let t=calc.getAngle(this.par.par.addPoint.position,this.par.par.addPoint1.position),i=this.point.x;calc.getVector(i,t,this.posit),this.posit.x+=this.par.par.addPoint.position.x,this.posit.y+=this.par.par.addPoint.position.y,this.posit.z=this.tComp3But.button.z},this.setZZ=function(t){this.tComp3But.button.z=t,this.tComp3But.button1.z=t,this.tComp3But.button2.z=t,this.drag()},this.clear=function(){this.par.removeGP(this),this.par.draw1()},this.setObj=function(t){null!=t&&(this.prosent=t.prosent,this.tComp3But.button.z=t.z,this.tComp3But.button1.z=t.z1,this.tComp3But.button2.z=t.z2)},this.getObj=function(){var t={};return t.prosent=this.prosent,t.z=this.tComp3But.button.z,t.z1=this.tComp3But.button1.z,t.z2=this.tComp3But.button2.z,t},this.setProsent=function(t){this.prosent=t},this.setX=function(t,i,e){let s=i-t/this.par.par._distans;0==this.bForst?(s<0&&(this.tComp3But.boolKill=!0,s=0),s>1&&(this.tComp3But.boolKill=!0,s=1)):s=0,this.prosent=s},this.setXESH=function(t){trace("xxx",t)}}set mast(t){this._mast!=t&&(this._mast=t,this.tCompArrow.mast=this._mast,this.tComp3But.mast=this._mast)}get mast(){return this._mast}set life(t){this._life!=t&&(this._life=t,this._life?this.c3d.add(this.content3d):this.c3d.remove(this.content3d))}get life(){return this._life}}class Vi{constructor(t,i){this.type="Razmeru";this.par=t,this.fun=i,this._mast=t._mast,this._razVisi=t.par.razVisi,this.content3d=new THREE.Object3D,this.par.content3d.add(this.content3d),this.content3d.visible=this._razVisi,this.otstup=30,this.content3d.position.y=-this.par.delph/2,1==t.par.param.mobile&&(this.content3d.position.z=-10),this._boolWindow=t.par.razWindow;var e=window.pm.matDop.getIDObj(24);this.array=[],this.get=function(){for(var t=0;t<this.array.length;t++)if(0==this.array[t].life)return this.array[t].life=!0,this.array[t];let i=new Bi(this.content3d,function(t,i){},null,e,e,e,e,e);return i.sten=this.par,i.zdvih=-20,i.bDurka=!1,i.bVerh=!1,i.bRotation=!0,i.mast=this._mast*facade._mastYmn,i.idArr=this.array.length,this.array.push(i),i},this.clear=function(){for(var t=0;t<this.array.length;t++)this.array[t].life=!1},this.sss=function(t,i){return t-i},this.dA=function(t){for(var i=0;i<t.length;i++)t[i]=Math.round(100*t[i])/100;for(i=0;i<t.length;i++)for(var e=t.length-1;e>i;e--)t[i]==t[e]&&t.splice(e,1);t.sort(this.sss)};var s,n,r,h,a,o,l,u=[];this.xx=0,this.xx1=0,this.dist=0,this.aaD=[],this.aaY1=[],this.aaX1=[],this.draw=function(){if(this.aaD.length=0,this.aaY1.length=0,this.aaX1.length=0,0==this._razVisi)return this.clear(),h=this.par.arrPosit[5]._x,a=this.par.arrPosit1[0]._x,s=this.par._distans+a+h,(r=this.get()).content3d.position.x=-h,void(r.distans=s);if(this.clear(),h=this.par.arrPosit[5]._x,a=this.par.arrPosit1[0]._x,s=this.par._distans+a+h,this.xx=h,this.xx1=a,this.dist=s,this.content3d.position.x=-h,this.par.sVephPoint.array.length>=2){this.aaY1.push(this.par.sVephPoint.array[0].posit.z),this.aaX1.push(0);for(var t=this.par.sVephPoint.array.length-1;t>=0;t--)0!=this.par.sVephPoint.array[t].point.x&&(this.aaX1.push(this.par.sVephPoint.array[t].point.x+this.xx),this.aaY1.push(this.par.sVephPoint.array[t].posit.z));this.aaX1.push(this.dist),this.aaY1.push(this.par.sVephPoint.array[this.par.sVephPoint.array.length-1].posit.z)}if(0==this._boolWindow){u.length=0,u.push(0,s);for(t=this.par.sVephPoint.array.length-1;t>=0;t--)0!=this.par.sVephPoint.array[t].point.x&&u.push(this.par.sVephPoint.array[t].point.x+this.xx);this.dA(u);for(t=0;t<u.length-1;t++)n=u[t+1]-u[t],(r=this.get()).content3d.position.x=u[t],r.distans=n}else{u.length=0,u.push(0,s);for(t=this.par.windows.arrBlok.length-1;t>=0;t--)u.push(this.par.windows.arrBlok[t].boxColizi.rectCollisMeshdy._x+h),u.push(this.par.windows.arrBlok[t].boxColizi.rectCollisMeshdy._x+this.par.windows.arrBlok[t].boxColizi.rectCollisMeshdy.width+h);this.dA(u);for(t=0;t<u.length-1;t++)n=u[t+1]-u[t],(r=this.get()).content3d.position.x=u[t],r.distans=n}},this.setWidth=function(t){this.dragIter(t,0),this.par.draw1()};var c={x:0,y:0},d={x:0,y:0},p={x:0,y:0};this.dragIter=function(t,i){i>3||(h=this.par.arrPosit[1].x,a=this.par.arrPosit1[5].x,o=-(h+a)+this.par._distans,Math.round(o)!=Math.round(t)&&(l=(t-o)/2*.7,c.x=(this.par.addPoint.position.x+this.par.addPoint1.position.x)/2,c.y=(this.par.addPoint.position.y+this.par.addPoint1.position.y)/2,calc.getVector(this.par._distans/2+l,this.par._rotation-Math.PI,d),p.x=c.x+d.x,p.y=c.y+d.y,this.par.addPoint.position.setPoint(p),calc.getVector(this.par._distans/2+l,this.par._rotation,d),p.x=c.x+d.x,p.y=c.y+d.y,this.par.addPoint1.position.setPoint(p),this.dragIter(t,i+1)))};c={x:0,y:0},d={x:0,y:0};let f;this.getInfo=function(){var t=[];f=0;for(var i=0;i<this.aaX1.length-1;i++){let e={};e.width=this.aaX1[i+1]-this.aaX1[i],e.x=this.aaX1[i],e.height=this.aaY1[i],e.height1=this.aaY1[i+1],c.x=this.aaX1[i],c.y=this.aaY1[i],d.x=this.aaX1[i+1],d.y=this.aaY1[i+1],e.angle=180*-calc.getAngle(c,d)/Math.PI,t.push(e),f=e.width}return t}}set mast(t){if(this._mast!=t){this._mast=t,this.content3d.position.z=-10*this._mast;for(var i=0;i<this.array.length;i++)this.array[i].mast=this._mast*facade._mastYmn;this.draw()}}get mast(){return this._mast}set razVisi(t){this._razVisi!=t&&(this._razVisi=t,this.draw())}get razVisi(){return this._razVisi}set boolWindow(t){this._boolWindow!=t&&(this._boolWindow=t,this.draw())}get boolWindow(){return this._boolWindow}}function Gi(t,i,e,s){this._x=t||0,this._y=i||0,this._z="function"!=typeof e&&e||0,this.fun="function"==typeof e?e:s,this.set=function(t,i,e){this._x=t||0,this._y=i||0,this._z=e||0,this.fun&&this.fun()},this.setPoint=function(t){this._x=t.x,this._y=t.y,this._z=t.z,this.fun&&this.fun()},this.getObj=function(){var t={};return t.x=this._x,t.y=this._y,t.z=this._z,t},this.copy=function(){return new Gi(this._x,this._y,this._z)}}function Xi(t){Jt.call(this,t);var i=this;this.type="SpliceSten",this.tipe="Splice",this.stage=t,this.par=t,this._boolText=!0,this._active=!1,this.idUi=Math.round(1e3*Math.random()),this._uuid=calc.generateRendom(2),this._mast=t._mast,this.sUi=-1,this._offset=t._offset,this._bChaz=!1,this.tip=0,this._boolAree=!0,this._boolMinH=this.par._boolMinH,this._height=t._height,this._lineOpor=this.par._lineOpor,this._activeVephPoint=this.par._activeVephPoint,this._delph=this.par._delph,this._height=this.stage._height,this.content3d=new THREE.Object3D,this.par.content3d.add(this.content3d),this.cont3dSten=new THREE.Object3D,this.content3d.add(this.cont3dSten),this.content3d.objGlob=this,visi3D.event3DArr.addChild(this.cont3dSten),this.ss3d=new Li(this),this.sVephPoint=new Fi(this),this.windows=new ui(this),this.razmeru=new Vi(this),this.arrayClass.push(this.ss3d),this.arrayClass.push(this.sVephPoint),this.arrayClass.push(this.windows),this.arrayClass.push(this.razmeru),this.addBlok=function(t){return null==t?-1:this.windows.addBlok(t)},this.removeBlok=function(t){return null==t?-1:this.windows.removeBlok(t)},this.numBlok=0,this.draw1=function(t){this.windows.draw(),this.sVephPoint.draw1(),this.ss3d.draw1(),this.razmeru.draw(),this.par.render()},this.dragPost=function(){this.content3d.position.x=this.position.x,this.content3d.position.y=this.position.y,this.content3d.rotation.z=this._rotation,this.ss3d.dragPost(),this.draw1(),this.stage.render()},this.dragMat=function(){this._boolAree?(this.ss3d.arrGrani[0].material=this.par.arrMat[0],this.ss3d.arrGrani[1].material=this.par.arrMat[1],this.ss3d.vergLittel.mat=this.par.arrMat[2],this.ss3d.vergLittel.mat1=this.par.arrMat[3],this.ss3d.arrGrani[0].renderOrder=0,this.ss3d.arrGrani[1].renderOrder=0):(this.ss3d.arrGrani[0].material=this.par.arrMatAlpha[0],this.ss3d.arrGrani[1].material=this.par.arrMatAlpha[1],this.ss3d.vergLittel.mat=this.par.arrMatAlpha[2],this.ss3d.vergLittel.mat1=this.par.arrMatAlpha[3],this.ss3d.arrGrani[0].renderOrder=1,this.ss3d.arrGrani[1].renderOrder=1),this.ss3d.vergLittel.dragMat()},this.dragMat(),this.delim=function(){let t={x:0,y:0};t.x=(this.addPoint.position.x+this.addPoint1.position.x)/2,t.y=(this.addPoint.position.y+this.addPoint1.position.y)/2;let e=i.par.craetPoint(),s=i.par.par.polDin.array;var n=i.par.craetSplice1();n.boolAree=this.boolAree;for(var r=-1,h=0;h<s.length;h++)if(s[h].uuid==this.addPoint1.uuid){r=h;break}return-1!=r&&i.par.par.polDin.addPoint(e,r),e.position.setPoint(t),this.addPoint.addSplice(n,!0),this.addPoint.removeSplice(this),e.addSplice(this,!0),e.addSplice(n,!1),n},this.korectOffset=function(){}}function Ui(t){this.par=t,this._mast=t._mast,this._height=t.stage._height,this._height1=t.stage._height1,this._life=!1,this._activ=!1,this._active=!1,this._alpha=1,this._tipVisi=0,this._activMouse=void 0,this._pointVisi=!0,this.visi3D=t.stage.visi3D,this.delph=this.par.par.delph,this.minH=this.par.par.minH,this.size=2,this.size1=13,this.funDragMenu=void 0,this.content3d=new THREE.Object3D,this.content3dNa=new THREE.Object3D,this.content3d.add(this.content3dNa),this.mesh=new THREE.Mesh(t.stage.cylinderGeometry,t.stage.cylinderMaterial),this.mesh.name="PointSten",this.mesh.objGlob=t,this.mesh.rotation.x=Math.PI/2,this.mesh1=new THREE.Mesh(t.stage.cylinderGeometry,t.stage.cylinderMaterial),this.content3dNa.add(this.mesh1),this.mesh1.name="PointSten",this.mesh1.objGlob=t,this.mesh1.rotation.x=Math.PI/2,this.dragHH=function(){this._height,this._height1;this.mesh1.scale.set(this.size1*this._mast,this.size,this.size1*this._mast),this.mesh1.position.z=-this.minH-this.size/2-15},this.dragHH(),this.drag=function(){this.content3d.position.x=t.position.x,this.content3d.position.y=t.position.y,void 0!==this.funDragMenu&&this.funDragMenu()},this.life=!0,this.activMouse=!0}function Yi(t){Ut.call(this);this.type="SpPointSten",this.tipe="SpPointSten",this.stage=t,this.par=t,this._height=150,this._mast=t._mast,this._active=!1,this._activMouse=t._amPoint,this._lineOpor=this.par._lineOpor,this._mashtabNa=this.par._mashtabNa,this.arrayClass.push(new Ui(this)),t.content3dPoint.add(this.arrayClass[0].content3d),this.arrayClass[0].content3dNa.visible=this._lineOpor,this.funDragMenu=void 0,this.funDragVokrug=function(t,i){for(var e=0;e<i.length;e++)i[e].dragPost()},this.dragPost=function(){this.dragVokrug(),null!=this.funDragMenu&&this.funDragMenu()},this.doFunRend=function(){this.par.addObjFun(this)},this.getTypeConnect=function(){var t=["AidPoint"];return this.arrIdSten.length>0&&t.push("Sten"),t}}function Wi(){this.type="SpUtility";var t=[],i=[];this.connectLines=function(e){t.length=0,i.length=0,t=this.tune(e);for(var s=0;s<t.length;s++)i[s]=e.stage.arrSplice[t[s]];return i};var e,s,n=[],r=[];function h(t,i){for(var e=0;e<t.length;e++)if(t[e]==i)return!1;return!0}function a(t){if(s=[],t._addPoint)for(var i=0;i<t._addPoint.arrSHron.length;i++)t.idArr!=t._addPoint.arrSHron[i].sten.idArr&&s.push(t._addPoint.arrSHron[i].sten.idArr);if(t._addPoint1)for(i=0;i<t._addPoint1.arrSHron.length;i++)t.idArr!=t._addPoint1.arrSHron[i].sten.idArr&&s.push(t._addPoint1.arrSHron[i].sten.idArr);return s}this.tune=function(t){arrSplice=t.stage.arrSplice,n.length=0,r.length=0,n.push(t.idArr),e=a(t);for(var i=0;i<e.length;i++)r.push(e[i]);for(i=0;i<r.length;i++)if(1==h(n,r[i])){n.push(r[i]),e=a(arrSplice[r[i]]);for(var s=0;s<e.length;s++)r.push(e[s])}return n}}function Qi(t){var i=this;this.sahAngel=t||10;var e=.1;this.radius=1,this.curvature=e,this.p=new Zt,this.p1=new Zt(1,0),this.p2=new Zt(.5,.5),this.pOCent=new Zt,this.pint90=new Zt,this.arrPosit=[];for(var s=0;s<this.sahAngel;s++)this.arrPosit[s]=new Zt;function n(t,i,e){calc.getVector(calc.getDistance(t,i)+e,calc.getAngle(i,t),t),t.x+=i.x,t.y+=i.y}this.moveLineRange=function(t){n(this.p,this.pOCent,t),n(this.p1,this.pOCent,t),n(this.p2,this.pOCent,t),this.updateFromCurvature(this.getCurrentCurvature())},this.setTwoPoint=function(t,i){this.p.setPoint(t),this.p1.setPoint(i),this.upDate()},this.getLR=function(t,i){this.upDate();var e=new Qi(this.sahAngel);0===i&&(e.p.setPoint(this.p),e.p1.setPoint(t)),1===i&&(e.p.setPoint(t),e.p1.setPoint(this.p1)),e.p2.set((e.p.x+e.p1.x)/2,(e.p.y+e.p1.y)/2);var s=calc.getAngle(this.pOCent,e.p2);return calc.getVector(this.radius,s,e.p2),e.p2.x+=this.pOCent.x,e.p2.y+=this.pOCent.y,e.updateFromCurvature(e.getCurrentCurvature()),e},this.setLR=function(t){this.p.setPoint(t.p),this.p1.setPoint(t.p1),this.p2.setPoint(t.p2),this.updateFromCurvature(this.getCurrentCurvature())},this.setCurvFromPoint=function(t){this.p2.setPoint(t),this.updateFromCurvature(this.getCurrentCurvature())},this.getCurrentCurvature=function(){return calc.getDistancePointToLine(this.p,this.p1,this.p2)},this.korectPoint2=function(t,i,e){t=t||0,i=i||this.p,e=e||this.p1,calc.getArrPointCircle(this.pOCent,this.radius+t,i,e,this.sahAngel,this.curvature>0,this.arrPosit)},this.upDate=function(){this.updateFromCurvature()};var r=new Zt;this.getPointInLineRange=function(t,i,e,s){e=e||0;var n=calc.getDistance(t,this.pOCent);if(calc.diffNum(n,this.radius)>i)return null;var h=this.getLengthPoint(t),a=this.getLenght();if(h<0||h>a){var o=Math.min(calc.diffNum(h,0),calc.diffNum(h,a));if(!s&&e<o)return null;if(s)return calc.diffNum(h,0)<calc.diffNum(h,a)?(r.setPoint(this.p),r):(r.setPoint(this.p1),r)}return calc.getVector(this.radius,calc.getAngle(this.pOCent,t),r),r.x+=this.pOCent.x,r.y+=this.pOCent.y,r},this.updateFromCurvature=function(t){var s,n,r,a;this.curvature=function(t){var s=calc.getDistance(i.p,i.p1)/2;(t=calc.getValueBetween(t,-s,s))<=0&&t>=-e?t=-e:t>=0&&t<=e&&(t=e);return t}(t||this.curvature),this.pint90.setPoint((s=this.p,n=this.p1,r=this.curvature,a=calc.getAngle(s,n)+90*calc.DEG2RAD,calc.getVector(r,a,h),h.x+=(s.x+n.x)/2,h.y+=(s.y+n.y)/2,h.x=calc.okrugNumber(h.x),h.y=calc.okrugNumber(h.y),h)),this.p2.setPoint(this.pint90);var o=calc.getCenterCircle(this.p,this.p1,this.p2);o&&this.pOCent.setPoint(o),this.radius=calc.getDistance(this.pOCent,this.p),this.korectPoint2()};var h=new Zt;this.getLengthPoint=function(t,i){i&&(t=new Zt(t.x,t.y),calc.rotationPointByLength(t,i*(this.curvature>0?-1:1),this.pOCent));var e=calc.getLenghtCircle(this.radius,this.pOCent,this.p,t,this.curvature>0),s=this.getLenght();if(e>s){var n=calc.getLenghtCircle(this.radius,this.pOCent);e>s+(n-s)/2&&(e-=n)}return e},this.getPositionByLength=function(t){var i=new Zt(this.p.x,this.p.y);return calc.rotationPointByLength(i,t*(this.curvature>0?-1:1),this.pOCent),i},this.getAngleByPoint=function(t,i){i*=this.curvature>0?-1:1;var e=calc.getCircleCircleIntersectionPoints(this.pOCent,this.radius,t,Math.abs(i)),s=i<0?e[0]:e[1];return calc.getAngle(t,s)},this.getLenght=function(){return calc.getLenghtCircle(this.radius,this.pOCent,this.p,this.p1,this.curvature>0)},this.getCurvatureByWidth=function(t){var i=calc.getCurvatureByWidth(t,this.radius);return null===i&&(i=calc.getCurvatureByWidth(2*this.radius*(t<0?-1:1),this.radius)),(i||0)*(this.curvature<0?-1:1)},this.getWidthByLengthTo=function(t){var i=new Zt(this.radius,0),e=new Zt(this.radius,0);return calc.rotationPointByLength(i,t),calc.getDistance(i,e)},this.getLengthByWidth=function(t){return calc.getLengthByWidth(t,i.getCurvatureByWidth(t))}}function Zi(t){this.otstup=t||50,this.tip=0,this.p=new Zt,this.p1=new Zt,this.p2=new Zt,this.maxp=new Zt,this.maxp1=new Zt,this.maxSp1=new Zt,this.maxp2=new Zt,this.p3=new Zt,this.dist01=0,this.dist12=0,this.p4=new Zt,this.lineRange=new Qi(20),this.lineRange1=new Qi(20),this.angel=0;var i,e;this.restertTip=function(t,s,n,r,h,a){null!=h&&0!==h._offset&&(a=(i=calc.getDistance(s,h.position))<h.delph,this.angel=calc.getAngle(s,n),1!=a?calc.getVector(h._offset,this.angel-Math.PI/2,this.p):calc.getVector(h._offset,this.angel+Math.PI/2,this.p),s.x+=this.p.x,s.y+=this.p.y,n.x+=this.p.x,n.y+=this.p.y,r.x+=this.p.x,r.y+=this.p.y,h.arrPosit[2].y=h.arrPosit[3].y=0,h.arrPosit1[2].y=h.arrPosit1[3].y=0),this.tip=t,0==t&&(this.p.setPoint(s),this.p1.setPoint(n),this.p2.setPoint(r),this.angel=calc.getAngle(s,n),calc.getVector(2e4,this.angel+Math.PI,this.maxp),this.maxp.x+=s.x,this.maxp.y+=s.y,calc.getVector(this.otstup,this.angel,this.maxp1),this.maxp1.x+=n.x,this.maxp1.y+=n.y,this.dist01=calc.getDistance(this.p,this.p1),this.dist12=calc.getDistance(this.p1,this.p2),calc.getVector(2e4,this.angel,this.maxSp1),this.maxSp1.x+=n.x,this.maxSp1.y+=n.y,i=calc.getDistance(this.p1,this.p2),e=calc.getAngle(this.p1,this.p2),calc.getVector(2*i,e,this.p3),this.p3.x+=this.p.x,this.p3.y+=this.p.y),1==t&&(this.dist12=Math.abs(n),null!=r?(this.lineRange.p.setPoint(s.p1),this.lineRange.p1.setPoint(s.p),this.lineRange.p2.setPoint(s.p2),this.lineRange.updateFromCurvature(this.lineRange.getCurrentCurvature()),this.lineRange1.p.setPoint(s.p1),this.lineRange1.p1.setPoint(s.p),this.lineRange1.p2.setPoint(s.p2),this.lineRange1.updateFromCurvature(this.lineRange1.getCurrentCurvature()),this.lineRange.moveLineRange(n)):(this.lineRange.setLR(s),this.lineRange.moveLineRange(n),this.lineRange1.setLR(s)))},this.dragOtstup=function(t){0==this.tip&&(calc.getVector(t,this.angel,this.maxp1),this.maxp1.x+=this.p1.x,this.maxp1.y+=this.p1.y)},this.drawDebag=function(t,i,e){null!=t&&0==this.tip&&(t.dLine(this.p,this.maxp,e),t.dLine(this.p1,this.maxp1,e),t.dLine(this.maxSp1,this.maxp1,e,10),t.dLine(this.p,this.p3,i,10),t.dPoint(this.p3,10,i),t.dLine(this.p,this.p1,i),t.dLine(this.p1,this.p2,i),t.dPoint(this.p,10,i),t.dPoint(this.p1,10,i),t.dPoint(this.p2,10,i))}}function Ki(t){var i,e,s,n,r,h,a;this.setDebug=function(t){t},this.getPeresek=function(t,o){if(0==t.tip&&0==o.tip)return function(t,s){var h=new Ji;if(0==t.tip&&0==s.tip)return h.p.setPoint(t.p1),h.p1.setPoint(t.p1),h.p2.setPoint(t.p2),(r=t.otstup)<2*t.dist12&&(r=2*t.dist12),r<2*s.dist12&&(r=2*s.dist12),t.dragOtstup(r),s.dragOtstup(r),n=calc.getTreeAngel(t.p,t.p1,s.p),314==Math.abs(Math.round(100*n))?(h.p.setPoint(t.p1),h):0==Math.abs(Math.round(100*(t.angel-s.angel)))?(h.p.setPoint(t.p1),h):null!=(i=calc.getPointOfIntersection(t.p,t.maxp1,s.maxp,s.maxp1))?null!=(e=calc.getPointOfIntersection(t.p,t.p1,s.p,s.p3))?(h.p.setPoint(e),h.p1.setPoint(e),h):(h.p.setPoint(i),h.p1.setPoint(i),h):t.dist12>s.dist12&&null!=(i=calc.getPointOfIntersection(t.p,t.maxp,s.p,s.maxp))?(h.p1.setPoint(t.p2),h):null!=(i=calc.getPointOfIntersection(t.p1,t.p2,s.maxp,s.maxp1))?(h.p1.setPoint(i),h.p.setPoint(t.p1),h):null!=(e=calc.getPointOfIntersection(t.p,t.p1,s.p,s.p3))?(h.p.setPoint(e),h.p1.setPoint(e),h):null!=(i=calc.getPointOfIntersection(t.p,t.maxSp1,s.p1,s.p2))?(h.p.setPoint(i),h.p1.setPoint(i),h):null!=(i=calc.getPointOfIntersection(t.p,t.maxSp1,s.p1,s.maxp1))?(h.p.setPoint(i),h.p1.setPoint(i),h):null!=(i=calc.getPointOfIntersection(t.p,t.maxSp1,s.p1,s.maxSp1))?(h.p.setPoint(t.maxp1),h.p1.set((t.maxp1.x+s.maxp1.x)/2,(t.maxp1.y+s.maxp1.y)/2),null!=(e=calc.getPointOfIntersection(t.p1,t.maxp1,s.p1,s.maxp1))&&(h.p1.setPoint(e),h.p.setPoint(e)),h):h}(t,o);if(0==t.tip&&1==o.tip)return function(t,i){var e=Math.min(t.dis/2,i.dis/2),n=new Ji;if(0==t.tip&&1==i.tip){if(n.p.setPoint(t.p),n.p1.setPoint(t.p1),n.p2.setPoint(t.p2),(r=t.otstup)<2*t.dist12&&(r=2*t.dist12),r<2*i.dist12&&(r=2*i.dist12),t.dragOtstup(r),(s=calc.getLineCircleIntersectionPoints(t.maxp1,t.p,i.lineRange.pOCent,i.lineRange.radius)).length>1&&calc.getDistance(n.p1,s[0])>calc.getDistance(n.p1,s[1])&&s.reverse(),0!=s.length&&calc.getDistance(s[0],n.p1)<e)return n.p.setPoint(s[0]),n.p1.setPoint(s[0]),n;n.p.setPoint(t.p1)}return n}(t,o);if(1==t.tip&&0==o.tip)return function(t,i){var e=Math.min(t.dis/2,i.dis/2),n=new Ji;if(1==t.tip&&0==i.tip){if(n.p.setPoint(i.p),n.p1.setPoint(i.p1),n.p2.setPoint(i.p2),(r=i.otstup)<2*t.dist12&&(r=2*t.dist12),r<2*i.dist12&&(r=2*i.dist12),i.dragOtstup(r),(s=calc.getLineCircleIntersectionPoints(i.maxp1,i.p,t.lineRange.pOCent,t.lineRange.radius,!0)).length>1&&calc.getDistance(n.p1,s[0])>calc.getDistance(n.p1,s[1])&&s.reverse(),0!=s.length&&calc.getDistance(s[0],n.p1)<e)return n.p.setPoint(s[0]),n.p1.setPoint(s[0]),n;n.p.setPoint(i.p1)}return n}(t,o);if(1==t.tip&&1==o.tip)return function(t,e){var n=Math.min(t.dis/2,e.dis/2),o=new Ji;if(1==t.tip&&1==e.tip){if((r=e.otstup)<2*t.dist12&&(r=2*t.dist12),r<2*e.dist12&&(r=2*e.dist12),o.p.setPoint(t.lineRange.p),o.p1.setPoint(t.lineRange.p),o.p2.setPoint(t.lineRange1.p),0!=(s=calc.getCircleCircleIntersectionPoints(t.lineRange.pOCent,t.lineRange.radius,e.lineRange.pOCent,e.lineRange.radius)).length){if(1==s.length)return o.p.setPoint(s[0]),o.p1.setPoint(s[0]),o;h=calc.getDistance(o.p2,s[0]),a=calc.getDistance(o.p2,s[1]),h<a?(dis=h,i=s[0]):(dis=a,i=s[1]),dis<t.delph+e.delph&&dis<n&&(o.p.setPoint(i),o.p1.setPoint(i))}t.dist12,e.dist12}return o}(t,o);throw new Error("err type bla="+t.tip+" blaX="+o.tip)}}function qi(){var t,i=!1,e=new Zi(20),s=new Zi(20);this.korektPoint=new Ki(this),this.generateUUID=function(){for(var t=[],i=0;i<256;i++)t[i]=(i<16?"0":"")+i.toString(16);return function(){var i=4294967295*Math.random()|0,e=4294967295*Math.random()|0,s=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return(t[255&i]+t[i>>8&255]+t[i>>16&255]+t[i>>24&255]+"-"+t[255&e]+t[e>>8&255]+"-"+t[e>>16&15|64]+t[e>>24&255]+"-"+t[63&s|128]+t[s>>8&255]+"-"+t[s>>16&255]+t[s>>24&255]+t[255&n]+t[n>>8&255]+t[n>>16&255]+t[n>>24&255]).toUpperCase()}}();i=void 0;this.setDebug=function(t){i=t,this.korektPoint.setDebug(t)},this.getAngle=function(t,i){return i=i||rezNull,t=t||rezNull,Math.atan2(i.y-t.y,i.x-t.x)},this.getDistance=function(t,i){return null==t?0:(null==i&&(i=rezNull),i=i||rezNull,Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2)))};var n,r,h,a=[new THREE.Vector2(0,0),new THREE.Vector2(0,0),new THREE.Vector2(0,0),new THREE.Vector2(0,0),new THREE.Vector2(0,0),new THREE.Vector2(0,0),new THREE.Vector2(0,0),new THREE.Vector2(0,0),new THREE.Vector2(0,0),new THREE.Vector2(0,0),new THREE.Vector2(0,0),new THREE.Vector2(0,0)];this.creatGrani2=function(i,e,s){if(t=i.sten,0==i.storona)if(a[0].x=e.p.x,a[0].y=e.p.y,a[1].x=e.p1.x,a[1].y=e.p1.y,a[2].x=e.p2.x,a[2].y=e.p2.y,a[3].x=s.p2.x,a[3].y=s.p2.y,a[4].x=s.p1.x,a[4].y=s.p1.y,a[5].x=s.p.x,a[5].y=s.p.y,n=i.sten.position1,r=-t._rotation,i.sten.bolPosit1=!0,0==i.sten.tip){for(var h=0;h<6;h++)a[h]=calc.povotorOtAngel(n,a[h],r);for(h=0;h<6;h++)i.sten.arrPosit1[h].set(a[h].x,a[h].y)}else if(1==i.sten.tip)if(i.sten.lineRange.curvature>0)for(h=0;h<6;h++)i.sten.arrPosit1[h].set(a[h].x,a[h].y);else for(h=0;h<6;h++)i.sten.arrPosit1[h].set(a[5-h].x,a[5-h].y);else window.console.warn("непонял как считить  ",i.sten.tip);else if(a[0].x=e.p.x,a[0].y=e.p.y,a[1].x=e.p1.x,a[1].y=e.p1.y,a[2].x=e.p2.x,a[2].y=e.p2.y,a[3].x=s.p2.x,a[3].y=s.p2.y,a[4].x=s.p1.x,a[4].y=s.p1.y,a[5].x=s.p.x,a[5].y=s.p.y,n=i.sten.position,r=-t._rotation,i.sten.bolPosit=!0,0==i.sten.tip){for(h=0;h<6;h++)a[h]=calc.povotorOtAngel(n,a[h],r);for(h=0;h<6;h++)i.sten.arrPosit[h].set(-a[h].x,a[h].y)}else if(1==i.sten.tip)if(i.sten.lineRange.curvature>0)for(h=0;h<6;h++)i.sten.arrPosit[h].set(a[5-h].x,a[5-h].y);else for(h=0;h<6;h++)i.sten.arrPosit[h].set(a[h].x,a[h].y);else window.console.warn("непонял как считить  ",i.sten.tip);0!=i.sten.offset&&(i.sten.arrPosit[2].y=i.sten.arrPosit[3].y=0,i.sten.arrPosit1[2].y=i.sten.arrPosit1[3].y=0)};var o,l,u,c,d,p,f,g=0,x=(new Ji,new Ji),y=new Ji;this.korektSHObject=function(t,i){if(d=(p=t).arrSHron.length,u=p.arrSHron[i],1==d&&(u.sten.korectOffset(),0==u.sten.tip?(f=u.sten.offset,1==u.storona?(u.sten.bolPosit=!1,u.sten.arrPosit[0].set(0,u.sten.delph/2+f),u.sten.arrPosit[1].set(0,u.sten.delph/2+f),u.sten.arrPosit[2].set(0,f),u.sten.arrPosit[3].set(0,f),u.sten.arrPosit[4].set(0,-u.sten.delph/2+f),u.sten.arrPosit[5].set(0,-u.sten.delph/2+f)):(u.sten.bolPosit1=!1,u.sten.arrPosit1[0].set(0,-u.sten.delph/2+f),u.sten.arrPosit1[1].set(0,-u.sten.delph/2+f),u.sten.arrPosit1[2].set(0,f),u.sten.arrPosit1[3].set(0,f),u.sten.arrPosit1[4].set(0,u.sten.delph/2+f),u.sten.arrPosit1[5].set(0,u.sten.delph/2+f))):1==u.sten.tip?1==u.storona?(u.sten.bolPosit=!0,u.sten.arrPosit[0].setPoint(u.sten.lineRange.p),u.sten.arrPosit[1].setPoint(u.sten.lineRange.p),u.sten.arrPosit[2].setPoint(u.sten.lineRange.p),u.sten.arrPosit[3].setPoint(u.sten.lineRange.p),u.sten.arrPosit[4].setPoint(u.sten.lineRange.p),u.sten.arrPosit[5].setPoint(u.sten.lineRange.p)):(u.sten.bolPosit1=!0,u.sten.arrPosit1[0].setPoint(u.sten.lineRange.p1),u.sten.arrPosit1[1].setPoint(u.sten.lineRange.p1),u.sten.arrPosit1[2].setPoint(u.sten.lineRange.p1),u.sten.arrPosit1[3].setPoint(u.sten.lineRange.p1),u.sten.arrPosit1[4].setPoint(u.sten.lineRange.p1),u.sten.arrPosit1[5].setPoint(u.sten.lineRange.p1)):window.console.warn("непонял как считить  ",u.sten.tip)),d>1){var e=0,s=0;e=0==i?p.arrSHron.length-1:i-1,s=i>=p.arrSHron.length-1?0:i+1,l=p.arrSHron[e],u=p.arrSHron[i],c=p.arrSHron[s],l.sten.korectOffset(),u.sten.korectOffset(),c.sten.korectOffset();var n=!1;d>2?(c=p.arrSHron[e],u=p.arrSHron[i],l=p.arrSHron[s]):(l=p.arrSHron[e],u=p.arrSHron[i],c=p.arrSHron[s]),x=this.getLineStan2(u,l,n),n=!n,y=this.getLineStan2(u,c,n),this.creatGrani2(u,x,y)}for(var r=0;r>p.arrSHron.length;r++)(o=p.arrSHron[r]).sten.arrPosit[2].y=0,o.sten.arrPosit[3].y=0,o.sten.arrPosit1[2].y=0,o.sten.arrPosit1[3].y=0},this.getSten2AddPoint=function(t,i){return null!=t.addPoint&&t.addPoint.idArr==i.idArr&&null!=t.addPoint1?t.addPoint1:null!=t.addPoint1&&t.addPoint1.idArr==i.idArr&&null!=t.addPoint?t.addPoint:null};var m=new THREE.Vector3(0,0);this.testAngel=function(t){if((d=t.arrSHron.length)<=1)return null;for(var i=0;i<t.arrSHron.length;i++)for(var e=i+1;e<t.arrSHron.length;e++)if(l=t.arrSHron[i],u=t.arrSHron[e],0==l.storona?(a[0].x=l.sten.position.x,a[0].y=l.sten.position.y,a[1].x=l.sten.position1.x,a[1].y=l.sten.position1.y):(a[0].x=l.sten.position1.x,a[0].y=l.sten.position1.y,a[1].x=l.sten.position.x,a[1].y=l.sten.position.y),0==u.storona?(a[2].x=u.sten.position.x,a[2].y=u.sten.position.y):(a[2].x=u.sten.position1.x,a[2].y=u.sten.position1.y),r=calc.getTreeAngel(a[0],a[1],a[2]),Math.abs(r)>3&&null!=(m=calc.isPointInLin(a[0],a[2],a[1],5,5)))return m;return null},this.getLineStan2=function(t,n,r,o,l){return e.delph=t.sten.delph+(o||0),s.delph=n.sten.delph+(l||0),e.dis=calc.getDistance(t.sten.position,t.sten.position1),s.dis=calc.getDistance(n.sten.position,n.sten.position1),g=5,e.delph/2+1>g&&(g=e.delph+1),s.delph/2+1>g&&(g=s.delph+1),h=1,1==r&&(h=-1),0==t.sten.tip?(0==t.storona?(a[0].x=a[2].x=a[4].x=t.sten.position.x,a[0].y=a[2].y=a[4].y=t.sten.position.y,a[1].x=a[3].x=a[5].x=t.sten.position1.x,a[1].y=a[3].y=a[5].y=t.sten.position1.y):(a[0].x=a[2].x=a[4].x=t.sten.position1.x,a[0].y=a[2].y=a[4].y=t.sten.position1.y,a[1].x=a[3].x=a[5].x=t.sten.position.x,a[1].y=a[3].y=a[5].y=t.sten.position.y),calc.korektToLine(a[0],a[1],0,-e.delph/2*h),e.restertTip(0,a[0],a[1],a[3],t.sten),i&&0!=t.sten.offset&&(i.clearD(),e.drawDebag(i))):1==t.sten.tip?1==r?1==t.storona?t.sten.lineRange.curvature>0?e.restertTip(1,t.sten.lineRange,-e.delph/2):e.restertTip(1,t.sten.lineRange,e.delph/2):t.sten.lineRange.curvature>0?e.restertTip(1,t.sten.lineRange,e.delph/2,!0):e.restertTip(1,t.sten.lineRange,-e.delph/2,!0):1==t.storona?t.sten.lineRange.curvature>0?e.restertTip(1,t.sten.lineRange,e.delph/2):e.restertTip(1,t.sten.lineRange,-e.delph/2):t.sten.lineRange.curvature>0?e.restertTip(1,t.sten.lineRange,-e.delph/2,!0):e.restertTip(1,t.sten.lineRange,e.delph/2,!0):window.console.warn("непонял как считить  ",t.sten.tip),0==n.sten.tip?(0==n.storona?(a[6].x=a[8].x=a[10].x=n.sten.position.x,a[6].y=a[8].y=a[10].y=n.sten.position.y,a[7].x=a[9].x=a[11].x=n.sten.position1.x,a[7].y=a[9].y=a[11].y=n.sten.position1.y):(a[6].x=a[8].x=a[10].x=n.sten.position1.x,a[6].y=a[8].y=a[10].y=n.sten.position1.y,a[7].x=a[9].x=a[11].x=n.sten.position.x,a[7].y=a[9].y=a[11].y=n.sten.position.y),calc.korektToLine(a[6],a[7],0,s.delph/2*h),s.restertTip(0,a[6],a[7],a[9],n.sten)):1==n.sten.tip?1==r?0==n.storona?n.sten.lineRange.curvature>0?s.restertTip(1,n.sten.lineRange,-s.delph/2,!0):s.restertTip(1,n.sten.lineRange,s.delph/2,!0):n.sten.lineRange.curvature>0?s.restertTip(1,n.sten.lineRange,s.delph/2):s.restertTip(1,n.sten.lineRange,-s.delph/2):0==n.storona?n.sten.lineRange.curvature>0?s.restertTip(1,n.sten.lineRange,s.delph/2,!0):s.restertTip(1,n.sten.lineRange,-s.delph/2,!0):n.sten.lineRange.curvature>0?s.restertTip(1,n.sten.lineRange,-s.delph/2):s.restertTip(1,n.sten.lineRange,s.delph/2):window.console.warn("непонял как считить  ",n.sten.tip),this.korektPoint.getPeresek(e,s)}}function Ji(t,i){this.p=t||new $i,this.p1=i||new $i,this.p2=new $i,this.status=0,this.perpendik=!0,this.angel=0,this.set=function(t,i){this.p=t||0,this.p1=i||0}}function $i(t,i,e){this._x=t||0,this._y=i||0,this._z=e||0,this.set=function(t,i,e){this._x=t||0,this._y=i||0,void 0!==e&&(this._z=e)},this.setPoint=function(t){this._x=t.x,this._y=t.y,void 0!==t.z&&(this._z=t.z)},this.getObj=function(){var t={};return t.x=this._x,t.y=this._y,t.z=this._z,t},this.copy=function(){return new $i(this._x,this._y,this._z)}}function te(t){var i=this;this.filterRect=void 0,this.stage=t;var e=new qt;function s(t){return p().filter(c).filter(n,t)}function n(t){return calc.isParalel(this.position,this.position1,t.position,t.position1,3*calc.DEG2RAD)}function r(t,i){return t.addPoint.idArr===i.addPoint.idArr&&t.addPoint1.idArr===i.addPoint1.idArr||t.addPoint.idArr===i.addPoint1.idArr&&t.addPoint1.idArr===i.addPoint.idArr}function h(t,i){for(var e=0;e<i.length;e++)if(r(t,i[e]))return!0}function a(t,i){for(var e=0;e<i.length;e++)if(t.idArr===i[e].idArr)return!0}function o(t,i,e){return e.indexOf(t)===i}this.filterRect=void 0,this.paralelSten=function(t){i.filterRect=void 0,t&&(e.setRect(t.getRect()),i.filterRect=e);var n=function(t,e){for(var s=new DataChangeSp,n=0;n<t.length;n++){var r=i.setPointWalls(t[n].position,i.filterRect,e);s.add(r)}return s}(function(t){for(var i=[],e=0;e<t.length;e++)t[e].addPoint&&i.push(t[e].addPoint),t[e].addPoint1&&i.push(t[e].addPoint1);return i.filter(o)}(s(t)),t),l=function(t){for(var i=[],e=s(t),n=0;n<e.length;n++)for(var h=0;h<e.length;h++)e[n].idArr!==e[h].idArr&&r(e[n],e[h])&&i.push(e[n]);return i}(t);if(l.length<=1)return n;var u=function(t,i){for(var e=[],s=0;s<t.length;s++)a(t[s],i)||-1===e.indexOf(t[s])&&(t[s].rememberState(),t[s].clear(),e.push(t[s]));return e}(l,function(t,i){for(var e=[],s=0;s<t.length;s++)i.idArr!==t[s].idArr&&(h(t[s],e)||e.push(t[s]));return e}(l,t));return n.arrClearSplice=u,n};var l=5;function u(t,i){var e=!0;return e&&t.idArr==i.idArr&&(e=!1),!e||t.addPoint&&t.addPoint1&&i.addPoint&&i.addPoint1||(e=!1),!e||t.addPoint.idArr!=i.addPoint.idArr&&t.addPoint.idArr!=i.addPoint1.idArr||(e=!1),!e||t.addPoint1.idArr!=i.addPoint.idArr&&t.addPoint1.idArr!=i.addPoint1.idArr||(e=!1),e}function c(t){return!!t.life&&!(i.filterRect&&!calc.isIntersectionRect(i.filterRect,t.getRect()))}function d(t){var e=i.stage.spRelief.snappingPoint;i.stage.spRelief.snappingPoint=1,i.stage.spRelief.slitTestPoint(t),i.stage.spRelief.snappingPoint=e}function p(){return i.stage.arrSplice}function f(){return i.stage.arrPoint}function g(t,e){return i.stage.spRelief.getRadiusPoint(t,e)}function x(t,i){var e=[],s=null;if(0==t.tip&&0==i.tip)null!=(s=calc.getPointOfIntersection(t.addPoint.position,t.addPoint1.position,i.addPoint.position,i.addPoint1.position))&&e.push(new Position(s.x,s.y));else if(1==t.tip&&0==i.tip)for(var n=t.lineRange.arrPosit,r=0;r<n.length-1;r++)null!=(s=calc.getPointOfIntersection(n[r],n[r+1],i.addPoint.position,i.addPoint1.position))&&e.push(new Position(s.x,s.y));else if(0==t.tip&&1==i.tip)for(n=i.lineRange.arrPosit,r=0;r<n.length-1;r++)null!=(s=calc.getPointOfIntersection(t.addPoint.position,t.addPoint1.position,n[r],n[r+1]))&&e.push(new Position(s.x,s.y));else if(1==t.tip&&1==i.tip){n=t.lineRange.arrPosit;var h=i.lineRange.arrPosit;for(r=0;r<n.length-1;r++)for(var a=0;a<h.length-1;a++)null!=(s=calc.getPointOfIntersection(h[a],h[a+1],n[r],n[r+1]))&&e.push(new Position(s.x,s.y))}return(t.tip>1||i.tip>1)&&window.console.warn("нужно добавить для этого типа пересечения",t.tip,i.tip),e}this.setIntersectStenPoint=function(t){for(var e=new DataChangeSp,s=this.getPointOfIntersectionSten(t),n=0;n<s.length;n++){var r=i.setPointWalls(s[n],t);e.add(r)}return e},this.getPointOfIntersectionSten=function(t){i.filterRect=t;for(var e=p().filter(c),s=[],n=0;n<e.length;n++)for(var r=n;r<e.length;r++)u(e[n],e[r])&&(s=x(e[n],e[r]).concat(s));return function(t){for(var i=0;i<t.length;i++)for(var e=0;e<t.length;e++)if(i!=e&&calc.getDistance(t[i],t[e])<l){t.splice(i,1),i=0;break}for(var s=-1,i=0;i<t.length;i++)-1!=(s=g(t[i],l))&&t[i].set(f()[s].position.x,f()[s].position.y)}(s),s},this.setPointWalls=function(t,e,s){var n=null,r=new DataChangeSp;i.filterRect=e;var h=i.stage.craetPoint();h.position.set(t.x,t.y);for(var a=p().filter(c).filter(function(t){return null!=t.isPointInLin(h.position,t.delph/4,t.delph/4)&&calc.getDistance(h.position,t.addPoint.position)>l&&calc.getDistance(h.position,t.addPoint1.position)>l}),o=0;o<a.length;o++)a[o].rememberState(),n=a[o].dividedSten(h,!0),r.arrNewSplice.push(n),r.arrDividedSplice.push(a[o]),d(h);return h.clearFree(),r.update(),r}}function ie(t){var i=this;this.type="SpPol",this.tipe="SpPol",this.stage=t,this.par=t,this._life=!0,this.idArr=-1,this._uuid=calc.generateUUID(),this.array=[],this.arrayClass=[];this.addPoint=function(t,i){var e=this.array.length;null!=i&&i<e&&(e=i),this.array.splice(e,0,t),t.addPol(this),this.drag(),this.stage.render()},this.removePoint=function(t){for(var i=0,e=0;e<this.array.length;e++)this.array[e].idArr==t.idArr&&(e,this.array.splice(e,1),t.removePol(this),i++);return 0!=i&&(this.drag(),this.testKill()),this.stage.render(),i},this.drag=function(){},this.clear=function(){for(var t=this.array.length-1;t>=0;t--)this.array[t]&&this.array[t].removePol(this);this.life=!1,this.stage.render()},this.testKill=function(){this.array.length<=2&&this.clear()},this._setAllParam=function(t,e){for(var s=0;s<i.arrayClass.length;s++)t in i.arrayClass[s]&&(i.arrayClass[s][t]=e)}}function ee(t){var i=this;this.type="SpVP",this.tipe="SpVP",this.stage=t,this.par=t,this.idArr=-1,this._life=!0,this._inSten=!1,this.gronVL=void 0,this._uuid=calc.generateRendom(2),this.uuid=this._uuid,this._objInLine=void 0,this.array=[],this.arrayClass=[],this.addObjInLine=function(t){},this.drawpositVP=function(){},this.arrayObj=[],this.addPol=function(t){this.arrayObj.push(t)},this.removePol=function(t){this.arrayObj.push(t)},this.removePol=function(t){for(var i=null,e=0;e<this.arrayObj.length;e++)"SpPolygon"==t.type&&t.uuid==this.arrayObj[e].uuid&&(this.arrayObj.splice(e,1),null==i&&(i=0),i++,t&&t.removePoint&&t.removePoint(this),e=0),"SPLine"==t.type&&t.uuid==this.arrayObj[e].uuid&&(t.removePoint(this),t.clear());return 0==this.arrayObj.length&&this.clear(),this.stage.render(),i};var e=[];this.clear=function(){e.length=0;for(var t=0;t<this.arrayObj.length;t++)e.push(this.arrayObj[t]);for(var i=0;i<this.arrayClass.length;i++)"function"==typeof this.arrayClass[i].clear&&this.arrayClass[i].clear();for(t=this.arrayObj.length-1;t>=0;t--)null!=this.arrayObj[t]&&this.removePol(this.arrayObj[t]);this.life=!1,this.stage.render()},this.drawposit=function(){for(var t=0;t<i.array.length;t++)i.array[t].drawpositVP&&i.array[t].drawpositVP(i);i.drawpositVP()},this.position=new Kt(0,0,0,this.drawposit)}function se(){var t=this;this.type="SpStage",this._delph=20,this.tipPoint="SpPoint",this.tipSplice="Splice",this.arrSplice=[],this.arrPoint=[],this.arrPol=[],this.arrayClass=[],this.arrCreat=[],this.arrClear=[],this.arrClearState=[],this.avp=[],this.objBase=void 0,this.configData={delph:20},this.spUtility=new Wi,this.spCalc=new qi,null==window.calc&&(window.calc=new Wt),window.PositionFun=Kt,window.Position=Zt,window.Rectangle=qt,window.LinePosition=Qt,this.korektSplice=new te(this),this._activMouse=!0,this._pointVisi=!0,this._oporPointVisi=!0,this._visiDimensioOnObj=!1,this.hesh={},this.getPoint=function(t){return new Ut(this)},this.getSplice=function(t){return new Jt(this)},this.getPol=function(t){return new ie(this)},this.getVP=function(t){return new ee(this)},this.render=function(){},this.funUpdateUuid=function(i,e){t.hesh[i]&&(t.hesh[i]!==this&&window.console.error("",t.hesh[i],this),delete t.hesh[i]),t.hesh[e]&&(t.hesh[e]!==this&&window.console.error("этот uuid уже испольузутся",t.hesh[e],this),delete t.hesh[i]),t.hesh[e]=this}}function ne(t,i,e){this._x=t||0,this._y=i||0,this._z=e||0,this.set=function(t,i,e){this._x=t||0,this._y=i||0,void 0!==e&&(this._z=e)},this.setPoint=function(t){this._x=t.x,this._y=t.y,void 0!==t.z&&(this._z=t.z)},this.getObj=function(){var t={};return t.x=this._x,t.y=this._y,t.z=this._z,t},this.copy=function(){return new ne(this._x,this._y,this._z)}}function re(t,i,e,s){this._x=t||0,this._y=i||0,this._z="function"!=typeof e&&e||0,this.fun="function"==typeof e?e:s,this.set=function(t,i,e){this._x=t||0,this._y=i||0,this._z=e||0,this.fun&&this.fun()},this.setPoint=function(t){this._x=t.x,this._y=t.y,this._z=t.z,this.fun&&this.fun()},this.getObj=function(){var t={};return t.x=this._x,t.y=this._y,t.z=this._z,t},this.copy=function(){return new re(this._x,this._y,this._z)}}Gi.prototype={set x(t){this._x=t,this.fun&&this.fun()},get x(){return this._x},set y(t){this._y=t,this.fun&&this.fun()},get y(){return this._y},set z(t){this._z=t,this.fun&&this.fun()},get z(){return this._z}},Xi.prototype=Object.create(Jt.prototype),Xi.prototype.constructor=Xi,Xi.prototype.getObj=function(){var t=Jt.prototype.getObj.call(this);return t.type=this.type,t.windows=this.windows.getObj(),t.sVephPoint=this.sVephPoint.getObj(),t},Xi.prototype.setObj=function(t){Jt.prototype.setObj.call(this,t),void 0!==t.boolHHH&&(this.boolHHH=t.boolHHH),void 0!==t.boolObr&&(this.boolObr=t.boolObr),void 0!==t.sVephPoint&&this.sVephPoint.setObj(t.sVephPoint),void 0!==t.windows&&this.windows.setObj(t.windows)},Xi.prototype.compare=function(t){var i=!0;return Jt.prototype.compare(this,t)||(i=!1),i},Xi.prototype.setSten=function(t){Jt.prototype.setSten.call(this,t)},Xi.prototype.restart=function(){Jt.prototype.restart(this)},Xi.prototype.drag=function(){Jt.prototype.drag.call(this),this.stage.addObjFun(this)},Object.defineProperties(Xi.prototype,{mast:{set:function(t){this._mast!=t&&(this._mast=t,this.sVephPoint.mast=t,this.ss3d.mast=t,this.razmeru.mast=t)},get:function(){return this._mast}},lineOpor:{set:function(t){this._lineOpor!=t&&(this._lineOpor=t,this.ss3d.lineOpor=t)},get:function(){return this._lineOpor}},boolAree:{set:function(t){this._boolAree!=t&&(this._boolAree=t,this.dragMat(),this.par.addObjFun(this))},get:function(){return this._boolAree}},activeVephPoint:{set:function(t){this._activeVephPoint!=t&&(this._activeVephPoint=t,this.sVephPoint.activeVephPoint=t)},get:function(){return this._activeVephPoint}},height:{set:function(t){this._height!==t&&(this._height=t,this._setAllParam("height",this._height))},get:function(){return this._height}},boolMinH:{set:function(t){this._boolMinH!==t&&(this._boolMinH=t,this._setAllParam("boolMinH",this._boolMinH))},get:function(){return this._boolMinH}},active:{set:function(t){this._active!==t&&(this._active=t,this._setAllParam("active",this._active))},get:function(){return this._active}},activMouse:{set:function(t){if(this._activMouse!=t){this._activMouse=t,t?visi3D.event3DArr.addChild(this.cont3dSten):visi3D.event3DArr.removeChild(this.cont3dSten);for(var i=0;i<this.arrayClass.length;i++)"activMouse"in this.arrayClass[i]&&(this.arrayClass[i].activMouse=this._activMouse)}},get:function(){return this._activMouse}},life:{set:function(t){if(this._life!=t){this._life=t;for(var i=0;i<this.arrayClass.length;i++)"life"in this.arrayClass[i]&&(this.arrayClass[i].life=this._life);1==this._life?this.par.content3d.add(this.content3d):(this.boolAree=!0,null!=this.content3d.parent&&this.content3d.parent.remove(this.content3d))}},get:function(){return this._life}}}),Ui.prototype={set active(t){this._active!=t&&(this._active=t,0==this._active?(this.mesh.material=this.mesh.objGlob.stage.cylinderMaterial,this.mesh1.material=this.mesh.objGlob.stage.cylinderMaterial):(this.mesh.material=this.mesh.objGlob.stage.cylinderMaterialActive,this.mesh1.material=this.mesh.objGlob.stage.cylinderMaterialActive))},get active(){return this._active},set mast(t){this._mast!=t&&(this._mast=t,this.mesh1.scale.set(this.size1*this._mast,this.size,this.size1*this._mast))},get mast(){return this._mast},set life(t){this._life!=t&&(this._life=t,this.content3d.visible=t,1==this._life&&(this.activMouse=!0))},get life(){return this._life},set activMouse(t){this._activMouse!=t&&(this._activMouse=t,t?visi3D.event3DArr.addChild(this.content3d):visi3D.event3DArr.removeChild(this.content3d))},get activMouse(){return this._activMouse},set height(t){this._height!=t&&(this._height=t,this.dragHH())},get height(){return this._height}},Yi.prototype=Object.create(Ut.prototype),Yi.prototype.constructor=Yi,Yi.prototype.getObj=function(){var t=Ut.prototype.getObj.call(this);return t.type=this.type,t},Yi.prototype.setObj=function(t){Ut.prototype.setObj.call(this,t)},Object.defineProperties(Yi.prototype,{mast:{set:function(t){this._mast!=t&&(this._mast=t,this.arrayClass[0].mast=this._mast)},get:function(){return this._mast}},lineOpor:{set:function(t){this._lineOpor!=t&&(this._lineOpor=t,this.arrayClass[0].content3dNa.visible=this._lineOpor)},get:function(){return this._lineOpor}},active:{set:function(t){if(this._active!=t){this._active=t;for(var i=0;i<this.arrayClass.length;i++)"active"in this.arrayClass[i]&&(this.arrayClass[i].active=this._active)}},get:function(){return this._active}},height:{set:function(t){if(this._height!=t){this._height=t;for(var i=0;i<this.arrayClass.length;i++)"height"in this.arrayClass[i]&&(this.arrayClass[i].height=this._height)}},get:function(){return this._height}},activMouse:{set:function(t){if(this._activMouse!=t){this._activMouse=t;for(var i=0;i<this.arrayClass.length;i++)"activMouse"in this.arrayClass[i]&&(this.arrayClass[i].activMouse=this._activMouse)}},get:function(){return this._activMouse}},life:{set:function(t){if(this._life!=t){this._life=t;for(var i=0;i<this.arrayClass.length;i++)"life"in this.arrayClass[i]&&(this.arrayClass[i].life=this._life)}},get:function(){return this._life}},mashtabNa:{set:function(t){this._mashtabNa!=t&&(this._mashtabNa=t)},get:function(){return this._mashtabNa}}}),$i.prototype={set x(t){this._x=t},get x(){return this._x},set y(t){this._y=t},get y(){return this._y},set z(t){this._z=t},get z(){return this._z}},ie.prototype={set uuid(t){this._uuid},get uuid(){return this._uuid},getObj:function(){for(var t={array:[]},i=0;i<this.array.length;i++)t.array.push({x:this.array[i].position.x,y:this.array[i].position.y,z:this.array[i].position.z,tipe:this.array[i].tipe,uuid:this.array[i].uuid});return t},setObj:function(t){for(var i=0;i<t.array.length;i++){var e=this.stage.getPointXY(t.array[i]);this.addPoint(e)}this.drag()},set life(t){this._life!=t&&(this._life=t)},get life(){return this._life}},ee.prototype={set life(t){if(this._life!=t){this._life=t;for(var i=0;i<this.arrayClass.length;i++)null!=this.arrayClass[i].life&&(this.arrayClass[i].life=this._life)}},get life(){return this._life},getObj:function(){var t={};return t.uuid=this._uuid,t.position=this.position.getObj(),null!=this.gronVL&&(t.gronVL={},t.gronVL.uuid=this.gronVL.par.uuid,t.gronVL.pros=this.gronVL.pros,t.gronVL.os=this.gronVL.par.os,t.gronVL.bUU=this.gronVL.bUU,t.gronVL.bST=this.gronVL.bST),t},setObj:function(t){if(t.uuid&&(this.uuid=this._uuid=t.uuid),this.position.setPoint(t.position),null!=t.gronVL){var i=this.par.getGronVP(t.gronVL.uuid);if(null!=i){var e=i.add(this);e.pros=t.gronVL.pros,t.gronVL.bUU&&(e.bUU=t.gronVL.bUU,e.bST=t.gronVL.bST)}}}},se.prototype={craetPoint:function(){for(var t=0;t<this.arrPoint.length;t++)if(0==this.arrPoint[t].life)return this.arrPoint[t].life=!0,this.arrPoint[t];var i=this.getPoint();return this.arrPoint.push(i),this.arrPoint[this.arrPoint.length-1].idArr=this.arrPoint.length-1,this.arrPoint[this.arrPoint.length-1]},craetVP:function(){for(var t=0;t<this.avp.length;t++)if(0==this.avp[t].life)return this.avp[t].life=!0,this.avp[t];var i=this.getVP();return this.avp.push(i),this.avp[this.avp.length-1].idArr=this.avp.length-1,this.avp[this.avp.length-1].life=!0,this.avp[this.avp.length-1]},craetSplice1:function(){for(var t=0;t<this.arrSplice.length;t++)if(0==this.arrSplice[t].life)return this.arrSplice[t].life=!0,this.arrSplice[t].delph=this._delph,this.arrSplice[t];var i=this.getSplice();return this.arrSplice.push(i),this.arrSplice[this.arrSplice.length-1].idArr=this.arrSplice.length-1,this.arrSplice[this.arrSplice.length-1].funUpdateUuid=this.funUpdateUuid,this.arrSplice[this.arrSplice.length-1].restart(),this.arrSplice[this.arrSplice.length-1].delph=this._delph,this.hesh[this.arrSplice[this.arrSplice.length-1].uuid]=this.arrSplice[this.arrSplice.length-1],this.arrSplice[this.arrSplice.length-1]},craetSplice11:function(){return this.craetSplice1()},craetSplice:function(t,i){return this.create(t,i)},create:function(t,i){if(t=t||{},!(i=i||t.uuid))return this.craetSplice1();this.hesh[i]||(this.craetSplice1().uuid=i);return t&&this.hesh[i].setObj(t),this.hesh[i]},craetPol:function(t){for(var i=0;i<this.arrPol.length;i++)if(0==this.arrPol[i].life){if(null==t)return this.arrPol[i].life=!0,this.arrPol[i];if(this.arrPol[i].unikName==t)return this.arrPol[i].life=!0,this.arrPol[i]}var e=this.getPol(t);return this.arrPol.push(e),this.arrPol[this.arrPol.length-1].idArr=this.arrPol.length-1,this.hesh[this.arrPol[this.arrPol.length-1].uuid]=this.arrPol[this.arrPol.length-1],this.arrPol[this.arrPol.length-1]},render:function(){},getIdPositon:function(t,i){for(var e=0;e<this.arrPoint.length;e++)if(0!=this.arrPoint[e].life&&calc.testPositPoint(this.arrPoint[e].position,t)&&s(this.arrPoint[e],i))return e;function s(t,i){if(!i)return!0;for(var e=t.getConectedSten(),s=0;s<e.length;s++)if(-1!==i.indexOf(e[s].uuid))return!0;return!1}return-1},getPointXY:function(t){if(t.tipe&&"SpVP"==t.tipe){for(var i=0;i<this.avp.length;i++)if(this.avp[i].life)if(void 0!==t.uuid){if(this.avp[i].uuid===t.uuid)return this.avp[i]}else if(Math.round(t.x)==Math.round(this.avp[i].position.x)&&Math.round(t.y)==Math.round(this.avp[i].position.y)&&Math.round(t.z)==Math.round(this.avp[i].position.z))return this.avp[i];return(e=this.craetVP()).position.setPoint(t),e}for(i=0;i<this.arrPoint.length;i++)if(this.arrPoint[i].life&&Math.round(t.x)==Math.round(this.arrPoint[i].position.x)&&Math.round(t.y)==Math.round(this.arrPoint[i].position.y))return this.arrPoint[i];var e;return(e=this.craetPoint()).position.setPoint(t),e},getGronVP:function(t){return null},stenInPoint:function(t){var i,e=t.connected?t.connected.arr:void 0,s=this.getIdPositon(t.position,e);(i=-1==s?this.craetPoint():this.arrPoint[s]).position.setPoint(t.position),i.addSplice(t,!0),e=t.connected?t.connected.arr1:void 0,(i=-1==(s=this.getIdPositon(t.position1,e))?this.craetPoint():this.arrPoint[s]).position.setPoint(t.position1),i.addSplice(t,!1)},getObj:function(t){var i={};i.type=this.type,i.tipPoint=this.tipPoint,i.tipSplice=this.tipSplice,i.arrPoint=[],i.arrSplice=[],i.arrPol=[],i.avp=[];for(var e=0;e<this.arrPoint.length;e++)this.arrPoint[e].life&&i.arrPoint.push(this.arrPoint[e].getObj());for(e=0;e<this.arrSplice.length;e++)this.arrSplice[e].life&&i.arrSplice.push(this.arrSplice[e].getObj());for(e=0;e<this.avp.length;e++)this.avp[e].life&&i.avp.push(this.avp[e].getObj());for(e=0;e<this.arrPol.length;e++)this.arrPol[e].life&&i.arrPol.push(this.arrPol[e].getObj());return i},setObj:function(t){var i;if(null!=t.tipPoint&&(this.tipPoint=t.tipPoint),null!=t.tipSplice&&(this.tipSplice=t.tipSplice),this.arrCreat.length=0,null!=t.arrSplice)for(var e=0;e<t.arrSplice.length;e++)(i=this.craetSplice()).setObj(t.arrSplice[e]),this.arrCreat.push(i);if(null!=t.avp)for(e=0;e<t.avp.length;e++)(i=this.craetVP()).setObj(t.avp[e]);if(null!=t.arrPol)for(e=0;e<t.arrPol.length;e++)(i=this.craetPol(t.arrPol[e].unik)).setObj(t.arrPol[e]);!function(t){for(var i=0;i<t.length;i++)t[i].clearFree()}(this.arrPoint);for(e=0;e<this.arrPoint.length;e++)this.arrPoint[e].life&&this.arrPoint[e].dragGG()},clear:function(){for(var t=0;t<this.arrPoint.length;t++)this.arrPoint[t].clear();for(t=0;t<this.arrSplice.length;t++)this.arrSplice[t].clear();for(t=0;t<this.arrPol.length;t++)this.arrPol[t].clear();for(t=0;t<this.avp.length;t++)this.avp[t].clear()}},Object.defineProperties(se.prototype,{delph:{set:function(t){this._delph=t},get:function(){return this._delph}}}),ne.prototype={set x(t){this._x=t},get x(){return this._x},set y(t){this._y=t},get y(){return this._y},set z(t){this._z=t},get z(){return this._z}},re.prototype={set x(t){this._x=t,this.fun&&this.fun()},get x(){return this._x},set y(t){this._y=t,this.fun&&this.fun()},get y(){return this._y},set z(t){this._z=t,this.fun&&this.fun()},get z(){return this._z}};function he(t,i){THREE.Object3D.call(this);this.type="BoxHelper",this._width=100,this._height=100,this._depth=100,this._sizeEdge=t||1,this._activeRadius=!1,this.sizeBox=10,this.arrCube=[],this.arrEdge=[],this._visiCube=!1,this._tilshia=5,this._material=i,this._activ=!1,this.boxGeometry=new THREE.BoxBufferGeometry(1,1,1),this.sphereGeometry=new THREE.SphereBufferGeometry(2,12,12),this.ms=new THREE.Mesh(this.sphereGeometry,this._material),this.add(this.ms),this._life=1,this.initCube=function(){for(var t=0;t<8;t++)this.arrCube[t]=new THREE.Mesh(this.boxGeometry1,this._material),this.arrCube[t].scale.x=this.sizeBox,this.arrCube[t].scale.y=this.sizeBox,this.arrCube[t].scale.z=this.sizeBox;this.arrCube[0].name="tm_1",this.arrCube[1].name="tm_1",this.arrCube[2].name="tm_4",this.arrCube[3].name="tm_4",this.arrCube[4].name="tm_2",this.arrCube[5].name="tm_2",this.arrCube[6].name="tm_3",this.arrCube[7].name="tm_3"};for(var e=0;e<12;e++)this.arrEdge[e]=new THREE.Mesh(this.boxGeometry,this._material),this.arrEdge[e].scale.x=this._sizeEdge,this.arrEdge[e].scale.y=this._sizeEdge,this.arrEdge[e].scale.z=this._sizeEdge,this.add(this.arrEdge[e]);this.box=new THREE.Mesh(this.boxGeometry,this.materialBH1),this.add(this.box),this.box.scale.x=this._width,this.box.scale.y=this._depth,this.box.scale.z=this._height,this.box.name="blok",this.box.visible=this._visiCube,this.box.renderOrder=2,this.setRect=function(t,i){t[3]<10||t[5]<10||t[4]<10?this.sizeEdge=.5:this.sizeEdge=2,this.width=t[3],this.position.x=t[0]+t[3]/2,this.height=t[5],this.position.z=t[2]+t[5]/2,this.depth=t[4],this.position.y=t[1]+t[4]/2},this.repositionCube=function(){1==this._visiCube&&(this.arrCube[0]||this.initCube(),this.arrCube[0].position.set(0-this.width/2,0-this.depth/2,0+this.height/2),this.arrCube[1].position.set(0-this.width/2,0+this.depth/2,0+this.height/2),this.arrCube[2].position.set(0-this.width/2,0-this.depth/2,0-this.height/2),this.arrCube[3].position.set(0-this.width/2,0+this.depth/2,0-this.height/2),this.arrCube[4].position.set(0+this.width/2,0-this.depth/2,0+this.height/2),this.arrCube[5].position.set(0+this.width/2,0+this.depth/2,0+this.height/2),this.arrCube[6].position.set(0+this.width/2,0-this.depth/2,0-this.height/2),this.arrCube[7].position.set(0+this.width/2,0+this.depth/2,0-this.height/2)),this.arrEdge[9].position.set(this.width/2,0+this.depth/2,0),this.arrEdge[10].position.set(0+this.width/2,0-this.depth/2,-0),this.arrEdge[2].position.set(0-this.width/2,0-this.depth/2,0),this.arrEdge[1].position.set(0-this.width/2,0+this.depth/2,0),this.arrEdge[8].position.set(this.width/2,this.sizeEdge/2,0+this.height/2),this.arrEdge[4].position.set(this.sizeEdge/2,0-this.depth/2,0+this.height/2),this.arrEdge[0].position.set(0-this.width/2,-this.sizeEdge/2,0+this.height/2),this.arrEdge[5].position.set(-this.sizeEdge/2,0+this.depth/2,0+this.height/2),this.arrEdge[11].position.set(+this.width/2,this.sizeEdge/2,0-this.height/2),this.arrEdge[6].position.set(this.sizeEdge/2,0-this.depth/2,0-this.height/2),this.arrEdge[3].position.set(0-this.width/2,-this.sizeEdge/2,0-this.height/2),this.arrEdge[7].position.set(-this.sizeEdge/2,0+this.depth/2,0-this.height/2)},this.changeSize=function(){this.arrEdge[0].scale.y=this.depth,this.arrEdge[8].scale.y=this.depth,this.arrEdge[3].scale.y=this.depth,this.arrEdge[11].scale.y=this.depth,this.arrEdge[1].scale.z=this.height-this.sizeEdge,this.arrEdge[2].scale.z=this.height-this.sizeEdge,this.arrEdge[9].scale.z=this.height-this.sizeEdge,this.arrEdge[10].scale.z=this.height-this.sizeEdge,this.arrEdge[4].scale.x=this.width,this.arrEdge[5].scale.x=this.width,this.arrEdge[6].scale.x=this.width,this.arrEdge[7].scale.x=this.width,this.box.scale.x=this._width,this.box.scale.y=this._depth,this.box.scale.z=this._height},this.changeSizeEdge=function(){this.arrEdge[4].scale.y=this._sizeEdge,this.arrEdge[5].scale.y=this._sizeEdge,this.arrEdge[6].scale.y=this._sizeEdge,this.arrEdge[7].scale.y=this._sizeEdge,this.arrEdge[4].scale.z=this._sizeEdge,this.arrEdge[5].scale.z=this._sizeEdge,this.arrEdge[6].scale.z=this._sizeEdge,this.arrEdge[7].scale.z=this._sizeEdge,this.arrEdge[1].scale.x=this._sizeEdge,this.arrEdge[2].scale.x=this._sizeEdge,this.arrEdge[9].scale.x=this._sizeEdge,this.arrEdge[10].scale.x=this._sizeEdge,this.arrEdge[1].scale.y=this._sizeEdge,this.arrEdge[2].scale.y=this._sizeEdge,this.arrEdge[9].scale.y=this._sizeEdge,this.arrEdge[10].scale.y=this._sizeEdge,this.arrEdge[0].scale.x=this._sizeEdge,this.arrEdge[8].scale.x=this._sizeEdge,this.arrEdge[3].scale.x=this._sizeEdge,this.arrEdge[11].scale.x=this._sizeEdge,this.arrEdge[0].scale.z=this._sizeEdge,this.arrEdge[8].scale.z=this._sizeEdge,this.arrEdge[3].scale.z=this._sizeEdge,this.arrEdge[11].scale.z=this._sizeEdge,this.ms.scale.set(this._sizeEdge,this._sizeEdge,this._sizeEdge)},Object.defineProperty(this,"life",{set:function(t){this._life!=t&&(this._life=t)},get:function(){return this._life}}),this.life=1,Object.defineProperty(this,"visiCube",{set:function(t){if(this._visiCube!=t){if(this._visiCube=t,null==this.arrCube[0]&&this.initCube(),1==this._visiCube){for(var i=0;i<this.arrCube.length;i++)this.add(this.arrCube[i]);this.repositionCube()}else for(i=0;i<this.arrCube.length;i++)this.remove(this.arrCube[i]);this.repositionCube()}},get:function(){return this._visiCube}}),Object.defineProperty(this,"material",{set:function(t){if(this._material.uuid!=t.uuid){this._material=t,trace("#########@@@@@@",this._material),this.ms.material=this._material;for(var i=0;i<12;i++)this.arrEdge[i].material=this._material}},get:function(){return this._material}}),Object.defineProperty(this,"width",{set:function(t){this._width!=t&&(this._width=t,this.changeSize(),this.repositionCube())},get:function(){return this._width}}),Object.defineProperty(this,"depth",{set:function(t){this._depth!=t&&(this._depth=t,this.changeSize(),this.repositionCube())},get:function(){return this._depth}}),Object.defineProperty(this,"height",{set:function(t){this._height!=t&&(this._height=t,this.changeSize(),this.repositionCube())},get:function(){return this._height}}),Object.defineProperty(this,"sizeEdge",{set:function(t){this._sizeEdge!=t&&(this._sizeEdge=t,this.changeSizeEdge())},get:function(){return this._sizeEdge}}),Object.defineProperty(this,"activ",{set:function(t){this._activ!=t&&(this._activ=t,this.box.visible=t)},get:function(){return this._activ}}),this.repositionCube(),this.changeSize()}he.prototype=Object.create(THREE.Object3D.prototype),he.prototype.constructor=he;class ae{constructor(t,i,e){this.type="Blok";var s=this;this.par=t,this.objBase=i,this.obj=i.obj,this.fun=e,this.worldBlok=null,this.id=i.id,this.icon=mhbd.getLink(i.icon),this.gateau=null,this.heightSten=this.par.par.height,this.typeStr="BInSten",this.typeStr1=this.obj.str[1],this.idArr=-1,this._active=!1,this.sizeLine=this.par.par.sizeLine,this._width=100,this._height=100,this._delph=100,this.boolSten=!0,this.boxHelper=void 0,this._life=!0,this._parent=void 0,this.unik=void 0,this.uuid=calc.generateRendom(2),this._visiBox=this.par._visiBox,this.content3d=new THREE.Object3D,this.cont3d=new THREE.Object3D,this.content3d.add(this.cont3d),this.cont3dL=new THREE.Object3D,this.content3d.objBlok=this,1==window.localS.object.debug&&setTimeout(function(){new Ri(s.content3d,-15,0,""+s.idArr).cont3d.rotation.x=-Math.PI/2},0),this.box=new THREE.Mesh(this.par.boxGeometry,window.pm.matDop.getIDObj(14)),this.cont3d.add(this.box),this.box.layers.set(31),this.boxHelper=new he(2,window.pm.matDop.getIDObj(6)),1==this._visiBox&&this.content3d.add(this.boxHelper),this.funInit=void 0,this.shape=void 0,this.init=function(){this.rect=[this.obj.mod.r[0],this.obj.mod.r[1],this.obj.mod.r[2],this.obj.mod.r[3],this.obj.mod.r[4],this.obj.mod.r[5]],this.coliziStop={x:-9999,y:0,z:0,width:9999,height:9999,depth:122},this.collisionOffset=0,this.inOgr=!0,this.boxColizi=new ai(this.rect[0],this.rect[2],this.rect[3],this.rect[5]),this.boxColizi.parent=this,this.boxColizi.coliziStop=this.coliziStop,this.boxColizi.rectCollisMeshdy.coliziStop=this.coliziStop,this.boxColizi.boolSten=this.boolSten,this.boxCurvColizi=new ai,this.boxCurvColizi.parent=this,this.rectSten={ir:Math.random(),parent:this,x:this.rect[0],y:this.rect[2],width:this.rect[3],height:this.rect[5]},this._width=this.rect[3],this._height=this.rect[5],this._delph=this.rect[4],this.offset=0,this.dragWHD(),null!=this.funInit&&this.funInit()},this.resetSize=function(){},this.clear=function(){null!=this._parent&&this._parent.removeBlok(this),this.life=!1,this.postClear&&this.postClear()},this.fuNsetPosition=void 0,this.vector,this.setPosition=function(t,i,e){null!=t&&(s.boxColizi.position.x=t),null!=i&&(s.boxColizi.position.y=s.heightSten-i),null!=s._parent&&s._parent.onUpdateBlokPosition(s),null!=t&&(this._x=t),null!=i&&(this._y=i),null!=e&&(this._z=e),this.render(),this._active&&this.worldBlok.wbVisiActiv.drag(this),null!=this.fuNsetPosition&&this.fuNsetPosition()},this.tipDrab=0,this._x=0,this._y=0,this._z=0,this.setReal=function(t,i,e){this._x=t,this._y=i,this._z=e,this._parent&&this._parent.drawDeb&&this._parent.drawDeb()},this.drag=function(){},s.funDO2=void 0,this.dragObj2=function(){s._parent&&(s.content3d.position.x=s.boxColizi.rectCollisMeshdy.x-s.rect[0],s.content3d.position.z=-s.heightSten+(s.boxColizi.rectCollisMeshdy.y-s.rect[2])),s.funDO2&&s.funDO2(),this.render()},this.redrahHHH=function(t,i){},this.copy=function(){var t=this.par.par.worldBlok.getBlok(this.obj.id);t.init();var i=this.getObj();return i.x+=i.width,t.setObj(i),t},this.render=function(){s._parent&&(s._parent.renderDo(),visi3D.intRend=1)},this.dragWHD=function(t,i,e){void 0!==t&&(this._width=t,this._height=i,this._delph=e),this.box.scale.set(this.rect[3],this.rect[5],this.rect[4]),this.boxHelper&&this.dragObjHA(this.boxHelper,this.rect)},this.dragObjHA=function(t,i){i[3]>0&&i[4]>0&&i[5]>0&&(t.width=i[3],t.position.x=i[0]+i[3]/2,t.depth=i[4],t.position.y=i[1]+i[4]/2,t.height=i[5],t.position.z=-i[2]-i[5]/2)},this.funSetObj=void 0,this.funGetObj=void 0;var n={};n.type=this.type,n.obj=this.obj,n.par=this,this.getInfo=function(t){t.push(n)},this.getInfoObj=function(t){let i={};return i.width=this._width,i.height=this._height,i.delph=this._delph,i.x=s.boxColizi.rectCollisMeshdy.x,i.y=s.heightSten-s.boxColizi.rectCollisMeshdy.y,i},this.drawGateau=function(t){},this.funDrahParent=void 0,this.drahParent=function(){void 0!==s.funDrahParent&&s.funDrahParent()},this.funMouseUp=void 0,this.funMouseDown=void 0,this.setObj=function(t){t.uuid&&(this.uuid=t.uuid),this.width=t.w||t.width,this.height=t.h||t.height,this.delph=t.d||t.delph,t.rotBool&&(this.rotBool=t.rotBool),this.setPosition(t.x,t.y,t.z),this.funSetObj&&this.funSetObj(t),this.dragWHD()},this.getObj=function(){var t={};return t.id=this.id,t.x=this._x,t.y=this._y,t.z=this._z,t.width=this._width,t.height=this._height,t.delph=this._delph,t.rotBool=this._rotBool,this.funGetObj&&this.funGetObj(t),t},this.drawActive=void 0,this.funBoolMax=void 0}set boolMax(t){this._boolMax!=t&&(this._boolMax=t,null!=this.funBoolMax&&this.funBoolMax())}get boolMax(){return this._boolMax}set active(t){this._active!=t&&(this._active=t,this.boxHelper.material=1==t?window.pm.matDop.getIDObj(7):window.pm.matDop.getIDObj(6),this.par.render(),null!=this.drawActive&&this.drawActive())}get active(){return this._active}set width(t){this._width!=t&&(this._width=t,this.rect[3]=t,this.boxColizi.width=t,this.rect[0]=-t/2,this.boxColizi.x=-t/2,this.dragWHD(),this.boxColizi.position.x=this._x)}get width(){return this._width}set height(t){this._height!=t&&(this._height=t,this.rect[5]=t,this.boxColizi.height=t,this.rect[2]=-t/2,this.boxColizi.y=-t/2,this.boxColizi.sy=-t/2,this.dragWHD(),this.boxColizi.position.x=this._x)}get height(){return this._height}set delph(t){this._delph!=t&&(this._delph=t,this.rect[4]=t,this.dragWHD())}get delph(){return this._delph}set visiBox(t){this._visiBox!=t&&(this._visiBox=t,1==this._visiBox?this.content3d.add(this.boxHelper):this.content3d.remove(this.boxHelper))}get visiBox(){return this._visiBox}set life(t){this._life!=t&&(this._life=t,null!=this._parent&&null!=this._parent.removeBlok&&this._parent.removeBlok(this))}get life(){return this._life}set parent(t){this._parent!=t&&(this.parentOld=this._parent,this.render(),this._parent=t,this._active&&this.worldBlok.wbVisiActiv.drag(this),null==t?(this._life=!1,this.boolMax=void 0):(this._life=!0,this._parent.sizeLine&&(this.sizeLine=this._parent.sizeLine),this.boolMax=this._parent.boolMax),this.par.render(),null!=this.postParent&&this.postParent())}get parent(){return this._parent}}class oe extends ae{constructor(t,i,e){super(t,i,e),this.type="BInSten";var s=this;this.par=t,this.amDelph=!1,this.c3d=void 0,this.funInit=function(){1==this.obj.bool[0]&&(this.amDelph=!0,this.width=220),pm.getId(this.obj.id,function(t){s.c3d=t,s.content3d.add(t),s.c3d&&(s.c3d.notEvent=!s.bEvewnt),s.dragWHD(),visi3D.intRend=1})},this.bEvewnt=!0,this.dONotEvent=function(t){trace(this.bEvewnt,t),this.bEvewnt=t,s.c3d&&(s.c3d.notEvent=this.bEvewnt),this.boxHelper.notEvent=this.bEvewnt},this.dragWHD=function(t,i,e){if(void 0!==t&&(this._width=t,this._height=i,this._delph=e),this.box.scale.set(this.rect[3],20,this.rect[5]),s.c3d){let t=this.rect[3]/this.obj.mod.r[3],i=this.rect[4]/this.obj.mod.r[4],n=this.rect[5]/this.obj.mod.r[5];if(s.c3d.scale.set(t,i,n),!1!==this.amDelph){e=this.obj.mod.r[5]*i;s.c3d.position.y=10-e}}this.dragObjHA(this.boxHelper,this.rect)},this.dragObjHA=function(t,i){!1===this.amDelph?i[3]>0&&i[4]>0&&i[5]>0&&(t.width=i[3],t.position.x=i[0]+i[3]/2,t.depth=i[4],t.position.y=i[1]+i[4]/2,t.height=i[5],t.position.z=-i[2]-i[5]/2):i[3]>0&&i[4]>0&&i[5]>0&&(t.width=i[3],t.position.x=i[0]+i[3]/2,t.depth=i[4],t.position.y=-(i[1]+i[4]/2),t.height=i[5],t.position.z=-i[2]-i[5]/2)},this.postParent=function(){1==s.amDelph&&(s.delph=100)},this.drawActive=function(){},this.drawGateau=function(t){},this.redrahHHH=function(t,i){},this.funSetObj=function(t){},this.funGetObj=function(t){},this.setColorObjects=function(t,i,e,s){},this.dragp20Color=function(t,i,e){},this.postClear=function(){}}set delph(t){this._delph!=t&&(this._delph=t,this.rect[4]=t,this.dragWHD())}get delph(){return this._delph}}class le extends ae{constructor(t,i,e){super(t,i,e),this.type="BInLes";var s,n,r,h,a=this;this.par=t,this.cont3dMod=new THREE.Object3D,this.content3d.add(this.cont3dMod),this.cont3d.rotation.x=-Math.PI/2,this.amDelph=!1,this.praoo=1e3,this.prase=1e3,this.c3d=void 0,this.funInit=function(){pm.getId(this.obj.id,function(t){a.c3d=t,a.c3d.position.y=a.rect[2],a.cont3d.add(t),a.dragWHD(),a.dragModel(),a.setOnMat(t),visi3D.intRend=1})},this.init=function(){this.boolSten=!1,this.rect=[this.obj.mod.r[0],0,-this.obj.mod.r[4]/2,this.obj.mod.r[3],this.obj.mod.r[5],this.obj.mod.r[4]],this.coliziStop={x:-9999,y:0,z:0,width:9999,height:9999,depth:122},this.collisionOffset=0,this.inOgr=!0,this.boxColizi=new ai(this.rect[0],this.rect[2],this.rect[3],this.rect[5]),this.boxColizi.parent=this,this.boxColizi.coliziStop=this.coliziStop,this.boxColizi.rectCollisMeshdy.coliziStop=this.coliziStop,this.boxColizi.boolSten=this.boolSten,this.boxCurvColizi=new ai,this.boxCurvColizi.parent=this,this.rectSten={ir:Math.random(),parent:this,x:this.rect[0],y:this.rect[2],width:this.rect[3],height:this.rect[5]},this._width=this.rect[3],this._height=this.rect[5],this._delph=this.rect[4],this.offset=0,this.dragWHD(),null!=this.funInit&&this.funInit()},this._bool=!1,this._sah=0,this._bLaft=!0,this.funDO2=function(){s=a.content3d.position.z-a.rect[2],Math.round(s)>=1?a.bool=!1:a.bool=!0},this.postParent=function(){1==a.amDelph&&(a.delph=100)},this.dragModel=function(){if(this.prase=1e3,1==this._bool&&(this.prase=.654*this.prase),0==a._sah&&(this.prase=1.254*this.prase),2==a._sah&&(this.prase=1.378*this.prase),null!=a.c3d){n=this.getName(a.c3d,"blok0_"),r=this.getName(a.c3d,"blok1_"),1==this._bool?(n.visible=!1,r.visible=!0):(n.visible=!0,r.visible=!1),null==h&&((h=[])[0]=a.getName(n,"verh",!0),h[1]=a.getName(r,"verh00"),h[2]=a.getName(n,"verh0_"),h[3]=a.getName(r,"verh0_"),h[4]=a.getName(n,"verh1_"),h[5]=a.getName(r,"verh1_"));for(var t=0;t<3;t++)t==a._sah?(h[2*t].visible=!0,h[2*t+1].visible=!0):(h[2*t].visible=!1,h[2*t+1].visible=!1);visi3D.intRend=1}},this.setOnMat=function(t){if(t.material){let i=1;t.material.name&&"matXZ1_"==t.material.name&&(i=1),t.material.name&&"matXZ2_"==t.material.name&&(i=2),t.material.name&&"matXZ3_"==t.material.name&&(i=3),t.material=window.pm.matDop.getIDObj(19+i)}if(t.children)for(var i=0;i<t.children.length;i++)this.setOnMat(t.children[i])},this.getName=function(t,i,e){if(t.name)if(e){if(t.name==i)return t}else if(-1!==t.name.indexOf(i))return t;if(t.children)for(var s=0;s<t.children.length;s++){if(null!=this.getName(t.children[s],i))return t.children[s]}return null},this.dragWHD=function(t,i,e){void 0!==t&&(this._width=t,this._height=i,this._delph=e),this.content3d.position.y=-90,this.box.scale.set(this.rect[3],this.rect[5],this.rect[4]),this.boxHelper&&(this.dragObjHA(this.boxHelper,this.rect),this.boxHelper.position.y=0)},this.postParent=function(){1==a.amDelph&&(a.delph=100)},this.funSetObj=function(t){t.plus&&(this.bool=t.plus.bool,this.bLaft=t.plus.bLaft,this.sah=t.plus.sah)},this.funGetObj=function(t){t.plus={},t.plus.bool=this._bool,t.plus.bLaft=this._bLaft,t.plus.sah=this._sah}}set bool(t){this._bool!=t&&(this._bool=t,this.dragModel())}get bool(){return this._bool}set sah(t){this._sah!=t&&(this._sah=t,this.dragModel())}get sah(){return this._sah}set bLaft(t){this._bLaft!=t&&(this._bLaft=t,this.dragModel())}get bLaft(){return this._bLaft}set delph(t){this._delph!=t&&(this._delph=t,this.dragWHD())}get delph(){return this._delph}}class ue{constructor(t,i){this.type="WorldBlok";this.par=t,this.fun=i,this._mast=this.par._mast,this._activeObject=null,this._visiBox=!1,this.uuid=calc.generateRendom(2),this.boxGeometry=new THREE.BoxGeometry(1,1,1),this.array=[],this.content3d=new THREE.Object3D,this.par.content3d.add(this.content3d),this.wbVisiActiv=new ce(this),this.sobBlok=function(t,i,e){},this.getBlok=function(t){let i=mhbd.getKeyId("objects3d",t);null==i.obj&&void 0!==i.json&&(i.obj=i.json);for(var e=0;e<this.array.length;e++)if(1!=this.array[e].life&&this.array[e].id==t)return this.array[e];let s=void 0;return"BInSten"==i.json.str[0]&&(s=new oe(this,i,this.sobBlok)),"BInLes"==i.json.str[0]&&(s=new le(this,i,this.sobBlok)),null==s&&(s=new ae(this,i,this.sobBlok)),s.worldBlok=this,s.idArr=this.array.length,this.array.push(s),s},this.render=function(){this.par.render()}}set activeObject(t){if(this._activeObject!==t){this._activeObject=t;for(var i=0;i<this.array.length;i++)this._activeObject&&this._activeObject.uuid==this.array[i].uuid?this._activeObject.active=!0:this.array[i].active=!1;this.wbVisiActiv.activeObject=t}}get activeObject(){return this._activeObject}set activeMouse(t){if(this._activeMouse!=t){this._activeMouse=t;for(var i=0;i<this.array.length;i++)this.array[i].activeMouse=t}}get activeMouse(){return this._activeMouse}set visiBox(t){if(this._visiBox!=t){this._visiBox=t;for(var i=0;i<this.array.length;i++)this.array[i].visiBox=t}}get visiBox(){return this._visiBox}set mast(t){if(this._mast!=t){this._mast=t,this.wbVisiActiv.mast=t;for(var i=0;i<this.array.length;i++)this.array[i].mast=t}}get mast(){return this._mast}}class ce{constructor(t,i){this.type="WBVisiActiv";this.par=t,this._mast=t._mast,this.fun=i,this._activeObject=null,this.content3d=new THREE.Object3D,this.content3d.position.z=10,this.array=[];for(var e,s=window.pm.matDop.getIDObj(7),n=0;n<4;n++){let t=new Bi(this.content3d,function(t,i){},null,s,s,s,s,s);t.idArr=n,this.array.push(t),t.bRotation=!0,t.otstup=2,t.mast=this._mast*facade._mastYmn}this.array[2].bRotation=!1,this.array[2].bRotZ=1,this.array[3].bRotation=!1,this.array[3].bRotZ=3,this.drag=function(t){this.move(t)};var r={x:0,y:0},h={x:0,y:0},a=[];this.korekt=function(){null!=this.blok.parent?(this.content3d.visible=!0,this.array[0].content3d.rotation.x=-Math.PI/2,this.array[0].content3d.rotation.z=Math.PI,r.x=this.blok.boxColizi.rectCollisMeshdy.x,r.y=h.y=this.blok._y,h.x=-99999,0!==(a=this.blok.parent.collision.colozi.collLine.getRey(r,h,this.blok.heightSten,[this.blok.boxColizi.rectCollisMeshdy])).length?(e=r.x-a[0].x,Math.abs(a[0].x)<.01&&(e+=this.razmeru.xx),this.array[0].content3d.position.x=r.x+this.razmeru.xx,this.array[0].content3d.position.z=-r.y,this.array[0].distans=e,this.array[0].content3d.visible=e>20):this.array[0].content3d.visible=!1,this.array[1].content3d.rotation.x=-Math.PI/2,this.array[1].content3d.rotation.z=Math.PI,r.x=this.blok.boxColizi.rectCollisMeshdy.x+this.blok.boxColizi.rectCollisMeshdy.width,r.y=h.y=this.blok._y,h.x=99999,0!==(a=this.blok.parent.collision.colozi.collLine.getRey(r,h,this.blok.heightSten,[this.blok.boxColizi.rectCollisMeshdy])).length?(e=a[0].x-r.x,Math.abs(a[0].x-this.blok.parent.par._distans)<.01?(e+=this.razmeru.xx1,this.array[1].content3d.position.x=a[0].x+this.razmeru.xx+this.razmeru.xx1):this.array[1].content3d.position.x=a[0].x+this.razmeru.xx,this.array[1].content3d.position.z=-r.y,this.array[1].distans=e,this.array[1].content3d.visible=e>20):this.array[1].content3d.visible=!1,this.array[2].content3d.rotation.x=-Math.PI/2,this.array[2].content3d.rotation.z=Math.PI/2,h.x=r.x=this.blok.boxColizi.rectCollisMeshdy.x+this.blok.boxColizi.rectCollisMeshdy.width/2,r.y=this.blok.heightSten-this.blok.boxColizi.rectCollisMeshdy.y,h.y=r.y+99999,0!==(a=this.blok.parent.collision.colozi.collLine.getRey(r,h,this.blok.heightSten,[this.blok.boxColizi.rectCollisMeshdy])).length?(e=a[0].y-r.y,this.array[2].content3d.position.x=r.x+this.razmeru.xx,this.array[2].content3d.position.z=-r.y,this.array[2].distans=e,this.array[2].content3d.visible=e>20):this.array[2].content3d.visible=!1,this.array[3].content3d.rotation.x=-Math.PI/2,this.array[3].content3d.rotation.z=-Math.PI/2,h.x=r.x=this.blok.boxColizi.rectCollisMeshdy.x+this.blok.boxColizi.rectCollisMeshdy.width/2,r.y=this.blok.heightSten-this.blok.boxColizi.rectCollisMeshdy.y-this.blok.boxColizi.rectCollisMeshdy.height,h.y=r.y-99999,0!==(a=this.blok.parent.collision.colozi.collLine.getRey(r,h,this.blok.heightSten,[this.blok.boxColizi.rectCollisMeshdy])).length?(e=r.y-a[0].y,this.array[3].content3d.position.x=r.x+this.razmeru.xx,this.array[3].content3d.position.z=-r.y,this.array[3].distans=e,this.array[3].content3d.visible=e>20):this.array[3].content3d.visible=!1):this.content3d.visible=!1},this.razmeru,this.move=function(t){this.blok=t,this.blok?null==t.parent?null!=this.content3d.parent&&this.content3d.parent.remove(this.content3d):(null==this.content3d.parent&&(this.razmeru=t.parent.par.razmeru,this.razmeru.content3d.add(this.content3d)),this.content3d.parent.uuid!=t.parent.par.razmeru.content3d.uuid&&(this.razmeru=t.parent.par.razmeru,this.razmeru.content3d.add(this.content3d)),this.korekt()):null!=this.content3d.parent&&this.content3d.parent.remove(this.content3d)}}set mast(t){if(this._mast!==t){this._mast=t;for(var i=0;i<this.array.length;i++)this.array[i].mast=t}}get mast(){return this._mast}set activeObject(t){this._activeObject!==t&&(this._activeObject=t,this.drag(this._activeObject))}get activeObject(){return this._activeObject}}class de{constructor(t,i){this.type="SSP3D";this.par=t,this._active=!1,this.content3d=new THREE.Object3D,this.par.content3d.add(this.content3d),this.cont3d=new THREE.Object3D,this.content3d.add(this.cont3d),this.cont3dL=new THREE.Object3D,this.content3d.add(this.cont3dL),this.planeXZ=new fi,this.lineSegments=new THREE.LineSegments(this.planeXZ,this.par.par.lineBasicMaterial1),this.cont3dL.add(this.lineSegments)}set active(t){this._active!=t&&(this._active=t)}get active(){return this._active}set life(t){this._life!=t&&(this._life=t)}get life(){return this._life}}class pe{constructor(t){this.type="GraniXZ";var i,e;this.par=t,this.cont3d=new THREE.Object3D,this.par.cont3d.add(this.cont3d),this.array=[],this.arrayCech=[],this.boolZ=!0,this.gateau,this.addGateau=function(t){let s=!1;if(this.array.length!=t.array.length&&(s=!0),0==s)for(var n=0;n<this.array.length;n++)if(0==this.array[n].isTovar(t.array[n])){s=!0;break}if(1==s){this.clear(),e=0;for(n=0;n<t.array.length;n++)(i=this.getBlock(t.array[n].tovar.id)).active=!0,i.depth=t.delph,i.setdoTovar(t.array[n],e),this.array.push(i),e+=i.hhh}return this.gateau=t,s},this.clear=function(){this.array.length=0;for(var t=0;t<this.arrayCech.length;t++)this.arrayCech[t].active=!1},this.getBlock=function(t){for(var i=0;i<this.arrayCech.length;i++)if(0==this.arrayCech[i].active&&this.arrayCech[i].idTovar==t)return this.arrayCech[i];for(i=0;i<this.arrayCech.length;i++)if(0==this.arrayCech[i].active)return this.arrayCech[i];return this.arrayCech.push(new fe(this)),this.arrayCech[this.arrayCech.length-1]},this.upData=function(t){for(var i=0;i<this.array.length;i++)this.array[i].upData(t)}}}class fe{constructor(t){this.type="GXZBlock";this._active=!1,this.par=t;for(var i=new Float32Array(9),e=0;e<9;e++)i[e]=Math.random();var s,n=new Float32Array(6),r=new Float32Array(9);this.depth=100,this.hhh=111,this.z=0,this.z1=100,this.u=0,this.u1=1,this._material=p20.mat,this.geom=new THREE.BufferGeometry,this.geom.setAttribute("position",new THREE.BufferAttribute(i,3)),this.mesh3d=new THREE.Mesh(this.geom,this._material),this.mesh3d.castShadow=!0,this.mesh3d.receiveShadow=!0,this.idTovar=-1,this.doTovar=void 0,this.isTovar=function(t){return!1},this.setdoTovar=function(t,i){this.doTovar=t,this.idTovar=t.tovar.id,this.hhh=t.tovar.depth2,this.z1=this.depth-i,this.z=this.depth-(i+this.hhh),(s=p20Gateau.getMatToTovar(t.tovar))&&s.uuid&&s.uuid!==this._material.uuid&&(this._material=s,this.mesh3d.material=this._material)},this.upData=function(t){this.updateMesh(t)};var h,a,o=[],l=[],u=[];this.updateMesh=function(t){o.length=0,l.length=0,u.length=0;for(var e=0;e<t.length;e++)0==e?this.upM(t[t.length-1].position,t[e].position):this.upM(t[e-1].position,t[e].position);if(0!=o.length){for(o.length!==i.length&&(i=new Float32Array(o.length),n=new Float32Array(l.length),r=new Float32Array(u.length),this.geom.deleteAttribute("normal"),this.geom.deleteAttribute("position"),this.geom.deleteAttribute("uv"),this.geom.setAttribute("position",new THREE.BufferAttribute(i,3)),this.geom.setAttribute("uv",new THREE.BufferAttribute(n,2)),this.geom.setAttribute("normal",new THREE.BufferAttribute(r,3))),e=0;e<o.length;e++)i[e]=o[e];for(e=0;e<l.length;e++)n[e]=l[e];for(e=0;e<u.length;e++)r[e]=u[e];this.geom.attributes.normal.needsUpdate=!0,this.geom.attributes.position.needsUpdate=!0,this.geom.attributes.uv.needsUpdate=!0,this.geom.computeBoundingBox(),this.geom.computeBoundingSphere(),this.geom.computeVertexNormals()}},this.upM=function(t,i){1==this.par.boolZ?(h=t.z,a=i.z):(h=0,a=0),o.push(t.x,t.y,-(h+this.z1)),o.push(t.x,t.y,-(h+this.z)),o.push(i.x,i.y,-(a+this.z)),l.push(0,this.u1),l.push(0,this.u),l.push(1,this.u),u.push(0,0,0),u.push(0,0,0),u.push(0,0,0),o.push(t.x,t.y,-(h+this.z1)),o.push(i.x,i.y,-(a+this.z)),o.push(i.x,i.y,-(a+this.z1)),l.push(0,this.u1),l.push(1,this.u),l.push(1,this.u1),u.push(0,0,0),u.push(0,0,0),u.push(0,0,0),o.push(t.x,t.y,-(h+this.z)),o.push(t.x,t.y,-(h+this.z1)),o.push(i.x,i.y,-(a+this.z)),l.push(0,this.u),l.push(0,this.u1),l.push(1,this.u),u.push(0,0,0),u.push(0,0,0),u.push(0,0,0),o.push(i.x,i.y,-(a+this.z)),o.push(t.x,t.y,-(h+this.z1)),o.push(i.x,i.y,-(a+this.z1)),l.push(1,this.u),l.push(0,this.u1),l.push(1,this.u1),u.push(0,0,0),u.push(0,0,0),u.push(0,0,0)}}set active(t){this._active!=t&&(this._active=t,1==t?this.par.cont3d.add(this.mesh3d):this.par.cont3d.remove(this.mesh3d))}get active(){return this._active}}class ge{constructor(t,i){this.type="PubBase";var e=this;this.par=t,this.fun=i,this._active=!1,this._sloiPoliUnik="null",this._alpha=1,this._idPosit=0,this._zdvigZ=0;var s=!1,n=new Float32Array(9),r=new Float32Array(6),h=new Float32Array(9);this.geom=new THREE.BufferGeometry,this.geom.setAttribute("position",new THREE.BufferAttribute(n,3));var a,o,l=new Float32Array(9);new Float32Array(6),new Float32Array(9);this.geom1=new THREE.BufferGeometry,this.geom1.setAttribute("position",new THREE.BufferAttribute(l,3)),this.matBase=pm.matDop.getIDObj(10),this._material=pm.matDop.getIDObj(11),this._material1=pm.matDop.getIDObj(9),this.cont3d=this.par.ssP3d.cont3d,this.cont3dL=this.par.ssP3d.cont3dL,this.mesh3d=new THREE.Mesh(this.geom,this._material),this.mesh3d.castShadow=!0,this.mesh3d.receiveShadow=!0,this.cont3d.add(this.mesh3d),this.mesh3d1=new THREE.Mesh(this.geom1,this._material1),this.mesh3d1.castShadow=!0,this.mesh3d1.receiveShadow=!0,this.cont3d.add(this.mesh3d1),this.graniXZ=new pe(this),this.boolNova=!1,visi3D.objShadow(this.cont3d),this.keyG=t.key,this.uuidDin="null",this.objDin=null,this._delph=1,this.arrKye=["gateauRoofPol","gateauOverlapPol","gateauScreedPol"],this.draw1Color=function(t,i){},this.drawOD=function(t,i){trace(">>od,b ^^ ",t,i),null==i&&(i=!1),this.uuidDin==t.uuid&&1!=i||(this.uuidDin=t.uuid,this.objDin=t,this.objDin.mat&&this.objDin.mat.uuid!==this._material.uuid&&(this.material=this.objDin.mat),this.objDin.mat1&&this.objDin.mat1.uuid!==this._material1.uuid&&(this.material1=this.objDin.mat1),this._delph=this.objDin.delph,a=100,o=100,this.objDin.tovarFace&&this.objDin.tovarFace.d3Width&&(a=this.objDin.tovarFace.d3Width,o=this.objDin.tovarFace.d3Height),this.par.rect.w=a,this.par.rect.h=o,this.graniXZ.addGateau(t),this.par.dragNaTriang(),this.draw1())},this.setColorNova=function(t,i,e){trace(">>setColorNova ^^ ",t,i,e),this.boolNova=!0,this.drawOD(i,e)};var u=[],c=[],d=[];this.updateMesh=function(){u.length=0,c.length=0,d.length=0;for(var t=0;t<this.triangulateShape.lTri;t++)this.upM(this.triangulateShape.aTri[t],0-this.par._delph);if(0!=u.length){for(u.length===n.length&&0!=s||(s=!0,n=new Float32Array(u.length),r=new Float32Array(c.length),h=new Float32Array(d.length),this.geom.deleteAttribute("normal"),this.geom.deleteAttribute("position"),this.geom.deleteAttribute("uv"),this.geom.setAttribute("position",new THREE.BufferAttribute(n,3)),this.geom.setAttribute("uv",new THREE.BufferAttribute(r,2)),this.geom.setAttribute("normal",new THREE.BufferAttribute(h,3))),t=0;t<u.length;t++)n[t]=u[t];for(t=0;t<c.length;t++)r[t]=c[t];for(t=0;t<d.length;t++)h[t]=d[t];this.geom.attributes.normal.needsUpdate=!0,this.geom.attributes.position.needsUpdate=!0,this.geom.attributes.uv.needsUpdate=!0,this.geom.computeBoundingBox(),this.geom.computeBoundingSphere(),this.geom.computeVertexNormals()}},this.upM=function(t,i){u.push(t.p1.x,t.p1.y,t.p1.z+i),u.push(t.p.x,t.p.y,t.p.z+i),u.push(t.p2.x,t.p2.y,t.p2.z+i),c.push(t.p1.u,t.p1.v),c.push(t.p.u,t.p.v),c.push(t.p2.u,t.p2.v),d.push(0,0,0,0,0,0,0,0,0)};this.updateMesh1=function(){},this.upM1=function(t,i,e,s,n){e.push(t.p.x,t.p.y,t.p.z+i),e.push(t.p1.x,t.p1.y,t.p1.z+i),e.push(t.p2.x,t.p2.y,t.p2.z+i),s.push(t.p.u,t.p.v),s.push(t.p1.u,t.p1.v),s.push(t.p2.u,t.p2.v),n.push(0,0,0,0,0,0,0,0,0)},this.draw2d=function(){},this.postActive=void 0,this.tween=void 0,this.animat=function(t){null==this.tween&&(this.tween=new TWEEN.Tween(this.graphics),this.tween.onUpdate(function(){e.par.par.render()})),this.graphics.alpha=0,this.tween.to({alpha:1},t).start()},this.clear=function(){this._alpha=1,0!=this.boolNova&&(this.boolNova=!1,this.objDin=this.par.gateauObj[this.keyG],this.par.draw1Color(this.par.key)),this._idPosit=0,this._zdvigZ=0,this.postClear&&this.postClear()},this.getObj=function(){var t={};return"null"!=this.uuidDin&&this.par.gateauObj[this.keyG].uuid!==this.uuidDin&&(t.gateau=p20Gateau.getSaveObj(this.objDin)),t.idPosit=this.idPosit,t.zdvigZ=this.zdvigZ,this.posGetObj&&this.posGetObj(t),t},this.setObj=function(t){return this.posSetObj&&this.posSetObj(t),null!=t.idPosit&&(this.idPosit=t.idPosit,this.zdvigZ=t.zdvigZ),this.boolNova=!1,t&&null!=t.gateau&&(this.boolNova=!0,p20Gateau.korektGateau(t.gateau),this.setColorNova(this.keyG,t.gateau,!0)),null}}set sloiPoliUnik(t){}get sloiPoliUnik(){return this._sloiPoliUnik}set active(t){if(this._active!=t){if(this._active=t,1==this._active){for(var i=0;i<this.par.array.length;i++)this.par.array[i].upChild(!0);null!=this.par.cont2dVerh.parent&&this.par.cont2dVerh.parent.addChild(this.par.cont2dVerh),null!=this.par.content2d.parent&&this.par.content2d.parent.addChild(this.par.content2d)}null!=this.postActive&&this.postActive()}}get active(){return this._active}set idPosit(t){this._idPosit!=t&&(this._idPosit=t)}get idPosit(){return this._idPosit}set zdvigZ(t){this._zdvigZ!=t&&(this._zdvigZ=t)}get zdvigZ(){return this._zdvigZ}}function xe(t,i,e){this.x=t,this.y=i,this.z=e}xe.prototype.set=function(t,i,e){this.x=t,this.y=i,this.z=e},xe.prototype.setPoint=function(t){this.x=t.x,this.y=t.y,this.z=t.z};
//!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!overlap//перекрытия
class ye extends ge{constructor(t,i){super(t,i),this.type="PubOverlap";var e=this;this.par=t,this.par.boolRezolka=!1,this.triangulateShape=this.par.triangulateShape,this._boolT=!1,this._boolAree=!1,this._text="",this._delph=1,this.kol=0,this.arrPoint=[],this.draw3d=function(){if(this.par.array.length>=2){this.par.ssP3d.lineSegments.visible=!0,this.par.ssP3d.planeXZ.clearPoint(),this.kolPointDrag();for(var t=0;t<this.kol;t++)t!=this.kol-1?this.par.ssP3d.planeXZ.addLine(this.arrPoint[t],this.arrPoint[t+1]):this.par.ssP3d.planeXZ.addLine(this.arrPoint[t],this.arrPoint[0]);this.par.ssP3d.planeXZ.upDate()}else this.par.ssP3d.lineSegments.visible=!1},this.kolPointDrag=function(){this.kol=this.par.array.length;for(var t=0;t<this.par.array.length;t++)null==this.arrPoint[t]&&(this.arrPoint[t]=new THREE.Vector3),this.arrPoint[t].x=this.par.array[t].position.x,this.arrPoint[t].y=this.par.array[t].position.y,this.arrPoint[t].z=0},this.draw1=function(){this.draw3d(),this.par._delph=this._delph,0==this._idPosit&&(this.cont3d.position.z=this._delph-this._zdvigZ,this.cont3dL.position.z=this._zdvigZ),1==this._idPosit&&(this.cont3d.position.z=this._zdvigZ,this.cont3dL.position.z=this._zdvigZ),2==this._idPosit&&(this.cont3d.position.z=-this._zdvigZ,this.cont3dL.position.z=-this._zdvigZ),3==this._idPosit&&(this.cont3d.position.z=this._delph-this._zdvigZ,this.cont3dL.position.z=-this._zdvigZ),this.cont3d.visible=this.par.par._boolMax,this.cont3dL.visible=!this.par.par._boolMax,1==this.par.par._boolMax?this.drawBig():(this.drawLittel(),this.par.par.addObjFun1(this.par))},this.kol=0,this.arrPoint=[],this.drawLittel=function(){if(this.par.array.length>=2){this.par.ssP3d.lineSegments.visible=!0,this.par.ssP3d.planeXZ.clearPoint(),this.kolPointDrag();for(var t=0;t<this.kol;t++)t!=this.kol-1?this.par.ssP3d.planeXZ.addLine(this.arrPoint[t],this.arrPoint[t+1]):this.par.ssP3d.planeXZ.addLine(this.arrPoint[t],this.arrPoint[0]);this.par.ssP3d.planeXZ.upDate()}else this.par.ssP3d.lineSegments.visible=!1},this.drawBig=function(){this.updateMesh(),this.updateMesh1(),this.graniXZ.upData(this.par.array)},this.dragText=function(){setTimeout(function(){e.compText1.x=-e.compText1.width/2,e.compText2.x=-e.compText2.width/2},10)},this.postClear=function(){this._boolT=!1,this._boolAree=!1,this._text="",this._color="#86d1d8"},this.posGetObj=function(t){t.color=this._color,t.boolT=this._boolT,t.boolAree=this._boolAree,t.text=this._text},this.posSetObj=function(t){t.text&&(this.text=t.text),t.color&&(this.color=t.color),t.boolT&&(this.boolT=t.boolT),t.boolAree&&(this.boolAree=t.boolAree)}}set material(t){this._material=t}get material(){return this._material}set material1(t){this._material1=t}get material1(){return this._material1}set color(t){this._color=t}get color(){return this._color}set text(t){this._text=t,this.compText1.text=t,this.compText1.x=-this.compText1.width/2,this.dragText()}get text(){return this._text}set boolT(t){this._boolT=t}get boolT(){return this._boolT}set boolAree(t){this._boolAree=t}get boolAree(){return this._boolAree}}function me(){var t=this;this.segment={x:.5,y:.5,width:100,height:100,rotation:0},this.arrPoint=[],this.arrTriangle=[],this.arrTriangleBig=[],this.arrPosition=[],this.arrUV=[],this.lengthUV=0,this.lengthPosition=0,this.lengthTriangle=0,this.lTri=0,this.aTri=[],this.centerShape=new ve,this.centerShape1=new ve,this.areaShape=0,this._bound={min:new ve,max:new ve,center:new ve};var i,e,s,n,r,h,a,o=new ve,l=new ve,u=[0,0,this.segment.width,this.segment.height],c=[new ve,new ve,new ve,new ve,new ve,new ve,new ve,new ve,new ve],d=0,p=new ve;function f(i,e){return calc.getAngle(t._bound.center,i)-calc.getAngle(t._bound.center,e)}this.start=function(i){t.lengthUV=0,t.lengthTriangle=0,t.lengthPosition=0,this.centerShape1.x=0,this.centerShape1.y=0;for(var e=[],s=0;s<i.length;s++)e.push(new ve(i[s].x,i[s].y,i[s].z)),this.centerShape1.x+=i[s].x,this.centerShape1.y+=i[s].y;if(this.centerShape1.x=this.centerShape1.x/i.length,this.centerShape1.y=this.centerShape1.y/i.length,0!==this.segment.rotation)for(s=0;s<e.length;s++)calc.rotationPoint(e[s],-this.segment.rotation);if(t.arrPoint=e,t.areaShape=t.area(t.arrPoint),t.areaShape){t.getCenterShape();for(s=0;s<t.arrTriangleBig.length;s++)t.segmentationTriangle(t.arrTriangleBig[s]);if(0!==this.segment.rotation){var n=new ve;for(s=0;s<t.arrPosition.length;s+=3)n.set(t.arrPosition[s],t.arrPosition[s+1]),calc.rotationPoint(n,this.segment.rotation),t.arrPosition[s]=n.x,t.arrPosition[s+1]=n.y}this.lTri=0;var r=0;for(s=0;s<t.lengthPosition;s+=9)null==this.aTri[this.lTri]&&(this.aTri[this.lTri]={p:{x:0,y:0,z:0,u:0,v:0},p1:{x:0,y:0,z:0,u:0,v:0},p2:{x:0,y:0,z:0,u:0,v:0}}),this.aTri[this.lTri].p.x=t.arrPosition[s],this.aTri[this.lTri].p.y=t.arrPosition[s+1],this.aTri[this.lTri].p.z=t.arrPosition[s+2],this.aTri[this.lTri].p.u=t.arrUV[r],this.aTri[this.lTri].p.v=t.arrUV[r+1],this.aTri[this.lTri].p1.x=t.arrPosition[s+3],this.aTri[this.lTri].p1.y=t.arrPosition[s+4],this.aTri[this.lTri].p1.z=t.arrPosition[s+5],this.aTri[this.lTri].p1.u=t.arrUV[r+2],this.aTri[this.lTri].p1.v=t.arrUV[r+3],this.aTri[this.lTri].p2.x=t.arrPosition[s+6],this.aTri[this.lTri].p2.y=t.arrPosition[s+7],this.aTri[this.lTri].p2.z=t.arrPosition[s+8],this.aTri[this.lTri].p2.u=t.arrUV[r+4],this.aTri[this.lTri].p2.v=t.arrUV[r+5],r+=6,this.lTri++}},this.getCenterShape=function(i){t.arrPoint=i||t.arrPoint,t.arrTriangleBig.length=0,t.arrTriangleBig=t.triangulate(t.arrPoint),t.updateCenterShape()},this.updateCenterShape=function(){var i=0,e=0;t.centerShape.set(0,0);var s=t.convex(t.arrPoint);if(0===s||-1===s)for(var n=0;n<t.arrTriangleBig.length;n++)i<(e=t.area(t.arrTriangleBig[n]))&&(i=e,t.centerShape.x=(t.arrTriangleBig[n][0].x+t.arrTriangleBig[n][1].x+t.arrTriangleBig[n][2].x)/3,t.centerShape.y=(t.arrTriangleBig[n][0].y+t.arrTriangleBig[n][1].y+t.arrTriangleBig[n][2].y)/3);else{for(n=0;n<t.arrPoint.length;n++)t.centerShape.x+=t.arrPoint[n].x,t.centerShape.y+=t.arrPoint[n].y;t.centerShape.x/=t.arrPoint.length,t.centerShape.y/=t.arrPoint.length}},this.segmentationTriangle=function(i){s=this.getBound(this.arrPoint),n=(s.min.x-s.min.x%this.segment.width-2*this.segment.width||0)+this.segment.x*this.segment.width,r=(s.min.y-s.min.y%this.segment.height-2*this.segment.height||0)+this.segment.y*this.segment.height,h=(s.max.x-s.max.x%this.segment.width+2*this.segment.width||500)+this.segment.x*this.segment.width,a=(s.max.y-s.max.y%this.segment.height+2*this.segment.height||500)+this.segment.y*this.segment.height,u[2]=this.segment.width,u[3]=this.segment.height;for(var o=n;o<h;o+=this.segment.width)for(var l=r;l<a;l+=this.segment.height){u[0]=o,u[1]=l,e=t.triangulate(t.getArrPointTriangleSegment(i,u),!1);for(var c=0;c<e.length;c++){t.arrTriangle[t.lengthTriangle++]=e[c];for(var d=0;d<e[c].length;d++)t.generatePointUV(e[c][d],u),t.arrPosition[t.lengthPosition++]=e[c][d].x,t.arrPosition[t.lengthPosition++]=e[c][d].y,t.arrPosition[t.lengthPosition++]=0}}},this.getArrPointTriangleSegment=function(e,s){for(var n=c,r=0;r<n.length;r++)n[r].x=n[r].y=1/0;d=0;for(r=0;r<3;++r)o.x=s[0],o.y=s[1],l.x=s[0]+s[2],l.y=s[1],(i=calc.getPointOfIntersection(o,l,e[r],e[(r+1)%3]))&&(t.inArr(n,i)||n[d++].setPoint(i)),o.x=s[0]+s[2],o.y=s[1],l.x=s[0]+s[2],l.y=s[1]+s[3],(i=calc.getPointOfIntersection(o,l,e[r],e[(r+1)%3]))&&(t.inArr(n,i)||n[d++].setPoint(i)),o.x=s[0]+s[2],o.y=s[1]+s[3],l.x=s[0],l.y=s[1]+s[3],(i=calc.getPointOfIntersection(o,l,e[r],e[(r+1)%3]))&&(t.inArr(n,i)||n[d++].setPoint(i)),o.x=s[0],o.y=s[1],l.x=s[0],l.y=s[1]+s[3],(i=calc.getPointOfIntersection(o,l,e[r],e[(r+1)%3]))&&(t.inArr(n,i)||n[d++].setPoint(i)),o.x=s[0],o.y=s[1],l.x=s[0]+s[2],l.y=s[1]+s[3],t.pointInSegment(e[r],o,l)&&(t.inArr(n,e[r])||n[d++].setPoint(e[r]));return o.x=s[0],o.y=s[1],calc.isInTriangle(e[0],e[1],e[2],o)&&(t.inArr(n,o)||n[d++].setPoint(o)),o.x=s[0]+s[2],o.y=s[1],calc.isInTriangle(e[0],e[1],e[2],o)&&(t.inArr(n,o)||n[d++].setPoint(o)),o.x=s[0]+s[2],o.y=s[1]+s[3],calc.isInTriangle(e[0],e[1],e[2],o)&&(t.inArr(n,o)||n[d++].setPoint(o)),o.x=s[0],o.y=s[1]+s[3],calc.isInTriangle(e[0],e[1],e[2],o)&&(t.inArr(n,o)||n[d++].setPoint(o)),n=n.slice(0,d),t.getBound(n),n.sort(f),n},this.inArr=function(t,i){for(var e=0;e<t.length;++e)if(t[e].x===i.x&&t[e].y===i.y)return!0;return!1},this.getBound=function(t){this._bound.min.set(999999,999999),this._bound.max.set(-999999,-999999);for(var i=0;i<t.length;i++)this._bound.min.x=Math.min(this._bound.min.x,t[i].x),this._bound.max.x=Math.max(this._bound.max.x,t[i].x),this._bound.min.y=Math.min(this._bound.min.y,t[i].y),this._bound.max.y=Math.max(this._bound.max.y,t[i].y);return this._bound.center.set(this._bound.max.x/2+this._bound.min.x/2,this._bound.max.y/2+this._bound.min.y/2),this._bound},this.pointInSegment=function(t,i,e){return i.x<=t.x&&t.x<=e.x&&i.y<=t.y&&t.y<=e.y},this.generatePointUV=function(i,e){i.x===e[0]?p.x=0:i.x===e[0]+e[2]?p.x=1:p.x=(i.x-e[0])%t.segment.width/t.segment.width,i.y===e[1]?p.y=0:i.y===e[1]+e[3]?p.y=1:p.y=(i.y-e[1])%t.segment.height/t.segment.height,t.arrUV[t.lengthUV++]=p.x,t.arrUV[t.lengthUV++]=p.y},this.convex=function(t){var i,e,s,n,r=t.length,h=0;if(r<3)return 0;for(i=0;i<r;i++)if(s=(i+2)%r,n=(t[e=(i+1)%r].x-t[i].x)*(t[s].y-t[e].y),(n-=(t[e].y-t[i].y)*(t[s].x-t[e].x))<0?h|=1:n>0&&(h|=2),3===h)return-1;return 0!=h?1:0},this.area=function(t){for(var i=t.length,e=0,s=i-1,n=0;n<i;s=n++)e+=t[s].x*t[n].y-t[n].x*t[s].y;return.5*e},this.snip=function(t,i,e,s,n,r){var h,a,o,l,u,c,d,p,f,g,x,y,m,v,b,w,_;if(a=t[r[i]].x,o=t[r[i]].y,l=t[r[e]].x,u=t[r[e]].y,c=t[r[s]].x,d=t[r[s]].y,Number.EPSILON>(l-a)*(d-o)-(u-o)*(c-a))return!1;for(g=c-l,x=d-u,y=a-c,m=o-d,v=l-a,b=u-o,h=0;h<n;h++)if(p=t[r[h]].x,f=t[r[h]].y,!(p===a&&f===o||p===l&&f===u||p===c&&f===d)&&(w=v*(f-o)-b*(p-a),_=y*(f-d)-m*(p-c),g*(f-u)-x*(p-l)>=-Number.EPSILON&&_>=-Number.EPSILON&&w>=-Number.EPSILON))return!1;return!0},this.triangulate=function(i,e){var s=i.length;if(s<3)return[];var n,r,h,a=[],o=[],l=[];if(t.area(i)>0)for(r=0;r<s;r++)o[r]=r;else for(r=0;r<s;r++)o[r]=s-1-r;var u=s,c=2*u;for(r=u-1;u>2;){if(c--<=0)return e?l:a;if(u<=(n=r)&&(n=0),u<=(r=n+1)&&(r=0),u<=(h=r+1)&&(h=0),t.snip(i,n,r,h,u,o)){var d,p,f,g,x;for(d=o[n],p=o[r],f=o[h],a.push([i[d],i[p],i[f]]),l.push([o[n],o[r],o[h]]),g=r,x=r+1;x<u;g++,x++)o[g]=o[x];c=2*--u}}return e?l:a}}function ve(t,i,e){this.x=t,this.y=i,this.z=e}function be(t,i){ie.call(this,t);var e=this;this.type="SpPolygon",this.tipe="SpPolygon",this.area1=0,this._sloiPoliUnik="null",this.unikName="PUnikBase",null!=i&&(this.unikName=i),this.stage=t,this.par=t,this._boolText=!0,this._active=!1,this.idUi=Math.round(1e3*Math.random()),this.sUi=-1,this._offset=0,this._bChaz=!1,this._active=!1,this._height1=this.par._height1,this._delph=5,this.gateauObj=this.par.gateauObj,this._uuid=calc.generateRendom(2),this.uuidDin="null",this.objDin=null,this.arrKye=["gateauRoofPol","gateauOverlapPol","gateauScreedPol"],this.key="gateauRoofPol",this.triangulateShape=new me,this.arrayClass=[],this.content3d=new THREE.Object3D,this.par.content3dPol.add(this.content3d),this.content3d.position.z=-2,1==this.par.param.mobile&&(this.content3d.position.z=-20),this.ssP3d=new de(this),this.boolRezolka=!0,this.unik=new ye(this),this.content3d.objClik=this,this.draw1=function(){null!=this.unik.doD1&&this.unik.doD1(),this.dragRect(),this.dragNaTriang(),this.unik.draw1()},this.dragTime=function(){this.draw1()},this.drag=function(){e.par.addObjFun(e)},this.dragPost=function(){this.draw1()};var s=[];this.clear=function(){s.length=0;for(var t=this.array.length-1;t>=0;t--)s[t]=this.array[t];for(t=this.array.length-1;t>=0;t--)this.array[t]&&this.array[t].removePol(this);for(t=0;t<s.length;t++)s[t].clear();this.life=!1,this.stage.render(),this.unik.clear()};var n;this.rectBig={x:0,y:0,z:0,x1:0,y1:0,z1:0,w:0,h:0,d:0,o:null},this.dragRect=function(){this.rectBig.x=99999999999,this.rectBig.y=99999999999,this.rectBig.x1=-29999999999,this.rectBig.y1=-29999999999;for(var t=0;t<this.array.length;t++)this.rectBig.x>this.array[t].position.x&&(this.rectBig.x=this.array[t].position.x),this.rectBig.x1<this.array[t].position.x&&(this.rectBig.x1=this.array[t].position.x),this.rectBig.y>this.array[t].position.y&&(this.rectBig.y=this.array[t].position.y),this.rectBig.y1<this.array[t].position.y&&(this.rectBig.y1=this.array[t].position.y),this.rectBig.z>this.array[t].position.z&&(this.rectBig.z=this.array[t].position.z),this.rectBig.z1<this.array[t].position.z&&(this.rectBig.z1=this.array[t].position.z);this.rectBig.w=this.rectBig.x1-this.rectBig.x,this.rectBig.h=this.rectBig.y1-this.rectBig.y,this.rectBig.d=this.rectBig.z1-this.rectBig.z},this.rect={x:0,y:0,w:100,h:100},this.arrPKesh=[],this.arrPosition=[],this.arrTiang=[],this.shTr,this.rrr=0,this.hhh=1,this.dragNaTriang=function(){this.arrPosition.length=0;for(var t=0;t<this.array.length;t++)null==this.arrPKesh[t]&&(this.arrPKesh[t]=new THREE.Vector3),this.arrPKesh[t].set(1*this.array[t].position.x,1*this.array[t].position.y,1*this.array[t].position.z),this.arrPosition.push(this.arrPKesh[t]);this.triangulateShape.segment.x=this.rect.x,this.triangulateShape.segment.y=this.rect.y,this.triangulateShape.segment.width=this.rect.w,this.triangulateShape.segment.height=this.rect.h*this.hhh,this.triangulateShape.segment.rotation=0,this.triangulateShape.start(this.arrPosition),this.area1=Math.abs(this.triangulateShape.areaShape)/this.hhh;var i=this.triangulateShape.arrTriangleBig;n=0;for(t=0;t<i.length;t++)null==this.arrTiang[n]&&(this.arrTiang[n]=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3]),this.arrTiang[n][0].set(i[t][0].x,i[t][0].y,-i[t][0].z),this.arrTiang[n][1].set(i[t][1].x,i[t][1].y,-i[t][1].z),this.arrTiang[n][2].set(i[t][2].x,i[t][2].y,-i[t][2].z),n++,this.shTr=n;0!==this.rrr&&1==p20.boolMax&&(this.triangulateShape.segment.rotation=this.rrr,this.triangulateShape.start(this.arrPosition))},this.isRect=function(t,i){},this.isRect=function(t,i){if(1==calc.isRectS(t,this.rectBig))for(var e=0;e<this.array.length;e++)if(1==calc.isRectPoint(t,this.array[e].position))return this;return null},this.setColorNova=function(t,i,e){this.unik.setColorNova(t,i,e)},this.draw1Color=function(t,i){if(this.unik.draw1Color){if(this.key!==t)return;this.unik.draw1Color(t,i)}},this.drawGateau=function(t){},this.draw1Color(this.unik.keyG),this.animat=function(t){this.unik.animat(t)};var r={};r.type=this.type,this.getInfo=function(t){r.idArr=this.idArr,r.square=this.area1,r.obj=this,this.unik.objDin&&(r.objDin=this.unik.objDin),t.push(r)},this.sloiPoliUnik=this.par._sloiPoliUnik}ve.prototype.set=function(t,i,e){this.x=t,this.y=i,this.z=e},ve.prototype.setPoint=function(t){this.x=t.x,this.y=t.y,this.z=t.z},be.prototype=Object.create(ie.prototype),be.prototype.constructor=be,be.prototype.getObj=function(){var t=ie.prototype.getObj.call(this);return t.unik=this.unikName,this.unik.getObj&&(t.oUnik=this.unik.getObj()),t},be.prototype.setObj=function(t){ie.prototype.setObj.call(this,t),this.unik.setObj&&this.unik.setObj(t.oUnik)},be.prototype.compare=function(t){var i=!0;return ie.prototype.compare(this,t)||(i=!1),i},be.prototype.setSten=function(t){ie.prototype.setSten.call(this,t)},be.prototype.restart=function(){ie.prototype.restart(this)},be.prototype.drag=function(){ie.prototype.drag.call(this),this.stage.addObjFun(this)},Object.defineProperties(be.prototype,{life:{set:function(t){if(this._life!=t){this._life=t;for(var i=0;i<this.arrayClass.length;i++)"life"in this.arrayClass[i]&&(this.arrayClass[i].life=this._life);this.ssP3d.life=this._life,this.content3d.visible=this._life}},get:function(){return this._life}},active:{set:function(t){this._active!==t&&(this._active=t,this.cont2dVerh.visible=this._active,this.unik&&null!=this.unik.active&&(this.unik.active=t),this._setAllParam("active",this._active))},get:function(){return this._active}},height1:{set:function(t){this._height1!==t&&(this._height1=t,this._setAllParam("height1",this._height1))},get:function(){return this._height1}},sloiPoliUnik:{set:function(t){this._sloiPoliUnik!=t&&(this._sloiPoliUnik=t,this.unik&&(this.unik.sloiPoliUnik=t))},get:function(){return this._sloiPoliUnik}}});class we{constructor(t,i,e,s,n,r){this.type="TComp3But";this.c3d=t,this.fun=i,this.gB=e,e||(this.gB=new THREE.BoxBufferGeometry(10,10,10)),this.gB1=s,s||(this.gB1=new THREE.BoxBufferGeometry(1,10,1)),this._material=n||new THREE.MeshBasicMaterial({color:16711680}),this._material1=r||new THREE.MeshBasicMaterial({color:65280}),this._life=!0,this._otstup=10,this._otstupZ=3,this._scale=5,this.content3d=new THREE.Object3D,this.c3d.add(this.content3d),this.content3d.objGlob=this,this.button=null,this.button1=null,this.button2=null,this.drag=function(){this.button.drag(),this.button1.drag(),this.button2.drag()},this.arrButton=[],this.init=function(){this.button=new Pe(this,this.gB,this._material,this._material1,0),this.button1=new _e(this,this.gB1,this._material,this._material1,1),this.button2=new _e(this,this.gB1,this._material,this._material1,2),this.button.idArr=0,this.button1.idArr=1,this.button2.idArr=2,this.arrButton.push(this.button,this.button1,this.button2),this.button.scale=this._scale,this.button1.scale=this._scale,this.button2.scale=this._scale},this.dragO=function(){let t=this.button1._z-this.button2._z;0==t&&(t=.001),this.button.dist=t,this.button.dragScale()},this.init()}set scale(t){this._scale!=t&&(this._scale=t,this.button.scale=this._scale,this.button1.scale=this._scale,this.button2.scale=this._scale)}get scale(){return this._scale}set life(t){this._life!=t&&(this._life=t,this._life?this.c3d.add(this.content3d):this.c3d.remove(this.content3d))}get life(){return this._life}}class _e{constructor(t,i,e,s,n){this.type="TCBut";this.notZbros=!1,this._z=0,this._active=!1,this.tip=n,this.par=t,this.gB=i,this.mat=e,this.mat1=s,this.content3d=new THREE.Object3D,this.par.content3d.add(this.content3d),this.content3d1=new THREE.Object3D,this.content3d.add(this.content3d1),this.mesh=new THREE.Mesh(i,e),this.content3d1.add(this.mesh),this.mesh.button=this,this.dist=52,this.s2=.1,this.drag=function(){0==n||(this.content3d.position.z=-this._z,this.par.dragO())},this.dragScale=function(){0==n&&(this.mesh.rotation.x=-Math.PI/2,this.mesh.scale.set(this._scale*this.s2,this.dist,this._scale*this.s2),this.mesh.position.z=-this.par.button1._z+this.dist/2),1==n&&(this.mesh.rotation.x=-Math.PI/2,this.mesh.position.z=-this._scale/2,this.mesh.scale.set(this._scale,this._scale,this._scale)),2==n&&(this.mesh.rotation.x=Math.PI/2,this.mesh.position.z=this._scale/2,this.mesh.scale.set(this._scale,this._scale,this._scale))}}set active(t){this._active!=t&&(1==this.notZbros&&(t=!0),this._active=t,0==this._active?this.mesh.material=this.mat:this.mesh.material=this.mat1,visi3D.intRend=1)}get active(){return this._active}set z(t){this._z!=t&&(this._z=t,this.content3d.position.z=-this._z-this.par._otstupZ,this.drag())}get z(){return this._z}set scale(t){this._scale!=t&&(this._scale=t,this.dragScale())}get scale(){return this._scale}}class Pe extends _e{constructor(t,i,e,s,n){super(t,i,e,s,n),this.type="TCBut0"}set z(t){this._z!=t&&(this._z=t)}get z(){return this._z}}class Se{constructor(t,i){this.type="TC3Big";this.par=t,this.fun=i,this._mastYmn=1.5,this._mast=this.par._mast,this._visible=!1,this.content3d=new THREE.Object3D,this.par.content3d.add(this.content3d),this.content3d.visible=this._visible,this.cont3d=new THREE.Object3D,this.content3d.add(this.cont3d),this.cont3d1=new THREE.Object3D,this.cont3d.add(this.cont3d1),this.cont3d1.objGlob=this,this.cont3d2=new THREE.Object3D,this.cont3d.add(this.cont3d2),this.mesh=new THREE.Mesh(this.par.boxGeometry,window.pm.matDop.getIDObj(7)),this.mesh.layers.set(31),this.par.content3dBox.add(this.mesh),this.metoduRofa=new Te(this),this.metoduStan=new Ae(this),this.rectSten={x:0,x1:0,x2:0,y:0,y1:0,y2:0,w:0,h:0},this.tComp3But2=new we(this.cont3d1,function(t,i){},this.par.cylinderGeometry,this.par.coneGeometry,window.pm.matDop.getIDObj(6),window.pm.matDop.getIDObj(7)),this.tComp3But2.scale=30*this._mast,this.tComp3But2.gronPoint=this,this._mast=this.par._mast,this._fontSize=14,this.tLabel=new Ri(this.cont3d2,10,0,"-"),this.tLabel1=new Ri(this.cont3d2,10,0,"-"),this.tLabel.fontSize=this._fontSize*this.par._mast,this.tLabel1.fontSize=this._fontSize*this.par._mast,this.tLabel1.cont3d.rotation.x=-Math.PI/2,this.tLabel.cont3d.rotation.x=-Math.PI/2,this.bool0=!1,this.startDrag=function(){this.dragRect(),this.bool0=!1,this.rectSten.d>0&&(this.bool0=!0);for(var t=0;t<this.par.arrSplice.length;t++)if(1==this.par.arrSplice[t].life)for(var i=0;i<this.par.arrSplice[t].sVephPoint.array.length;i++){if(!this.bool0){this.par.arrSplice[t].sVephPoint.array[i].point.pz=0,this.par.arrSplice[t].sVephPoint.array[i].point.pz1=0;continue}let e=(this.par.arrSplice[t].sVephPoint.array[i].point.y-this.rectSten.z)/this.rectSten.d;1==isNaN(e)&&(e=0),this.par.arrSplice[t].sVephPoint.array[i].point.pz=e;let s=(this.par.arrSplice[t].sVephPoint.array[i].point1.y-this.rectSten.z)/this.rectSten.d;1==isNaN(s)&&(s=0),this.par.arrSplice[t].sVephPoint.array[i].point.pz1=s}},this.moveDrag=function(t,i){if(0==i){let i=t;i<25&&(i=25),this.tComp3But2.arrButton[1].z=i+this.rectSten.d,this.tComp3But2.arrButton[2].z=i,this.moveDrag2()}if(1==i||2==i)if(0==this.bool0)this.tComp3But2.arrButton[1].z=t,this.tComp3But2.arrButton[2].z=t,this.moveDrag2();else{let e=t;1==i&&(e<this.tComp3But2.arrButton[2].z&&(e=this.tComp3But2.arrButton[2].z),e>9999&&(e=9999),this.tComp3But2.arrButton[1].z=e),2==i&&(e>this.tComp3But2.arrButton[1].z&&(e=this.tComp3But2.arrButton[1].z),e<25&&(e=25),this.tComp3But2.arrButton[2].z=e),this.moveDrag2()}},this.moveDrag2=function(){let t;if(0==this.bool0){for(var i=0;i<this.par.arrSplice.length;i++)if(1==this.par.arrSplice[i].life)for(var e=0;e<this.par.arrSplice[i].sVephPoint.array.length;e++)(t=this.par.arrSplice[i].sVephPoint.array[e]).tComp3But.button.z=this.tComp3But2.arrButton[1].z,t.tComp3But.button1.z=this.tComp3But2.arrButton[1].z,t.tComp3But.button2.z=this.tComp3But2.arrButton[1].z,t.drag()}else{let s=this.tComp3But2.arrButton[1].z-this.tComp3But2.arrButton[2].z;for(i=0;i<this.par.arrSplice.length;i++)if(1==this.par.arrSplice[i].life)for(e=0;e<this.par.arrSplice[i].sVephPoint.array.length;e++){let n=(t=this.par.arrSplice[i].sVephPoint.array[e]).point.pz*s+this.tComp3But2.arrButton[2].z,r=t.point.pz1*s+this.tComp3But2.arrButton[2].z,h=n;r>h&&(h=r),t.tComp3But.button.z=h,t.tComp3But.button1.z=n,t.tComp3But.button2.z=r,t.drag()}}for(i=0;i<this.par.arrSplice.length;i++)1==this.par.arrSplice[i].life&&this.par.arrSplice[i].par.addObjFun(this.par.arrSplice[i]);this.moveDrag3()},this.moveDrag3=function(){this.tLabel.cont3d.position.z=-this.tComp3But2.arrButton[2].z,this.tLabel1.cont3d.position.z=-this.tComp3But2.arrButton[1].z-15;let t=""+Math.round(this.tComp3But2.arrButton[2].z),i=""+Math.round(this.tComp3But2.arrButton[1].z);this.tLabel1.text=i,t==i?this.tLabel.cont3d.visible=!1:(this.tLabel.cont3d.visible=!0,this.tLabel.text=t),this.par.osiPoint.dragOsi()},this.fun_rotationZ=function(){this.content3d.rotation.z=visi3D.rotationZ},this.drag=function(){this.dragRect(),this.tComp3But2.button1.z=this.rectSten.z1,this.tComp3But2.button2.z=this.rectSten.z,this.content3d.position.x=this.rectSten.x2,this.content3d.position.y=this.rectSten.y2;let t=this.rectSten.w/2;t<this.rectSten.h/2&&(t=this.rectSten.h/2),t+=100,this.cont3d.position.x=t+155,this.moveDrag3();this.mesh.position.x=this.rectSten.x2,this.mesh.position.y=this.rectSten.y2,this.mesh.position.z=-this.rectSten.z1/2,this.mesh.scale.set(200,200,200),this.mesh.scale.set(this.rectSten.w+60,this.rectSten.h+60,this.rectSten.z1+60)},this.dragRXYZmin=function(t){t.x=999.999999999999,t.x1=-999999999999999,t.y=999999999999999,t.y1=-999999999999999,t.z=999999999999999,t.z1=-999999999999999,t.d=0},this.dragRWHD=function(t){t.w=t.x1-t.x,t.x2=t.x+t.w/2,t.h=t.y1-t.y,t.y2=t.y+t.h/2,t.d=t.z1-t.z},this.dragRect=function(){this.dragRXYZmin(this.rectSten);for(var t=0;t<this.par.arrSplice.length;t++)if(1==this.par.arrSplice[t].life){this.rectSten.x>this.par.arrSplice[t]._addPoint.position._x&&(this.rectSten.x=this.par.arrSplice[t]._addPoint.position._x),this.rectSten.x1<this.par.arrSplice[t]._addPoint.position._x&&(this.rectSten.x1=this.par.arrSplice[t]._addPoint.position._x),this.rectSten.y>this.par.arrSplice[t]._addPoint.position._y&&(this.rectSten.y=this.par.arrSplice[t]._addPoint.position._y),this.rectSten.y1<this.par.arrSplice[t]._addPoint.position._y&&(this.rectSten.y1=this.par.arrSplice[t]._addPoint.position._y);for(var i=0;i<this.par.arrSplice[t].sVephPoint.array.length;i++)this.rectSten.z>this.par.arrSplice[t].sVephPoint.array[i].point.y&&(this.rectSten.z=this.par.arrSplice[t].sVephPoint.array[i].point.y),this.rectSten.z1<this.par.arrSplice[t].sVephPoint.array[i].point.y&&(this.rectSten.z1=this.par.arrSplice[t].sVephPoint.array[i].point.y),this.rectSten.z>this.par.arrSplice[t].sVephPoint.array[i].point1.y&&(this.rectSten.z=this.par.arrSplice[t].sVephPoint.array[i].point1.y),this.rectSten.z1<this.par.arrSplice[t].sVephPoint.array[i].point1.y&&(this.rectSten.z1=this.par.arrSplice[t].sVephPoint.array[i].point1.y)}this.dragRWHD(this.rectSten)},this.korectLineRoof=function(t,i){this.metoduRofa.korectLineRoof(t,i),this.par.osiPoint.redrag()},this.redragRect=function(t,i){this.metoduStan.redragRect(t,i)},this.setRect=function(t){this.metoduStan.setRect(t)},this.setMinMax=function(t,i,e,s){this.metoduRofa.setMinMax(t,i,e,s)}}set mast(t){this._mast!=t&&(this._mast=t,this.tLabel.fontSize=this._fontSize*this.par._mast*facade._mastYmn,this.tLabel1.fontSize=this._fontSize*this.par._mast*facade._mastYmn,this.tComp3But2.scale=30*this._mast,this.tLabel.x=10*this.par._mast*facade._mastYmn,this.tLabel1.x=10*this.par._mast*facade._mastYmn)}get mast(){return this._mast}set visible(t){this._visible!=t&&(this._visible=t,this.content3d.visible=t,this.drag(),t?visi3D.event3DArr.addChild(this.cont3d1):visi3D.event3DArr.removeChild(this.cont3d1))}get visible(){return this._visible}set life(t){this._life!=t&&(this._life=t,this._life?this.c3d.add(this.content3d):this.c3d.remove(this.content3d))}get life(){return this._life}}class Ae{constructor(t){this.type="MetoduStan";var i,e,s,n;this.par=t;var r,h,a={x:0,y:0},o={x:0,y:0};this.rectSten=this.par.rectSten,this.redragRect=function(t,l){this.par.dragRect(),this.rectSten=this.par.rectSten,this.par.par.clear();var u=this.par.par,c=this.rectSten.w/100,d=this.rectSten.h/100;this.polDin=u.craetPol();for(var p=0;p<l.length;p+=2){if(n=u.craetPoint(),a.x=l[p]*c,a.y=l[p+1]*d,r=calc.getDistance(o,a),h=calc.getAngle(o,a),calc.getVector(r,h+t,a),a.x+=this.rectSten.x2,a.y+=this.rectSten.y2,n.position.x=a.x,n.position.y=a.y,0==p)i=n,this.polDin.addPoint(n);else{e=n;let t=u.craetSplice1();e.addSplice(t,!1),s.addSplice(t,!0),this.polDin.addPoint(e)}s=n}let f=u.craetSplice1();i.addSplice(f,!1),s.addSplice(f,!0),visi3D.intRend=1},this.setRect=function(t){this.par.dragRect(),this.rectSten=this.par.rectSten;let i=t.width/this.rectSten.w,e=t.height/this.rectSten.h;for(var s=this.par.par,n=0;n<s.arrPoint.length;n++)0!=s.arrPoint[n].life&&s.arrPoint[n].position.set(s.arrPoint[n].position.x*i,s.arrPoint[n].position.y*e);this.rectSten=this.par.rectSten;let r=this.rectSten.x-t.x,h=this.rectSten.y-t.y;for(n=0;n<s.arrPoint.length;n++)0!=s.arrPoint[n].life&&s.arrPoint[n].position.set(s.arrPoint[n].position.x-r,s.arrPoint[n].position.y-h)}}}class Te{constructor(t){this.type="MetoduRofa";var i,e,s,n,r,h,a,o,l,u,c,d;this.par=t,this.rectSten=this.par.rectSten,this.arrSplice=this.par.par.arrSplice,this.korectLineRoof=function(t,n){this.par.dragRect(),this.rectSten=this.par.rectSten,this.clearPoint2(),0==this.rectSten.d?((i=this.rectSten.z-50)<25&&(i=25),e=i+100):(i=this.rectSten.z,e=this.rectSten.z1),s=e-i,this.cratePoint2(t,n),this.korectXY(),this.korectZ(t,n)},this.setMinMax=function(t,n,r,h){trace("setMinMax==",t,n),this.par.dragRect(),this.rectSten=this.par.rectSten,this.clearPoint2(),s=(e=n)-(i=t),this.cratePoint2(r,h),this.korectXY(),this.korectZ(r,h)},this.korectZ=function(t,e){for(var o=0;o<this.arrSplice.length;o++)if(1==this.arrSplice[o].life){let u=this.arrSplice[o].sVephPoint.array.length-1;for(var l=0;l<u;l++)n=this.arrSplice[o].sVephPoint.array[l].posit,r=0==t?(n.x-this.rectSten.x)/this.rectSten.w:(n.y-this.rectSten.y)/this.rectSten.h,h=this.getZ(r,e),a=i+s*h,this.arrSplice[o].sVephPoint.array[l].setZZ(a);this.par.par.addObjFun(this.arrSplice[o])}},this.getZ=function(t,i){for(var e=2;e<i.length;e+=2)if(o=i[e-2]/100,l=i[e]/100,u=i[e-1],c=i[e+1],d=c-u,t>=o&&t<=l)return(d*((t-o)/(l-o))+u)/100;return 0},this.korectXY=function(){for(var t=0;t<this.arrSplice.length;t++)if(1==this.arrSplice[t].life){let e=this.arrSplice[t].sVephPoint.array.length-1;for(var i=0;i<e;i++)this.arrSplice[t].sVephPoint.array[i].korectXY()}},this.clearPoint2=function(){for(var t=0;t<this.arrSplice.length;t++)if(1==this.arrSplice[t].life){for(var i=this.arrSplice[t].sVephPoint.array.length-2;i>=1;i--)this.arrSplice[t].sVephPoint.array[i].kill()}};var p,f,g,x,y={x:0,y:0},m={x:0,y:0};this.cratePoint2=function(t,i){for(var e=2;e<i.length-2;e+=2){0==t?(y.y=99999999,m.y=-99999999,y.x=this.rectSten.x+this.rectSten.w*i[e]/100,m.x=y.x):(y.x=99999999,m.x=-99999999,y.y=this.rectSten.y+this.rectSten.h*i[e]/100,m.y=y.y);for(var s=0;s<this.arrSplice.length;s++)if(1==this.arrSplice[s].life&&(p=calc.getPointOfIntersection(y,m,this.arrSplice[s]._addPoint.position,this.arrSplice[s]._addPoint1.position))){f=calc.getDistance(this.arrSplice[s]._addPoint.position,p),g=calc.getDistance(this.arrSplice[s]._addPoint.position,this.arrSplice[s]._addPoint1.position),x=f/g;let t=this.arrSplice[s].sVephPoint.getPoint();t.prosent=x,t.drag(),this.arrSplice[s].sVephPoint.array.splice(1,0,t),this.arrSplice[s].sVephPoint.addGP(t)}}}}}class Ee{constructor(t,i){this.type="OsiPoint";this.par=t,this.fun=i,this._visible=!1,this.content3d=new THREE.Object3D,this.par.content3d.add(this.content3d),this.content3d.visible=this._visible,this.lineOsi=new Me(this),this.array=[],this.get=function(){for(var t=0;t<this.array.length;t++)if(0==this.array[t].life)return this.array[t].life=!0,this.array[t];let i=new De(this);return i.idArr=this.array.length,this.array.push(i),i},this.clear=function(){for(var t=0;t<this.array.length;t++)this.array[t].life=!1},this.korektOsi=function(){let t=!1;for(var i=0;i<this.array.length;i++)this.array[i].bta=!1;for(var e=0;e<this.lineOsi.arrayX.length;e++)if(!(this.lineOsi.arrayX[e].length<=1)){t=!0;for(i=0;i<this.array.length;i++)0!=this.array[i].life&&0!=this.array[i].xBool&&1==this.array[i].isPoint(this.lineOsi.arrayX[e][0])&&(t=!1,this.array[i].bta=!0);if(1==t){let t=this.get();t.xBool=!0,t.setArrPoint(this.lineOsi.arrayX[e])}}for(e=0;e<this.lineOsi.arrayY.length;e++)if(!(this.lineOsi.arrayY[e].length<=1)){t=!0;for(i=0;i<this.array.length;i++)0!=this.array[i].life&&0!=this.array[i].xBool&&1==this.array[i].isPoint(this.lineOsi.arrayY[e][0])&&(t=!1,this.array[i].bta=!0);if(1==t){let t=this.get();t.xBool=!1,t.setArrPoint(this.lineOsi.arrayY[e])}}for(i=0;i<this.array.length;i++)0==this.array[i].bta&&(this.array[i].life=!1)},this.dragPoint=function(t){for(var i=0;i<this.array.length;i++)if(0!=this.array[i].life&&1==this.array[i].isPoint(t))return void(this.array[i].life=!1)},this.dragOsi=function(){for(var t=0;t<this.array.length;t++)0!=this.array[t].life&&this.array[t].arrPoint[0]&&this.array[t].drag()},this.redrag=function(){this.lineOsi.redrag(),this.korektOsi()}}set visible(t){this._visible!=t&&(this._visible=t,this.content3d.visible=t)}get visible(){return this._visible}}class Me{constructor(t){this.type="LineOsi";this.par=t;var i=this.par.par;this.arrayX=[],this.arrayY=[];var e=[];this.redrag=function(){e.length=0,this.arrayX.length=0,this.arrayY.length=0;for(var t=0;t<i.arrSplice.length;t++)if(1==i.arrSplice[t].life)for(var s=1;s<i.arrSplice[t].sVephPoint.array.length-1;s++)e.push(i.arrSplice[t].sVephPoint.array[s]);for(t=0;t<e.length;t++)this.setArr(!0,e[t],this.arrayX),this.setArr(!1,e[t],this.arrayY)},this.setArr=function(t,i,e){let s=-1;for(var n=0;n<e.length;n++)if(e[n][0].par.par.uuid!==i.par.par.uuid&&Math.abs(e[n][0].tComp3But.button.z-i.tComp3But.button.z)<.001)if(t){if(Math.abs(e[n][0].posit.x-i.posit.x)<.001){s=n;break}}else if(Math.abs(e[n][0].posit.y-i.posit.y)<.001){s=n;break}-1!=s?e[s].push(i):e.push([i])}}}class De{constructor(t,i){this.type="Osi";var e=this;this.par=t,this.fun=i,this._life=!0,this._xBool=!0,this._size=3,this._zdvigZ=20*this.par.par.param.mastab,this._active=!1,this.mat=window.pm.matDop.getIDObj(6),this.mat1=window.pm.matDop.getIDObj(7),this.mat2=window.pm.matDop.getIDObj(8),this.bta=!0,this.content3d=new THREE.Object3D,this.par.content3d.add(this.content3d),this.c3d=this.par.content3d,this.content3d.objGlob=this,this.mesh=new THREE.Mesh(this.par.par.cylinderGeometry,this.mat),this.content3d.add(this.mesh),this.mesh.scale.x=this._size*this.par.par.param.mastab,this.mesh.scale.z=this._size*this.par.par.param.mastab,this.mesh.position.z=-this._zdvigZ,visi3D.event3DArr.addChild(this.mesh),this.arrPoint=[],this.position=new ze(0,0,0,function(){e.content3d.position.set(this.x,this.y,-this.z)});var s,n,r,h,a=this.par.par,o={x:0,y:0},l={x:0,y:0},u=0,c=[];this.setx_y_z=function(t,i,e){1==this._xBool?(o.y=99999999,l.y=-99999999,o.x=t,l.x=t):(o.x=99999999,l.x=-99999999,o.y=i,l.y=i),u=0;for(var d=0;d<a.arrSplice.length;d++)1==a.arrSplice[d]._life&&(r=calc.getPointOfIntersection(o,l,a.arrSplice[d]._addPoint.position,a.arrSplice[d]._addPoint1.position))&&(null==c[u]&&(c[u]={x:0,y:0,point:null,sten:null}),c[u].x=r.x,c[u].y=r.y,c[u].dist=calc.getDistance(a.arrSplice[d]._addPoint.position,r),c[u].prosent=c[u].dist/a.arrSplice[d]._distans,c[u].point=null,c[u].sten=a.arrSplice[d],u++);if(u>=2){for(d=0;d<this.arrPoint.length;d++)this.arrPoint[d].xzB=!1;for(d=0;d<u;d++)null!==(h=this.getPointToArr(c[d].sten))&&(c[d].point=h,h.xzB=!0);for(d=this.arrPoint.length-1;d>=0;d--)0==this.arrPoint[d].xzB&&(this.arrPoint[d].kill(),this.arrPoint.splice(d,1));for(d=0;d<u;d++){if(null==c[d].point){let t=c[d].sten.sVephPoint.getPoint();c[d].sten.sVephPoint.addGP(t),c[d].point=t,this.arrPoint.push(t)}c[d].point.prosent=c[d].prosent,c[d].point.drag()}}for(d=0;d<this.arrPoint.length;d++)s=this.arrPoint[d].tComp3But.button.z-this.arrPoint[d].tComp3But.button1.z,n=this.arrPoint[d].tComp3But.button.z-this.arrPoint[d].tComp3But.button2.z,this.arrPoint[d].tComp3But.button.z=e,this.arrPoint[d].tComp3But.button1.z=e+s,this.arrPoint[d].tComp3But.button2.z=e+n,this.arrPoint[d].drag(),this.arrPoint[d].par.par.par.addObjFun(this.arrPoint[d].par.par.addPoint),this.arrPoint[d].par.par.par.addObjFun(this.arrPoint[d].par.par.addPoint1);this.drag()},this.getPointToArr=function(t){for(var i=0;i<this.arrPoint.length;i++)if(this.arrPoint[i].par.par.uuid==t.uuid)return this.arrPoint[i];return null},this.isPoint=function(t){for(var i=0;i<this.arrPoint.length;i++)if(this.arrPoint[i].uuid==t.uuid)return!0;return!1},this.setArrPoint=function(t){this.arrPoint=t,this.drag()};var d,p=[];this.drag=function(){if(1==this._xBool){p.length=0;for(var t=0;t<this.arrPoint.length;t++)p.push(this.arrPoint[t].posit.y);p.sort(this.sort),d=p[p.length-1]-p[0],this.position.x=this.arrPoint[0].posit.x,this.position.z=this.arrPoint[0].tComp3But.button.z,this.position.y=p[0]+d/2,this.mesh.scale.y=d,this.mesh.rotation.z=0}else{p.length=0;for(t=0;t<this.arrPoint.length;t++)p.push(this.arrPoint[t].posit.x);p.sort(this.sort),d=p[p.length-1]-p[0],this.position.y=this.arrPoint[0].posit.y,this.position.z=this.arrPoint[0].tComp3But.button.z,this.position.x=p[0]+d/2,this.mesh.scale.y=d,this.mesh.rotation.z=Math.PI/2}},this.sort=function(t,i){return t-i}}set active(t){this._active!=t&&(this._active=t,1==this._active?this.mesh.material=this.mat1:this.mesh.material=this.mat,visi3D.intRend=1)}get active(){return this._active}set xBool(t){this._xBool!=t&&(this._xBool=t)}get xBool(){return this._xBool}set life(t){this._life!=t&&(this._life=t,this.bta=!0,1==this._life?(this.c3d.add(this.content3d),visi3D.event3DArr.addChild(this.mesh)):(this.c3d.remove(this.content3d),visi3D.event3DArr.removeChild(this.mesh)))}get life(){return this._life}}function ze(t,i,e,s){this._x=t||0,this._y=i||0,this._z="function"!=typeof e&&e||0,this.fun="function"==typeof e?e:s,this.set=function(t,i,e){this._x=t||0,this._y=i||0,this._z=e||0,this.fun&&this.fun()},this.setPoint=function(t){this._x=t.x,this._y=t.y,this._z=t.z,this.fun&&this.fun()},this.getObj=function(){var t={};return t.x=this._x,t.y=this._y,t.z=this._z,t},this.copy=function(){return new ze(this._x,this._y,this._z)}}ze.prototype={set x(t){this._x=t,this.fun&&this.fun()},get x(){return this._x},set y(t){this._y=t,this.fun&&this.fun()},get y(){return this._y},set z(t){this._z=t,this.fun&&this.fun()},get z(){return this._z}};class Re{constructor(t,i){this.type="Info33But";var e=this;this.par=t,this.fun=i,this._mast=this.par._mast,this.tC3B,this.tC3BL,this.tC3BR,this._active=!1,this.content3d=new THREE.Object3D,this.par.content3d.add(this.content3d),this.content3d.visible=this._active,this.razmer=new Be(this),this.razmer1=new Be(this),this.drag=function(){0!=this._active&&this.tC3B};var s,n,r,h,a={tC3BL:null,tC3BR:null};this.dragLR=function(t){a.tC3BL=null,a.tC3BR=null,s=t.gronPoint,n=-1;for(var i=0;i<s.par.array.length;i++)if(s.par.array[i].uuid==s.uuid){n=i;break}if(a.tC3BL=t.gronPoint.par.array[n+1].tComp3But,0!=n&&-1!=n)return a.tC3BR=t.gronPoint.par.array[n-1].tComp3But,a;for(i=0;i<this.par.arrSplice.length;i++){r=this.par.arrSplice[i].sVephPoint.array;for(var e=1;e<r.length;e++)if(r[e].uuid==s.uuid)return a.tC3BR=r[e-1].tComp3But,a}return a},this.setObject=function(t){t?(this.tC3B&&this.tC3B.uuid!=t.uuid&&(this.tC3B.dragFun=null,this.tC3B.button.active=!1,this.tC3B.button1.active=!1,this.tC3B.button2.active=!1),this.tC3B=t,this.tC3B.button.active=!0,this.tC3B.button1.active=!0,this.tC3B.button2.active=!0,this.tC3B.dragFun=this.drag,this.tC3BL=void 0,this.tC3BR=void 0,h=this.dragLR(this.tC3B),this.tC3BL=h.tC3BL,this.tC3BR=h.tC3BR,this.razmer.setPS(this.tC3B,this.tC3BL,1,2),this.razmer1.setPS(this.tC3BR,this.tC3B,1,2),menuBig&&menuBig.setObject(t),this.active=!0,this.drag()):(this.tC3B&&(this.tC3B.button.active=!1,this.tC3B.button1.active=!1,this.tC3B.button2.active=!1,this.tC3B.dragFun=null),menuBig&&menuBig.setObject(null),this.active=!1,this.tC3B=t)},this.drag=function(){0!=this._active&&(h=e.dragLR(e.tC3B),e.razmer.isTB(e.tC3B,h.tC3BL),e.razmer1.isTB(h.tC3BR,e.tC3B),e.razmer.drag(),e.razmer1.drag())},this.clear=function(){}}set mast(t){this._mast!=t&&(this._mast=t,this.razmer.mast=t,this.razmer1.mast=t)}get mast(){return this._mast}set active(t){this._active!=t&&(this._active=t,this.content3d.visible=t,this.razmer.active=t,this.razmer1.active=t)}get active(){return this._active}}class Be{constructor(t){this.type="Razmer";this.par=t,this._mast=this.par._mast,this._active=!1,this.content3d=new THREE.Object3D,this.par.content3d.add(this.content3d),this.content3d.visible=this._active,this.rPont2=new Ce(this),this.vector=new THREE.Vector3,this.vector1=new THREE.Vector3,this.korect=function(){this.rPont2.setPoints(this.vector,this.vector1)},this.drag=function(){o&&l?(this.active=!0,this.korPoint(o,this.vector,u),this.korPoint(l,this.vector1,c),this.korect()):this.active=!1};var i,e,s,n,r=new THREE.Vector3,h=new THREE.Vector3,a=new THREE.Vector3;this.korPoint=function(t,o,l){i=t.gronPoint,e=i.par.par,0==i.prosent?(r.x=-e.arrPosit[5].x,r.y=-10,s=calc.getAngle(a,r),n=calc.getDistance(a,r)):(s=-Math.PI/2,n=10),calc.getVector(n,s+e._rotation,h),o.x=i.posit.x+h.x,o.y=i.posit.y+h.y,o.z=t.arrButton[l].z};var o=null,l=null,u=0,c=0;this.setPS=function(t,i,e,s){o=t,l=i,u=e,c=s},this.isTB=function(t,i){let e=!1;!l&&i&&(e=!0),l&&!i&&(e=!0),e||l&&i&&l.uuid!==i.uuid&&(e=!0),e&&this.setPS(t,i,u,c)}}set mast(t){this._mast!=t&&(this._mast=t,this.rPont2.mast=t)}get mast(){return this._mast}set active(t){this._active!=t&&(this._active=t,this.content3d.visible=t)}get active(){return this._active}}class Ce{constructor(t){this.type="RPoint2";this.par=t,this._mast=this.par._mast,this.content3d=new THREE.Object3D,this.par.content3d.add(this.content3d),this.array=[],this.array1=[],this.matA1=window.pm.matDop.getIDObj(24),this.matA1A=window.pm.matDop.getIDObj(26),this._boolA1=!0,this._fontSize=12,this.tLabel,this.tLabel1,this.init=function(){for(var t=0;t<3;t++){var i=new Bi(this.content3d,function(t,i){},null,this.matA1,this.matA1,this.matA1,this.matA1,this.matA1);2!==t?(i.bRotZ=1,i.content3d.rotation.x=-Math.PI/2,i.content3d.rotation.z=-Math.PI/2):(i.content3d.rotation.x=-Math.PI/2,i.bVerh=!1,i.bRotation=!0,i.c3dLabelYY.rotation.z=Math.PI),i.bDurka=!1,i.mast=this.mast*facade._mastYmn,1==t&&(i.bVerh=!1),this.array.push(i)}this.tLabel=new Ri(this.content3d,0,0,"xz"),this.tLabel1=new Ri(this.content3d,0,0,"xz1"),this.tLabel.fontSize=this._fontSize*facade._mastYmn,this.tLabel1.fontSize=this._fontSize*facade._mastYmn,this.tLabel.cont3d.rotation.z=Math.PI,this.tLabel.cont3d.rotation.x=Math.PI/2,this.tLabel1.cont3d.rotation.z=Math.PI,this.tLabel1.cont3d.rotation.x=Math.PI/2,this.tLabel.material=this.matA1,this.tLabel1.material=this.matA1},this.init();var i,e,s,n,r,h,a,o,l={x:0,y:0},u={x:0,y:0};this.setPoints=function(t,c){a=t,o=c,i=calc.getDistance(t,c),e=calc.getAngle(t,c),this.content3d.position.x=t.x,this.content3d.position.y=t.y,this.content3d.rotation.z=e,this.array[1].content3d.position.x=i,s=a.z,o.z<s&&(s=o.z),n=o.z-a.z,t.z==c.z?this.boolA1=!1:this.boolA1=!0,this.array[0].content3d.position.z=-a.z,this.array[1].content3d.position.z=-o.z,this.array[1].content3d.position.x=i,this.array[0].distans=a.z,this.array[1].distans=o.z,n<0?(this.array[2].content3d.position.z=-a.z,this.array[2].distans=Math.sqrt(-n*-n+i*i),l.x=i,l.y=-n,r=calc.getAngle(u,l),this.array[2].content3d.rotation.z=-r,h=Math.round(r*(180/Math.PI)),this.tLabel.text=-h+"°",this.tLabel1.text=h+"°"):(this.array[2].content3d.position.z=-a.z,this.array[2].distans=Math.sqrt(n*n+i*i),l.x=i,l.y=n,r=calc.getAngle(u,l),this.array[2].content3d.rotation.z=r,h=Math.round(r*(180/Math.PI)),this.tLabel.text=-h+"°",this.tLabel1.text=h+"°"),this.tLabel.cont3d.position.z=10-a.z,this.tLabel.cont3d.position.x=this.tLabel.width+10,this.tLabel1.cont3d.position.z=10-o.z,this.tLabel1.cont3d.position.x=i-10,this.tLabel.cont3d.position.y=10-10*this._mast*facade._mastYmn,this.tLabel1.cont3d.position.y=10-10*this._mast*facade._mastYmn}}set mast(t){if(this._mast!=t){this._mast=t;for(var i=0;i<this.array.length;i++)this.array[i].mast=t*facade._mastYmn,this.array[i].tLabel.cont3d.position.z=10*this._mast*facade._mastYmn-10;this.tLabel.fontSize=this._fontSize*this._mast*facade._mastYmn,this.tLabel1.fontSize=this._fontSize*this._mast*facade._mastYmn}}get mast(){return this._mast}set boolA1(t){if(this._boolA1!=t){if(this._boolA1=t,this._boolA1){for(var i=0;i<this.array.length;i++)this.array[i].tLabel.material=this.matA1,this.array[i].a[0].material=this.matA1,this.array[i].a[1].material=this.matA1,this.array[i].a[2].material=this.matA1;this.tLabel.material=this.matA1,this.tLabel1.material=this.matA1}else{for(i=0;i<this.array.length;i++)this.array[i].tLabel.material=this.matA1A,this.array[i].a[0].material=this.matA1A,this.array[i].a[1].material=this.matA1A,this.array[i].a[2].material=this.matA1A;this.tLabel.material=this.matA1A,this.tLabel1.material=this.matA1A}visi3D.intRend=1}}get boolA1(){return this._boolA1}}function Le(t,i){se.call(this);var e=this;this.type="SpStageSten",this.par=t,this.param=t.param,this.tipSplice="SpliceSten",this.tipPoint="SpPointSten",this._idArr=-1,this.fun=i,this.uuid=calc.generateRendom(2),this._boolMax=!0,this._lineOpor=!1,this._activeVephPoint=!1,this._offset=0,this._delph=20,this._height=t._height+t._height2,this.minH=50,this._boolMinH=!1,this._razVisi=!0,this._razWindow=!1,this._mast=1,this.cylinderGeometry=new THREE.CylinderGeometry(1,1,1,22),this.boxGeometry=new THREE.BoxGeometry(1,1,1),this.sphereGeometry=new THREE.SphereGeometry(.5,16,16),this.coneGeometry=new THREE.ConeGeometry(.25,1,16),this.cylinderMaterial=window.pm.matDop.getIDObj(6),this.materialVerh1=this.cylinderMaterialActive=window.pm.matDop.getIDObj(7),this.arrMat=[window.pm.matDop.getIDObj(4),window.pm.matDop.getIDObj(5),window.pm.matDop.getIDObj(1),window.pm.matDop.getIDObj(10)],this.arrMatAlpha=[];for(var s=0;s<e.arrMat.length;s++){e.arrMat[s].userData={};var n=e.arrMat[s].clone();n.transparent=!0,n.opacity=.5,this.arrMatAlpha[s]=n}function r(t,i){t.x>i.x&&(t.x=i.x),t.y>i.y&&(t.y=i.y),t.x1<i.x&&(t.x1=i.x),t.y1<i.y&&(t.y1=i.y)}this.content3d=new THREE.Object3D,this.par.content3d.add(this.content3d),this.content3dPoint=new THREE.Object3D,this.content3d.add(this.content3dPoint),this.content3dPol=new THREE.Object3D,this.content3d.add(this.content3dPol),this.content3dBox=new THREE.Object3D,this.content3d.add(this.content3dBox),this.content3d.objStage=this,this.tc3Big=new Se(this),this.osiPoint=new Ee(this),this.info33But=new Re(this),this.worldBlok=new ue(this),this.triangulateShape=new me,this.getPoint=function(t){return new Yi(this)},this.getSplice=function(t){return new Xi(this)},this.getPol=function(t){return new be(this,t)},this.getInfo=function(t){for(var i=0;i<this.arrSplice.length;i++)0!=this.arrSplice[i].life&&this.arrSplice[i].getInfo(t);for(i=0;i<this.arrPol.length;i++)0!=this.arrPol[i].life&&this.arrPol[i].getInfo(t);this.worldBlok.getInfo(t)},this.render=function(){this.par.renderDebag&&this.par.renderDebag()},this.getRect=function(t,i,e,s){if(null==t){t=[];for(var n=0;n<this.arrPoint.length;n++)0!=this.arrPoint[n].life&&t.push(this.arrPoint[n])}if(null==i){i=[];for(n=0;n<this.arrSplice.length;n++)0!=this.arrSplice[n].life&&i.push(this.arrSplice[n])}if(null==e){e=[];for(n=0;n<this.avp.length;n++)0!=this.avp[n].life&&e.push(this.avp[n])}var h={x:9999999,y:999999,x1:-9999999,y1:-9999999,w:0,h:0};for(n=0;n<e.length;n++)r(h,e[n].position);for(n=0;n<t.length;n++)r(h,t[n].position);for(n=0;n<i.length;n++)i[n].poiskGran(),r(h,i[n].arrGran[0]),r(h,i[n].arrGran[1]),r(h,i[n].arrGran[2]),r(h,i[n].arrGran[3]);for(n=0;n<s.length;n++)r(h,s[n].pT);return h.w=h.x1-h.x,h.h=h.y1-h.y,h},this.bigDrag=function(t){for(var i=0;i<this.arrSplice.length;i++)0!=this.arrSplice[i].life&&this.arrSplice[i].dragPost();for(i=0;i<this.arrPoint.length;i++)0!=this.arrPoint[i].life&&this.arrPoint[i].dragPost();for(i=0;i<this.arrPol.length;i++)0!=this.arrPol[i].life&&this.arrPol[i].dragPost();t&&setTimeout(function(){for(var t=0;t<e.arrPol.length;t++)0!=e.arrPol[t].life&&e.arrPol[t].dragTime()},1)},this.arrFun=[],this.arrObj=[],this.addObjFun=function(t){for(let i=0;i<this.arrObj.length;i++)if(this.arrObj[i]._uuid==t._uuid)return;this.arrObj.push(t)},e.funFDO,e.funFDO1;this.doRender=function(){if(0==e.arrObj.length)return!1;!1;for(let t=0;t<e.arrObj.length;t++)e.arrObj[t].dragPost(),"SpliceSten"==e.arrObj[t].type&&!0;return e.arrObj.length=0,e.tc3Big.drag(),e.funFDO&&e.funFDO(),e.funFDO1&&e.funFDO1(),!0},this.arrFun1=[],this.arrObj1=[],this.addObjFun1=function(t){for(let i=0;i<this.arrObj1.length;i++)if(this.arrObj1[i]._uuid==t._uuid)return;this.arrObj1.push(t)},this.doRender1=function(){if(0==e.arrObj1.length)return!1;for(let t=0;t<e.arrObj1.length;t++)e.arrObj1[t].dragPost();return e.arrObj1.length=0,!0}}Le.prototype=Object.create(se.prototype),Le.prototype.constructor=Le,Le.prototype.getObj=function(t){var i=se.prototype.getObj.call(this,t);return i.height=this._height,i},Le.prototype.setObj=function(t){se.prototype.setObj.call(this,t),null!=t.name&&(this.name=t.name),this.bigDrag(!0),this.osiPoint.redrag()},Le.prototype.craetSplice1=function(){return se.prototype.craetSplice1.call(this)},Le.prototype.craetPoint=function(){return se.prototype.craetPoint.call(this)},Le.prototype.craetPol=function(t){return se.prototype.craetPol.call(this,t)},Le.prototype.craetVP=function(){return se.prototype.craetVP.call(this)},Le.prototype.clear=function(){return se.prototype.clear.call(this)},Object.defineProperties(Le.prototype,{mast:{set:function(t){if(this._mast!=t){this._mast=t,this.info33But.mast=t,this.tc3Big.mast=t,this.worldBlok.mast=t;for(var i=0;i<this.arrSplice.length;i++)this.arrSplice[i].mast=this._mast;for(i=0;i<this.arrPoint.length;i++)this.arrPoint[i].mast=this._mast*facade._mastYmn}},get:function(){return this._mast}},razVisi:{set:function(t){if(this._razVisi!=t){this._razVisi=t;for(var i=0;i<this.arrSplice.length;i++)this.arrSplice[i].razmeru.razVisi=this._razVisi}},get:function(){return this._razVisi}},razWindow:{set:function(t){if(this._razWindow!=t){this._razWindow=t;for(var i=0;i<this.arrSplice.length;i++)this.arrSplice[i].razmeru.boolWindow=this._razWindow}},get:function(){return this._razWindow}},lineOpor:{set:function(t){if(this._lineOpor!=t){this._lineOpor=t;for(var i=0;i<this.arrSplice.length;i++)this.arrSplice[i].lineOpor=this._lineOpor;for(i=0;i<this.arrPoint.length;i++)this.arrPoint[i].lineOpor=this._lineOpor}},get:function(){return this._lineOpor}},activeVephPoint:{set:function(t){if(this._activeVephPoint!=t){this._activeVephPoint=t;for(var i=0;i<this.arrSplice.length;i++)this.arrSplice[i].activeVephPoint=this._activeVephPoint}},get:function(){return this._activeVephPoint}},boolMinH:{set:function(t){if(this._boolMinH!=t){this._boolMinH=t;for(var i=0;i<this.arrSplice.length;i++)this.arrSplice[i].boolMinH=this._boolMinH}},get:function(){return this._boolMinH}},height:{set:function(t){for(var i=0;i<this.arrSplice.length;i++)0==this.arrSplice[i]._boolHHH&&(this.arrSplice[i].height=t),this.arrSplice[i].draw1();var e,s;s=Math.round(this._height),e=Math.round(t);for(i=0;i<this.avp.length;i++)this.avp[i].position.z;for(i=0;i<this.arrPoint.length;i++)this.arrPoint[i].position.z>=s&&(this.arrPoint[i].position.z=e);for(i=0;i<this.arrPoint.length;i++)this.arrPoint[i].life&&this.arrPoint[i].dragGG();this._height=t},get:function(){return this._height}}});class Oe{constructor(t,i){this.type="WordHelp3D";this.cont3d=t,this.boxGeometry=new THREE.BoxGeometry(1,1,1),this.cylinderGeometry=new THREE.CylinderGeometry(1,1,1,22),this.sphereGeometry=new THREE.SphereGeometry(.5,16,16),this.size=1,this.matDefolt=i||new THREE.MeshBasicMaterial({color:255}),this.content3d=new THREE.Object3D,t&&t.add(this.content3d),this.array=[],this.get=function(t){for(var i=0;i<this.array.length;i++)if(this.array[i].type===t&&1!=this.array[i].visible)return this.array[i].visible=!0,this.array[i];return"WHLine"==t&&(this.array[this.array.length]=new Ie(this.content3d,this.matDefolt,this.cylinderGeometry)),"WHPint"==t&&(this.array[this.array.length]=new ke(this.content3d,this.matDefolt,this.sphereGeometry)),this.array[this.array.length-1]},this.clear=function(){for(var t=0;t<this.array.length;t++)this.array[t].visible=!1;visi3D.intRend=1},this.setLine=function(t,i,e,s,r){let a=this.get("WHLine");r?(this.draggP3(t,i,r),a.setVects(n,h)):a.setVects(t,i),a.size=s||this.size,a.material=e||this.matDefolt},this.setLines=function(t,i,e){},this.setPoint=function(t,i,e){let s=this.get("WHPint");s.setVect(t),s.size=e||this.size,s.material=i||this.matDefolt};var e,s,n=new THREE.Vector3,r=new THREE.Vector3,h=new THREE.Vector3;new THREE.Vector3;this.draggP3=function(t,i,a){r.x=(t.x+i.x)/2,r.y=(t.y+i.y)/2,r.z=(t.z+i.z)/2,e=this.getDistance(t,i)/2,s=(e+a)/e,n.x=(t.x-r.x)*s+r.x,n.y=(t.y-r.y)*s+r.y,n.z=(t.z-r.z)*s+r.z,h.x=(i.x-r.x)*s+r.x,h.y=(i.y-r.y)*s+r.y,h.z=(i.z-r.z)*s+r.z},this.getDistance=function(t,i){return Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2)+Math.pow(t.z-i.z,2))},this.setXSP=function(t,i){null==o&&(o=facade.sp),g.x=t,g.y=-i._delph/2,d=calc.getAngle(x,g),p=calc.getDistance(x,g),calc.getVector(p,d+i._rotation,f),f.x+=i._addPoint.position.x,f.y+=i._addPoint.position.y,l.x=f.x,l.y=f.y,l.z=0,u.x=f.x,u.y=f.y,u.z=-9999,this.setLine(l,u)};var a,o=void 0;this.setYSP=function(t,i){null==o&&(o=facade.sp),a=null;for(var e=0;e<o.arrSplice.length;e++)if(1==o.arrSplice[e].life){a=o.arrSplice[e];break}null!=a&&this.setSten(a,t,i)};var l=new THREE.Vector3,u=new THREE.Vector3,c=new THREE.Vector3;this.setSten=function(t,i,e){if(0==e&&(l.x=t._addPoint.position.x,l.y=t._addPoint.position.y,l.z=-i,u.x=t._addPoint1.position.x,u.y=t._addPoint1.position.y,u.z=-i,this.setLine(l,u)),1==e&&(c=this.getPointGlobSten(t,0,5),l.x=c.x,l.y=c.y,l.z=-i,c=this.getPointGlobSten(t,1,0),u.x=c.x,u.y=c.y,u.z=-i,this.setLine(l,u)),t._addPoint1.uuid!=a._addPoint.uuid)for(var s=0;s<t._addPoint1.arrSHron.length;s++)t._addPoint1.arrSHron[s].sten.uuid!=t.uuid&&this.setSten(t._addPoint1.arrSHron[s].sten,i,e)};var d,p,f=new THREE.Vector3,g=new THREE.Vector3,x=(new THREE.Vector3,new THREE.Vector3);this.getPointGlobSten=function(t,i,e,s){return null==s?0==i?(g.x=-t.arrPosit[e].x,g.y=t.arrPosit[e].y):(g.x=t.arrPosit1[e].x+t._distans,g.y=t.arrPosit1[e].y):(g.x=s.x,g.y=s.y),d=calc.getAngle(x,g),p=calc.getDistance(x,g),calc.getVector(p,d+t._rotation,f),f.x+=t._addPoint.position.x,f.y+=t._addPoint.position.y,f}}}class Ie{constructor(t,i,e){this.type="WHLine";this._visible=!0,this.cont3d=t,this._size=1,this.content3d=new THREE.Object3D,t&&t.add(this.content3d),this._matDefolt,this._matDefolt=i||new THREE.MeshBasicMaterial({color:255}),this.mesh=new THREE.Mesh(e,this._matDefolt),this.content3d.add(this.mesh);var s,n,r,h,a,o=new THREE.Vector3;new THREE.Vector3;this.setVects=function(t,i){o.x=(t.x+i.x)/2,o.y=(t.y+i.y)/2,o.z=(t.z+i.z)/2,s=this.getAngle(t,i),r=this.getDistance(t,i),h=t.z-i.z,a=Math.abs(h),n=Math.asin(a/r),h<0&&(n*=-1),this.mesh.scale.y=r,this.mesh.rotation.z=Math.PI/2,this.mesh.rotation.y=n,this.content3d.rotation.z=s,this.content3d.position.copy(o)},this.getAngle=function(t,i){return Math.atan2(i.y-t.y,i.x-t.x)},this.getDistance=function(t,i){return Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2)+Math.pow(t.z-i.z,2))}}set visible(t){this._visible!=t&&(this._visible=t,this.content3d.visible=t)}get visible(){return this._visible}set size(t){this._size!=t&&(this._size=t,this.mesh.scale.x=t,this.mesh.scale.z=t)}get size(){return this._size}set matDefolt(t){this._matDefolt.uuid!=t.uuid&&(this._matDefolt=t,this.mesh.material=this._matDefolt)}get matDefolt(){return this._matDefolt}}class ke{constructor(t,i,e){this.type="WHPint";this._visible=!0,this._size=1,this.cont3d=t,this.content3d=new THREE.Object3D,t&&t.add(this.content3d),this._matDefolt,this._matDefolt=i||new THREE.MeshBasicMaterial({color:255}),this.mesh=new THREE.Mesh(e,this._matDefolt),this.content3d.add(this.mesh),this.setVect=function(t){this.content3d.position.set(t.x,t.y,t.z)}}set size(t){this._size!=t&&(this._size=t,this.mesh.scale.set(t,t,t))}get size(){return this._size}set matDefolt(t){this._matDefolt.uuid!=t.uuid&&(this._matDefolt=t,this.mesh.material=this._matDefolt)}get matDefolt(){return this._matDefolt}set visible(t){this._visible!=t&&(this._visible=t,this.content3d.visible=t)}get visible(){return this._visible}}class je{constructor(t,i){this.type="Facade";this.par=t,this.fun=i,this.param=this.par.param,this.content3d=new THREE.Object3D,this.par.content3d.add(this.content3d),window.facade=this,this.boolLoad=!1,this.korektRect=new Tt,this.korektLine=new Ot,this._height=7300,this._height1=0,this._height2=0,this._height3=55,this.aDefolt=[13,13,13],this.sobSP=function(t,i,e){},this.sp=new Le(this,this.sobSP),this.wordHelp3D=new Oe(this.content3d,window.pm.matDop.getIDObj(25)),window.wH3D=this.wordHelp3D,this.polDin,this.clear=function(){this.sp.clear(),visi3D.intRend=1},this.roomPlus=function(t,i,e,s){var n=this.sp.craetPoint(),r=this.sp.craetPoint(),h=this.sp.craetPoint(),a=this.sp.craetPoint();n.position.x=t-e/2,n.position.y=i-s/2,r.position.x=t+e/2,r.position.y=i-s/2,h.position.x=t+e/2,h.position.y=i+s/2,a.position.x=t-e/2,a.position.y=i+s/2;var o=this.sp.craetSplice1();n.addSplice(o,!0),r.addSplice(o,!1);var l=this.sp.craetSplice1();r.addSplice(l,!0),h.addSplice(l,!1);var u=this.sp.craetSplice1();h.addSplice(u,!0),a.addSplice(u,!1);var c=this.sp.craetSplice1();a.addSplice(c,!0),n.addSplice(c,!1),this.polDin=this.sp.craetPol(),this.polDin.addPoint(n),this.polDin.addPoint(r),this.polDin.addPoint(h),this.polDin.addPoint(a),visi3D.intRend=1},this.mast1=10,this.maxMast=3,this._mastYmn=1.5,this.mastDev=0,this.fun_rotationZ=function(){this.sp.tc3Big.fun_rotationZ();let t=visi3D.zume/(visi3D.position3d.maxZum-visi3D.position3d.minZum)-.04,i=this.mast1;1==dcmParam.mobile&&(i=this.mast1+this.mastDev),t<0&&(t=0);let e=1+t*i;e>this.maxMast&&(e=this.maxMast),this.sp.mast=e},this.upDate=function(){this.sp.doRender()},this.setObj=function(t){t.sp&&(this.boolLoad=!0,this.clear(),this.sp.setObj(t.sp),this.boolLoad=!1);for(var i=0;i<this.sp.arrPol.length;i++)if(1==this.sp.arrPol[i].life){this.polDin=this.sp.arrPol[i];break}visi3D.intRend=1},this.getObj=function(){var t={};return t.sp=this.sp.getObj(),t.visi3D=visi3D.getObj(),t}}}class He{constructor(t,i){this.type="View";this.par=t,this.fun=i,this.param=this.par.param,this.content3d=new THREE.Object3D,this.par.content3d.add(this.content3d),this.array=[],this.init=function(){this.facade=new je(this,function(t,i,e){}),this.cylinderGeometry=new THREE.CylinderBufferGeometry(1e5,100,10,32),this.cylinderGeometry=new THREE.CylinderBufferGeometry(1e4,1e4,100,32),this.meshPlan=new THREE.Mesh(this.cylinderGeometry,window.pm.matDop.getIDObj(9)),this.meshPlan.rotation.x=Math.PI/2,this.meshPlan.position.z=50,this.content3d.add(this.meshPlan),visi3D.objShadow(this.meshPlan)},this.upDate=function(){this.facade.upDate()},this.sizeWindow=function(t,i,e){t&&(t,i,e)},this.init()}set index(t){this._index!=t&&(this._index=t)}get index(){return this._index}}class Fe{constructor(t,i){this.type="MozgMenu";this.par=t,this.fun=i,this.param=this.par.param,this.dCont1=new DCont,this.par.dCont.add(this.dCont1),this.otstup=this.param.otstup,this._active=!1,this.dCont=void 0,this.dragActive=void 0,this.facade=this.par.par.view.facade,this.init=function(){if(null==this.dCont){this.dCont=new DCont;var t=new DPanel(this.dCont,this.otstup+this.param.wh,this.otstup),i=new DLabel(t,5,5,"Еще не начинал работу по "+this.type);i.width=90,i.fontSize=10}},this.ww=100,this.hh=100,this.ss=1,this.sizeWindow=function(t,i,e){t&&(this.ww=t,this.hh=i,this.ss=e),this.sizeWDrag()},this.sizeWDrag=function(){}}set active(t){this._active!=t&&(this._active=t,1==this._active?(this.init(),this.dCont1.add(this.dCont)):this.dCont1.remove(this.dCont),this.dragActive&&this.dragActive())}get active(){return this._active}}class Ne extends Fe{constructor(t,i){super(t,i),this.type="MozgMenu0";var e,s,n=this;this._indexAngel=0,this.oInfo=mhbd.objectBase.three.json.three,this.aaa=[];for(var r=0;r<this.oInfo.array.length;r++)"0"==this.oInfo.array[r].tId&&(this.aaa=this.oInfo.array[r].array);this.init=function(){if(null==this.dCont){this.dCont=new DCont,this.facade=this.par.par.view.facade,this.dCont.x=0,this.dCont.y=3*this.param.wh+2*this.param.otstup,this.gallery=new Ve(this.dCont,0,0,function(){n.gallery.array.length-1!=this.index?n.setPlane(this.index):n.indexAngel=n.indexAngel+1},this),this.gallery.kolII=1,this.gallery.widthPic=this.param.wh,this.gallery.heightPic=this.param.wh,this.gallery.otstup=0,this.gallery.width=this.param.wh+2*this.otstup,this.gallery.color=this.gallery.color1,this.gallery.panel.visible=!1,this.oInfo=mhbd.objectBase.three.json.three,this.aaa=[];for(var t=0;t<this.oInfo.array.length;t++)"0"==this.oInfo.array[t].tId&&(this.aaa=this.oInfo.array[t].array);this.gallery.height=(this.param.wh+this.otstup)*this.aaa.length+this.otstup,this.gallery.indexAngel=this._indexAngel}},this.setPlane=function(t){if(trace("setPlane==",t),null!=this.aaa[t]){this.redragRect;var i=this.aaa[t].s[0],e=this.aaa[t].b[0];0===e&&(e=!1),1===e&&(e=!0);for(var s=i.split(","),r=0;r<s.length;r++)s[r]=1*s[r];n.facade.sp.tc3Big.redragRect(n._indexAngel*Math.PI/2,s)}},this.setModel=function(t,i,e){if(-1!=t.indexOf("plane")){if("plane"==t)return void n.setPlane(i);if("planeAngel"==t)return void(n.indexAngel=i);if("planeRect"==t)return n.facade.sp.tc3Big.setRect(i),void trace(t,i)}},this.dragScan=function(t){null==t&&(t=this.time),this.tween.stop();let i=visi3D.getObj();visi3D.utility.focus.active=!0,visi3D.utility.focus.targetObject=this.facade.sp.content3dBox,visi3D.fov=15,visi3D.rotationX=0,visi3D.rotationZ=0,visi3D.render(),s=visi3D.getObj(),visi3D.utility.focus.active=!1,visi3D.setObj(i),visi3D.render(),this.tween.to(s,t).start()},this.time=500,this.tween=new TWEEN.Tween(visi3D);this.dragActive=function(){visi3D.rotationZ=visi3D.rotationZ%(2*Math.PI),this._active?(e=visi3D.getObj(),this.dragScan(),visi3D.position3d.boolDrahXZ=!1,this.facade.sp.lineOpor=!0,this.facade.sp.content3dPol.position.z=10-this.facade.sp.minH,this.facade.sp.boolMinH=!0,this.facade.sp.razVisi=!1):(this.facade.sp.content3dPol.position.z=0,visi3D.position3d.boolDrahXZ=!0,this.tween.to(e,this.time).start(),this.facade.sp.lineOpor=!1,this.facade.sp.boolMinH=!1),visi3D.intRend=1}}set indexAngel(t){this._indexAngel!=t&&(this._indexAngel=t,this._indexAngel>=4&&(this._indexAngel=0),this.gallery&&(this.gallery.indexAngel=this._indexAngel))}get indexAngel(){return this._indexAngel}}class Ve extends DGallery{constructor(t,i,e,s,n){super(t,i,e,s),this.par=n,this._indexAngel=0,this.createZamen=function(){var t=new Ge(this.content,0,0,this.downBtn,this.intText,this);return t.whPic=this.whPic,t.finalLink=this.finalLink,t.indexAngel=this._indexAngel,t}}set indexAngel(t){if(this._indexAngel!=t){this._indexAngel=t;for(var i=0;i<this.array.length;i++)this.array[i].indexAngel=t}}get indexAngel(){return this._indexAngel}}function Ge(t,i,e,s,n,r){DBox.call(this,t,i,e,s),this.type="BoxAngel";var h=this;function a(t,i){var e=t.clientWidth,s=t.clientHeight,n=Math.sin(i),r=Math.cos(i);t.style.transform="rotate("+i+"rad)",t.style.left=s*n+"px";var h=t.parentElement.style;h.width=e*r+s*n+"px",h.height=e*n+s*r+"px"}this.image.activMouse=!1,this.id=-1,this._indexAngel=0,this.panel.alpha=r.par.param.alpha,this.startLoad=function(t){this.object=t,this.obj3d=mhbd.getKeyId(t.key,t.id),this.image.link=mhbd.getLink(this.obj3d.icon),this.image.visible=!0,h.funLoad()},this.dragAngel=function(){trace(this._indexAngel),0==this._indexAngel&&a(this.image.image,0),1==this._indexAngel&&a(this.image.image,Math.PI/2),2==this._indexAngel&&a(this.image.image,Math.PI),3==this._indexAngel&&a(this.image.image,Math.PI+Math.PI/2)}}Ge.prototype=Object.create(DBox.prototype),Ge.prototype.constructor=Ge,Object.defineProperties(Ge.prototype,{indexAngel:{set:function(t){this._indexAngel!=t&&(this._indexAngel=t,this.dragAngel())},get:function(){return this._indexAngel}}});class Xe extends Fe{constructor(t,i){super(t,i),this.type="MozgMenu1";var e=this;this._index=-1,this.oInfo=mhbd.objectBase.three.json.three,this.aaa=[];for(var s=0;s<this.oInfo.array.length;s++)"1"==this.oInfo.array[s].tId&&(this.aaa=this.oInfo.array[s].array);this.init=function(){if(null==this.dCont){this.dCont=new DCont,this.facade=this.par.par.view.facade,this.dCont.x=0,this.dCont.y=3*this.param.wh+2*this.param.otstup,this.gallery=new Ue(this.dCont,0,0,function(){e.gallery.array.length-1!=this.index?e.setRoof(this.index):e.index=e.index+1},this),this.gallery.kolII=1,this.gallery.widthPic=this.param.wh,this.gallery.heightPic=this.param.wh,this.gallery.otstup=0,this.gallery.width=this.param.wh+2*this.otstup,this.gallery.color=this.gallery.color1,this.gallery.panel.visible=!1,this.oInfo=mhbd.objectBase.three.json.three,this.aaa=[];for(var t=0;t<this.oInfo.array.length;t++)"1"==this.oInfo.array[t].tId&&(this.aaa=this.oInfo.array[t].array)}},this.bool=!1,this.arr=[];var n=this.aaa[0].array[0].s[0],r=this.aaa[0].array[0].b[0];0===r&&(r=!1),1===r&&(r=!0);var h,a=n.split(",");for(s=0;s<a.length;s++)a[s]=1*a[s];this.bool=r,this.arr=a,this.setRoof=function(t){if(null!=this.aaa[e.index].array[t]){var i=this.aaa[e.index].array[t].s[0],s=this.aaa[e.index].array[t].b[0];0===s&&(s=!1),1===s&&(s=!0);for(var n=i.split(","),r=0;r<n.length;r++)n[r]=1*n[r];this.bool=s,this.arr=n,e.facade.sp.tc3Big.korectLineRoof(s,n)}},this.setModel=function(t,i,s){if(-1!=t.indexOf("roof")){if("roof"==t)return void e.setRoof(i);if("roofAngel"==t)return void(e.index=i);if("roofMinMax"==t)return void e.facade.sp.tc3Big.setMinMax(i,s,this.bool,this.arr)}},this.time=500,this.tween=new TWEEN.Tween(visi3D);this.dragScan=function(t){null==t&&(t=this.time),this.tween.stop();let i=visi3D.getObj();visi3D.utility.focus.active=!0,visi3D.utility.focus.targetObject=this.facade.sp.content3dBox,visi3D.render(),h=visi3D.getObj(),visi3D.utility.focus.active=!1,visi3D.setObj(i),visi3D.render(),this.tween.to(h,t).start()},this.dragActive=function(){this._active?(this.facade.sp.activeVephPoint=!0,this.facade.sp.tc3Big.visible=!0,this.facade.sp.osiPoint.visible=!0,this.facade.sp.razVisi=!0,this.facade.sp.razWindow=!1,this.facade.sp.osiPoint.redrag()):(this.facade.sp.activeVephPoint=!1,this.facade.sp.tc3Big.visible=!1,this.facade.sp.osiPoint.visible=!1,facade.sp.info33But.setObject(null)),visi3D.intRend=1}}set index(t){this._index!=t&&(this._index=t,null==this.aaa[this._index]&&(this._index=0),this.gallery.height=(this.param.wh+this.otstup)*this.aaa[this._index].array.length+this.otstup,this.gallery.start(this.aaa[this._index].array))}get index(){return this._index}}class Ue extends DGallery{constructor(t,i,e,s,n){super(t,i,e,s),this.par=n,this.createZamen=function(){var t=new Ye(this.content,0,0,this.downBtn,this.intText,this);return t.whPic=this.whPic,t.finalLink=this.finalLink,t}}}function Ye(t,i,e,s,n,r){DBox.call(this,t,i,e,s),this.type="Box2";var h=this;this.image.activMouse=!1,this.id=-1,this.panel.alpha=r.par.param.alpha,this.startLoad=function(t){this.object=t,this.obj3d=mhbd.getKeyId(t.key,t.id),this.image.link=mhbd.getLink(this.obj3d.icon),this.image.visible=!0,h.funLoad()}}Ye.prototype=Object.create(DBox.prototype),Ye.prototype.constructor=Ye,Object.defineProperties(Ye.prototype,{});class We extends Fe{constructor(t,i){super(t,i),this.type="MozgMenu2";var e=this;this.sobIndex2=void 0,this.facade=void 0,this.param=this.par.param,this.init=function(){if(null==this.dCont){this.sobIndex2=this.par.par.fManager.sobIndex[2],this.facade=this.par.par.view.facade,this.dCont=new DCont,this.dCont.x=0,this.dCont.y=3*this.param.wh+2*this.param.otstup,this.gallery=new Qe(this.dCont,0,0,function(){var t=this.array[this.index].object,i=mhbd.getKeyId(t.key,t.id);e.sobIndex2.sobSP("creatObjDin",i.id),visi3D.intRend=1},this),this.gallery.kolII=1,this.gallery.widthPic=this.param.wh,this.gallery.heightPic=this.param.wh,this.gallery.otstup=0,this.gallery.width=this.param.wh+2*this.otstup,this.gallery.color=this.gallery.color1,this.gallery.panel.visible=!1,this.oInfo=mhbd.objectBase.three.json.three;for(var t=[],i=0;i<this.oInfo.array.length;i++)"2"==this.oInfo.array[i].tId&&(t=this.oInfo.array[i].array);if(0==window.localS.object.debug)for(i=t.length-1;i>=0;i--)5==t[i].id&&t.splice(i,1);this.gallery.height=(this.param.wh+this.otstup)*t.length+this.otstup,this.gallery.start(t)}},this.dragActive=function(){this._active?(this.facade.sp.worldBlok.visiBox=!0,this.facade.sp.razVisi=!0,this.facade.sp.razWindow=!0):(this.facade.sp.worldBlok.visiBox=!1,this.facade.sp.worldBlok.activeObject=void 0),visi3D.intRend=1}}}class Qe extends DGallery{constructor(t,i,e,s,n){super(t,i,e,s),this.par=n,this.createZamen=function(){var t=new Ze(this.content,0,0,this.downBtn,this.intText,this);return t.whPic=this.whPic,t.finalLink=this.finalLink,t}}}function Ze(t,i,e,s,n,r){DBox.call(this,t,i,e,s),this.type="Box2";var h=this;this.image.activMouse=!1,this.id=-1,this.panel.alpha=r.par.param.alpha,this.startLoad=function(t){this.object=t,this.obj3d=mhbd.getKeyId(t.key,t.id),this.image.link=mhbd.getLink(this.obj3d.icon),this.image.visible=!0,h.funLoad()}}Ze.prototype=Object.create(DBox.prototype),Ze.prototype.constructor=Ze,Object.defineProperties(Ze.prototype,{});class Ke extends Fe{constructor(t,i){super(t,i),this.type="MozgMenu3";this.dragActive=function(){}}}class qe extends Fe{constructor(t,i){super(t,i),this.type="MozgMenu4";var e=this;this.init=function(){if(null==this.dCont){this.dCont=new DCont,this.dCont.x=this.param.otstup,this.dCont.y=this.param.wh+4*this.param.otstup,this.panel=new DPanel(this.dCont,0,0),this.panel.width=this.param.sizeBase;var t=(this.panel.width-3*this.otstup)/3-this.otstup;this.button=new DButton(this.panel,this.otstup,this.otstup,"save new",function(){e.save(function(t){history.pushState(null,null,window.location.origin+"/?id="+t),e.dragGal(function(){})})}),this.button.width=this.panel.width-2*this.otstup,this.button1=new DButton(this.panel,this.otstup,2*this.otstup+32,"save this",function(){var t=null,i=window.location.href.split("?id=");2==i.length&&1*i[1]&&(t=1*i[1]),e.save(function(t){history.pushState(null,null,window.location.origin+"/?id="+t),e.dragGal(function(){})},t)}),this.button1.width=this.panel.width-2*this.otstup;var i=window.location.href.split("?id=");2==i.length&&1*i[1]?this.button1.activMouse=!0:this.button1.activMouse=!1,this.gallery=new Je(this.panel,this.otstup,3*this.otstup+64,function(){if(this.array[this.index]){var t=this.array[this.index].id;history.pushState(null,null,window.location.origin+"/?id="+t),e.par.par.openId(t),e.button1.activMouse=!0}else{history.pushState(null,null,window.location.origin+"/");var i=200;e.par.par.view.facade.clear(),e.par.par.view.facade.roomPlus(Math.random()*i-100,Math.random()*i-100,Math.random()*i+100,Math.random()*i+100),e.button1.activMouse=!1}visi3D.intRend=1}),this.gallery.kolII=3,this.gallery.widthPic=t,this.gallery.heightPic=t,this.gallery.otstup=this.otstup,this.gallery.width=this.panel.width-2*this.otstup,e.foto3d=new ts(this.par.par.view.facade.content3d),this.save=function(t,i){let s=1;mhbd.setPHP({tip:"getDiractFiles",dir:"../../resources/date/save/"},function(n){for(var r=n.split(","),h=0;h<r.length;h++)1*r[h]!=void 0&&1*r[h]>=s&&(s=1*r[h]+1);i&&(s=i),mhbd.setPHP({tip:"mkdir",dir:"../../resources/date/save/"+s},function(i){var n="../../resources/date/save/"+s+"/config.json",r=JSON.stringify(e.par.par.view.facade.getObj());mhbd.setPHP({tip:"saveJSON",link:n,text:r},function(i){e.foto3d.getFile(200,200,function(i){trace(n,i),e.setFile(i,"../../resources/date/save/"+s+"/icon.png",function(){t(s)})})})})})},this.setFile=function(t,i,e){let s=new FormData;return s.append("tip","saveFile"),s.append("file",t),s.append("dest",i),$.ajax({url:"src/component/MHBDPHP.php",dataType:"text",cache:!1,contentType:!1,processData:!1,data:s,type:"post",success:function(t){e()}})},this.dragGal=function(t){mhbd.setPHP({tip:"getFiles1",dir:"../../resources/date/save/",arrNot:["node_modules","hlam","date"]},function(i){var s=JSON.parse(i);e.gallery.start(s);let n=e.gallery.scrollBarV.heightContent;if(n>300&&(n=300),e.gallery.height=n,e.panel.height=e.gallery.y+e.gallery.height+e.otstup,2==(s=window.location.href.split("?id=")).length&&1*s[1]){for(var r=1*s[1],h=e.gallery.array.length-1;h>=0;h--)if(e.gallery.array[h].id==r)return e.gallery._index=-2,void(e.gallery.index=h);e.openId(1*s[1])}t&&t()})},this.dragGal()}},this.dragActive=function(){}}}class Je extends DGallery{constructor(t,i,e,s){super(t,i,e,s),this.createZamen=function(){var t=new $e(this.content,0,0,this.downBtn,this.intText,this);return t.whPic=this.whPic,t.finalLink=this.finalLink,t}}set index(t){this._index==t&&(t=-2),trace("@@@@@",this._index,t),this._index=t;for(var i=0;i<this.array.length;i++)this._index==i?(this.array[i].activ=!0,this.killTukIndex=1):this.array[i].activ=!1}get index(){return this._index}}function $e(t,i,e,s,n,r){DBox.call(this,t,i,e,s),this.type="Box1";var h=this;this.id=-1,this.startLoad=function(t){for(var i in t)this.id=1*i;this.object=t,this.image.link="resources/date/save/"+this.id+"/icon.png?"+Math.random(),this.image.visible=!0,h.funLoad(),this.label.visible=!0,this.label.text=""+this.id,this.label.activMouse=!1,this.label.fontSize=10}}$e.prototype=Object.create(DBox.prototype),$e.prototype.constructor=$e,Object.defineProperties($e.prototype,{});class ts{constructor(t){var i,e;this.tip="image/png",this.getBase64=function(s,n){let r=visi3D.getObj();i=visi3D.width,e=visi3D.height,visi3D.utility.focus.active=!0,visi3D.utility.focus.targetObject=t,visi3D.sizeWindow(visi3D._x,visi3D._y,s,n),visi3D.render();var h=visi3D.renderer.domElement.toDataURL(this.tip);return visi3D.sizeWindow(visi3D._x,visi3D._y,i,e),visi3D.utility.focus.active=!1,visi3D.setObj(r),h},this.getFile=function(t,i,e){!function(t,i,e,s,n,r){const h=new Image;h.onload=(()=>{const t=document.createElement("canvas");if(null==r&&null!=e&&e>h.naturalWidth)return void i(null);t.width=null==e?h.naturalWidth:e,t.height=null==s?h.naturalHeight:s;const a=t.getContext("2d");if(a.drawImage(h,0,0,t.width,t.height),null==r)a.canvas.toBlob(t=>{const e=new File([t],null==n?"icon.png":n);i(e)},"image/png");else{let e=t.toDataURL();i(e)}}),h.src=t}(this.getBase64(t,i),e)}}}class is{constructor(t,i){this.type="Mozg";var e,s,n;this.par=t,this.fun=i,this.param=this.par.param,this.dCont=new DCont(t.dCont),this.array=[],this.activMozg=void 0,this.init=function(){this.array[0]=new Ne(this,function(t,i,e){}),this.array[1]=new Xe(this,function(t,i,e){}),this.array[2]=new We(this,function(t,i,e){}),this.array[3]=new Ke(this,function(t,i,e){}),this.array[4]=new qe(this,function(t,i,e){})},this.setModel=function(t,i,e){if("centerModel"==t)return trace(this.activMozg),void(this.activMozg.dragScan&&this.activMozg.dragScan());for(var s=0;s<this.array.length;s++)null!=this.array[s].setModel&&this.array[s].setModel(t,i,e)},this.sizeWindow=function(t,i,r){t&&(e=t,s=i,n=r);for(var h=0;h<this.array.length;h++)this.array[h].sizeWindow&&this.array[h].sizeWindow(e,s,n)},this.init()}set indexStep(t){if(this._indexStep!=t){this._indexStep=t,this.activMozg=void 0;for(var i=0;i<this.array.length;i++)i!=this._indexStep?this.array[i].active=!1:this.activMozg=this.array[i];this.activMozg&&(this.activMozg.active=!0)}}get indexStep(){return this._indexStep}}function es(){var t,i,e,s,n=new THREE.Vector3(0,0,0),r=new THREE.Vector3(0,0,0),h=new THREE.Vector3(0,0,0),a=new THREE.Vector3(0,0,0);this.DEG2RAD=Math.PI/180,this.RAD2DEG=180/Math.PI,this.getAngle=function(t,i){return i=i||a,t=t||a,Math.atan2(i.y-t.y,i.x-t.x)};var o,l,u,c,d,p,f,g,x,y=0;this.getAngle2=function(t,i){return i=i||a,t=t||a,(y=Math.atan2(i.y-t.y,i.x-t.x))<0&&(y+=2*Math.PI),y},this.getDistance=function(t,i){return null==t?0:(null==i&&(i=a),i=i||a,Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2)))},this.getVector=function(t,i,e){if(null==e)e=new THREE.Vector2(0,0);return t<0&&(i+=Math.PI),e.x=Math.abs(t)*Math.cos(i),e.y=Math.abs(t)*Math.sin(i),e},this.isPointInLin=function(t,e,n,a,o){return this.getTreeAngel(t,e,n),o<0&&2*Math.abs(o)>s?null:r.x<=s+o&&r.x>=-o&&Math.abs(r.y)<=a?((h=r.x<0?this.getVector(r.x,i-Math.PI):this.getVector(r.x,i)).x+=e.x,h.y+=e.y,h.z=r.y,h):null},this.okrugPoint=function(t,i){null==i&&(i=100),t.x=Math.round(t.x/i)*i,t.y=Math.round(t.y/i)*i},this.okrugNumber=function(t,i){null==i&&(i=100);var e=Math.round(t*i)/i;return t=e,e},this.isInTriangle=function(t,i,e,s){var n=(t.x-s.x)*(i.y-t.y)-(i.x-t.x)*(t.y-s.y),r=(i.x-s.x)*(e.y-i.y)-(e.x-i.x)*(i.y-s.y),h=(e.x-s.x)*(t.y-e.y)-(t.x-e.x)*(e.y-s.y);return n>=0&&r>=0&&h>=0||n<=0&&r<=0&&h<=0},this.getTreeAngel=function(t,n,h,l){return i=this.getAngle(n,t),e=this.getAngle(n,h),o=this.getDistance(n,h),s=this.getDistance(t,n),this.getVector(o,e-i,r),e=this.getAngle(a,r),null==l?e:e>0?e:2*Math.PI+e},this.getTreeAngelPI2=function(t,i,e){x1=t.x-i.x,x2=e.x-i.x,y1=t.y-i.y,y2=e.y-i.y,s=Math.sqrt(x1*x1+y1*y1),d2=Math.sqrt(x2*x2+y2*y2);var n=(x1*x2+y1*y2)/(s*d2);return n>1&&(n=1),n<-1&&(n=-1),Math.acos(n)},this.isLineInTriangle=function(i,e,s,r,h){return(t=this.getPointOfIntersection(i,e,r,h))?(n.x=t.x,n.y=t.y,n.z=0,n):(t=this.getPointOfIntersection(e,s,r,h))?(n.x=t.x,n.y=t.y,n.z=1,n):!!(t=this.getPointOfIntersection(s,i,r,h))&&(n.x=t.x,n.y=t.y,n.z=2,n)};var m,v,b,w,_=new THREE.Vector2(0,0);this.getPointOfIntersection=function(t,i,e,s){return o=(t.x-i.x)*(s.y-e.y)-(t.y-i.y)*(s.x-e.x),l=(t.x-e.x)*(s.y-e.y)-(t.y-e.y)*(s.x-e.x),u=(t.x-i.x)*(t.y-e.y)-(t.y-i.y)*(t.x-e.x),d=u/o,(c=l/o)>=0&&c<=1&&d>=0&&d<=1?(p=t.x+c*(i.x-t.x),f=t.y+c*(i.y-t.y),_.x=p,_.y=f,_):null},this.korektToLine=function(t,i,e,s,n){g=this.getDistance(t,i),x=null==n?this.getAngle(t,i):n,0!=s&&(_=s<0?this.getVector(-s,x-Math.PI/2):this.getVector(s,x+Math.PI/2),t.x+=_.x,t.y+=_.y,i.x+=_.x,i.y+=_.y),_=this.getVector(e,x),i.x+=_.x,i.y+=_.y,_=this.getVector(e,x+Math.PI),t.x+=_.x,t.y+=_.y},this.getProsent3Point=function(t,i,e){return l=this.getDistance(t,i),(u=this.getDistance(t,e))/l},this.povotorOtAngel=function(t,i,e){return x=this.getAngle(t,i),g=this.getDistance(t,i),this.getVector(g,x+e)},this.testPositPoint=function(t,i,e){return null==e&&(e=100),Math.round(t.x*e)/e==Math.round(i.x*e)/e&&Math.round(t.y*e)/e==Math.round(i.y*e)/e},this.okrugAngel=function(t,i,e){var s=t;m=1,t<0&&(m=-1),v=Math.abs(t),b=Math.round(v/i)+1,w=0;for(var n=b;n>=0;n--){if(v>n*i-e&&v<n*i+e)return s=n*i*m;if(3==++w)return s}return s};var P=new ss,S=new ss,A=[];this.getLineCircleIntersectionPoints=function(t,i,e,s,n){A.length=0;var r=i.x-t.x,h=i.y-t.y,a=e.x-t.x,o=e.y-t.y,l=r*r+h*h,u=(r*a+h*o)/l,c=u*u-(a*a+o*o-s*s)/l;if(c<0)return A;var d=Math.sqrt(c),p=-u+d,f=-u-d;return P.set(t.x-r*p,t.y-h*p),this.isPointInLine(t,i,P)&&A.push(P),0==c?A:(S.set(t.x-r*f,t.y-h*f),this.isPointInLine(t,i,S)&&A.push(S),n&&2==A.length&&(m=this.getDistance(t,A[0]),v=this.getDistance(t,A[1]),m>v&&A.reverse()),A)},this.isPointInLine=function(t,i,e){var s=calc.getDistance(t,i),n=calc.getDistance(t,e),r=calc.getDistance(i,e);return calc.okrugNumber(n+r)===calc.okrugNumber(s)},this.getDistancePointToLine=function(t,i,e){var s=((i.y-t.y)*e.x-(i.x-t.x)*e.y+i.x*t.y-i.y*t.x)/calc.getDistance(t,i);return-calc.okrugNumber(Number.isFinite(s)?s:0)},this.getCircleCircleIntersectionPoints=function(t,i,e,s){var n,r,h,a,o;return A.length=0,(h=Math.sqrt(Math.pow(Math.abs(t.x-e.x),2)+Math.pow(Math.abs(t.y-e.y),2)))>i+s?A:(a=(i*i-s*s+h*h)/(2*h),o=Math.sqrt(Math.pow(i,2)-Math.pow(a,2)),isNaN(o)?A:(n=t.x+a*(e.x-t.x)/h,r=t.y+a*(e.y-t.y)/h,P.x=n+o*(e.y-t.y)/h,P.y=r-o*(e.x-t.x)/h,A.push(P),a==i?A:(S.x=n-o*(e.y-t.y)/h,S.y=r+o*(e.x-t.x)/h,A.push(S),A)))};var T=[new ss,new ss,new ss,new ss],E=[new ss,new ss,new ss,new ss];this.isIntersectionRect=function(t,i){return T[0].set(t.x,t.y),T[1].set(t.x+t.width,t.y),T[2].set(t.x+t.width,t.y+t.height),T[3].set(t.x,t.y+t.height),E[0].set(i.x,i.y),E[1].set(i.x+i.width,i.y),E[2].set(i.x+i.width,i.y+i.height),E[3].set(i.x,i.y+i.height),this.isIntersectionFromPoint(T,E)},this.isIntersectionFromPoint=function(t,i){for(var e=0;e<t.length-2;e++)for(var s=0;s<i.length-2;s++)if(calc.getPointOfIntersection(t[e],t[(e+2)%t.length],i[s],i[(s+2)%i.length]))return!0;for(e=0;e<t.length;e++)for(s=0;s<i.length;s++)if(calc.getPointOfIntersection(t[e],t[(e+1)%t.length],i[s],i[(s+1)%i.length]))return!0;for(e=0;e<i.length;e+=2)if(calc.contains(i[e].x,i[e].y,t))return!0;for(e=0;e<t.length;e+=2)if(calc.contains(t[e].x,t[e].y,i))return!0;return!1},this.isParalel=function(t,i,e,s,n){n=n||0;var r=Math.abs(calc.getAngle(t,i)%Math.PI),h=Math.abs(calc.getAngle(i,t)%Math.PI),a=Math.abs(calc.getAngle(e,s)%Math.PI),o=Math.abs(calc.getAngle(s,e)%Math.PI);return Math.min(Math.abs(r-a),Math.abs(h-o),Math.abs(r-o),Math.abs(h-a))<=n},this.rotationPoint=function(t,i,e){var s=0,n=0;e?(s=e.x+(t.x-e.x)*Math.cos(i)-(t.y-e.y)*Math.sin(i),n=e.y+(t.y-e.y)*Math.cos(i)+(t.x-e.x)*Math.sin(i)):(s=t.x*Math.cos(i)-t.y*Math.sin(i),n=t.y*Math.cos(i)+t.x*Math.sin(i)),t.x=s,t.y=n},this.rotationPointByLength=function(t,i,e){e=e||a;var s=calc.getDistance(t,e),n=calc.getLenghtCircle(s),r=i*(2*Math.PI/n);calc.rotationPoint(t,r,e)},this.isIntersectionTriangle=function(t,i,e,s,n,r){for(var h=!1,a=[t,i,e],o=[s,n,r],l=0;l<a.length&&!h;l++)h=calc.isInTriangle(s,n,r,a[l]);for(l=0;l<o.length&&!h;l++)h=calc.isInTriangle(t,i,e,o[l]);if(!h)for(l=0;l<a.length;l++)for(var u=0;u<o.length&&!h;u++)h=calc.getPointOfIntersection(a[l],a[(l+1)%a.length],o[u],o[(u+1)%o.length]);return h},this.getArrPointCircle=function(t,i,e,s,n,r,h){var a,o=calc.getAngle(e,t)-Math.PI,l=calc.getAngle(s,t)-Math.PI;a=h||[new ss],n=n||5,!(r=r||!1)&&l<=o?l+=2*Math.PI:r&&o<=l&&(o+=2*Math.PI);var u=r?-1*(o-l):l-o,c=Math.ceil(Math.abs(u)/(2*Math.PI))*(n-1),d=u/(2*c),p=2*d,f=Math.cos(d),g=Math.sin(d),x=c-1,y=x%1/x,m=0,v=0,b=0,w=0,_=0;a[0].x=t.x+Math.cos(o)*i,a[0].y=t.y+Math.sin(o)*i;for(var P=0;P<=x;P++)m=d+o+(p*P+y*P),w=(f*(v=Math.cos(m))+g*(b=-Math.sin(m)))*i+t.x,_=(f*-b+g*v)*i+t.y,a[P+1]?(a[P+1].x=w,a[P+1].y=_):a.push(new ss(w,_));return a},this.getLenghtCircle=function(t,i,e,s,n){i||(i=e=s=a);var r=calc.getAngle(e,i)-Math.PI,h=calc.getAngle(s,i)-Math.PI;return r===h&&e!==s?0:(!(n=n||!1)&&h<=r?h+=2*Math.PI:n&&r<=h&&(r+=2*Math.PI),Math.PI*t*(n?r-h:h-r)/Math.PI)},this.getLengthByWidth=function(t,i){var e=new ss(0,0),s=new ss(t,0),n=calc.getVector(i,.5*Math.PI);n.x=t/2;var r=calc.getCenterCircle(e,s,n);return r?calc.getLenghtCircle(calc.getDistance(r,e),r,e,s,i>0):t},this.getCenterCircle=function(t,i,e){var s=i.x-t.x,n=i.y-t.y,r=e.x-t.x,h=e.y-t.y,a=s*(t.x+i.x)+n*(t.y+i.y),o=r*(t.x+e.x)+h*(t.y+e.y),l=2*(s*(e.y-i.y)-n*(e.x-i.x));return 0===l?null:new ss((h*a-n*o)/l,(s*o-r*a)/l)},this.getArcPoint=function(t,i,e,s,n){s=s||5;var r=calc.getAngle(t,i)+90*calc.DEG2RAD,h=calc.getVector(e,r),a=new ss((t.x+i.x)/2,(t.y+i.y)/2);a.x+=h.x,a.y+=h.y;var o=calc.getCenterCircle(t,a,i);return o?calc.getArrPointCircle(o,calc.getDistance(o,t),t,i,s,e>0,n):[t,i]},this.getArea=function(t){for(var i=t.length,e=0,s=i-1,n=0;n<i;s=n++)e+=t[s].x*t[n].y-t[n].x*t[s].y;return.5*e||0},this.generateUUID=function(){for(var t=[],i=0;i<256;i++)t[i]=(i<16?"0":"")+i.toString(16);return function(){var i=4294967295*Math.random()|0,e=4294967295*Math.random()|0,s=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return(t[255&i]+t[i>>8&255]+t[i>>16&255]+t[i>>24&255]+"-"+t[255&e]+t[e>>8&255]+"-"+t[e>>16&15|64]+t[e>>24&255]+"-"+t[63&s|128]+t[s>>8&255]+"-"+t[s>>16&255]+t[s>>24&255]+t[255&n]+t[n>>8&255]+t[n>>16&255]+t[n>>24&255]).toUpperCase()}}(),this.diffNum=function(t,i){return t>=0&&i>=0?Math.abs(t-i):t<=0&&i<=0?Math.abs(Math.abs(t)-Math.abs(i)):t<=0&&i>=0?Math.abs(t)+i:t>=0&&i<=0?t+Math.abs(i):void 0},this.getPercentNum=function(t,i,e){return((t=null!=t?t:0)-(i=null!=i?i:0))/((e=null!=e?e:100)-i)*100},this.getValueNum=function(t,i,e){return(t=null!=t?t:0)/100*((e=null!=e?e:100)-(i=null!=i?i:0))+i},this.getValueBetween=function(t,i,e){var s=Math.max(i,e),n=Math.min(i,e);return Math.max(Math.min(t,s),n)},this.contains=function(t,i,e){for(var s=!1,n=e.length,r=0,h=n-1;r<n;h=r++){if(e[r].x===t&&e[r].y===i)return!0;var a=e[r].x,o=e[r].y,l=e[h].x,u=e[h].y;o>i!=u>i&&t<(l-a)*(i-o)/(u-o)+a&&(s=!s)}return s};var M={maxX:0,minX:0,maxY:0,minY:0},D=new ss,z=[new ss,new ss,new ss,new ss],R=new ss;this.getBoundsRect=function(t,i){R.set(t.width/2,t.height/2),z[0].set(0,0),z[1].set(t.width,0),z[2].set(t.width,t.height),z[3].set(0,t.height);for(var e=0;e<z.length;e++)this.rotationPoint(z[e],i,R);M.maxX=-t.width,M.minX=t.width,M.maxY=-t.height,M.minY=t.height;for(e=0;e<z.length;e++)M.maxX=Math.max(M.maxX,z[e].x),M.minX=Math.min(M.minX,z[e].x),M.maxY=Math.max(M.maxY,z[e].y),M.minY=Math.min(M.minY,z[e].y);return D.x=M.minX,D.y=M.minY,D.width=M.maxX-M.minX,D.height=M.maxY-M.minY,D},this.getCurvatureByWidth=function(t,i){if(Math.abs(t)>2*i)return null;var e=Math.pow(Math.abs(t),2),s=Math.pow(i,2),n=Math.acos((s+s-e)/(2*s));return i*(1-Math.cos(n/2))*(t<0?-1:1)},this.getWidthByCurvature=function(t,i){return 2*i*Math.sin(Math.acos(1-2*Math.abs(t)/(2*i)))*(t<0?-1:1)};var B=function(t,i){if(C(t)&&C(i))return t===i;for(var e in t){if(t.hasOwnProperty(e)!==i.hasOwnProperty(e))return!1;switch(typeof t[e]){case"object":if(!B(t[e],i[e]))return!1;break;case"function":if(void 0===i[e]||"compare"!==e&&t[e].toString()!==i[e].toString())return!1;break;case"number":if(Number(Number(t[e]).toFixed(3))!==Number(Number(i[e]).toFixed(3)))return!1;break;default:if(t[e]!==i[e])return!1}}for(var e in i)if(t.hasOwnProperty(e)!==i.hasOwnProperty(e))return!1;return!0};function C(t){return t!==Object(t)}this.compare=B}function ss(t,i,e){this._x=t||0,this._y=i||0,this._z=e||0,this.set=function(t,i,e){this._x=t||0,this._y=i||0,void 0!==e&&(this._z=e)},this.setPoint=function(t){this._x=t.x,this._y=t.y,void 0!==t.z&&(this._z=t.z)},this.getObj=function(){var t={};return t.x=this._x,t.y=this._y,t.z=this._z,t},this.copy=function(){return new ss(this._x,this._y,this._z)}}ss.prototype={set x(t){this._x=t},get x(){return this._x},set y(t){this._y=t},get y(){return this._y},set z(t){this._z=t},get z(){return this._z}};class ns{constructor(t,i){this.type="SobIndex";var e,s;this.par=t,this.fun=i,this.mozgMenu=void 0,this._sah=0,this.calcXZ=new es,this.setActive=function(){this.par.floor.sp.activMouse=!0,this.par.floor.visiPoint=!0},this.move=function(t){},this.out=function(t){},this.over=function(t){},this.down=function(t){},this.up=function(t){},this.getGObj=function(t,i){var e="objGlob";return null!=i&&(e=i),t&&t.target?function t(i,e){if(i[e])return i[e];if(i.parent)return t(i.parent,e);return null}(t.target,e):null},this.clear=function(){this._sah=0},this.clearActive=function(){!1,e=this.par.floor.sp.arrPoint,s=this.par.floor.sp.arrSplice;for(var t=0;t<e.length;t++)e[t].life&&!1!==e[t].active&&(e[t].active=!1);for(t=0;t<s.length;t++)s[t].life&&!1!==s[t].active&&(s[t].active=!1)},this.distSten=20,this.getPosEv3D=function(t){var i=new THREE.Vector3;return i.set(-this.par.whSize/2+this.par.whSize*t.uv.x,-(-this.par.whSize/2+this.par.whSize*t.uv.y),0),i};var n,r=new THREE.Vector2,h=new THREE.Vector2;this.getSten=function(t){return this.getParName(t,"sten")},this.getParName=function(t,i){return null!=t[i]?t[i]:null!=t.parent?this.getParName(t.parent,i):null},this.getPosEv3DSten=function(t){var i=new THREE.Vector3;return null==(n=this.getSten(t.target))?null:(i.z=2,h.x=t.point.x,h.y=t.point.z,calc.getDistance(h,n.position)<25?(i.z=0,i.x=n.position.x,i.y=n.position.y,i):calc.getDistance(h,n.position1)<25?(i.z=1,i.x=n.position1.x,i.y=n.position1.y,i):(r=calc.isPointInLin(n.position,n.position1,h,100,100),i.z=2,i.x=r.x,i.y=r.y,i))},this.getDistSten=function(t,i){return h.x=i.x,h.y=i.z,r=calc.isPointInLin(t.position,t.position1,h,11111,11111),calc.getDistance(t.position,r)};var a=new THREE.Vector3,o=[],l=[];this.startAP=function(t,i){t,t?(a.x=t.position.x,a.y=t.position.y):(a.x=9999999999,a.y=9999999999),o.length=0;for(var e=0;e<this.par.floor.sp.arrPoint.length;e++)this.par.floor.sp.arrPoint[e].life&&(t&&this.par.floor.sp.arrPoint[e]._uuid==t._uuid||i&&this.par.floor.sp.arrPoint[e]._uuid==i._uuid||o.push(this.par.floor.sp.arrPoint[e]));var s;l.length=0;for(e=0;e<this.par.floor.sp.arrSplice.length;e++)if(this.par.floor.sp.arrSplice[e].life){s=!0;for(var n=0;n<t.arrSHron.length;n++)t.arrSHron[n].sten._uuid==this.par.floor.sp.arrSplice[e]._uuid&&(s=!1);1==s&&l.push(this.par.floor.sp.arrSplice[e])}};var u,c,d=new THREE.Vector3,p=new THREE.Vector3;this.korektAP=function(t){wH3D.clear(),u=!1,c=!1,t.x=Math.round(10*t.x)/10,t.y=Math.round(10*t.y)/10,a.x-10<t.x&&a.x+10>t.x&&(t.x=a.x,u=!0),a.y-10<t.y&&a.y+10>t.y&&(t.y=a.y,c=!0),t.obj=void 0;for(var i=0;i<o.length;i++){if(calc.getDistance(t,o[i].position)<10.1)return t.x=o[i].position.x,t.y=o[i].position.y,void(t.obj=o[i]);o[i].position.x-10<t.x&&o[i].position.x+10>t.x&&(t.x=o[i].position.x,u=!0),o[i].position.y-10<t.y&&o[i].position.y+10>t.y&&(t.y=o[i].position.y,c=!0)}u&&(d.z=-75,d.x=t.x,d.y=t.y,p.z=-75,p.x=t.x,p.y=t.y+10,wH3D.setLine(d,p,null,null,2e4)),c&&(d.z=-75,d.x=t.x,d.y=t.y,p.z=-75,p.x=t.x+10,p.y=t.y,wH3D.setLine(d,p,null,null,2e4))},this.keydown=function(t,i,e){},this.keyup=function(t,i,e){}}}class rs extends ns{constructor(t,i){super(),this.type="SobIndex0";var e,s,n=this;this.par=t,this.fun=i,this._sah=0;var r=[],h=new THREE.Vector3,a=new THREE.Vector3,o=(new THREE.Vector3,new THREE.Vector3),l=new THREE.Vector3,u=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],c=[new THREE.Vector3,new THREE.Vector3];this.move=function(t){};var d,p,f,g,x;this.drahPoint=function(){if(p){for(var t=0;t<p.array.length;t++){let i=new THREE.Vector3;i.x=r[t].x+n.par.tukalka.valueX,i.y=r[t].y+n.par.tukalka.valueY,p.array[t].position.setPoint(i),p.array[t].dragVokrug(),p.array[t].drag()}n.par.visi3D.intRend=1}e&&n.dragPoint(),d&&(h.x=l.x+n.par.tukalka.valueX,h.y=l.y+n.par.tukalka.valueY,n.dragSten())},this.stopPoint=function(){e&&(h.x=s.x+n.par.tukalka.valueX,h.y=s.y+n.par.tukalka.valueY,n.korektAP(h),null!=h.obj&&("SpPointSten"==h.obj.type&&h.obj.slitie(e),"SpliceSten"==h.obj.type&&h.obj.dividedSten(e,!0))),wH3D.clear()},this.out=function(t){(f=this.getGObj(t))&&(null!=f.active&&(visi3D.intRend=1),"TCompArrow"==f.type&&(f.active=!1),window.document.body.style.cursor="auto")},this.over=function(t){(f=this.getGObj(t))&&(visi3D.intRend=1,"TCompArrow"==f.type&&(f.active=!0),window.document.body.style.cursor="pointer")},this.down=function(t){if(e=null,d=null,p=null,f=this.getGObj(t)){if("TCompArrow"==f.type){if(d=f.sten,trace("!!!!!!!!!!!!!!TCompArrow!!!!!!!!!!!!"),null==d)return void n.par.activOne(f);let i=d.delim();return trace(i),e=i.addPoint1,g=t.point.y,n.par.planDrag.setZ(g),s=new THREE.Vector3(e.position.x,e.position.y),n.par.tukalka.start(n.par.content3d,new THREE.Vector3(t.point.x,t.point.z,-t.point.y),n.drahPoint,n.stopPoint),n.par.visi3D.intRend=1,n.startAP(e),!0,d=null,void n.par.activOne(f)}if("SpPointSten"==f.type){if(e=f,n.par.activOne(e),null==t.originalEvent.touches&&0!=t.originalEvent.button)return;return s=new THREE.Vector3(e.position.x,e.position.y),l.copy(s),o.copy(s),n.par.tukalka.start(n.par.content3d,new THREE.Vector3(t.point.x,t.point.z,-t.point.y),n.drahPoint,n.stopPoint),n.par.visi3D.intRend=1,n.startAP(e),void!0}if("SpliceSten"==f.type){if(d=f,n.par.activOne(d),n.par.visi3D.intRend=1,null==t.originalEvent.touches&&0!=t.originalEvent.button)return;return s=new THREE.Vector3(d.position.x,d.position.y),u[0].copy(d.position),u[1].copy(d.position1),u[2].x=(d.position.x+d.position1.x)/2,u[2].y=(d.position.y+d.position1.y)/2,l.copy(u[2]),o.copy(u[2]),s.copy(u[2]),H=d._distans/2,F=d._rotation,this.setPosVV(9999,u[2],c[0],Math.PI/2+F),this.setPosVV(9999,u[2],c[1],-Math.PI/2+F),n.par.tukalka.start(n.par.content3d,new THREE.Vector3(t.point.x,t.point.z,-t.point.y),n.drahPoint,n.stopPoint),void!0}}n.par.activOne(null)},this.clear=function(){this._sah=0};var y={x:0,y:0},m={x:0,y:0};this.korektToLine=function(t,i,e){y.x=(t.x+i.x)/2,y.y=(t.y+i.y)/2,V=calc.getDistance(y,m),x=(V+e)/V,t.x=(t.x-y.x)*x+y.x,t.y=(t.y-y.y)*x+y.y,i.x=(i.x-y.x)*x+y.x,i.y=(i.y-y.y)*x+y.y},this.korArr=function(t,i){return t<0?(t+=i,this.korArr(t,i)):t>=i?(t-=i,this.korArr(t,i)):t};var v,b,w,_,P,S,A,T,E,M,D,z,R={x:0,y:0};this.isGoodPoint=function(t){A=t.length,R.x=0,R.y=0,0;for(var i=0;i<t.length;i++)for(var e=i+1;e<t.length;e++)if((V=calc.getDistance(t[i],t[e]))<50)return!1;T=0;for(i=0;i<t.length;i++)if(v=t[this.korArr(i-1,A)],b=t[this.korArr(i,A)],w=t[this.korArr(i+1,A)],N=Math.round(180*calc.getTreeAngel(v,b,w)/Math.PI),T+=N,Math.abs(N)<5)return!1;if(T>0)return!1;for(i=0;i<t.length;i++){E=this.korArr(i-1,A),M=i,v=t[E],b=t[M];for(e=0;e<t.length-3;e++){if(D=this.korArr(i+1,A),z=this.korArr(i+2,A),_=t[D],P=t[z],S=calc.getPointOfIntersection(v,b,_,P))return!1;if(S=calc.isPointInLin(v,b,_,30,0))return!1;if(S=calc.isPointInLin(v,b,P,30,0))return!1}}return!0},this.dragPoint=function(){h.x=s.x+n.par.tukalka.valueX,h.y=s.y+n.par.tukalka.valueY,a.x=l.x,a.y=l.y,this.privazka([h],[e]),this.privazkaFinal([h],[e]),this.dragWWW(h,a,0,5,0,!0),this.korektAAA(h,!0),1==this.isGoodPoint(B)&&(l.x=h.x,l.y=h.y),e.position.setPoint(h),e.dragVokrug(),e.drag(),n.par.visi3D.intRend=1};var B=[],C=new THREE.Vector3,L=new THREE.Vector3;this.dragSten=function(){h.x=s.x+n.par.tukalka.valueX,h.y=s.y+n.par.tukalka.valueY,this.setPosVV(H,h,X,F+Math.PI),this.setPosVV(H,h,U,F),this.privazka([X,h,U],[d.addPoint1,d.addPoint]),this.privazkaOs(h,c),this.privazkaFinal([X,h,U],[d.addPoint1,d.addPoint]),a.x=l.x,a.y=l.y,this.dragWWW(h,a,0,5,0),this.korektAAA(h),1==this.isGoodPoint(B)&&(l.x=h.x,l.y=h.y),this.setPosSten(h)};var O,I,k,j,H,F,N,V,G=new THREE.Vector3;new THREE.Vector3;this.dragWWW=function(t,i,e,s,n,r){if(++n>10)return;if(this.korektAAA(t,r),0==this.isGoodPoint(B)){if(G.x=(t.x+i.x)/2,G.y=(t.y+i.y)/2,this.korektAAA(G,r),0==this.isGoodPoint(B))t.x=G.x,t.y=G.y,this.dragWWW(t,i,e+1,s,n,r);else{if(i.x=G.x,i.y=G.y,e>s)return;this.dragWWW(t,i,e,s,n,r)}}},this.korektAAA=function(t,i){if(i){O=null;for(var s=0;s<n.par.floor.sp.arrSplice.length;s++)1==n.par.floor.sp.arrSplice[s].life&&n.par.floor.sp.arrSplice[s].addPoint.uuid==e.uuid&&(O=n.par.floor.sp.arrSplice[s]);O&&(B.length=0,C.x=t.x,C.y=t.y,B.push(C),L.x=O.addPoint1.position.x,L.y=O.addPoint1.position.y,B.push(L),this.dragSRR(O))}else O=d,this.setPosVV(H,t,C,F+Math.PI),this.setPosVV(H,t,L,F),B.length=0,B.push(C,L),this.dragSRR(d)},this.dragSRR=function(t){I=t.addPoint1,k=null;for(var i=0;i<I.arrSHron.length;i++)if(I.arrSHron[i].sten.uuid!=t.uuid){k=I.arrSHron[i].sten.addPoint1,j=I.arrSHron[i].sten;break}null!=k&&k.uuid!=O.addPoint.uuid&&(B.push(k.position),this.dragSRR(j))};var X=new THREE.Vector3,U=new THREE.Vector3;this.setPosSten=function(t){this.setPosVV(H,t,X,F+Math.PI),d.addPoint.position.setPoint(X),d.addPoint.dragVokrug(),d.addPoint.drag(),this.setPosVV(H,t,X,F),d.addPoint1.position.setPoint(X),d.addPoint1.dragVokrug(),d.addPoint1.drag()},this.setPosVV=function(t,i,e,s){calc.getVector(t,s,e),e.x+=i.x,e.y+=i.y};var Y,W,Q,Z,K={x:0,y:0,x1:0,y1:0,xz:0,yz:0};this.privazka=function(t,i){K.x1=99999,K.y1=99999,K.xz=0,K.yz=0;for(var s=0;s<t.length;s++){Y=t[s];for(var n=0;n<this.par.floor.sp.arrPoint.length;n++)if(this.par.floor.sp.arrPoint[n].life){Z=!0;for(var r=0;r<i.length;r++)this.par.floor.sp.arrPoint[n].uuid==i[r].uuid&&(Z=!1);0!=Z&&(W=this.par.floor.sp.arrPoint[n].position,(Q=Math.abs(Y.x-W.x))<20&&K.x1>Q&&(K.x1=Q,K.x=W.x,K.xz=Y.x-W.x),(Q=Math.abs(Y.y-W.y))<20&&K.y1>Q&&(K.y1=Q,K.y=W.y,K.yz=Y.y-W.y))}e&&((Q=Math.abs(Y.x-o.x))<20&&K.x1>Q&&(K.x1=Q,K.x=o.x,K.xz=Y.x-o.x),(Q=Math.abs(Y.y-o.y))<20&&K.y1>Q&&(K.y1=Q,K.y=o.y,K.yz=Y.y-o.y))}},this.privazkaOs=function(t,i){(S=calc.isPointInLin(i[0],i[1],t,30,0))&&((Q=Math.abs(t.x-S.x))<20&&K.x1>Q&&(K.x1=Q,K.x=S.x,K.xz=t.x-S.x),(Q=Math.abs(t.y-S.y))<20&&K.y1>Q&&(K.y1=Q,K.y=S.y,K.yz=t.y-S.y))};var q,J=-75,$=new THREE.Vector3,tt=new THREE.Vector3;this.privazkaFinal=function(t,i){if(q=!1,0===K.xz&&0===K.yz||(q=!0),wH3D.clear(),0!=q){for(var s=0;s<t.length;s++)t[s].x-=K.xz,t[s].y-=K.yz;for(s=0;s<t.length;s++){Y=t[s];for(var n=0;n<this.par.floor.sp.arrPoint.length;n++)if(this.par.floor.sp.arrPoint[n].life){Z=!0;for(var r=0;r<i.length;r++)this.par.floor.sp.arrPoint[n].uuid==i[r].uuid&&(Z=!1);0!=Z&&(W=this.par.floor.sp.arrPoint[n].position,(Q=Math.abs(Y.x-W.x))<.02&&($.z=J,$.x=Y.x,$.y=Y.y,tt.z=J,tt.x=Y.x,tt.y=Y.y+10,wH3D.setLine($,tt,null,null,2e4)),(Q=Math.abs(Y.y-W.y))<.02&&($.z=J,$.x=Y.x,$.y=Y.y,tt.z=J,tt.x=Y.x+10,tt.y=Y.y,wH3D.setLine($,tt,null,null,2e4)))}e&&((Q=Math.abs(Y.x-o.x))<.02&&($.z=J,$.x=Y.x,$.y=Y.y,tt.z=J,tt.x=Y.x,tt.y=Y.y+10,wH3D.setLine($,tt,null,null,2e4)),(Q=Math.abs(Y.y-o.y))<.02&&($.z=J,$.x=Y.x,$.y=Y.y,tt.z=J,tt.x=Y.x+10,tt.y=Y.y,wH3D.setLine($,tt,null,null,2e4)))}t[1]&&(S=calc.isPointInLin(c[0],c[1],t[1],1,0))&&($.z=J,$.x=c[0].x,$.y=c[0].y,tt.z=J,tt.x=c[1].x,tt.y=c[1].y,wH3D.setLine($,tt,null,null,20))}}}}class hs extends ns{constructor(t,i){super(),this.type="SobIndex1";var e,s,n,r,h=this;this.par=t,this.fun=i,this.dot=2,this.out=function(t){(e=this.getGObj(t))&&("Osi"==e.type&&(e.active=!1,window.document.body.style.cursor="auto"),"TComp3But"==e.type&&t.target.button&&(t.target.button.active||(window.document.body.style.cursor="auto")),"TCompArrow"==e.type&&(e.active=!1,window.document.body.style.cursor="auto"))},this.over=function(t){(e=this.getGObj(t))&&("Osi"==e.type&&(e.active=!0,window.document.body.style.cursor="pointer"),"TComp3But"==e.type&&t.target.button&&(window.document.body.style.cursor="pointer"),"TCompArrow"==e.type&&(e.active=!0,window.document.body.style.cursor="pointer"))};var a={x:0,y:0},o={x:0,y:0};this.drahPoint=function(){if("Osi"!=c.type)if("TC3Big"!=c.gronPoint.type){if(c&&(c.boolKill=!1),0==d.idArr){let i=h.par.tukalka.valueY;x.z2-i<25&&(i=-(25-x.z2));let e=x.z-i,s=h.korektAD(e,x.gObj);c.button.z=s,c.button1.z=x.z1-i+(s-e),c.button2.z=x.z2-i+(s-e);var t=h.par.tukalka.valueX*g;h.korektXY(t,x.prosentOld,c.gronPoint)}else{let t=x.zAct-h.par.tukalka.valueY;for(var i=x.az.length-1;i>=0;i--)Math.abs(x.az[i]-t)<h.dot&&(t=x.az[i]);t<25&&(t=25),t=h.korektAD(t,x.gObj),d.z=t,h.korektVusota(x.gObj)}h.par.dragMenu(),-1!=c.gronPoint.idAp&&(r=c.gronPoint.idAp+1,n=!1,s=c.gronPoint.par.array,a.x=c.gronPoint.point.x,a.y=c.gronPoint.point.y,a.y<c.gronPoint.point1.y&&(a.y=c.gronPoint.point1.y),o.x=s[r-1].point.x,o.y=s[r-1].point.y,o.y<s[r-1].point1.y&&(o.y=s[r-1].point1.y),(T=calc.getDistance(a,o))<20&&(n=!0),o.x=s[r+1].point.x,o.y=s[r+1].point.y,o.y<s[r+1].point1.y&&(o.y=s[r+1].point1.y),T=calc.getDistance(a,o),0!==o.x&&T<20&&(n=!0),n&&(c.boolKill=n),c.gronPoint.par.par.par.osiPoint.dragPoint(c.gronPoint)),c.gronPoint.par.par.par.addObjFun(c.gronPoint.par.par.addPoint),c.gronPoint.par.par.par.addObjFun(c.gronPoint.par.par.addPoint1),visi3D.intRend=1}else if(0==d.idArr){let t=x.z2-h.par.tukalka.valueY;c.gronPoint.moveDrag(t,d.idArr),visi3D.intRend=1}else{let t=x.zAct-h.par.tukalka.valueY;c.gronPoint.moveDrag(t,d.idArr),visi3D.intRend=1}else{let t=y.z-h.par.tukalka.valueY,i=h.korektADOsi(t,c);c.setx_y_z(y.x+h.par.tukalka.valueX*g,y.y-h.par.tukalka.valueX*g,i)}},this.stopPoint=function(){wH3D.clear(),"Osi"!=c.type&&(c&&null!=c.gronPoint.tComp3But&&1==c.gronPoint.tComp3But.boolKill&&(c.gronPoint.kill(),c.gronPoint.par.par.par.addObjFun(c.gronPoint.par.par.addPoint),c.gronPoint.par.par.par.addObjFun(c.gronPoint.par.par.addPoint1),h.par.activOne(null)),d.notZbros=!1,"TCBut"!==d.type&&(d.active=!1),x&&x.gObj&&h.korektVusota(x.gObj),c.gronPoint.par.par.par.osiPoint&&c.gronPoint.par.par.par.osiPoint.redrag())},this.korektVusota=function(t){let i=t.button1._z;t.button2._z>i&&(i=t.button2._z),t.button._z!=i&&(t.button.z=i)};var l,u,c,d,p,f,g=1,x={z:0,z1:0,z2:0},y={x:0,y:0,z:0},m=!1;this.down=function(t){if(f=!1,p=null,m=!0,e=this.getGObj(t)){if("SpliceSten"==e.type)return facade.sp.info33But.setObject(null),h.par.activOne(e),void(h.par.visi3D.intRend=1);if("Osi"==e.type){facade.sp.info33But.setObject(null),h.par.activOne(e),h.dby();var i=0;g=1,l=visi3D.rotationZ%(2*Math.PI)*180/Math.PI,1==e.xBool?l>=-270&&l<=-90&&(i+=Math.PI,g=-1):(i=Math.PI/2,g=1,l<=-180&&(i+=Math.PI,g=-1)),y.x=e.position.x,y.y=e.position.y,y.z=e.position.z,c=e,h.par.tukalka.start(h.par.content3d,new THREE.Vector3(t.point.x,t.point.z,-t.point.y),h.drahPoint,h.stopPoint,-Math.PI/2,null,i),m=!1}if("TCompArrow"==e.type){facade.sp.info33But.setObject(null),h.par.activOne(e);let t=e.gPoint.par.addPointCenter(e.gPoint);e=t.tComp3But,p=t.tComp3But.button,t.tComp3But.button.active=!0,f=!0}if("TComp3But"==e.type){h.boolCTRL,c=e,d=p,p||(d=t.target.button),x.z=e.button.z,x.z1=e.button1.z,x.z2=e.button2.z,x.az=[x.z,x.z1,x.z2],x.gObj=e,x.zAct=d.z,x.act=d,this.dby(),x.prosentOld=c.gronPoint.prosent,d.notZbros=!0,"TC3Big"==c.gronPoint.type?c.gronPoint.startDrag():(facade.sp.info33But.setObject(e),f&&(c.gronPoint.par.par.par.addObjFun(c.gronPoint.par.par.addPoint),setTimeout(function(){facade.sp.info33But.setObject(e),visi3D.intRend=1},0)));i=-visi3D.rotationZ;0!==c.gronPoint.idArr&&(g=-1,l=-c.gronPoint.par.par._rotation%(2*Math.PI),u=(-visi3D.rotationZ+c.gronPoint.par.par._rotation)%(2*Math.PI)*180/Math.PI,i=l,u>=-90&&u<=90||(g=1,i=l+Math.PI)),"TC3Big"==c.gronPoint.type&&(i=-visi3D.rotationZ),h.par.tukalka.start(h.par.content3d,new THREE.Vector3(t.point.x,t.point.z,-t.point.y),h.drahPoint,h.stopPoint,-Math.PI/2,null,i),m=!1}}0!=m&&h.par.dragCenter.setMouse(t)},this.boolCTRL=!1,this.keydown=function(t,i,e){void 0!==e&&(this.boolCTRL=e)},this.keyup=function(t,i,e){void 0!==e&&(this.boolCTRL=e)};var v,b,w,_,P,S,A,T,E,M=new THREE.Vector3,D=new THREE.Vector3,z=new THREE.Vector3,R=new THREE.Vector3;this.korektXY=function(t,i,e){let s=i-t/e.par.par._distans;D.x=e.par.par._distans*s,D.y=0,M=wH3D.getPointGlobSten(e.par.par,0,0,D),999,E=99999;for(var n=0;n<K.length;n++)K[n].par.par.uuid!=e.par.par.uuid&&K[n].uuid!=e.uuid&&(b=Math.abs(M.x-K[n].posit.x),(w=Math.abs(M.y-K[n].posit.y))>5&&b<10&&Math.abs(b)>.01&&b<10&&E>b&&(z.x=K[n].posit.x,z.y=K[n].posit.y-999999,R.x=K[n].posit.x,R.y=K[n].posit.y+9e5,(v=calc.getPointOfIntersection(e.par.par._addPoint.position,e.par.par._addPoint1.position,z,R))&&(E=b,_=K[n],s=calc.getDistance(v,e.par.par._addPoint.position)/e.par.par._distans)));S=99999;for(n=0;n<K.length;n++)K[n].par.par.uuid!=e.par.par.uuid&&K[n].uuid!=e.uuid&&(b=Math.abs(M.x-K[n].posit.x),w=Math.abs(M.y-K[n].posit.y),b>5&&w<10&&Math.abs(w)>.01&&S>w&&(z.x=K[n].posit.x-999999,z.y=K[n].posit.y,R.x=K[n].posit.x+9e5,R.y=K[n].posit.y,(v=calc.getPointOfIntersection(e.par.par._addPoint.position,e.par.par._addPoint1.position,z,R))&&(S=w,P=K[n],s=calc.getDistance(v,e.par.par._addPoint.position)/e.par.par._distans)));return 0==e.bForst?(s<0&&(e.tComp3But.boolKill=!0,s=0),s>1&&(e.tComp3But.boolKill=!0,s=1)):s=0,c.gronPoint.setProsent(s),99999!=E&&(c.gronPoint.drag(),M.x=c.gronPoint.posit.x,M.y=c.gronPoint.posit.y,M.z=-c.gronPoint.posit.z-20,D.x=_.posit.x,D.y=_.posit.y,D.z=-_.posit.z-20,wH3D.setLine(M,D)),99999!=S&&(c.gronPoint.drag(),M.x=c.gronPoint.posit.x,M.y=c.gronPoint.posit.y,M.z=-c.gronPoint.posit.z-20,D.x=P.posit.x,D.y=P.posit.y,D.z=-P.posit.z-20,wH3D.setLine(M,D)),s},this.korektADOsi=function(t,i){A=t,wH3D.clear(),A=t,E=99999;for(var e=0;e<q.length;e++)(T=Math.abs(q[e]-t))<10&&E>T&&(A=q[e],E=T);return 99999!==E&&wH3D.setYSP(A+20,0),A},this.korektAD=function(t,i){A=t,E=99999;for(var e=0;e<q.length;e++)(T=Math.abs(q[e]-t))<10&&E>T&&(A=q[e],E=T);return wH3D.clear(),99999!=E?wH3D.setYSP(A+20,0):A=this.korektADSten(A,i.gronPoint),A};var B,C,L,O,I,k=[],j={x:0,y:0},H={x:0,y:0},F={x:0,y:0},N={x:0,y:0},V={x:0,y:0},G={x:0,y:0},X={x:0,y:0},U={x:0,y:0};this.korektADSten=function(t,i){let e=t;k.length=0;var s=-1;O=i.par.array;for(var n=0;n<O.length;n++)O[n].uuid==i.uuid&&(s=n);null!=O[s-1]&&null!=O[s+1]&&k.push(s+1,s-1),null!=O[s-2]&&null!=O[s-1]&&k.push(s-2,s-1),null!=O[s+2]&&null!=O[s+1]&&k.push(s+2,s+1),j.x=H.x=i.point.x,j.y=99999999,H.y=-9999999,L=9999;for(n=0;n<k.length;n+=2)F.x=O[k[n]].point.x,k[n]==O.length-1&&(F.x=i.par.par._distans),N.x=O[k[n+1]].point.x,F.y=O[k[n]].point.y,N.y=O[k[n+1]].point.y,this.korektToLine(F,N,X,U),(B=calc.getPointOfIntersection(X,U,j,H))&&(C=Math.abs(B.y-e))<20&&C<L&&(L=C,n,e=B.y,V.x=F.x,G.x=N.x,V.y=F.y,G.y=N.y);return 9999!=L&&(calc.getVector(V.x,i.par.par._rotation,j),j.x+=i.par.par._addPoint.position.x,j.y+=i.par.par._addPoint.position.y,j.z=-V.y-20,calc.getVector(G.x,i.par.par._rotation,H),H.x+=i.par.par._addPoint.position.x,H.y+=i.par.par._addPoint.position.y,H.z=-G.y-20,wH3D.setLine(j,H,null,null,9959)),e};var Y={x:0,y:0},W={x:0,y:0};this.korektToLine=function(t,i,e,s){e.x=t.x,e.y=t.y,s.x=i.x,s.y=i.y;Y.x=(e.x+s.x)/2,Y.y=(e.y+s.y)/2,calc.getDistance(Y,W),I=(T+900)/T,e.x=(e.x-Y.x)*I+Y.x,e.y=(e.y-Y.y)*I+Y.y,s.x=(s.x-Y.x)*I+Y.x,s.y=(s.y-Y.y)*I+Y.y};var Q,Z,K=[],q=[];this.dby=function(){q.length=0,K.length=0,Q=facade.sp;for(var t=0;t<Q.arrSplice.length;t++)if(1==Q.arrSplice[t].life){Z=Q.arrSplice[t].sVephPoint.array;for(var i=0;i<Z.length;i++)q.push(Z[i].tComp3But.button.z),q.push(Z[i].tComp3But.button1.z),q.push(Z[i].tComp3But.button2.z),K.push(Z[i])}for(t=0;t<q.length;t++)for(i=q.length-1;i>t;i--)q[t]==q[i]&&q.splice(i,1);for(t=0;t<K.length;t++)for(i=K.length-1;i>t;i--)K[t].uuid==K[i].uuid&&K.splice(i,1)}}}class as extends ns{constructor(t,i){super(),this.type="SobIndex2";var e=this;this.par=t,this.fun=i;var s,n=void 0,r={x:0,y:0};n=void 0;this.sp=this.par.par.view.facade.sp,this.up=function(t){null!=n&&(n.dONotEvent&&n.dONotEvent(null),n=void 0,window.dragPic.stop(),visi3D.position3d.pause=!1,wH3D.clear())},this.over=function(t){},this.korektP2=function(t,i,e,n){o.x=t,o.y=i,s=calc.isPointInLin(h.addPoint.position,h.addPoint1.position,o,1000001,0);var r=this.calcXZ.getDistance(s,h.addPoint.position);l.x=r+n,l.y=e};var h,a,o={x:0,y:0},l={x:0,y:0},u={x:20,y:20};this.move=function(t){null!=n&&((h=this.getGObj(t))&&"SpliceSten"==h.type?(e.korektP2(t.point.x,t.point.z,t.point.y+u.y,u.x),null==n.parent&&(n.setPosition(l.x,l.y,0),h.addBlok(n),void 0!==n.parent?(n.parent.clearYBig(),n.parent.dragOsi(n),window.dragPic.stop()):0==window.dragPic.active&&window.dragPic.start(48,n.icon,n,this.upDrag,1)),void 0!==n.parent&&n.parent.par.uuid!=h.uuid&&(u.x=0,u.y=0,e.korektP2(t.point.x,t.point.z,t.point.y+u.y,u.x),n.parent.par.removeBlok(n),h.addBlok(n),void 0!==n.parent&&(n.parent.clearYBig(),n.parent.dragOsi(n))),void 0!==n.parent&&(n.parent.korectOsi(l,n),n.setPosition(l.x,l.y,0))):void 0!==n.parent&&"ManMouse3D"==t.target.name&&(window.dragPic.start(48,n.icon,n,this.upDrag,1),n.parent.par.removeBlok(n),visi3D.intRend=1,u.x=0,u.y=0),visi3D.intRend=1)},this.down=function(t){if(u.x=0,u.y=0,h=this.getGObj(t),null!=(a=this.getGObj(t,"objBlok"))){if(n=a,e.boolCTRL){var i=n.copy();n.parent.addBlok(i),i.parent&&(n=i)}e.korektP2(t.point.x,t.point.z,t.point.y,0),u.x=n._x-l.x,u.y=n._y-l.y,n.dONotEvent&&n.dONotEvent(!0),visi3D.event3DArr.mouseRay();let s=visi3D.event3DArr.event3D,r=this.getGObj(s);r&&r.idArr===h.idArr&&(e.korektP2(s.point.x,s.point.z,s.point.y,0),u.x=n._x-l.x,u.y=n._y-l.y),n.parent.dragOsi(),visi3D.position3d.pause=!0,e.sp.worldBlok.activeObject=n,e.par.activOne(n)}},this.sobSP=function(t,i,s){if(r.x=0,r.y=0,"creatObjDin"==t)return visi3D.position3d.pause=!0,(n=e.sp.worldBlok.getBlok(i)).init(),e.par.activOne(n),e.sp.worldBlok.activeObject=n,window.dragPic.start(48,n.icon,n,this.upDrag,1),void(n.funMouseDown&&n.funMouseDown())},this.upDrag=function(){}}}class os extends ns{constructor(t,i){super(),this.type="SobIndex0";var e,s,n,r,h=this;this.par=t,this.fun=i,this.setActive=function(){this.par.floor.sp.activMouse=!0,this.par.floor.visiPoint=!1,this.par.floor.bazaMod.activMouse=!0,this.par.floor.bazaMod.activeRadius=!1},this.move=function(t){},this.out=function(t){},this.over=function(t){},this.down=function(t){if(n=null,e=null,s=null,t.target){if("Pol3D"==t.target.name)return s=t.target.gObj,void h.par.activOne(s);if("PointSten"==t.target.name)return n=t.target.objGlob,void h.par.activOne(n);if("Sten3D"==t.target.name)return e=h.getSten(t.target),h.par.activOne(e),void(h.par.visi3D.intRend=1);if(trace(">>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>",t.target.name),r=h.getParName(t.target,"gObj"),trace(">>>>>>",r),null!=r&&"Blok"==r.type)return trace(">>",r),void h.par.activOne(r)}h.par.activOne(null)},this.clear=function(){}}}class ls extends ns{constructor(t,i){super(),this.type="SobIndex4";this.par=t,this.fun=i,this.setActive=function(){},this.move=function(t){},this.out=function(t){},this.over=function(t){},this.down=function(t){},this.clear=function(){}}}class us{constructor(t,i){this.type="FManager";var e=this;this.par=t,this.fun=i,this._index=-1,this._tipDrav=-1,this.visi3D=t.visi3D,this.mobile=t.mobile,this._boolDraw=!1,this.menu=void 0,this.whSize=t.whSize,this.floor,this.array=[],this.debug=t.debug,this.content3d=new THREE.Object3D,t.content3d.add(this.content3d),this.planDrag=new ds(this),this.tukalka=new ps(this.visi3D),this.dragCenter=new cs(this),this.sobDragPic=void 0,this.sobIndex=[],this.sobIndex[0]=new rs(this),this.sobIndex[1]=new hs(this),this.sobIndex[2]=new as(this),this.sobIndex[3]=new os(this),this.sobIndex[4]=new ls(this);new THREE.Vector3;this.addFloor=function(t){null!=this.floor&&(null!=this.floor.dContDebag&&null!=this.floor.dContDebag.parent&&this.floor.dContDebag.parent.remove(this.floor.dContDebag),this.floor.activMouse=!1),this.floor=t,this.floor.activMouse=!0,this.floor.sp.visi3D=this.visi3D,this.debug&&null!=this.floor.dContDebag&&this.par.par.dCV.add(this.floor.dContDebag)},this.addMenu=function(t){this.menu=t,this.menu.whSize=this.whSize,this.sobDragPic=new fs(this,this.menu.dragPic,this.visi3D)},this.dragMenu=function(){this.menu.mObject.dragMenu()},this.activOne=function(t){this.menu.setObject(t),t&&null!=t.active&&(t.active=!0),e.visi3D.intRend=1},this.move=function(t){null!=e.sobIndex[e._index]&&e.sobIndex[e._index].move(t)},this.out=function(t){null!=e.sobIndex[e._index]&&e.sobIndex[e._index].out(t)},this.over=function(t){null!=e.sobIndex[e._index]&&e.sobIndex[e._index].over(t)},this.down=function(t){null!=e.sobIndex[e._index]&&e.sobIndex[e._index].down(t)},this.up=function(t){null!=e.sobIndex[e._index]&&e.sobIndex[e._index].up(t)},this.visi3D.addEvent("move",this.move),this.visi3D.addEvent("out",this.out),this.visi3D.addEvent("over",this.over),this.visi3D.addEvent("down",this.down),this.visi3D.addEvent("up",this.up),this.keydown=function(t,i,s){for(var n=0;n<e.sobIndex.length;n++)e.sobIndex[n].keydown(t,i,s)},this.keyup=function(t,i,s){for(var n=0;n<e.sobIndex.length;n++)e.sobIndex[n].keyup(t,i,s)},this.sizeWindow=function(t,i,e){t&&(t,i,e)}}set index(t){if(this._index!=t){this._index=t,this.activOne(null),this.sobIndex[1].tipDrav=this.sobIndex[1]._tipDrav;for(var i=0;i<this.sobIndex.length;i++)this.sobIndex[i].clear();this.sobIndex[this._index].setActive(),this.planDrag.setZ(0),this.visi3D.intRend=1}}get index(){return this._index}set tipDrav(t){this._tipDrav!=t&&(this._tipDrav=t,this.sobIndex[1].tipDrav=t)}get tipDrav(){return this._tipDrav}}class cs{constructor(t){this.par=t,this.setMouse=function(t){},this.fun_Positioin=function(){}}}class ds{constructor(t){var i=this;this.par=t,this.whSize=2e4;let e=new THREE.MeshPhongMaterial({color:16777215});this.mesh=new THREE.Mesh(new THREE.PlaneBufferGeometry(this.whSize,this.whSize,1,1),e),this.mesh.rotation.x=Math.PI,this.par.content3d.add(this.mesh),this.mesh.layers.set(31),this.mesh.name="ManMouse3D",this.par.visi3D.event3DArr.addChild(this.mesh),this.tween=new TWEEN.Tween(e),this.tween.onUpdate(function(){i.par.visi3D.intRend=1}),this.setZ=function(t){},this.setTextur=function(t){}}}class ps{constructor(t){var i=this;this.material=void 0,this.material=window.pm.matDop.getIDObj(14),this.cont3d=new THREE.Object3D;var e=new THREE.Mesh(new THREE.PlaneBufferGeometry(1e4,1e4,1,1),this.material);e.scale.z=1e-8,i.cont3d.add(e),e.name="eJS103",e.layers.set(31),this.funSob,this.funUp,this.drahForst,this.valueX=0,this.valueY=0,i.startPoint={},i.startPoint.uv={},i.startPoint.uv.x=.5,i.startPoint.uv.y=.5,this.move=function(t){i.valueX=1e4*(t.uv.x-i.startPoint.uv.x),i.valueY=1e4*-(t.uv.y-i.startPoint.uv.y),null!=i.funSob&&i.funSob()},i.mouseup=function(e){t.event3DArr.removeChild(i.cont3d),t.removeEvent("move",i.move),i.cont3d.parent.remove(i.cont3d),t.intRend=1,t.event3DArr.poiskName=i.poiskNameDo,0==dcmParam.mobile?document.removeEventListener("mouseup",i.mouseup):document.removeEventListener("touchend",i.mouseup),t.position3d.pause=!1,null!=i.funUp&&i.funUp()},this.start=function(e,s,n,r,h,a,o){s=s||new THREE.Vector3,i.funSob=n,i.funUp=r,i.drahForst=a,this.valueX=0,this.valueY=0,t.event3DArr.poiskName="eJS103",t.position3d.pause=!0,i.cont3d.position.set(s.x,s.y,s.z),e.add(i.cont3d),i.cont3d.rotation.x=null==h?Math.PI:h,i.cont3d.rotation.y=null==o?0:o,i.cont3d.updateWorldMatrix(!0,!0),t.event3DArr.addChild(i.cont3d),t.addEvent("move",this.move),0==dcmParam.mobile?document.addEventListener("mouseup",i.mouseup):document.addEventListener("touchend",i.mouseup)},this.sizeWindow=function(t,i,e){t&&(t,i,e)}}}class fs{constructor(t,i,e){this.par=t,this.dragPic=i,this.getSten=function(t){return null!=t.sten?t.sten:null!=t.parent?this.getSten(t.parent):null}}}class gs{constructor(t){this.type="Glaf";var i=this;this.scale=1,this.content3d=new THREE.Object3D,this.par=t,this.param=this.par.param,this._indexStep=-1,this.contHTML=document.createElement("div"),this.contHTML.style.position="fixed",this.contHTML.style.top="0px",this.contHTML.style.left="0px",t.contentHTML.appendChild(this.contHTML);var e,n,r=mhbd.getKeyId("scenes3d",2).json;this.visi3D=new s.a(this.contHTML,null,dcmParam.mobile,!0,!0,!0,!0),this.visi3D.yes3d=!0,this.visi3D.groupObject.add(this.content3d),window.visi3D=this.visi3D,this.sceneSB=new j(this.visi3D),window.pm=new I(visi3D,null,this.param);for(var h=0;h<this.sceneSB.array.length;h++)void 0===r.scene[this.sceneSB.array[h].name]&&(r.scene[this.sceneSB.array[h].name]={}),this.sceneSB.array[h].setBasa(r.scene[this.sceneSB.array[h].name]);this.dCont=new DCont(t.contentHTML),this.menu=new Gt(this,function(t,e,s){"indexStep"==t&&(window.localS.object.info.indexStep=e,window.localS.save(),i.indexStep=e)}),this.view=new He(this,function(t,i,e){}),this.fManager=new us(this,function(t,i,e){}),this.fManager.addMenu(this.menu),this.fManager.addFloor(this.view.facade),this.mozg=new is(this,function(t,i,e){}),this.visi3D.fun_drag=function(){i.view.facade.fun_rotationZ()},1==dcmParam.mobile&&dcmParam.addFunMove(visi3D.getFunMouseMove()),this.setModel=function(t,i,e){this.mozg.setModel(t,i,e)},this.update=function(){this.view.upDate(),this.visi3D.upDate()},this.sizeWindow=function(t,i,s){t&&(e=t,n=i,o=s),this.scale=o,this.dCont.scale=o,this.visi3D.sizeWindow(0,0,e,n),this.menu.sizeWindow(e,n,o),this.mozg.sizeWindow(e,n,o),this.fManager.sizeWindow(e,n,o)},this.openId=function(t){$.ajax({url:"resources/date/save/"+t+"/config.json",success:function(t){var e;"string"==typeof t?e=JSON.parse(t):e=t;i.view.facade.setObj(e),0==i.indexStep&&setTimeout(function(){i.mozg.array[0].dragScan()},10)},error:function(t){console.error("Что то случилось с конфигом")}})};var a,o,l,u=window.location.href.split("?id=");2==u.length&&1*u[1]?i.openId(1*u[1]):i.view.facade.roomPlus(-200,-200,400,400),setTimeout(function(){0==i._indexStep&&i.mozg.array[0].dragScan(0)},0),this.saveP=function(){window.localS.object.info.visi3D=visi3D.getObj(),window.localS.save()},this.sah=0,this.savePosit=function(){this.sah++;var t=this.sah;setTimeout(function(){i.sah==t&&i.saveP()},100)},visi3D.fun_Positioin=function(){i.savePosit(),i.fManager.dragCenter.fun_Positioin()},this.keydown=function(t,i,e){this.fManager.keydown(t,i,e),this.menu.keydown(t,i,e)},this.keyup=function(t,i,e){this.fManager.keyup(t,i,e),this.menu.keyup(t,i,e)},null==window.localS.object.info.indexStep&&(window.localS.object.info.indexStep=0),this.indexStep=window.localS.object.info.indexStep,null==window.localS.object.info.visi3D&&(window.localS.object.info.visi3D=visi3D.getObj()),visi3D.setObj(window.localS.object.info.visi3D),this.view.facade.sp.funFDO1=function(){i.saveTime()},this.save=function(){let t={measurements:[]};a=this.view.facade.sp;for(var i=0,e=0,s=0,n=0,r=this.getPoradok(a.arrSplice),h=0;h<r.length;h++)if(1==r[h].life&&1==r[h].boolAree){i+=r[h].arrayClass[0].arrGrani[0].area;let a={};a.angle=r[h].angelDin,a.area=r[h].arrayClass[0].arrGrani[0].area,a.distance=r[h].ss3d.tCompArrow.distans,a.windows=r[h].windows.getInfo(),a.osi=r[h].razmeru.getInfo(),o=r[h];for(var u=0;u<o.addPoint1.arrSHron.length;u++)o.addPoint1.arrSHron[u].sten.uuid!=o.uuid&&(l=o.addPoint1.arrSHron[u].sten.addPoint1);if(null==l)return;a.angle>0?s+=1:n+=1,t.measurements.push(a),e+=a.distance}t.a1=s,t.a2=n,t.area=i,t.distans=e,trace(t),localSInfo.object=t,localSInfo.save()},this.getPoradok=function(t){let i=[];t[0]._addPoint;for(var e,s,n,r=t[0],h=0;h<t.length;h++)i.push(r),r=this.getSten(r.addPoint1,t);for(h=0;h<i.length;h++){s=i[h];let t=h-1;t<0&&(t=i.length-1),e=i[t];let r=h+1;r==i.length&&(r=0),n=i[r];let a=calc.getTreeAngel(e._addPoint.position,s._addPoint.position,n._addPoint.position);a=180*-a/Math.PI,s.angelDin=a}return i},this.getSten=function(t,i){for(var e=0;e<i.length;e++)if(i[e]._addPoint.uuid==t.uuid)return i[e];return null},this.sah=0,this.saveTime=function(){this.sah++;var t=this.sah;setTimeout(function(){i.sah==t&&i.save()},100)},this.touchmove=function(t){t.preventDefault(),visi3D.position3d.stageMoveNew(t),visi3D.event3DArr.mousemove(t),dragPic.mousemove(t),t.stopPropagation()},1==dcmParam.mobile&&(window.addEventListener("touchmove",this.touchmove,{passive:!1,capture:!0}),this.visi3D.position3d.div.removeEventListener("touchmove",this.visi3D.position3d.stageMoveNew,{passive:!1,capture:!0}),window.removeEventListener("touchmove",this.visi3D.event3DArr.mousemove),window.removeEventListener("touchmove",dragPic.mousemove))}set indexStep(t){this._indexStep!=t&&(this._indexStep=t,this.menu.indexStep=this._indexStep,this.mozg.indexStep=this._indexStep,this.fManager.index=this._indexStep)}get indexStep(){return this._indexStep}}class xs{constructor(){if(this.type="Param",this.param={},this.param.otstup=5,this.param.color="#008cba",this.param.colorFont="#ffffff",this.param.color1="#999999",this.param.colorActive="#f28044",this.param.wh=40,this.param.wh2=32,this.param.wb=150,this.param.mobile=!1,this.param.whb=32,this.param.whCr=840,this.param.otMy=10,this.param.sizeBase=292,this.param.fontSize=16,this.param.fontSize1=24,this.param.fontSizeLittel=10,this.param.sizeBase2=200,this.param.bRadius=24,this.param.whPic=256,this.param.kolVolid=10,this.param.borderRadius=5,this.param.glowColor="#979797",this.param.glowSah=5,this.param.vers="3.03",this.param.host="https://kaleidoplan.ru/",this.param.host="http://77.222.60.51/",this.param.host="http://larvij.design/",this.param.server=this.param.host+"api/v1/",this.param.server=this.param.host+"api/v1/",this.param.serverNa=this.param.host+"www/",this.param.nameLS="___credentials2",this.param.token=null,this.param.objects3d=void 0,this.param.materials=void 0,this.param.textures=void 0,this.param.objectBase=void 0,this.param.scenes3d=void 0,this.param.arrayName=["objects3d","materials","textures","scenes3d","materials_sorts","objects3d_sorts"],this.param.debug=!1,this.param.version_reliz=1,this.param.version_dev=8,this.param.parentId=0,this.param.simMani="₽",this.param.versi="v "+this.param.version_reliz+".0"+this.param.version_dev,this.param.objectBase={},this.param.fontFamily="Montserrat",this.param.maxW=350,this.param.maxH=350,this.param.langs=["ru","en"],-1!=window.document.URL.toString().indexOf("localhost")){for(var t=window.document.URL.toString().split("/"),i=t[0],e=1;e<t.length-1;e++)i+="/"+t[e];this.param.serverNa=i+"/",this.param.localServer=this.param.serverNa+"adminAll.html"}}}class ys{constructor(t){var i=this;this.type="MHBDPHP",this.par=t,this.param=t.param,this.debug=!1,this.param.debug&&(this.debug=this.param.debug),this.token=this.param.token,this.idUzer=10,this.uzer=null,this.plusLinkKey="";var e=h("typeUzer");e&&(this.param.typeUzer=e),this.objectBase=null,this.load=function(t){function e(){null==i.objectBase.materials&&(i.objectBase.materials=[],i.saveTime()),null==i.objectBase.objects3d&&(i.objectBase.objects3d=[],i.saveTime()),null==i.objectBase.textures&&(i.objectBase.textures=[],i.saveTime()),null==i.objectBase.scenes3d&&(i.objectBase.scenes3d=[],i.saveTime()),null==i.objectBase.info&&(i.objectBase.info=[],i.saveTime()),i.objectBase.info=[],null==i.objectBase.three&&(i.objectBase.three={},i.saveTime()),null==i.objectBase.scenes3d[1]&&(i.creat("scenes3d"),i.creat("scenes3d")),t()}$.ajax({url:"resources/date/config.json?"+Math.random(),success:function(t){if("string"==typeof t){var s=JSON.parse(t);i.objectBase=s}else i.objectBase=t;e()},error:function(t){i.objectBase={},e()}})},this.save=function(){JSON.stringify(this.objectBase);trace(">>>>",this.objectBase),$.post("src/component/MHBDPHP.php",{tip:"saveJSON",link:"../../resources/date/config.json",text:JSON.stringify(this.objectBase)},function(t){trace("<<<",t)})},this.sah=0,this.saveTime=function(){this.sah++;var t=this.sah;setTimeout(function(){i.sah==t&&i.save()},100)},this.deleteId=function(t,e,s){for(var n=0;n<i.objectBase[t].length;n++)if(e<=i.objectBase[t][n].id){$.post("src/component/MHBDPHP.php",{tip:"removeDirRec",dir:"../../resources/date/"+t+"/"+e},function(t){});var r=i.objectBase[t][n];return i.objectBase[t].splice(n,1),this.saveTime(),s&&s(r),r}return s&&s(null),null},this.creat=function(t,e){for(var s={},n=0,r=0;r<i.objectBase[t].length;r++)n<=i.objectBase[t][r].id&&(n=i.objectBase[t][r].id);return s.id=n+1,s.ru=t+"_"+s.id+"_ru",s.en=t+"_"+s.id+"_en",s.name=t+"_"+s.id+"_name",s.sort=1,s.json={},s.icon="not.png",s.iconId=-1,s.files=[],s.fname=[],i.objectBase[t].push(s),this.saveTime(),$.post("src/component/MHBDPHP.php",{tip:"mkdir",dir:"../../resources/date/"+t+"/"+s.id},function(t){e&&e(s)}),s},this.getIdResCol=function(t){for(var e=1,s=0;s<i.objectBase[t].length;s++)for(var n=0;n<i.objectBase[t][s].files.length;n++)e<=i.objectBase[t][s].files[n]&&(e=i.objectBase[t][s].files[n]);return++e},this.getIdResObj=function(t,e,s){for(var n=0;n<i.objectBase[t].length;n++)for(var r=0;r<i.objectBase[t][n].files.length;r++)if(e==i.objectBase[t][n].files[r])return s?r:i.objectBase[t][n];return null},this.saveFile=function(t,e,s,r){null==(n=this.getKeyId(e,s))&&r&&r(null);var h=this.getIdResCol(e),a=h+"-"+t.name;let o=new FormData;return o.append("tip","saveFile"),o.append("file",t),o.append("dest","../../resources/date/"+e+"/"+s+"/"+a),$.ajax({url:"src/component/MHBDPHP.php",dataType:"text",cache:!1,contentType:!1,processData:!1,data:o,type:"post",success:function(t){null==n.fname&&(n.fname=[]),n.fname.push(a),n.files.push(h),i.save(),r&&r({id:h,src:"date/"+e+"/"+s+"/"+a,rel_obj:s})}})},this.clearFile=function(t,e,s){console.warn("deleteId>>clearFile =",t,e);var n=this.getIdResObj(t,e);if(n){var r=this.getIdResObj(t,e,!0),h=n.fname[r],a="../../resources/date/"+t+"/"+n.id+"/"+h;$.post("src/component/MHBDPHP.php",{tip:"unlink",dir:a},function(t){n.fname.splice(r,1),n.files.splice(r,1),i.save(),s&&s()})}},this.getKeyList=function(t,e,s,n,h){if(-1!==t.indexOf("sorts")&&"sorts"==(r=t.split("/"))[1]){for(var a=[],o=0;o<i.objectBase[r[0]].length;o++)i.objectBase[r[0]][o].sort==1*r[2]&&a.push(i.objectBase[r[0]][o]);return e&&e(a),a}return-1!==t.indexOf("sort")?(r=[{id:1,name:"Не установлено"},{id:2,name:"xz1"},{id:3,name:"xz2"},{id:4,name:"xz3"},{id:5,name:"xz4"}],e&&e(r),r):i.objectBase[t]?(e&&e(i.objectBase[t]),i.objectBase[t]):(e&&e(null),null)},this.objId={},this.funGetKeyId=void 0;var s,n,r;function h(t,i){var e=window.document.URL.toString();null!=i&&(e=i);e.split("/");if(e.indexOf("?")>0){var s=e.split("?")[1].split("&"),n=new Array(s.length),r=new Array(s.length);s=e.split("?")[1].split("&"),n=new Array(s.length),r=new Array(s.length);var h=0;for(h=0;h<s.length;h++){var a=s[h].split("=");n[h]=a[0],""!=a[1]?r[h]=unescape(a[1]):r[h]=null}for(h=0;h<s.length;h++)if(n[h]==t)return r[h];return null}}this.getKeyId=function(t,e,s,n){for(var r=0;r<i.objectBase[t].length;r++)if(i.objectBase[t][r].id==e)return s&&s(i.objectBase[t][r]),i.objectBase[t][r];return s&&s(null),null},this.setParam=function(t,i,e,r,h){return null==(n=this.getKeyId(t,i))?(h&&h(null),null):n[e]?(s=r,"string"==typeof r&&r[0]&&("{"!=r[0]&&"["!=r[0]||(s=JSON.parse(r))),n[e]=s,this.saveTime(),h&&h(n),n):(h&&h(null),null)},this.getArKey=function(t,i){for(var e=0;e<this.param[t].length;e++)if(this.param[t][e].id==i)return this.param[t][e];return null},this.getURLParameters=function(t,i){return h(t,i)},this.creatParamKategor=function(){this.creatParamKategor1()},this.creatParamKategor1=function(){for(var t=0;t<this.param.group.length;t++)if((n=this.param.group[t]).products){n.productsObj=[];for(var i=0;i<n.products.length;i++){var e=this.getArKey("group3",n.products[i]);n.productsObj[i]=e}}},this.getLink=function(t){return 1==(r=t.split("/")).length?t:"date"==r[0]?t.replace("date","resources/date/"):-1!=t.indexOf("http://77.222.60.51")?t.replace("http://77.222.60.51",this.param.host):("http:"==r[0]||r[0],t)},this.setPHP=function(t,i){$.post("src/component/MHBDPHP.php",t,function(t){i&&i(t)})}}}function ms(){var t,i,e,s=new THREE.Vector3(0,0,0),n=new THREE.Vector3(0,0,0),r=new THREE.Vector3(0,0,0),h=new THREE.Vector3(0,0,0);this.DEG2RAD=Math.PI/180,this.RAD2DEG=180/Math.PI,this.getAngle=function(t,i){return i=i||h,t=t||h,Math.atan2(i.y-t.y,i.x-t.x)};var a,o,l,u,c,d,p,f,g,x,y,m,v,b,w,_=0;this.getAngle2=function(t,i){return i=i||h,t=t||h,(_=Math.atan2(i.y-t.y,i.x-t.x))<0&&(_+=2*Math.PI),_},this.getDistance=function(t,i){return null==t?0:(null==i&&(i=h),i=i||h,Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2)))},this.getDistance3d=function(t,i){return Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2)+Math.pow(t.z-i.z,2))},this.getVector=function(t,i,e){if(null==e)e=new THREE.Vector2(0,0);return t<0&&(i+=Math.PI),e.x=Math.abs(t)*Math.cos(i),e.y=Math.abs(t)*Math.sin(i),e},this.isPointInLin=function(t,e,s,h,a){return this.getTreeAngel(t,e,s),a<0&&2*Math.abs(a)>c?null:n.x<=c+a&&n.x>=-a&&Math.abs(n.y)<=h?((r=n.x<0?this.getVector(n.x,i-Math.PI):this.getVector(n.x,i)).x+=e.x,r.y+=e.y,r.z=n.y,r):null},this.okrugPoint=function(t,i){null==i&&(i=100),t.x=Math.round(t.x/i)*i,t.y=Math.round(t.y/i)*i},this.okrugNumber=function(t,i){null==i&&(i=100);var e=Math.round(t*i)/i;return t=e,e},this.isInTriangle=function(t,i,e,s){var n=(t.x-s.x)*(i.y-t.y)-(i.x-t.x)*(t.y-s.y),r=(i.x-s.x)*(e.y-i.y)-(e.x-i.x)*(i.y-s.y),h=(e.x-s.x)*(t.y-e.y)-(t.x-e.x)*(e.y-s.y);return n>=0&&r>=0&&h>=0||n<=0&&r<=0&&h<=0},this.getTreeAngel=function(t,s,r,a){return i=this.getAngle(s,t),e=this.getAngle(s,r),p=this.getDistance(s,r),c=this.getDistance(t,s),this.getVector(p,e-i,n),e=this.getAngle(h,n),null==a?e:e>0?e:2*Math.PI+e},this.getTreeAngelPI2=function(t,i,e){a=t.x-i.x,o=e.x-i.x,l=t.y-i.y,u=e.y-i.y,c=Math.sqrt(a*a+l*l),d=Math.sqrt(o*o+u*u);var s=(a*o+l*u)/(c*d);return s>1&&(s=1),s<-1&&(s=-1),Math.acos(s)},this.isLineInTriangle=function(i,e,n,r,h){return(t=this.getPointOfIntersection(i,e,r,h))?(s.x=t.x,s.y=t.y,s.z=0,s):(t=this.getPointOfIntersection(e,n,r,h))?(s.x=t.x,s.y=t.y,s.z=1,s):!!(t=this.getPointOfIntersection(n,i,r,h))&&(s.x=t.x,s.y=t.y,s.z=2,s)};var P,S,A,T,E=new THREE.Vector2(0,0);this.getPointOfIntersection=function(t,i,e,s){return p=(t.x-i.x)*(s.y-e.y)-(t.y-i.y)*(s.x-e.x),f=(t.x-e.x)*(s.y-e.y)-(t.y-e.y)*(s.x-e.x),g=(t.x-i.x)*(t.y-e.y)-(t.y-i.y)*(t.x-e.x),y=g/p,(x=f/p)>=0&&x<=1&&y>=0&&y<=1?(m=t.x+x*(i.x-t.x),v=t.y+x*(i.y-t.y),E.x=m,E.y=v,E):null},this.korektToLine=function(t,i,e,s,n){b=this.getDistance(t,i),w=null==n?this.getAngle(t,i):n,0!=s&&(E=s<0?this.getVector(-s,w-Math.PI/2):this.getVector(s,w+Math.PI/2),t.x+=E.x,t.y+=E.y,i.x+=E.x,i.y+=E.y),E=this.getVector(e,w),i.x+=E.x,i.y+=E.y,E=this.getVector(e,w+Math.PI),t.x+=E.x,t.y+=E.y},this.getProsent3Point=function(t,i,e){return f=this.getDistance(t,i),(g=this.getDistance(t,e))/f},this.povotorOtAngel=function(t,i,e){return w=this.getAngle(t,i),b=this.getDistance(t,i),this.getVector(b,w+e)},this.testPositPoint=function(t,i,e){return null==e&&(e=100),Math.round(t.x*e)/e==Math.round(i.x*e)/e&&Math.round(t.y*e)/e==Math.round(i.y*e)/e},this.okrugAngel=function(t,i,e){var s=t;P=1,t<0&&(P=-1),S=Math.abs(t),A=Math.round(S/i)+1,T=0;for(var n=A;n>=0;n--){if(S>n*i-e&&S<n*i+e)return s=n*i*P;if(3==++T)return s}return s};var M=new vs,D=new vs,z=[];this.getLineCircleIntersectionPoints=function(t,i,e,s,n){z.length=0;var r=i.x-t.x,h=i.y-t.y,a=e.x-t.x,o=e.y-t.y,l=r*r+h*h,u=(r*a+h*o)/l,c=u*u-(a*a+o*o-s*s)/l;if(c<0)return z;var d=Math.sqrt(c),p=-u+d,f=-u-d;return M.set(t.x-r*p,t.y-h*p),this.isPointInLine(t,i,M)&&z.push(M),0==c?z:(D.set(t.x-r*f,t.y-h*f),this.isPointInLine(t,i,D)&&z.push(D),n&&2==z.length&&(P=this.getDistance(t,z[0]),S=this.getDistance(t,z[1]),P>S&&z.reverse()),z)},this.isPointInLine=function(t,i,e){var s=this.getDistance(t,i),n=this.getDistance(t,e),r=this.getDistance(i,e);return this.okrugNumber(n+r)===this.okrugNumber(s)},this.getDistancePointToLine=function(t,i,e){var s=((i.y-t.y)*e.x-(i.x-t.x)*e.y+i.x*t.y-i.y*t.x)/this.getDistance(t,i);return-this.okrugNumber(Number.isFinite(s)?s:0)},this.getCircleCircleIntersectionPoints=function(t,i,e,s){var n,r,h,a,o;return z.length=0,(h=Math.sqrt(Math.pow(Math.abs(t.x-e.x),2)+Math.pow(Math.abs(t.y-e.y),2)))>i+s?z:(a=(i*i-s*s+h*h)/(2*h),o=Math.sqrt(Math.pow(i,2)-Math.pow(a,2)),isNaN(o)?z:(n=t.x+a*(e.x-t.x)/h,r=t.y+a*(e.y-t.y)/h,M.x=n+o*(e.y-t.y)/h,M.y=r-o*(e.x-t.x)/h,z.push(M),a==i?z:(D.x=n-o*(e.y-t.y)/h,D.y=r+o*(e.x-t.x)/h,z.push(D),z)))};var R=[new vs,new vs,new vs,new vs],B=[new vs,new vs,new vs,new vs];this.isIntersectionRect=function(t,i){return R[0].set(t.x,t.y),R[1].set(t.x+t.width,t.y),R[2].set(t.x+t.width,t.y+t.height),R[3].set(t.x,t.y+t.height),B[0].set(i.x,i.y),B[1].set(i.x+i.width,i.y),B[2].set(i.x+i.width,i.y+i.height),B[3].set(i.x,i.y+i.height),this.isIntersectionFromPoint(R,B)},this.isRectS=function(t,i){return 1==this.colisiLine2D(t.x,t.x+(null==t.w?t.width:t.w),i.x,i.x+(null==i.w?i.width:i.w))&&1==this.colisiLine2D(t.y,t.y+(null==t.h?t.height:t.h),i.y,i.y+(null==i.h?i.height:i.h))},this.colisiLine2D=function(t,i,e,s){return e>=t&&e<=i||t>=e&&t<=s},this.isIntersectionFromPoint=function(t,i){for(var e=0;e<t.length-2;e++)for(var s=0;s<i.length-2;s++)if(this.getPointOfIntersection(t[e],t[(e+2)%t.length],i[s],i[(s+2)%i.length]))return!0;for(e=0;e<t.length;e++)for(s=0;s<i.length;s++)if(this.getPointOfIntersection(t[e],t[(e+1)%t.length],i[s],i[(s+1)%i.length]))return!0;for(e=0;e<i.length;e+=2)if(this.contains(i[e].x,i[e].y,t))return!0;for(e=0;e<t.length;e+=2)if(this.contains(t[e].x,t[e].y,i))return!0;return!1},this.isParalel=function(t,i,e,s,n){n=n||0;var r=Math.abs(this.getAngle(t,i)%Math.PI),h=Math.abs(this.getAngle(i,t)%Math.PI),a=Math.abs(this.getAngle(e,s)%Math.PI),o=Math.abs(this.getAngle(s,e)%Math.PI);return Math.min(Math.abs(r-a),Math.abs(h-o),Math.abs(r-o),Math.abs(h-a))<=n},this.rotationPoint=function(t,i,e){var s=0,n=0;e?(s=e.x+(t.x-e.x)*Math.cos(i)-(t.y-e.y)*Math.sin(i),n=e.y+(t.y-e.y)*Math.cos(i)+(t.x-e.x)*Math.sin(i)):(s=t.x*Math.cos(i)-t.y*Math.sin(i),n=t.y*Math.cos(i)+t.x*Math.sin(i)),t.x=s,t.y=n},this.rotationPointByLength=function(t,i,e){e=e||h;var s=this.getDistance(t,e),n=this.getLenghtCircle(s),r=i*(2*Math.PI/n);this.rotationPoint(t,r,e)},this.isIntersectionTriangle=function(t,i,e,s,n,r){for(var h=!1,a=[t,i,e],o=[s,n,r],l=0;l<a.length&&!h;l++)h=this.isInTriangle(s,n,r,a[l]);for(l=0;l<o.length&&!h;l++)h=this.isInTriangle(t,i,e,o[l]);if(!h)for(l=0;l<a.length;l++)for(var u=0;u<o.length&&!h;u++)h=this.getPointOfIntersection(a[l],a[(l+1)%a.length],o[u],o[(u+1)%o.length]);return h},this.getArrPointCircle=function(t,i,e,s,n,r,h){var a,o=this.getAngle(e,t)-Math.PI,l=this.getAngle(s,t)-Math.PI;a=h||[new vs],n=n||5,!(r=r||!1)&&l<=o?l+=2*Math.PI:r&&o<=l&&(o+=2*Math.PI);var u=r?-1*(o-l):l-o,c=Math.ceil(Math.abs(u)/(2*Math.PI))*(n-1),d=u/(2*c),p=2*d,f=Math.cos(d),g=Math.sin(d),x=c-1,y=x%1/x,m=0,v=0,b=0,w=0,_=0;a[0].x=t.x+Math.cos(o)*i,a[0].y=t.y+Math.sin(o)*i;for(var P=0;P<=x;P++)m=d+o+(p*P+y*P),w=(f*(v=Math.cos(m))+g*(b=-Math.sin(m)))*i+t.x,_=(f*-b+g*v)*i+t.y,a[P+1]?(a[P+1].x=w,a[P+1].y=_):a.push(new vs(w,_));return a},this.getLenghtCircle=function(t,i,e,s,n){i||(i=e=s=h);var r=this.getAngle(e,i)-Math.PI,a=this.getAngle(s,i)-Math.PI;return r===a&&e!==s?0:(!(n=n||!1)&&a<=r?a+=2*Math.PI:n&&r<=a&&(r+=2*Math.PI),Math.PI*t*(n?r-a:a-r)/Math.PI)},this.getLengthByWidth=function(t,i){var e=new vs(0,0),s=new vs(t,0),n=this.getVector(i,.5*Math.PI);n.x=t/2;var r=this.getCenterCircle(e,s,n);return r?this.getLenghtCircle(this.getDistance(r,e),r,e,s,i>0):t},this.getCenterCircle=function(t,i,e){var s=i.x-t.x,n=i.y-t.y,r=e.x-t.x,h=e.y-t.y,a=s*(t.x+i.x)+n*(t.y+i.y),o=r*(t.x+e.x)+h*(t.y+e.y),l=2*(s*(e.y-i.y)-n*(e.x-i.x));return 0===l?null:new vs((h*a-n*o)/l,(s*o-r*a)/l)},this.getArcPoint=function(t,i,e,s,n){s=s||5;var r=this.getAngle(t,i)+90*this.DEG2RAD,h=this.getVector(e,r),a=new vs((t.x+i.x)/2,(t.y+i.y)/2);a.x+=h.x,a.y+=h.y;var o=this.getCenterCircle(t,a,i);return o?this.getArrPointCircle(o,this.getDistance(o,t),t,i,s,e>0,n):[t,i]},this.getArea=function(t){for(var i=t.length,e=0,s=i-1,n=0;n<i;s=n++)e+=t[s].x*t[n].y-t[n].x*t[s].y;return.5*e||0},this.generateUUID=function(){for(var t=[],i=0;i<256;i++)t[i]=(i<16?"0":"")+i.toString(16);return function(){var i=4294967295*Math.random()|0,e=4294967295*Math.random()|0,s=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return(t[255&i]+t[i>>8&255]+t[i>>16&255]+t[i>>24&255]+"-"+t[255&e]+t[e>>8&255]+"-"+t[e>>16&15|64]+t[e>>24&255]+"-"+t[63&s|128]+t[s>>8&255]+"-"+t[s>>16&255]+t[s>>24&255]+t[255&n]+t[n>>8&255]+t[n>>16&255]+t[n>>24&255]).toUpperCase()}}(),this.generateRendom=function(t){null==t&&(t=2);let i,e="",s="";for(var n=0;n<t;n++){if((s=(255&(i=4294967295*Math.random()|0)).toString(16)+(i>>8&255).toString(16)+(i>>16&255).toString(16)+(i>>24&255).toString(16)).length<8)for(var r=0;r<8-s.length+1;r++)s+="Z";e+=s,n!=t-1&&(e+="-")}return e},this.diffNum=function(t,i){return t>=0&&i>=0?Math.abs(t-i):t<=0&&i<=0?Math.abs(Math.abs(t)-Math.abs(i)):t<=0&&i>=0?Math.abs(t)+i:t>=0&&i<=0?t+Math.abs(i):void 0},this.getPercentNum=function(t,i,e){return((t=null!=t?t:0)-(i=null!=i?i:0))/((e=null!=e?e:100)-i)*100},this.getValueNum=function(t,i,e){return(t=null!=t?t:0)/100*((e=null!=e?e:100)-(i=null!=i?i:0))+i},this.getValueBetween=function(t,i,e){var s=Math.max(i,e),n=Math.min(i,e);return Math.max(Math.min(t,s),n)},this.contains=function(t,i,e){for(var s=!1,n=e.length,r=0,h=n-1;r<n;h=r++){if(e[r].x===t&&e[r].y===i)return!0;var a=e[r].x,o=e[r].y,l=e[h].x,u=e[h].y;o>i!=u>i&&t<(l-a)*(i-o)/(u-o)+a&&(s=!s)}return s};var C={maxX:0,minX:0,maxY:0,minY:0},L=new vs,O=[new vs,new vs,new vs,new vs],I=new vs;this.getBoundsRect=function(t,i){I.set(t.width/2,t.height/2),O[0].set(0,0),O[1].set(t.width,0),O[2].set(t.width,t.height),O[3].set(0,t.height);for(var e=0;e<O.length;e++)this.rotationPoint(O[e],i,I);C.maxX=-t.width,C.minX=t.width,C.maxY=-t.height,C.minY=t.height;for(e=0;e<O.length;e++)C.maxX=Math.max(C.maxX,O[e].x),C.minX=Math.min(C.minX,O[e].x),C.maxY=Math.max(C.maxY,O[e].y),C.minY=Math.min(C.minY,O[e].y);return L.x=C.minX,L.y=C.minY,L.width=C.maxX-C.minX,L.height=C.maxY-C.minY,L},this.getCurvatureByWidth=function(t,i){if(Math.abs(t)>2*i)return null;var e=Math.pow(Math.abs(t),2),s=Math.pow(i,2),n=Math.acos((s+s-e)/(2*s));return i*(1-Math.cos(n/2))*(t<0?-1:1)},this.getWidthByCurvature=function(t,i){return 2*i*Math.sin(Math.acos(1-2*Math.abs(t)/(2*i)))*(t<0?-1:1)};var k=function(t,i){if(j(t)&&j(i))return t===i;for(var e in t){if(t.hasOwnProperty(e)!==i.hasOwnProperty(e))return!1;switch(typeof t[e]){case"object":if(!k(t[e],i[e]))return!1;break;case"function":if(void 0===i[e]||"compare"!==e&&t[e].toString()!==i[e].toString())return!1;break;case"number":if(Number(Number(t[e]).toFixed(3))!==Number(Number(i[e]).toFixed(3)))return!1;break;default:if(t[e]!==i[e])return!1}}for(var e in i)if(t.hasOwnProperty(e)!==i.hasOwnProperty(e))return!1;return!0};function j(t){return t!==Object(t)}this.compare=k}function vs(t,i,e){this._x=t||0,this._y=i||0,this._z=e||0,this.set=function(t,i,e){this._x=t||0,this._y=i||0,void 0!==e&&(this._z=e)},this.setPoint=function(t){this._x=t.x,this._y=t.y,void 0!==t.z&&(this._z=t.z)},this.getObj=function(){var t={};return t.x=this._x,t.y=this._y,t.z=this._z,t},this.copy=function(){return new vs(this._x,this._y,this._z)}}function bs(t,i){this.fun=t;var e,s=this;this.object,this.key=i||"shirt",this.object,this.initLoad=function(){e=!0,this.object=window.localStorage[this.key],"undefined"==this.object&&(e=!1),null==this.object&&(e=!1),this.object=0==e?this.getStartObj():jQuery.parseJSON(this.object),this.fun&&s.fun()},this.getStartObj=function(){return{}},this.save=function(){window.localStorage[this.key]=JSON.stringify(s.object)},this.clear=function(){window.localStorage[this.key]=void 0},s.initLoad()}vs.prototype={set x(t){this._x=t},get x(){return this._x},set y(t){this._y=t},get y(){return this._y},set z(t){this._z=t},get z(){return this._z}};class ws{constructor(t){this.type="Languages";this.a=t,this._key=t[0].key,this.array=[],this.arrayC=[],this.setCompObj=function(t,i,e,s){this.array.push(new _s(t,i,e,s)),this.dragDB(this.array[this.array.length-1])},this.dragDB=function(t){t.setKey(this._key)},this.setClass=function(t){this.arrayC.push(t),t.languages=this._key},this.arrayFun=[]}set key(t){if(this._key!=t){this._key=t;for(var i=0;i<this.array.length;i++)this.dragDB(this.array[i]);for(i=0;i<this.arrayC.length;i++)this.array[i].languages=this._key;for(i=0;i<this.arrayFun.length;i++)this.arrayFun[i](this._key)}}get key(){return this._key}}class _s{constructor(t,i,e,s){this.type="DBLeng";var n=this;this.comp=t,this.obj=i,this.type="text",this.fun=s,null!=e&&(this.type=e);var r="";this.setKey=function(e){r="null",i&&i[e]&&(r=i[e]),n.type&&(t[n.type]=r),n.fun&&n.fun(e)}}}e.d(i,"a",function(){return Ps});class Ps{constructor(t){this.type="Main";var i=this;this.contentHTML=document.createElement("div"),this.contentHTML.style.position="fixed",this.contentHTML.style.top="0px",this.contentHTML.style.left="0px",document.body.appendChild(this.contentHTML),this.start=function(){this.tick(),i.glaf=new gs(this),t("init")},this.setModel=function(t,e,s){i.glaf.setModel(t,e,s)};var e;this.tick=function(){TWEEN.update(),i.glaf&&i.glaf.update(),requestAnimationFrame(i.tick)},this.scale=1,this.sizeWindow=function(t,s){i._width=t,i._height=s,i._width<450&&(i._width=450),i._height<610&&(i._height=610),(e=t/i._width)>s/i._height&&(e=s/i._height),this.scale=e,i.glaf&&i.glaf.sizeWindow(t,s,this.scale)},window.languages=new ws([{key:"ru"},{key:"en"}]),languages.key="en",window.localS=new bs(function(){},"3dplaner_v1"),window.localSInfo=new bs(function(){},"3dplaner_info_v1"),null==window.localS.object.info&&(window.localS.object.info={}),null==window.localS.object.debug&&(window.localS.object.debug=!1),window.calc=new ms,this.param=(new xs).param,this.param.wb=160,this.param.wb1=160,this.param.mastab=1,1==dcmParam.mobile&&(this.param.wb=90,this.param.mastab=3),this.param.mobile=dcmParam.mobile,this.param.wh=64,this.param.otstup=10,dcmParam.color1="#C4C4C4",dcmParam.fontSizeLittel=dcmParam._fontSizeLittel=10,dcmParam.colorText="#000000",dcmParam.colorText1="#000000",this.param.alpha=.5,dcmParam.fontFamily="PT Mono",this.param.sizeBase=3*this.param.wh+4*this.param.otstup,trace(">>",this.param),window.tStyle=new Ti,document.body.style.backgroundColor="#303841",window.tStyle._gage=.1,window.mhbd=new ys(this),window.mhbd.load(function(){(new THREE.FontLoader).load("resources/font/helvetiker_bold.typeface.json",function(t){tStyle._fontSize=i.param.fontSizeLittel,tStyle.addFont(t),i.start()})}),this.keydown=function(t){17==t.keyCode&&(i.boolCTRL=!0),81==t.keyCode&&i.boolCTRL&&(i.active=!i.active,window.localS.object.debug=!window.localS.object.debug,window.localS.save(),window.location.reload()),i.glaf.keydown("down",t,i.boolCTRL)},this.keyup=function(t){17==t.keyCode&&(i.boolCTRL=!1),i.glaf.keyup("up",t,i.boolCTRL)},window.addEventListener("keydown",this.keydown),window.addEventListener("keyup",this.keyup)}}},function(t,i,e){"use strict";var s=e(1),n=e(4);function r(t){var i=this;this.visi3D=t,this.box3=new THREE.Box3,this.rectScreen=new a,this.world=new a(0,0,100,100),this.targetObject=null,this.arrPoint=[],this.isMoveCam=!1,this.isFromGeometry=!1,this._offset=0,this._active=!0,this._debug=!1;var e=new THREE.Vector2,s=new THREE.Vector2,n=new THREE.Vector3;function r(){i.zumeVisi3D(),e.set(i.world.x+i.world.width/2,i.world.y+i.world.height/2),s.set(i.rectScreen.x+i.rectScreen.width/2,i.rectScreen.y+i.rectScreen.height/2),e.sub(s).divideScalar(2)}this.upDate=function(){if(i.active&&(this.updateBound3d(),!i.box3.isEmpty())){if(this.visi3D.xVerh=n.x,this.visi3D.zVerh=n.z,this.visi3D.yVerh=-n.y,i.zumeVisi3D(),i.isMoveCam){r();for(var t=0;e.length()>2&&++t<10;)this.visi3D.position3d.moveCamXY(e),r()}i.debugFocus&&i.debugFocus.upDate()}},this.zumeVisi3D=function(){for(var t,e,s=0,n=6e4,r=0;s<n&&!(++r>20)&&(e=t=(s+n)/2,i.visi3D.zume=e,!(Math.abs(s-t)<.01||Math.abs(n-t)<.01||t<.01));)i.updateRectScreen(),i.isZoomIn()?n=t:s=t+1},this.updateBound3d=function(){if(i.box3.makeEmpty(),i.targetObject)i.box3.copy(i.getCompoundBoundingBox(i.targetObject));else for(var t=0;t<i.arrPoint.length;t++)i.box3.expandByPoint(i.arrPoint[t]);i.box3.getCenter(n)},this.updateRectScreen=function(){if(this.visi3D.camera.updateMatrixWorld(),this.visi3D.scene.updateMatrixWorld(),i.targetObject&&i.isFromGeometry){var t=i.getBoxObject(i.targetObject);i.box3.copy(t.box3),i.box3.getCenter(n),i.setRectFromBox(i.rectScreen,t.box2)}else i.setRectFromBox(i.rectScreen,i.boxToScreen(i.box3));i.updateWorldSize()},this.setRectFromBox=function(t,i){t.x=i.min.x,t.y=i.min.y,t.width=i.max.x-i.min.x,t.height=i.max.y-i.min.y},this.getCompoundBoundingBox=function(){var t=new THREE.Box3,i=new THREE.Box3;function e(e){var s=e.geometry;void 0!==s&&(s.boundingBox||s.computeBoundingBox(),i.copy(s.boundingBox),i.applyMatrix4(e.matrixWorld),t.union(i))}return function(i){return i.updateMatrixWorld(!0),t.makeEmpty(),i.traverseVisible(e),t}}(),this.boxToScreen=function(){for(var t=new THREE.Box2,e=[],s=0;s<8;s++)e[s]=new THREE.Vector3;return function(s){t.makeEmpty(),e[0].set(s.min.x,s.min.y,s.min.z),e[1].set(s.min.x,s.max.y,s.min.z),e[2].set(s.max.x,s.min.y,s.min.z),e[3].set(s.max.x,s.max.y,s.min.z),e[4].set(s.min.x,s.min.y,s.max.z),e[5].set(s.min.x,s.max.y,s.max.z),e[6].set(s.max.x,s.min.y,s.max.z),e[7].set(s.max.x,s.max.y,s.max.z);for(var n=0;n<e.length;n++)t.expandByPoint(i.toScreenXY(e[n]));return t}}(),this.getBoxObject=function(){var t,e,s=new THREE.Box2,n=new THREE.Box3,r={box2:s,box3:n},h=new THREE.Vector3;function a(r){var a=r.geometry;if(void 0!==a)if(a.isGeometry){var o=a.vertices;for(t=0,e=o.length;t<e;t++)h.copy(o[t]).applyMatrix4(r.matrixWorld),n.expandByPoint(h),s.expandByPoint(i.toScreenXY(h))}else if(a.isBufferGeometry){var l=a.attributes.position;if(void 0!==l)for(t=0,e=l.count;t<e;t++)h.fromBufferAttribute(l,t).applyMatrix4(r.matrixWorld),n.expandByPoint(h),s.expandByPoint(i.toScreenXY(h))}}return function(t){return t.updateMatrixWorld(!0),s.makeEmpty(),n.makeEmpty(),t.traverseVisible(a),r}}();var h=new THREE.Vector2,o=new THREE.Vector3;this.toScreenXY=function(t){return o.copy(t),o.project(i.visi3D.camera),h.x=Math.round((o.x+1)*i.visi3D._width/2),h.y=Math.round((1-o.y)*i.visi3D._height/2),h},this.updateWorldSize=function(){i.world.x=i.offset,i.world.y=i.offset,i.world.width=this.visi3D._width-2*i.offset,i.world.height=this.visi3D._height-2*i.offset},this.isZoomIn=function(){return i.rectScreen.x>i.world.x&&i.rectScreen.x+i.rectScreen.width<i.world.x+i.world.width&&i.rectScreen.y>i.world.y&&i.rectScreen.y+i.rectScreen.height<i.world.y+i.world.height}}function h(t){var i=this;this.mFocus=t;var e=visi3D.scene,s=main.stage,n=new BoxHelper(1,materialAlphaRed);e.add(n);var r=new PIXI.Graphics;r.hitArea=new PIXI.Rectangle(0,0,0,0),s.addChild(r),i.active=!1,n.visible=r.visible=i.active,this.upDate=function(){n.visible=r.visible=i.active,i.active&&(r.clear(),r.position.set(visi3D._x,visi3D._y),r.lineStyle(1,0,1),r.drawRect(t.world.x,t.world.y,t.world.width,t.world.height),r.lineStyle(1,16711680,1),r.drawRect(t.rectScreen.x,t.rectScreen.y,t.rectScreen.width,t.rectScreen.height),n.width=t.box3.max.x-t.box3.min.x,n.depth=t.box3.max.y-t.box3.min.y,n.height=t.box3.max.z-t.box3.min.z,t.box3.getCenter(n.position))}}function a(t,i,e,s,n){this._x=t||0,this._y=i||0,this._width=void 0!==e?e:100,this._height=void 0!==s?s:100,this.angel=0,this.p=new o,this.fun,this.set=function(t,i,e,s){this._x=t||0,this._y=i||0,this._width=void 0!==e?e:100,this._height=void 0!==s?s:100},this.setRect=function(t){this._x=t.x,this._y=t.y,this._width=t.width,this._height=t.height,this.p.setPoint(t.p),this.angel=t.angel}}function o(t,i,e){this._x=t||0,this._y=i||0,this._z=e||0,this.xx=0,this.yy=0,this.zz=0,this.set=function(t,i,e){this._x=t||0,this._y=i||0,void 0!==e&&(this._z=e)},this.setPoint=function(t){this._x=t.x,this._y=t.y,void 0!==t.z&&(this._z=t.z)},this.getObj=function(){var t={};return t.x=this._x,t.y=this._y,t.z=this._z,t},this.copy=function(){return new o(this._x,this._y,this._z)}}r.prototype={set offset(t){this._offset=t||0},get offset(){return this._offset},set debug(t){this._debug=t,t&&!this.debugFocus&&(this.debugFocus=new h(this)),this.debugFocus&&(this.debugFocus.active=t)},get debug(){return this._debug},set active(t){this._active=t,t||(this.debug=!1)},get active(){return this._active}},a.prototype={set x(t){this._x!==t&&(this._x=t)},get x(){return this._x},set y(t){this._y!==t&&(this._y=t)},get y(){return this._y},set width(t){this._width!==t&&(this._width=t)},get width(){return this._width},set height(t){this._height!==t&&(this._height=t)},get height(){return this._height}},o.prototype={set x(t){this._x=t},get x(){return this._x},set y(t){this._y=t},get y(){return this._y},set z(t){this._z=t},get z(){return this._z}};class l{constructor(t){this.type="PointZdvig";var i=this;this.scale=1,this._active=!1,this.debag=!1,this.funD=void 0,this.content3d=new THREE.Object3D,this.par=t,this.initDebag=function(){this.axesHelper=new THREE.AxesHelper(100),this.par.scene.add(this.axesHelper),this.axPoint=new THREE.AxesHelper(50),this.par.scene.add(this.axPoint),this.axCentr=new THREE.AxesHelper(170),this.par.gCGG.add(this.axCentr)},this.debag&&this.initDebag(),this.vect=new THREE.Vector3,this.setPoint=function(t){this.vect.set(t.x,t.y,t.z),1==this.debag&&(this.axPoint.position.set(t.x,t.y,t.z),this.par.intRend=1)};var e,s,n,r=new THREE.Vector3,h=new THREE.Vector3,a=new THREE.Vector3;this.set=function(t,i,o){if(0!=this._active)return"rotationZ"==t?(r.x=this.vect.x,r.y=this.vect.z,h.x=this.par._xVerh,h.y=this.par._zVerh,s=i-o,n=this.getDistance(r,h),e=this.getAngle(r,h),this.getVector(n,e+s,a),a.x+=r.x,a.y+=r.y,this.par.xVerh=a.x,void(this.par.zVerh=a.y)):"rotationX"==t?(this.funD&&(this.funD("clear"),this.funD("setka",10,1),this.funD("pointXY",{x:0,y:0},2)),r.x=this.vect.x,r.y=this.vect.y,r.z=this.vect.z,void trace()):void 0},this.getDistance3d=function(t,i){return Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2)+Math.pow(t.z-i.z,2))},this.getDistance=function(t,i){return Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2))},this.getAngle=function(t,i){return Math.atan2(i.y-t.y,i.x-t.x)},this.getVector=function(t,i,e){return e.x=Math.abs(t)*Math.cos(i),e.y=Math.abs(t)*Math.sin(i),e},this.dragE3d=function(t,e){trace("ss",t,e),"down"==t&&null!=e&&null!=e.point&&(trace("ss",t,e.point),i.setPoint(e.point))},this.dragActiv=function(){1==this._active?this.par.event3DArr.dragE3d=this.dragE3d:this.par.event3DArr.dragE3d=void 0}}set active(t){this._active!=t&&(this._active=t,this.dragActiv())}get active(){return this._active}}function u(t){var i=this;this.parent=t,this.parent=t,this._debug=!1,this.debugInit=!1,this.shadowHelper=void 0,this.spotLightHelper=void 0,this.gridHelper=void 0,this.FIXATION=!1,this.ROTATION_X=0,this.ROTATION_Z=0,this.DISTANCE=this.parent.DISTANCE,this.CUB_HEIGHT=this.parent.CUB_HEIGHT,this.CUB_WIDTH=this.parent.CUB_WIDTH,this.SKY_X=0,this.SKY_Y=0,this.SKY_Z=0,this._fixation=this.FIXATION,this._rotationX=this.ROTATION_X,this._rotationZ=this.ROTATION_Z,this._distance=this.DISTANCE,this._cubHeight=this.CUB_HEIGHT,this._cubWidth=this.CUB_WIDTH,this.sky=new s.a(this),this.smc=new n.a(this),this.focus=new r(this.parent),this.pointZdvig=new l(this.parent),this.funDebug=function(){1!=this.debugInit&&(this.debugInit=!0,this.plane=new THREE.Mesh(new THREE.PlaneBufferGeometry(1e3,1e3).rotateX(-Math.PI),new THREE.MeshPhongMaterial({color:11316396,transparent:!0,opacity:.5})),this.plane.castShadow=this.plane.receiveShadow=!0,this.plane.position.z=2,this.plane.renderOrder=1,this.gridHelper=new THREE.GridHelper(1e3,10),this.gridHelper.rotation.x=-Math.PI/2,this.shadowHelper=new THREE.CameraHelper(this.parent.sunLight.shadow.camera),this.parent.sunLight&&(this.spotLightHelper=new THREE.DirectionalLightHelper(this.parent.sunLight))),1==this._debug?(null==this.gridHelper.parent&&this.parent.groupObject.add(this.gridHelper),null==this.plane.parent&&this.parent.groupObject.add(this.plane),null==this.shadowHelper.parent&&this.parent.scene.add(this.shadowHelper),this.parent.sunLight&&(null!=this.parent.sunLight.parent||(null!=this.spotLightHelper.parent&&this.parent.scene.remove(this.spotLightHelper),null!=this.shadowHelper.parent&&this.parent.scene.remove(this.shadowHelper)))):(null!=this.gridHelper.parent&&this.parent.groupObject.remove(this.gridHelper),null!=this.plane.parent&&this.parent.groupObject.remove(this.plane),null!=this.shadowHelper.parent&&this.parent.scene.remove(this.shadowHelper),this.parent.sunLight&&null!=this.spotLightHelper.parent&&this.parent.scene.remove(this.spotLightHelper))},this.render=function(){1==this._debug&&null!=this.spotLightHelper&&this.spotLightHelper.update(),this.smc.render(),this.sky.render(),this.focus.upDate(),this.dragSunLight()};var e=0;this.dragSunLight=function(){var t;null!=this.parent.sunLight&&(null!=this.parent.sunLight.parent&&(!0===i._fixation?(e=this._distance+2*this._cubHeight,i.parent.sunLight.position.set(0,e,0),i.parent.sunLight.position.applyAxisAngle(new THREE.Vector3(1,0,0),i._rotationX),i.parent.sunLight.position.applyAxisAngle(new THREE.Vector3(0,1,0),i._rotationZ-i.parent._rotationZ)):(e=this._distance+this._cubHeight,this.parent.sunLight.position.set(0,e,0),this.parent.sunLight.position.applyAxisAngle(new THREE.Vector3(1,0,0),this._rotationX),this.parent.sunLight.position.applyAxisAngle(new THREE.Vector3(0,1,0),this._rotationZ),this.parent.staticShadow&&(t=new THREE.Vector3(i.parent.xVerh,i.parent.yVerh,i.parent.zVerh),i.parent.sunLight.position.add(t),i.parent.sunLight.target.position.copy(t),h.distanceTo(t)>i.distanceUpdateShadow&&(h.copy(t),i.parent.shadowNeedsUpdate=!0)))))};var h=new THREE.Vector3;this.distanceUpdateShadow=500,this.dragSunLight2=function(){null!=this.parent.sunLight&&null!=this.parent.sunLight.parent&&(!0===this._fixation||(e=this._distance+2*this._cubHeight,this.parent.sunLight.position.set(0,e,0),this.parent.sunLight.position.applyAxisAngle(new THREE.Vector3(1,0,0),this._rotationX),this.parent.sunLight.position.applyAxisAngle(new THREE.Vector3(0,1,0),this._rotationZ)))},this.dragSunLight3=function(){this.parent.sunLight&&(this.parent.sunLight.shadow.camera.near=0+this._cubHeight,this.parent.sunLight.shadow.camera.far=2*this._cubHeight+this._cubHeight,this.parent.sunLight.shadow.camera.updateProjectionMatrix(),this.shadowHelper&&this.shadowHelper.update())},this.sunActiv=function(t){this.parent.objShadow(this.parent.group,t),1==t?null==this.parent.sunLight.parent&&(this.parent.scene.add(this.parent.sunLight),this.parent.scene.add(i.parent.sunLight.target)):null!=this.parent.sunLight.parent&&(this.parent.scene.remove(this.parent.sunLight),this.parent.scene.remove(i.parent.sunLight.target)),this.funDebug()},this.ambientActiv=function(t){1==t?null==this.parent.ambientLight.parent&&this.parent.scene.add(this.parent.ambientLight):null!=this.parent.ambientLight.parent&&this.parent.scene.remove(this.parent.ambientLight)};var a,o=new THREE.Vector3(0,0,0);this.posi=new THREE.Vector3(0,0,0),this.get2Point=function(t){return a=t.localToWorld(this.posi.clone()),this.toScreenXY(a),o},this.toScreenXY=function(t){return t.project(visi3D.camera),o.x=Math.round((t.x+1)*visi3D._width/2),o.y=Math.round((1-t.y)*visi3D._height/2),o.z=t.z,o}}e.d(i,"a",function(){return u}),u.prototype={set debug(t){this._debug!==t&&(this._debug=t,this.funDebug())},get debug(){return this._debug},set rotationX(t){this._rotationX!==t&&(this._rotationX=t,null!=this.spotLightHelper&&(this.parent.sunLight.shadow.camera.updateProjectionMatrix(),this.spotLightHelper.update()),this.dragSunLight2())},get rotationX(){return this._rotationX},set rotationZ(t){this._rotationZ!==t&&(this._rotationZ=t,this.sky.shadRotZ=t,null!=this.spotLightHelper&&this.spotLightHelper.update(),this.dragSunLight2())},get rotationZ(){return this._rotationZ},set fixation(t){this._fixation!==t&&(this._fixation=t,this.dragSunLight2())},get fixation(){return this._fixation},set distance(t){this._distance!==t&&(this._distance=t,this.dragSunLight3(),this.dragSunLight2())},get distance(){return this._distance},set cubHeight(t){this._cubHeight!==t&&(this._cubHeight=t,this.dragSunLight3(),this.dragSunLight2())},get cubHeight(){return this._cubHeight},set cubWidth(t){this._cubWidth!==t&&(this._cubWidth=t,this.parent.sunLight&&(this.parent.sunLight.shadow.camera.right=this._cubWidth,this.parent.sunLight.shadow.camera.left=-this._cubWidth,this.parent.sunLight.shadow.camera.top=this._cubWidth,this.parent.sunLight.shadow.camera.bottom=-this._cubWidth,this.parent.sunLight.shadow.camera.updateProjectionMatrix(),this.shadowHelper&&this.shadowHelper.update()))},get cubWidth(){return this._cubWidth}}},function(t,i,e){"use strict";function s(){var t=this,i=256,e=256,s=new THREE.Scene,n=new THREE.OrthographicCamera(i/-2,i/2,e/2,e/-2,.001,1e4),r=(new THREE.Clock,new THREE.WebGLRenderer({antialias:!0,alpha:!0,preserveDrawingBuffer:!0}));n.position.set(200,200,200),s.add(n),this.camera=n,this.fotoContainer=new THREE.Object3D,s.add(this.fotoContainer),s.background=new THREE.Color(38655),r.setPixelRatio(window.devicePixelRatio),r.setSize(i,e),r.localClippingEnabled=!0;var h=document.createElement("div");h.style.position="absolute",h.style.bottom="0px",h.style.left="0px",h.appendChild(r.domElement),this.contentHTML=h,this.canvas=r.domElement,this.contentHTML=h;var a=new THREE.AmbientLight("#ffffff",1);s.add(a);var o=new THREE.GridHelper(1e3,10),l=new THREE.AxesHelper(100),u=new THREE.BoxHelper(this.fotoContainer,16776960);s.add(o),s.add(l),s.add(u);var c=[l,o,u];function d(){r.render(s,n)}this.render=d,d(),u.setFromObject(t.fotoContainer);var p=new THREE.Box3,f=new THREE.Vector3;this.box=p,this.center=f,this.setSize=function(t,s){i=t,e=s,r.setSize(i,e),n.aspect=i/e,n.updateProjectionMatrix()},this.addObjFoto=function(t){this.fotoContainer.add(t),u.setFromObject(this.fotoContainer)},this.removeObjFoto=function(t){this.fotoContainer.remove(t)},this.moveToObj=function(i){p.setFromObject(i||t.fotoContainer);var e=p.max.x-p.min.x,s=p.max.z-p.min.z;t.moveToRect(p.min.x,p.min.z,e,s)},this.moveToRect=function(t,i,e,s){if(t+=e/2,i+=s/2,f.set(t,0,i),n.position.set(f.x,9e3,f.z),n.lookAt(f),"OrthographicCamera"===n.type){var r=Math.max(s,e);n.zoom=1,n.left=r/-2,n.right=r/2,n.top=r/2,n.bottom=r/-2,n.aspect=r/r}n.updateProjectionMatrix()},this.getFoto=function(t){t=t||1024;for(var n=0;n<c.length;n++)c[n].visible=!1;var h=s.background;s.background=null,r.setSize(t,t),d();var a=r.domElement.toDataURL("image/png");r.setSize(i,e),s.background=h;for(var o=0;o<c.length;o++)c[o].visible=!0;return d(),a},this.getCanvas=function(t){t=t||1024;for(var i=0;i<c.length;i++)c[i].visible=!1;s.background;s.background=null;var e=r.getSize();return e.width==t&&e.height==t||r.setSize(t,t),d(),r.domElement}}function n(t){var i=this,e=THREE.Math.generateUUID(),n=new THREE.Vector3(0,1,0),o=(new THREE.Plane(n,.01),new THREE.Vector4(0,999,0,.001)),l=new THREE.Box3,u=t||new s;this.foto3D=u;var c=new THREE.Vector2(0,0),d=100,p=new h;this.canvas=p.canvas,this.isTime=!1;var f=new THREE.Texture(p.canvas);this.texturePlan=f,this.matPlan=new THREE.MeshPhongMaterial({transparent:!0,side:THREE.DoubleSide,map:f});var g=new a;this.canvasGG=g,g.arrColorStopTranspanent[0]=.15,g.arrProcent[0]=.82,g.arrColorStopTranspanent[1]=1,g.arrProcent[1]=1,g.update();var x=new THREE.Texture(g.canvas);x.needsUpdate=!0,this.textureShadow=x,this.content3d=new THREE.Object3D,this.shadowContent3d=new THREE.Object3D,this.meshPlan=new THREE.Mesh(new THREE.PlaneBufferGeometry(1,1),this.matPlan),this.meshPlan.rotation.x=-Math.PI/2,this.content3d.add(this.meshPlan);var y=new THREE.Mesh(new THREE.SphereBufferGeometry(10,16,16));y.position.set(o.x,o.y,o.z),this.arrShadowMesh=[],this.arrObj=[],this._dunamic=!0,this.dirty=!0,this._lightPosition4D=o,this._fotoPosition=new THREE.Vector2(0,0),this._fotoWH=150,this._imgWH=512,this._imgBlur=1,this._imgAlpha=1,this._offsetY=0,this._scaleShadow=1,this._isDinamFotoRect=!1,this._opacityMat=1;var m=[new THREE.Plane(new THREE.Vector3(0,-1,0),100),new THREE.Plane(new THREE.Vector3(0,1,0),0)];this._shadowMaterial=new THREE.MeshBasicMaterial({side:THREE.DoubleSide,transparent:!0,opacity:this._opacityMat,depthWrite:!1,map:x,clippingPlanes:m,clipIntersection:!1}),this.arrDataSempl=[],this.arrDataSempl.push(new r(0,200,3,1));var v=new THREE.Group;this.content3d.add(v);var b=new THREE.Mesh(new THREE.PlaneBufferGeometry(1,1),new THREE.MeshBasicMaterial({side:THREE.DoubleSide,map:x,transparent:!0}));b.scale.set(1,30,1),b.rotation.z=-Math.PI/2,v.add(b),v.visible=!1,this.helpers=v,this.setConstMax=function(t){m[0].constant=t},this.setConstMin=function(t){m[1].constant=-t},this.addObj=function(t){if(-1==i.arrObj.indexOf(t)){t.updateMatrixWorld();var e=t.clone();!function t(i,e){i.userData.targetObject=e;for(var s=0;s<i.children.length;s++){if(!e.children[s])throw new Error("обекты не одинаковы");t(i.children[s],e.children[s])}}(e,t),function(t){var e=[];!function t(i,e){"Mesh"==i.type&&e.push(i);for(var s=0;s<i.children.length;s++)"Mesh"==i.type?e.push(i.children[s]):t(i.children[s],e)}(t,e);for(var s=0;s<e.length;s++)e[s].material=i._shadowMaterial}(e),i.arrShadowMesh.push(e),i.arrObj.push(t),i.shadowContent3d.add(e),this.dirty=!0}},this.removeObj=function(t){var e=i.arrObj.indexOf(t);-1!=e&&(i.arrObj.splice(e,1),i.shadowContent3d.remove(i.arrShadowMesh[e]),i.arrShadowMesh.splice(e,1),this.dirty=!0)},this.clear=function(){for(var t=0;(t=i.arrObj.length)>0;)if(i.removeObj(i.arrObj[t-1]),t===i.arrObj.length)throw new Error("object not remove")},this.intRend=1,this.intRendOk=1,this.upDate=function(){i.opacityMat&&(i.dunamic&&(i.intRend=i.intRendOk),i.intRend==i.intRendOk&&(i.dirty||function(){for(var t=0;t<i.arrShadowMesh.length;t++)if((i._isDinamFotoRect||w(i.arrShadowMesh[t]))&&_(i.arrShadowMesh[t]))return!0;return!1}())&&i.render(),i.intRend++)};function w(t){var e=!1,s=!1,n=l.min.x,r=l.min.z,h=l.max.x-l.min.x,a=l.max.z-l.min.z;if(l.setFromObject(t.userData.targetObject),e=D(n=l.min.x,r=l.min.z,h=l.max.x-l.min.x,a=l.max.z-l.min.z,i.fotoPosition.x,i.fotoPosition.y,i.fotoWH,i.fotoWH),l.setFromObject(t),s=D(n=l.min.x,r=l.min.z,h=l.max.x-l.min.x,a=l.max.z-l.min.z,i.fotoPosition.x,i.fotoPosition.y,i.fotoWH,i.fotoWH),!e&&!s)return!1;e=!1,s=!1;for(var o=0;o<t.children.length;o++)if(l.setFromObject(t.children[o].userData.targetObject),n=l.min.x,r=l.min.z,h=l.max.x-l.min.x,a=l.max.z-l.min.z,e=e||D(n,r,h,a,i.fotoPosition.x,i.fotoPosition.y,i.fotoWH,i.fotoWH),l.setFromObject(t.children[o]),n=l.min.x,r=l.min.z,h=l.max.x-l.min.x,a=l.max.z-l.min.z,s=s||D(n,r,h,a,i.fotoPosition.x,i.fotoPosition.y,i.fotoWH,i.fotoWH),e||s)return!0;return!0}function _(t){if(!function(t,i){if(t.position.equals(i.position)&&t.quaternion.equals(i.quaternion)&&t.scale.equals(i.scale)&&t.visible===i.visible)return!0;return!1}(t,t.userData.targetObject))return!0;for(var i=0;i<t.children.length;i++)if(_(t.children[i]))return!0;return!1}function P(t){!function(t,i){t.position.copy(i.position),t.quaternion.copy(i.quaternion),t.scale.copy(i.scale),t.visible=i.visible}(t,t.userData.targetObject);for(var i=0;i<t.children.length;i++)P(t.children[i])}this.render=function(){i.isTime&&console.time("render "+e),i.dirty=!1,function(){o.w=.001,y.position.set(o.x,o.y,o.z);for(var t=0;t<i.arrShadowMesh.length;t++)P(i.arrShadowMesh[t]);E()}(),u.addObjFoto(i.shadowContent3d),d=i.fotoWH,c.x=i.fotoPosition.x,c.y=i.fotoPosition.y,i.isDinamFotoRect&&(l.setFromObject(i.shadowContent3d),c.x=l.min.x,c.y=l.min.z,d=Math.max(l.max.x-l.min.x,l.max.z-l.min.z),c.x-=100,c.y-=100,d+=200),u.moveToRect(c.x,c.y,d,d),function(){var t=u.getCanvas(i.imgWH);p.setCanvas(t),0==i.arrDataSempl.length&&p.update();for(var e=0;e<i.arrDataSempl.length;e++)i.setConstMin(i.arrDataSempl[e].min*i._scaleShadow+i._offsetY),i.setConstMax(i.arrDataSempl[e].max*i._scaleShadow+i._offsetY),u.render(),p._blur=i.arrDataSempl[e].blur+(i._scaleShadow>1?i._scaleShadow:0),p._alpha=i.arrDataSempl[e].alpha,p.update();i.setConstMin(-999999),i.setConstMax(999999),f.needsUpdate=!0}(),i.meshPlan.scale.set(d,d,1),i.meshPlan.position.set(c.x+d/2,0,c.y+d/2),i.isTime&&console.timeEnd("render "+e),i.onUpdate&&i.onUpdate()};var S=new THREE.Box3(new THREE.Vector3,new THREE.Vector3(300,300,300));this.boundingBoxUv=S;var A=new THREE.Vector3;function T(t){if("Mesh"===t.type){var e=!1,s=t.getWorldPosition(t.position),n=t.getWorldQuaternion(t.quaternion),r=i.maxHeight;s.y-=i._offsetY,t.userData.pos?t.userData.pos.y!=s.y?e=!0:t.userData.rot.equals(n)?t.userData.maxHeight!==r?e=!0:t.userData.scaleShadow!==i._scaleShadow&&(e=!0):e=!0:e=!0,i._isDinamFotoRect||(l.setFromObject(t),D(l.min.x,l.min.z,l.max.x-l.min.x,l.max.z-l.min.z,i.fotoPosition.x,i.fotoPosition.y,i.fotoWH,i.fotoWH)||(e=!1)),e&&(!function(t){t.geometry.uuid===t.userData.targetObject.geometry.uuid&&(t.geometry=t.userData.targetObject.geometry.clone());var e=S,s=0;if(t.geometry instanceof THREE.Geometry){for(var n=t.geometry.faces,r=t.geometry.vertices,h=t.geometry.faceVertexUvs[0],a=0;a<n.length;a++)A.set(r[n[a].a].x,r[n[a].a].y,r[n[a].a].z),t.localToWorld(A),s=1-z(A.y-i._offsetY,e.min.y,e.min.y+e.max.y)/100,h[a][0].set(s,s),A.set(r[n[a].b].x,r[n[a].b].y,r[n[a].b].z),t.localToWorld(A),s=1-z(A.y-i._offsetY,e.min.y,e.min.y+e.max.y)/100,h[a][1].set(s,s),A.set(r[n[a].c].x,r[n[a].c].y,r[n[a].c].z),t.localToWorld(A),s=1-z(A.y-i._offsetY,e.min.y,e.min.y+e.max.y)/100,h[a][2].set(s,s);t.geometry.uvsNeedUpdate=!0}else{var o=t.geometry.attributes.position.array;t.geometry.attributes.uv||(arrUvAttribut=new Float32Array(o.length/3*2),t.geometry.addAttribute("uv",new THREE.BufferAttribute(arrUvAttribut,2)));var l=t.geometry.attributes.uv.array,u=(t.geometry.attributes.uv.itemSize,t.geometry.index.array),c=t.geometry.index.count;for(a=0;a<c;a++){var d=u[a],p=3*d,f=2*d;A.set(o[p],o[p+1],o[p+2]),t.localToWorld(A),s=1-z(A.y-i._offsetY,e.min.y,e.min.y+e.max.y*i._scaleShadow)/100,l[f]=s,l[f+1]=s}t.geometry.attributes.uv.needsUpdate=!0}}(t),t.userData.pos=s,t.userData.rot=n,t.userData.maxHeight=r,t.userData.scaleShadow=i._scaleShadow)}for(var h=0;h<t.children.length;h++)T(t.children[h])}function E(){b.scale.x=(i.boundingBoxUv.max.y||1)*i._scaleShadow,b.position.y=b.scale.x/2+i.boundingBoxUv.min.y;for(var t=0;t<i.arrShadowMesh.length;t++)(i._isDinamFotoRect||(l.setFromObject(i.arrShadowMesh[t]),D(l.min.x,l.min.z,l.max.x-l.min.x,l.max.z-l.min.z,i.fotoPosition.x,i.fotoPosition.y,i.fotoWH,i.fotoWH)))&&T(i.arrShadowMesh[t])}this.updateShadowUv=E,this.updateShadowTexture=function(){this.canvasGG.update(),this.textureShadow.needsUpdate=!0},this.setShadowColor=function(t,e,s){g.r=t,g.g=e,g.b=s,i.updateShadowTexture()},this.getConfig=function(){var t={};return t.imgWH=i.imgWH,t.fotoPosition={x:i._fotoPosition.x,y:i._fotoPosition.y},t.fotoWH=i.fotoWH,t.maxHeight=i.maxHeight,t.isDinamFotoRect=i.isDinamFotoRect,t.arrDataSempl=i.arrDataSempl,t.opacityMat=i.opacityMat,t.dunamic=i.dunamic,t.canvasGG={arrColorStopTranspanent:i.canvasGG.arrColorStopTranspanent,arrProcent:i.canvasGG.arrProcent},t},this.setConfig=function(t){i.canvasGG.arrColorStopTranspanent=t.canvasGG.arrColorStopTranspanent,i.canvasGG.arrProcent=t.canvasGG.arrProcent,i.fotoPosition.x=t.fotoPosition.x,i.fotoPosition.y=t.fotoPosition.y,i.fotoWH=t.fotoWH,i.isDinamFotoRect=t.isDinamFotoRect,i.arrDataSempl=t.arrDataSempl,i.opacityMat=t.opacityMat,i.imgWH=t.imgWH,i.dunamic=t.dunamic,i.updateShadowTexture(),i.maxHeight=t.maxHeight};var M={imgWH:1024,fotoPosition:{x:0,y:0},fotoWH:150,maxHeight:300,isDinamFotoRect:!1,arrDataSempl:[{min:0,max:6,blur:.8,alpha:.25},{min:4,max:15,blur:3,alpha:.64},{min:10,max:23,blur:4,alpha:.5},{min:15,max:50,blur:15,alpha:1},{min:20,max:198.09,blur:15,alpha:.7},{min:0,max:2,blur:1.02,alpha:1}],opacityMat:1,dunamic:!0,canvasGG:{arrColorStopTranspanent:[0,1,.25],arrProcent:[.4,1,.96]}};function D(t,i,e,s,n,r,h,a){return t<n+h&&i<r+a&&t+e>n&&i+s>r}function z(t,i,e,s){return i=null!=i?i:0,e=null!=e?e:100,s=s||100,isNaN(parseFloat(t))&&(t=i),t<i&&(t=i),t>e&&(t=e),t=Math.round(t*s)/s,i<0?100*(Math.abs(i)+t)/(Math.abs(i)+Math.abs(e)||1):100*(Math.abs(i)-t)/(Math.abs(i)-Math.abs(e)||1)}this.sss=M,this.setConfig(M),this.getBase64=function(){return i.render(),p.canvas.toDataURL()},this.debug=!1}function r(t,i,e,s){this.min=t||0,this.max=i||1,this.blur=e||0,this.alpha=s||1}function h(){var t=this,i=document.createElement("canvas");this.canvas=i,i.width=256,i.height=256;var e=i.getContext("2d"),s=new Image;this.b64=null,this._blur=0,this._blur1=1,this._alpha=1,this.image=new Image,this.setBase64=function(e,n){this.b64=e,(s=new Image).onload=function(){i.clearRect(0,0,i.width,i.height),i.width=s.width,i.height=s.height,t.update(),n&&n(i.toDataURL())},s.src=e},this.setCanvas=function(t){s=t,i.width=t.width,i.height=t.height},this.update=function(){e.filter="blur("+t._blur+"px)",e.globalAlpha=t._alpha,e.drawImage(s,0,0)}}function a(){var t=this,i=document.createElement("canvas");i.width=i.height=256,this.canvas=i;var e=i.getContext("2d");this._blur=0,this._alpha=1,this.arrColorStopTranspanent=[0,1],this.arrProcent=[0,1],this.position=new THREE.Vector2,this.position1=new THREE.Vector2(1,0),this.r=0,this.g=0,this.b=0,this.update=function(){var s=i.width,n=i.height;e.clearRect(0,0,s,n),e.rect(0,0,s,n),e.filter="blur("+t._blur+"px)",e.globalAlpha=t._alpha;for(var r=t.position.x*s,h=t.position.y*n,a=t.position1.x*s,o=t.position1.y*n,l=e.createLinearGradient(r,h,a,o),u=0;u<t.arrColorStopTranspanent.length;u++)l.addColorStop(t.arrProcent[u],"rgba("+t.r+","+t.g+","+t.b+","+t.arrColorStopTranspanent[u]+")");e.fillStyle=l,e.fill()},this.update()}function o(t){this.parent=t;this._active=!1,this._visible=!0,this.WH=512,this._wn=this.WH,this._obj3d=void 0,this.smc=void 0,this.init=function(){null==this.smc&&(this.smc=new n,this.smc.fotoPosition.set(-this._wn/2,-this._wn/2),this.smc.fotoWH=this._wn,this.smc.content3d.rotation.x=-Math.PI/2,this.smc.content3d.position.y=-1,this.smc.content3d.visible=this._visible,this.dergObj())},this.dergActiv=function(){1==this._active?null==this.smc.content3d.parent&&this.parent.parent.groupObject.add(this.smc.content3d):null!=this.smc.content3d.parent&&this.parent.parent.groupObject.remove(this.smc.content3d)},this.render=function(){null!=this.smc&&null!=this.smc.content3d.parent&&this.smc.upDate()},this.dergObj=function(){null!=this.smc&&(null!=this._obj3d?this.smc.arrObj[0]==this._obj3d||(this.smc.clear(),this.smc.addObj(this._obj3d)):this.smc.clear())}}Object.defineProperties(n.prototype,{scaleShadow:{set:function(t){this.dirty=!0,this._scaleShadow=t},get:function(){return this._scaleShadow}},debug:{set:function(t){this.helpers.visible=t},get:function(){return this.helpers.visible}},offsetY:{set:function(t){this._offsetY=t,this.dirty=!0},get:function(){return this._offsetY}},maxHeight:{set:function(t){this.dirty=!0,this.boundingBoxUv.max.y=t,this.updateShadowUv()},get:function(){return this.boundingBoxUv.max.y}},dunamic:{set:function(t){this.dirty=!0,this._dunamic=t},get:function(){return this._dunamic}},fotoPosition:{set:function(t){this.dirty=!0,this._fotoPosition=t},get:function(){return this._fotoPosition}},fotoWH:{set:function(t){this.dirty=!0,this._fotoWH=t},get:function(){return this._fotoWH}},imgWH:{set:function(t){this.dirty=!0,this._imgWH=t},get:function(){return this._imgWH}},imgBlur:{set:function(t){this.dirty=!0,this._imgBlur=t},get:function(){return this.dirty=!0,this._imgBlur}},imgAlpha:{set:function(t){this.dirty=!0,this._imgAlpha=t},get:function(){return this._imgAlpha}},isDinamFotoRect:{set:function(t){this.dirty=!0,this._isDinamFotoRect=t},get:function(){return this._isDinamFotoRect}},opacityMat:{set:function(t){this.dirty=!0,this._opacityMat=t,this.matPlan.opacity=this._opacityMat},get:function(){return this._opacityMat}},shadowMaterial:{set:function(t){if(t!==this._shadowMaterial){this._shadowMaterial=t;for(var i=0;i<this.arrShadowMesh.length;i++)if(this.arrShadowMesh[i]instanceof THREE.ShadowMesh)this.arrShadowMesh[i].material=this._shadowMaterial;else for(var e=0;e<this.arrShadowMesh[i].children.length;e++)this.arrShadowMesh[i].children[e]instanceof THREE.ShadowMesh&&(this.arrShadowMesh[i].children[e].material=this._shadowMaterial)}},get:function(){return this._shadowMaterial}},lightPosition4D:{set:function(t){this._lightPosition4D.set(t.x,t.y,t.z,.001)},get:function(){return this._lightPosition4D}}}),Object.defineProperties(h.prototype,{blur:{set:function(t){this._blur=t},get:function(){return this._blur}},alpha:{set:function(t){this._alpha=t},get:function(){return this._alpha}}}),Object.defineProperties(a.prototype,{}),e.d(i,"a",function(){return o}),o.prototype={set active(t){this._active!==t&&(this._active=t,this.init(),this.dergActiv())},get active(){return this._active},set visible(t){this._visible!==t&&(this._visible=t,null!=this.smc&&(this.smc.content3d.visible=t))},get visible(){return this._visible},set obj3d(t){this._obj3d!==t&&(this._obj3d=t,this.dergObj())},get obj3d(){return this._obj3d},set wh(t){this._wh!==t&&(this._wh=t,null!=this.smc&&(this.smc.fotoPosition.set(-this._wn/2,-this._wn/2),this.smc.fotoWH=this._wn))},get wh(){return this._wh}}},function(t,i,e){"use strict";e.d(i,"a",function(){return n});var s=e(0);function n(){var t,i=this;this.type="CubeMap",this.LINK="null",this.EXPOSURE=-1,this.GAMMA=-1,this._link="nullXZ",this._exposure=this.EXPOSURE,this._gamma=this.GAMMA,this.exposureStart=-1,this.gammaStart=-1,this._activDiz=!1,this._layer=1,this.otherLayer=31,this.renderer=void 0,this.scene=void 0,this.cubeCamera=new THREE.CubeCamera(1,1e4,512),this.geometry=new THREE.SphereBufferGeometry(1500,32,32),this.mesh=new THREE.Mesh(this.geometry),this.loader=void 0,this.loader=new s.a,this.init=function(t,i){void 0!==t&&void 0!==i&&(this.renderer=t,this.scene=i,this.scene.add(this.cubeCamera),this.scene.add(this.mesh),this.link="null")},this.setLayers=function(t){i.mesh.layers.set(t),i.cubeCamera.layers.set(t),i.cubeCamera.traverse(function(i){i.layers.set(t)})},this.upDate=function(t){this.setLayers(this.otherLayer),this.cubeCamera.update(t||this.renderer,this.scene),this.setLayers(this._layer)},this.material=void 0,this.dragMaterial=function(t){this.material=t,e==t.sahMin&&(this.mesh.material=t,this.upDate())},this.arrMat=[],this.testBD=function(t){for(var i=0;i<this.arrMat.length;i++)if(this.arrMat[i].linkMy==t)return this.arrMat[i];return null};var e=0;this.loadFun=function(){var s=++e,r=this._link+"";if(null!=(t=this.testBD(this._link))&&(t.sahMin=e,this.dragMaterial(t)),"null"!=this._link&&null!=this._link){if(-1!=this._link.indexOf(".png")||-1!=this._link.indexOf(".jpg")||-1!=this._link.indexOf(".jpeg")){var h=this._link;return window.mhbd&&(h=window.mhbd.getLink(this._link)),void(new THREE.TextureLoader).load(h,function(t){t.minFilter=THREE.LinearFilter,t.magFilter=THREE.NearestFilter,t.flipY=!0,t.wrapS=t.wrapT=THREE.RepeatWrapping,t.anisotropy=i.renderer.capabilities.getMaxAnisotropy();var e=new THREE.MeshBasicMaterial({map:t,side:THREE.BackSide});e.linkMy=r,e.sahMin=s,i.arrMat.push(e),i.dragMaterial(e)})}null!=this.loader?this.loader.load(this._link,function(t,e){var h=new THREE.ShaderMaterial({uniforms:{tDiffuse:{type:"t",value:t},exposure:{type:"f",value:e.exposure},gamma:{type:"f",value:e.gamma},offsetRepeat:{type:"v4",value:new THREE.Vector4(0,0,1,1)}},vertexShader:n.vertex,fragmentShader:n.fragment});t.minFilter=THREE.LinearFilter,t.magFilter=THREE.NearestFilter,t.flipY=!0,t.wrapS=t.wrapT=THREE.RepeatWrapping,t.anisotropy=i.renderer.capabilities.getMaxAnisotropy(),h.side=THREE.BackSide,h.linkMy=r,h.sahMin=s,i.arrMat.push(h),i.dragMaterial(h),i.exposureStart=e.exposure,i.gammaStart=e.gamma,1==i._activDiz&&(i._exposure=e.exposure,i._gamma=e.gamma)}):console.log("Подключи в загрущик RGBELoader токо если надо hdr загрузить!!!")}},this.getTexture=function(){return this.cubeCamera.renderTarget.texture};var n={vertex:["uniform vec4 offsetRepeat;","varying vec2 vUv;","void main() {","    // vUv  = uv;","    vUv = uv * offsetRepeat.zw + offsetRepeat.xy;","    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 3);","}"].join("\n"),fragment:["uniform sampler2D   tDiffuse;","uniform float       exposure;","uniform float       gamma;","varying vec2  vUv;","vec3 decode_pnghdr( const in vec4 color ) {","    vec4 rgbcolor = vec4( 0.0, 0.0, 0.0, 0.0 );","    if ( color.w > 0.0 ) {","        float f = pow(2.0, 127.0*(color.w-0.5));","        rgbcolor.xyz = color.xyz * f;","    }","    return rgbcolor.xyz;","    /*","    // remove gamma correction","    vec4 res = color * color;","    // decoded RI","    float ri = pow( 2.0, res.w * 32.0 - 16.0 );","    // decoded HDR pixel","    res.xyz = res.xyz * ri;","    return res.xyz;","    */","}","void main() {","    vec4 color = texture2D( tDiffuse, vUv );","    color.xyz  = decode_pnghdr( color );","    // apply gamma correction and exposure","    //gl_FragColor = vec4( pow( exposure * color.xyz, vec3( 0.474 ) ), 1.0 );","    // Perform tone-mapping","    float Y = dot(vec4(0.30, 0.59, 0.11, 0.0), color);","    float YD = exposure * (exposure/gamma + 1.0) / (exposure + 1.0);","    color *= YD;","    gl_FragColor = vec4( color.xyz, 1.0 );","}"].join("\n")};this.debug=!1}Object.defineProperties(n.prototype,{link:{set:function(t){this._link!=t&&(this._link=t,this.loadFun())},get:function(){return this._link}},activDiz:{set:function(t){this._activDiz!=t&&(this._activDiz=t)},get:function(){return this._activDiz}},exposure:{set:function(t){this._exposure!=t&&(this._exposure=t,this.material&&null!=this.material.uniforms&&(this.material.uniforms.exposure.value=t,this.upDate()))},get:function(){return this._exposure}},gamma:{set:function(t){this._gamma!=t&&(this._gamma=t,this.material&&null!=this.material.uniforms&&(this.material.uniforms.gamma.value=t,this.upDate()))},get:function(){return this._gamma}},debug:{set:function(t){this._debug!=t&&(this._debug=t,this._layer=t?0:31,this.setLayers(this._layer))},get:function(){return this._debug}}})},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",function(){return MVisi3D});var _MEffectArray_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(9),_MPosition3d_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(7),_MEvent3DArr_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(10),_MUtility_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(3),_CubeMap_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(5);function MVisi3D(_contentHTML,_content2d,_devas,_directional,_efect,_event3DArr,_alpha){var self=this;this.contentHTML=_contentHTML,_devas=void 0!==_devas&&_devas,_directional=void 0===_directional||_directional,_efect=void 0===_efect||_efect,_event3DArr=void 0===_event3DArr||_event3DArr,_alpha=void 0!==_alpha&&_alpha,this.intRend=0,this.devas=_devas,this.alpha=_alpha,this.arrSetiScene=[],this._xVerh=0,this._yVerh=0,this._zVerh=0,this._rotationX=0,this._rotationZ=0,this._zume=1e3,this._arrOut=[],this._x=0,this._y=0,this._height=100,this._width=100,this.yes3d=!0,this.intRendOk=1,this._visible=!0,this._isDragPan=!1,this._activMouse=!0,this._staticShadow=!1,this._fov=45,this.alwaysRender=!1,this.AMBIEN_COLOR="#ffffff",this.AMBIEN_INTENSITY=.79,this.LIGHT_COLOR="#ffffff",this.LIGHT_BIAS=.001,this.SHADOW_INTENSITY=.22,this.SHADOW_RADIUS=1,this.SHADOW_WH=4096,this.DISTANCE=0,this.CUB_HEIGHT=500,this.CUB_WIDTH=500,this.FOV=45,this.FAR=45e3,this._fov=this.FOV,this.content=void 0,this.graphics=void 0,this.fun_sob=void 0,null!=_content2d&&(this.content=eval("new PIXI.Container()"),this.graphics=eval("new PIXI.Graphics()"),_content2d.addChild(this.content),this.content.addChild(this.graphics),this.graphics.interactive=!0),this.camera,this.scene=new THREE.Scene;var color=3160129;this.color=color,this.camera=new THREE.PerspectiveCamera(this.FOV,this._width/this._height,1,this.FAR),this.renderer=new THREE.WebGLRenderer({antialias:!0,alpha:_alpha}),this.renderer.shadowMap.enabled=!0,this.renderer.setSize(this._width,this._height),1==_alpha?this.renderer.setClearColor(color,0):this.renderer.setClearColor(color,1),this.renderer.shadowMap.type=THREE.PCFSoftShadowMap,this.efect,this.efect=new _MEffectArray_js__WEBPACK_IMPORTED_MODULE_0__.a(this),_contentHTML.appendChild(this.renderer.domElement),this.renderer.domElement.style.zIndex=-10,this.event3DArr,1==_event3DArr&&(this.event3DArr=new _MEvent3DArr_js__WEBPACK_IMPORTED_MODULE_2__.a(this,this.camera,_contentHTML),this.scene.event3DArr=this.event3DArr,this.event3DArr.addDragEvent(this.graphics,_contentHTML),this.event3DArr.activ=this._activMouse),this.camera.position.set(0,0,-60),this.camera.rotation.set(Math.PI,0,0),this.renderer.domElement.style.position="fixed",this.renderer.domElement.style.top="0px",this.renderer.domElement.style.left="0px",this.group=new THREE.Object3D,this.group.rotation.x=Math.PI/2,this.scene.add(this.group),this.group1=new THREE.Object3D,this.group.add(this.group1),this.group2=new THREE.Object3D,this.group1.add(this.group2),this.groupObject=new THREE.Object3D,this.group2.add(this.groupObject),this.group3d=new THREE.Object3D,this.groupObject.add(this.group3d),this.gp=new THREE.Object3D,this.gp.rotation.x=Math.PI/2,this.scene.add(this.gp),this.gp1=new THREE.Object3D,this.gp.add(this.gp1),this.gp2=new THREE.Object3D,this.gp1.add(this.gp2),this.gpObject=new THREE.Object3D,this.gp2.add(this.gpObject),this.gpObject2=new THREE.Object3D,this.gp2.add(this.gpObject2),this.gpObject.position.z=1,this.gpObject.scale.set(.001,.001,.001),this.gpObject2.position.z=1,this.gpObject2.scale.set(.001,.001,.001),this.gCGG=new THREE.Object3D,this.group.add(this.gCGG),this.gCAngel=new THREE.Object3D,this.gCGG.add(this.gCAngel),this.gCam1=new THREE.Object3D,this.gCAngel.add(this.gCam1),this.gCam2=new THREE.Object3D,this.gCam1.add(this.gCam2),this.ggCam=new THREE.Object3D,this.gCam2.add(this.ggCam),this.ggCam.add(this.camera),this.ggCam.position.z=-this._zume,this.camera.position.z=0,this.arrPoint=[];var disLig=4e3,powerLig=.4,dis=1e4,bbbbbb;if(this.sunLight,this.ambientLight=new THREE.AmbientLight(this.AMBIEN_COLOR,this.AMBIEN_INTENSITY),this.scene.add(this.ambientLight),this.ambientLight.castShadow=!1,1==_directional){var sunIntensity=this.SHADOW_INTENSITY;this.sunLight=new THREE.DirectionalLight(this.LIGHT_COLOR,sunIntensity,0,0,.2),this.sunLight.position.set(0,this.DISTANCE+2*this.CUB_HEIGHT,0),this.sunLight.castShadow=!0,this.sunLight.shadow.camera.near=this.CUB_HEIGHT,this.sunLight.shadow.camera.far=this.CUB_HEIGHT+2*this.CUB_HEIGHT,this.sunLight.shadow.camera.right=this.CUB_WIDTH,this.sunLight.shadow.camera.left=-this.CUB_WIDTH,this.sunLight.shadow.camera.top=this.CUB_WIDTH,this.sunLight.shadow.camera.bottom=-this.CUB_WIDTH,this.sunLight.shadow.mapSize.width=this.SHADOW_WH,this.sunLight.shadow.mapSize.height=this.SHADOW_WH,this.sunLight.shadow.bias=this.LIGHT_BIAS,this.sunLight.shadow.radius=this.SHADOW_RADIUS}this.initOut=function(){},this.position3d=new _MPosition3d_js__WEBPACK_IMPORTED_MODULE_1__.a(self,this.graphics,this.renderer.domElement),this.utility=new _MUtility_js__WEBPACK_IMPORTED_MODULE_3__.a(self),this.arrayDoRender=[],this.arrayDoRender2=[],this.shadowNeedsUpdate=!1,this.arrFun=[],this.addFun=function(t){for(var i=0;i<this.arrFun.length;i++)if(this.arrFun[i]===t)return!1;return this.arrFun.push(t),!0},this.render=function(){if(0!=this.yes3d){if(0!=this.arrayDoRender2.length)for(var t=0;t<this.arrayDoRender2.length;t++)this.arrayDoRender2[t]();if(0!=this.arrFun.length){for(t=0;t<this.arrFun.length;t++)this.arrFun[t]();this.arrFun.length=0}if(this.utility.render(),this.intRend=10,this.shadowNeedsUpdate&&(this.shadowNeedsUpdate=!1,this.renderer.shadowMap.needsUpdate=!0),this.efect?0==this.efect.render()&&this.renderer.render(this.scene,this.camera):this.renderer.render(this.scene,this.camera),0!=this.arrayDoRender.length)for(t=0;t<this.arrayDoRender.length;t++)this.arrayDoRender[t]()}},this.upDate=function(){(this.alwaysRender||this.intRend==this.intRendOk)&&this.render(),this.intRend<10&&this.intRend++},this.renderer.render(this.scene,this.camera),this.sizeWindow=function(t,i,e,s){null!=t&&(this._x=t),null!=i&&(this._y=i),null!=s&&(this._height=s),null!=e&&(this._width=e),null!=this.content&&(this.content.x=this._x,this.content.y=this._y,this.graphics.clear(),this.graphics.beginFill(16711680,0),this.graphics.drawRect(0,0,this._width,this._height),this.graphics.endFill()),this.renderer.domElement.style.left=this._x+"px",this.renderer.domElement.style.top=this._y+"px",this.camera.aspect=this._width/this._height,this.camera.updateProjectionMatrix(),this.renderer.setSize(this._width,this._height),this.intRend=1;let n=87e-5*this.camera.aspect;this.gpObject2.scale.set(n,87e-5,1),this.gpObject.scale.set(n/(this._width/1e3),87e-5/(this._height/1e3),1),this.event3DArr&&(this.event3DArr.sizeWindow(this._width,this._height),this.event3DArr.setRect(this._x,this._y,this._width,this._height)),this.efect&&this.efect.sizeWindow(this._width,this._height)},this.render(),this.sizeWindow(),this.objShadow=function(t,i){if(null==i&&(i=!0),bbbbbb=!0,t.material&&1==t.material.transparent&&t.material.opacity<1&&(bbbbbb=!1),1==bbbbbb&&(t.castShadow=i,t.receiveShadow=i),null!=t.children)for(var e=0;e<t.children.length;e++)null!=t.children?this.objShadow(t.children[e],i):(bbbbbb=!0,t.children[e].material&&1==t.material.transparent&&t.material.opacity<1&&(bbbbbb=!1),1==bbbbbb&&(t.children[e].castShadow=i,t.children[e].receiveShadow=i))},this.cubeMap=new _CubeMap_js__WEBPACK_IMPORTED_MODULE_4__.a,this.cubeMap.init(this.renderer,this.scene),this.getEnvMap=function(){return self.cubeMap.getTexture()},this.cubeMap1=new _CubeMap_js__WEBPACK_IMPORTED_MODULE_4__.a,this.cubeMap1.init(this.renderer,this.scene);var t=this.cubeMap1.getTexture();t.mapping=THREE.CubeRefractionMapping,this.cubeMap1.upDate(),this.getEnvMap1=function(){return self.cubeMap1.getTexture()},this.getObj=function(){var t={};return t.xVerh=this._xVerh,t.yVerh=this._yVerh,t.zVerh=this._zVerh,t.rotationX=this._rotationX,t.rotationZ=this._rotationZ,t.zume=this._zume,t.fov=this._fov,t},this.setObj=function(t){null!=t&&(this.xVerh=t.xVerh,this.yVerh=t.yVerh,this.zVerh=t.zVerh,this.rotationX=t.rotationX,this.rotationZ=t.rotationZ,this.zume=t.zume,this.fov=t.fov)},this.mousemove=function(t){self.position3d.stageMoveNew(t),self.event3DArr.mousemove(t)},this.getFunMouseMove=function(){return 0==self.devas?self.position3d.div.removeEventListener("mousemove",self.mousemove):self.position3d.div.removeEventListener("touchmove",self.mousemove),self.mousemove},null==_content2d?0==self.devas?self.position3d.div.addEventListener("mousemove",self.mousemove):self.position3d.div.addEventListener("touchmove",self.mousemove):(self.stageM2=function(t){self.position3d.stageMoveNew(t.data.originalEvent),self.event3DArr.mousemove(t.data.originalEvent)},0==self.devas?this.graphics.on("mousemove",self.stageM2):this.graphics.on("touchmove",self.stageM2)),document.oncontextmenu=function(t){return!1},this.addEvent=function(t,i){this.event3DArr&&this.event3DArr.eventSob.addEvent(t,i)},this.removeEvent=function(t,i){this.event3DArr&&this.event3DArr.eventSob.removeEvent(t,i)},this.addChildMouse=function(t){this.event3DArr&&this.event3DArr.addChild(t)},this.removeChildMouse=function(t){this.event3DArr&&this.event3DArr.removeChild(t)},this.fun_rotationX,this.fun_rotationZ,this.fun_drag=void 0}MVisi3D.prototype={set staticShadow(t){this.renderer.shadowMap.autoUpdate=!t,this._staticShadow=t},get staticShadow(){return this._staticShadow},set rotationX(t){this._rotationX!==t&&(this.utility.pointZdvig.set("rotationX",t,this._rotationX),this._rotationX=t,this.intRend=1,this.gCam2.rotation.x=t,this.gp2.rotation.x=t,this.fun_rotationX&&this.fun_rotationX(),null!=this.fun_drag&&this.fun_drag())},get rotationX(){return this._rotationX},set rotationZ(t){this._rotationZ!==t&&(this.utility.pointZdvig.set("rotationZ",t,this._rotationZ),this._rotationZ=t,this.gCam1.rotation.z=t,this.gp1.rotation.z=t,this.intRend=1,this.fun_rotationZ&&this.fun_rotationZ(),null!=this.fun_drag&&this.fun_drag())},get rotationZ(){return this._rotationZ},set zume(t){this._zume!==t&&(this.utility.pointZdvig.set("zume",t,this._zume),this.gpObject.position.z=1-t,this.gpObject2.position.z=1-t,this._zume=t,this.ggCam.position.z=-t,this.camera.position.z=0,this.intRend=1,null!=this.fun_drag&&this.fun_drag())},get zume(){return this._zume},set fov(t){this._fov=t,this.camera.fov=t,this.camera.updateProjectionMatrix(),null!=this.fun_drag&&this.fun_drag()},get fov(){return this._fov},set yVerh(t){this._yVerh=t,this.gCGG.position.z=t,this.intRend=1,null!=this.fun_drag&&this.fun_drag()},get yVerh(){return this.gCGG.position.z},set xVerh(t){this._xVerh=t,this.gCGG.position.x=t,this.intRend=1,null!=this.fun_drag&&this.fun_drag()},get xVerh(){return this.gCGG.position.x},set zVerh(t){this._zVerh=t,this.gCGG.position.y=t,this.intRend=1,null!=this.fun_drag&&this.fun_drag()},get zVerh(){return this.gCGG.position.y},set arrOut(t){this._arrOut=t,1!=this.alpha&&(this.efect&&this.efect.setValue(this._arrOut),this.intRend=1,null!=this.fun_drag&&this.fun_drag())},get arrOut(){return this._arrOut},set x(t){this._x=t,this.sizeWindow()},get x(){return this._x},set y(t){this._y=t,this.sizeWindow()},get y(){return this._y},set height(t){this._height=t,this.sizeWindow()},get height(){return this._height},set width(t){this._width=t,this.sizeWindow()},get width(){return this._width},set visible(t){this._visible=t,this.content.visible=t,this.renderer.domElement.style.visibility=t?"visible":"hidden"},get visible(){return this._visible},set isDragPan(t){this._isDragPan=t,this.position3d.isDragPan=t},get isDragPan(){return this._isDragPan},set activMouse(t){this._activMouse=t,this.event3DArr&&(this.event3DArr.activ=this._activMouse)},get activMouse(){return this._activMouse},set minZum(t){this.position3d.minZum=t},get minZum(){return this.position3d.minZum},set maxZum(t){this.position3d.maxZum=t},get maxZum(){return this.position3d.maxZum},set maxRotationX(t){this.position3d.minMaxX.x=t},get maxRotationX(){return this.position3d.minMaxX.x},set minRotationX(t){t<this.rotationX&&(this.rotationX=t),this.position3d.minMaxX.y=t},get minRotationX(){return this.position3d.minMaxX.y}}},function(t,i,e){"use strict";e.d(i,"a",function(){return s});e(3),e(1),e(4);function s(t,i,e){var s=this;this.parent=t,this.content2d=i,this.drag=!0,this.zdvigX=0,this.sPixi=void 0,this.div=e,this.devas=t.devas,this.pause=!1,this.minMaxX=new THREE.Vector2(0,2.5),this.zume=new THREE.Vector3(1,30,10),this.point=new THREE.Vector2(0,0),this.point1=new THREE.Vector2(0,0),this.b=0,this.minZum=0,this.maxZum=5e3,this.powerZum=50,this.distMinMaxBox=15e7,this.boolDrahXZ=!0,this.boolMouseRight=!0,this.isDragPan=t._isDragPan,this.isRotateScene=!1;var n=0;this.isIE=!1,(-1!==navigator.userAgent.indexOf("MSIE")||navigator.appVersion.indexOf("Trident/")>0)&&(this.isIE=!0),this.getStage=function(t){return null==t.parent?t:this.getStage(t.parent)},this.pppW=.2,this.ppp=.5,this.pTime=500,this.tween1=new TWEEN.Tween(s.parent),this.tween1.onUpdate(function(){s.parent.intRend=1}),this.tween1.easing(TWEEN.Easing.Quintic.Out),this.tween2=new TWEEN.Tween(s.parent),this.tween2.onUpdate(function(){s.parent.intRend=1}),this.tween2.easing(TWEEN.Easing.Quintic.Out),this.stageMoveNew=function(t){if(0!=s.boolDrag&&1!=s.pause&&!(0==s.drag||t&&t.buttons&&2==t.buttons&&0==s.boolMouseRight))if(t&&s.isDragPan&&o)p(t);else if(null==t.touches){if(s.isRotateScene&&t.data.originalEvent.shiftKey)s.parent.scene.rotation.y=n+.01*(t.clientX-s.point1.x),s.parent.intRend=1;else if(s.boolDrahXZ){var i=s.point.y-.01*(t.clientY-s.point1.y),e=s.point.x+.01*(t.clientX-s.point1.x);s.minMaxX.x>i&&(i=s.minMaxX.x),s.minMaxX.y<i&&(i=s.minMaxX.y),s.parent.rotationX=i,s.parent.rotationZ=e}}else if(1==t.touches.length){if(s.boolDrahXZ){i=s.point.y-.01*(t.touches[0].clientY-s.point1.y),e=s.point.x+.01*(t.touches[0].clientX-s.point1.x);s.minMaxX.x>i&&(i=s.minMaxX.x),s.minMaxX.y<i&&(i=s.minMaxX.y),trace(i,s.minMaxX),s.parent.rotationX=i,s.parent.rotationZ=e}}else t.touches.length>=2&&(s.pT.x=t.touches[0].clientX,s.pT.y=t.touches[0].clientY,s.pT1.x=t.touches[1].clientX,s.pT1.y=t.touches[1].clientY,0==s.distTach?(s.distTach=calc.getDistance(s.pT,s.pT1),r=0,u.set(Math.round(1*s.pT.x),Math.round(1*s.pT.y))):(h=calc.getDistance(s.pT,s.pT1),r=h-s.distTach,s.distTach=h),a=s.parent._zume-r*(s.parent._zume/100),s.zumNEW(a),p(null,Math.round(1*s.pT.x),Math.round(1*s.pT.y)))},this.pT=new THREE.Vector2(0,0),this.pT1=new THREE.Vector2(0,0);var r=0,h=0;this.boolDrag=!1,this.stageUpNew=function(t){s.boolDrag=!1,0==s.devas?window.removeEventListener("mouseup",s.stageUpNew):(s.distTach=0,window.removeEventListener("touchend",s.stageUpNew))},this.mouseUpp=function(t){s.parent.intRend=1};var a,o=!1;if(this.distTach=0,this.mouseDown=function(t){var i;1!=s.pause&&(0!=s.drag&&(t&&t.buttons&&2==t.buttons&&0==s.boolMouseRight||(o=!1,s.boolDrag=!0,s.distTach=0,s.point.y=s.parent.rotationX,s.point.x=s.parent.rotationZ,s.isRotateScene&&(n=s.parent.scene.rotation.y),s.isDragPan&&t&&(1===t.button||2===t.button)&&(o=!0,i=t,u.set(i.clientX,i.clientY)),0==s.devas?(s.point1.x=t.clientX,s.point1.y=t.clientY,window.addEventListener("mouseup",s.stageUpNew)):(s.point1.x=t.touches[0].clientX,s.point1.y=t.touches[0].clientY,window.addEventListener("touchend",s.stageUpNew)))))},this.dragscrol=void 0,this.mousewheel=function(t){if(0!=s.drag){var i=-1;t.delta;null==t.wheelDelta&&t.wheelDelta,t.delta&&t.delta<0&&(i=1),t.deltaY&&t.deltaY<0&&(i=1),t.detail&&t.detail<0&&(i=1),null!=t.wheelDelta&&(i=t.wheelDelta>0?-1:1),a=s.parent._zume+i*(s.powerZum/100)*s.parent._zume,s.zumNEW(a),s.dragscrol&&s.dragscrol(t)}},this.zumNEW=function(t){t<s.minZum&&(t=s.minZum),t>s.maxZum&&(t=s.maxZum);var i=t;s.parent.zume=s.parent.zume+(i-s.parent.zume)*s.pppW,s.tween2.stop(),s.tween2.to({zume:i},s.pTime).start(),s.parent.intRend=1},0==s.devas){e.addEventListener("mousedown",this.mouseDown);e.addEventListener("mousewheel",this.mousewheel),e.addEventListener("DOMMouseScroll",this.mousewheel)}else e.addEventListener("touchstart",this.mouseDown,{passive:!1,capture:!0});var l=new THREE.Vector3,u=new THREE.Vector2,c=new THREE.Vector2,d=new THREE.Vector2;function p(t,i,e){null!=t?c.set(t.clientX,t.clientY):c.set(i,e),d.subVectors(c,u),s.moveCamXY(d),u.copy(c)}var f=function(){var t=new THREE.Vector3;return function(i,e){t.setFromMatrixColumn(e,0),t.multiplyScalar(-i),l.add(t)}}(),g=function(){var t=new THREE.Vector3;return function(i,e){t.setFromMatrixColumn(e,1),t.multiplyScalar(i),l.add(t)}}(),x=function(t,i){var e=s.parent.renderer.domElement;if(s.parent.camera.isPerspectiveCamera){var n=Math.max(s.parent.zume,10);n*=Math.tan(s.parent.camera.fov/2*Math.PI/180),f(2*t*n/e.clientHeight,s.parent.camera.matrixWorld),g(2*i*n/e.clientHeight,s.parent.camera.matrixWorld)}else console.warn("WARNING: camera neither perspective.")};this.moveCamXY=function(t){l.set(0,0,0),s.parent.camera.updateMatrixWorld(),s.parent.scene.updateMatrixWorld(),arguments.length>1&&(t={x:arguments[0],y:arguments[1]}),x(t.x||0,t.y||0),s.parent.xVerh+=l.x,s.parent.yVerh+=-l.y,s.parent.zVerh+=l.z,s.parent.xVerh=Math.max(Math.min(s.parent.xVerh,s.distMinMaxBox),-s.distMinMaxBox),s.parent.zVerh=Math.max(Math.min(s.parent.zVerh,s.distMinMaxBox),-s.distMinMaxBox),s.parent.yVerh=Math.max(Math.min(s.parent.yVerh,s.distMinMaxBox),-s.distMinMaxBox),l.set(0,0,0)}}},function(module,__webpack_exports__,__webpack_require__){"use strict";function PMMat(par,visi3D,objbase){this.type="PMMat";var self=this;this.par=par,this.visi3D=visi3D,this.objbase=objbase,this.pmTexture=this.par.tex,this.ser=window.location.href;var arrParams=window.location.href.split("?"),arrParams2=arrParams[0].split("/");this.param=this.par.param,this.nameType="materials",this.maxzls=this.param.materials,this.matError=new THREE.MeshBasicMaterial({color:16711680}),this.server="";for(var i=0;i<arrParams2.length-1;i++)this.server+=arrParams2[i]+"/";this.setObjS=function(t,i,e){this.getTestTitleObj(t),e()},this.testObjMatLoad=function(t){if(t.children)for(var i=0;i<t.children.length;i++)if(0==this.testObjMatLoad(t.children[i]))return!1;return!t.material||null==t.material.bLoad||0!=t.material.bLoad},this.matarialArray=this.param[this.nameType];var matarialArray=this.matarialArray;this.idColor=null;var loader=new THREE.TextureLoader,rt,textur;this.obj={},this.arrayTitleId=null,this.getTestTitle=function(t){if(null==this.arrayTitleId)return null;for(var i=0;i<this.arrayTitleId.length;i++)if(-1!=t.indexOf(this.arrayTitleId[i].title))return this.getIDReturn(this.arrayTitleId[i].id);return null},this.getTestTitleObj=function(t){t.material&&null!=(rt=this.getTestTitle(t.material.name))&&(t.material=rt);for(var i=0;i<t.children.length;i++)this.getTestTitleObj(t.children[i])},this.getIDReturn=function(t,i){return this.getIdmhbd(t,i)},this.get=function(t,i,e){var s,n,r=-1;if(null!=e){s=t+"",t="2456567567867896789";for(var h=0;h<this.matarialArray.length;h++)if(n=this.matarialArray[h].title+"",-1!=s.indexOf(n)){t=this.matarialArray[h].title;break}}for(h=0;h<this.matarialArray.length;h++)this.matarialArray[h].title==t&&(r=h);-1!=r?this.getId(this.matarialArray[r].id,i):i(null)},this.getId=function(id,_fun){for(var p=-1,i=0;i<this.matarialArray.length;i++)if(this.matarialArray[i].id==id){p=i;break}if(-1!=p){if(null!=this.obj[id])return 1==this.obj[id].bLoad?_fun(this.obj[id]):this.obj[id].arrFun.push(_fun),this.obj[id];var comand="new THREE."+this.matarialArray[p].key+"()",m=eval(comand);return m.idObj=matarialArray[p],m.bLoad=!1,m.loadTexure=999,m.arrFun=[_fun],this.startMat(m,id),this.obj[id]=m,m}_fun(null)},this.getIdmhbd=function(t,i){if(null==i&&null!=this.obj[t])return this.obj[t];"m"==(t+"")[0]&&(t=1*(t+"").split("_")[1]);var e=new THREE.MeshPhongMaterial;return e.idUz=t,mhbd.getKeyId("materials",t,function(t){e.userData=t,self.startMat2(t.json,e)}),this.obj[t]=e,e},this.objToMater=function(t,i){for(var e in t)null!=i[e]&&(i[e]instanceof THREE.Color?i[e]=new THREE.Color(t[e]):"type"!=e&&(i[e]=t[e]));if(i.loadTexure=0,t.textur&&"object"==typeof t.textur){i.loadTexure=t.textur.length;for(var s=0;s<t.textur.length;s++)if(t.textur[s].id){let e=s;textur=this.pmTexture.getById(t.textur[s].id,s=>{i[t.textur[e].name]=s,--i.loadTexure}),i[t.textur[s].name]=textur}else{var n=mhbd.getLink(t.textur[s].res.src);(textur=loader.load(n,function(t){self.visi3D&&(self.visi3D.intRend=1),i.loadTexure--})).wrapS=textur.wrapT=THREE.RepeatWrapping,textur.repeat.x=t.textur[s].rx,textur.repeat.y=t.textur[s].ry,i[t.textur[s].name]=textur}}if(i.needsUpdate=!0,i.bLoad=!0,i.arrFun)for(s=0;s<i.arrFun.length;s++)i.arrFun[s](i)},this.startMat=function(t,i){for(var e=null,s=0;s<this.matarialArray.length;s++)if(this.matarialArray[s].id==i){this.matarialArray[s].json&&(e="string"==typeof this.matarialArray[s].json?JSON.parse(this.matarialArray[s].json):this.matarialArray[s].json);break}if(null==e){this.server,self.par.plus;var n,r={type:"GET"};r.url=this.param.server+this.nameType+"/"+i+"/",r.success=function(i){n="string"==typeof i.json?JSON.parse(i.json):i.json,self.startMat2(n,t)},$.ajax(r)}else self.startMat2(e,t)},this.startMat2=function(t,i){t||((t={}).mirro=0,t.obj={}),!0===t.mirro?self.visi3D&&(i.envMap=self.visi3D.getEnvMap()):(t.mirro,1==t.mirro&&self.visi3D&&(i.envMap=self.visi3D.getEnvMap()),2==t.mirro&&self.visi3D&&(i.envMap=self.visi3D.getEnvMap1())),self.objToMater(t.obj,i)}}__webpack_require__.d(__webpack_exports__,"a",function(){return PMMat})},function(t,i,e){"use strict";function s(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}var n,r,h;Object.assign(s.prototype,{setSize:function(){},render:function(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}),s.FullScreenQuad=(n=new THREE.OrthographicCamera(-1,1,1,-1,0,1),r=new THREE.PlaneBufferGeometry(2,2),h=function(t){this._mesh=new THREE.Mesh(r,t)},Object.defineProperty(h.prototype,"material",{get:function(){return this._mesh.material},set:function(t){this._mesh.material=t}}),Object.assign(h.prototype,{render:function(t){t.render(this._mesh,n)}}),h);var a=function(t,i){s.call(this),this.textureID=void 0!==i?i:"tDiffuse",t instanceof THREE.ShaderMaterial?(this.uniforms=t.uniforms,this.material=t):t&&(this.uniforms=THREE.UniformsUtils.clone(t.uniforms),this.material=new THREE.ShaderMaterial({defines:Object.assign({},t.defines),uniforms:this.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader})),this.fsQuad=new s.FullScreenQuad(this.material)};a.prototype=Object.assign(Object.create(s.prototype),{constructor:a,render:function(t,i,e){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=e.texture),this.fsQuad.material=this.material,this.renderToScreen?(t.setRenderTarget(null),this.fsQuad.render(t)):(t.setRenderTarget(i),this.clear&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),this.fsQuad.render(t))}});var o=function(t,i){if(this.renderer=t,void 0===i){var e={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,stencilBuffer:!1},s=t.getSize(new THREE.Vector2);this._pixelRatio=t.getPixelRatio(),this._width=s.width,this._height=s.height,(i=new THREE.WebGLRenderTarget(this._width*this._pixelRatio,this._height*this._pixelRatio,e)).texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=i.width,this._height=i.height;this.renderTarget1=i,this.renderTarget2=i.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new a(THREE.CopyShader),this.clock=new THREE.Clock};Object.assign(o.prototype,{swapBuffers:function(){var t=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=t},addPass:function(t){this.passes.push(t),t.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)},insertPass:function(t,i){this.passes.splice(i,0,t)},isLastEnabledPass:function(t){for(var i=t+1;i<this.passes.length;i++)if(this.passes[i].enabled)return!1;return!0},render:function(t){void 0===t&&(t=this.clock.getDelta());var i,e,s=this.renderer.getRenderTarget(),n=!1,r=this.passes.length;for(e=0;e<r;e++)if(!1!==(i=this.passes[e]).enabled){if(i.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(e),i.render(this.renderer,this.writeBuffer,this.readBuffer,t,n),i.needsSwap){if(n){var h=this.renderer.getContext(),a=this.renderer.state.buffers.stencil;a.setFunc(h.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,t),a.setFunc(h.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==THREE.MaskPass&&(i instanceof THREE.MaskPass?n=!0:i instanceof THREE.ClearMaskPass&&(n=!1))}this.renderer.setRenderTarget(s)},reset:function(t){if(void 0===t){var i=this.renderer.getSize(new THREE.Vector2);this._pixelRatio=this.renderer.getPixelRatio(),this._width=i.width,this._height=i.height,(t=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=t,this.renderTarget2=t.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2},setSize:function(t,i){this._width=t,this._height=i;var e=this._width*this._pixelRatio,s=this._height*this._pixelRatio;this.renderTarget1.setSize(e,s),this.renderTarget2.setSize(e,s);for(var n=0;n<this.passes.length;n++)this.passes[n].setSize(e,s)},setPixelRatio:function(t){this._pixelRatio=t,this.setSize(this._width,this._height)}});var l=function(t,i,e,n,r){s.call(this),this.scene=t,this.camera=i,this.overrideMaterial=e,this.clearColor=n,this.clearAlpha=void 0!==r?r:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1};l.prototype=Object.assign(Object.create(s.prototype),{constructor:l,render:function(t,i,e){var s,n,r=t.autoClear;t.autoClear=!1,this.scene.overrideMaterial=this.overrideMaterial,this.clearColor&&(s=t.getClearColor().getHex(),n=t.getClearAlpha(),t.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&t.clearDepth(),t.setRenderTarget(this.renderToScreen?null:e),this.clear&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),t.render(this.scene,this.camera),this.clearColor&&t.setClearColor(s,n),this.scene.overrideMaterial=null,t.autoClear=r}});var u={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","\tvec4 texel = texture2D( tDiffuse, vUv );","\tgl_FragColor = opacity * texel;","}"].join("\n")},c=function(t,i,e,n){this.renderScene=i,this.renderCamera=e,this.selectedObjects=void 0!==n?n:[],this.visibleEdgeColor=new THREE.Color(1,1,1),this.hiddenEdgeColor=new THREE.Color(.1,.04,.02),this.edgeGlow=0,this.usePatternTexture=!1,this.edgeThickness=1,this.edgeStrength=3,this.downSampleRatio=2,this.pulsePeriod=0,s.call(this),this.resolution=void 0!==t?new THREE.Vector2(t.x,t.y):new THREE.Vector2(256,256);var r={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat},h=Math.round(this.resolution.x/this.downSampleRatio),a=Math.round(this.resolution.y/this.downSampleRatio);this.maskBufferMaterial=new THREE.MeshBasicMaterial({color:16777215}),this.maskBufferMaterial.side=THREE.DoubleSide,this.renderTargetMaskBuffer=new THREE.WebGLRenderTarget(this.resolution.x,this.resolution.y,r),this.renderTargetMaskBuffer.texture.name="OutlinePass.mask",this.renderTargetMaskBuffer.texture.generateMipmaps=!1,this.depthMaterial=new THREE.MeshDepthMaterial,this.depthMaterial.side=THREE.DoubleSide,this.depthMaterial.depthPacking=THREE.RGBADepthPacking,this.depthMaterial.blending=THREE.NoBlending,this.prepareMaskMaterial=this.getPrepareMaskMaterial(),this.prepareMaskMaterial.side=THREE.DoubleSide,this.prepareMaskMaterial.fragmentShader=function(t,i){var e=i.isPerspectiveCamera?"perspective":"orthographic";return t.replace(/DEPTH_TO_VIEW_Z/g,e+"DepthToViewZ")}(this.prepareMaskMaterial.fragmentShader,this.renderCamera),this.renderTargetDepthBuffer=new THREE.WebGLRenderTarget(this.resolution.x,this.resolution.y,r),this.renderTargetDepthBuffer.texture.name="OutlinePass.depth",this.renderTargetDepthBuffer.texture.generateMipmaps=!1,this.renderTargetMaskDownSampleBuffer=new THREE.WebGLRenderTarget(h,a,r),this.renderTargetMaskDownSampleBuffer.texture.name="OutlinePass.depthDownSample",this.renderTargetMaskDownSampleBuffer.texture.generateMipmaps=!1,this.renderTargetBlurBuffer1=new THREE.WebGLRenderTarget(h,a,r),this.renderTargetBlurBuffer1.texture.name="OutlinePass.blur1",this.renderTargetBlurBuffer1.texture.generateMipmaps=!1,this.renderTargetBlurBuffer2=new THREE.WebGLRenderTarget(Math.round(h/2),Math.round(a/2),r),this.renderTargetBlurBuffer2.texture.name="OutlinePass.blur2",this.renderTargetBlurBuffer2.texture.generateMipmaps=!1,this.edgeDetectionMaterial=this.getEdgeDetectionMaterial(),this.renderTargetEdgeBuffer1=new THREE.WebGLRenderTarget(h,a,r),this.renderTargetEdgeBuffer1.texture.name="OutlinePass.edge1",this.renderTargetEdgeBuffer1.texture.generateMipmaps=!1,this.renderTargetEdgeBuffer2=new THREE.WebGLRenderTarget(Math.round(h/2),Math.round(a/2),r),this.renderTargetEdgeBuffer2.texture.name="OutlinePass.edge2",this.renderTargetEdgeBuffer2.texture.generateMipmaps=!1;this.separableBlurMaterial1=this.getSeperableBlurMaterial(4),this.separableBlurMaterial1.uniforms.texSize.value=new THREE.Vector2(h,a),this.separableBlurMaterial1.uniforms.kernelRadius.value=1,this.separableBlurMaterial2=this.getSeperableBlurMaterial(4),this.separableBlurMaterial2.uniforms.texSize.value=new THREE.Vector2(Math.round(h/2),Math.round(a/2)),this.separableBlurMaterial2.uniforms.kernelRadius.value=4,this.overlayMaterial=this.getOverlayMaterial(),void 0===u&&console.error("OutlinePass relies on CopyShader");var o=u;this.copyUniforms=THREE.UniformsUtils.clone(o.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new THREE.ShaderMaterial({uniforms:this.copyUniforms,vertexShader:o.vertexShader,fragmentShader:o.fragmentShader,blending:THREE.NoBlending,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this.oldClearColor=new THREE.Color,this.oldClearAlpha=1,this.fsQuad=new s.FullScreenQuad(null),this.tempPulseColor1=new THREE.Color,this.tempPulseColor2=new THREE.Color,this.textureMatrix=new THREE.Matrix4};c.prototype=Object.assign(Object.create(s.prototype),{constructor:c,dispose:function(){this.renderTargetMaskBuffer.dispose(),this.renderTargetDepthBuffer.dispose(),this.renderTargetMaskDownSampleBuffer.dispose(),this.renderTargetBlurBuffer1.dispose(),this.renderTargetBlurBuffer2.dispose(),this.renderTargetEdgeBuffer1.dispose(),this.renderTargetEdgeBuffer2.dispose()},setSize:function(t,i){this.renderTargetMaskBuffer.setSize(t,i);var e=Math.round(t/this.downSampleRatio),s=Math.round(i/this.downSampleRatio);this.renderTargetMaskDownSampleBuffer.setSize(e,s),this.renderTargetBlurBuffer1.setSize(e,s),this.renderTargetEdgeBuffer1.setSize(e,s),this.separableBlurMaterial1.uniforms.texSize.value=new THREE.Vector2(e,s),e=Math.round(e/2),s=Math.round(s/2),this.renderTargetBlurBuffer2.setSize(e,s),this.renderTargetEdgeBuffer2.setSize(e,s),this.separableBlurMaterial2.uniforms.texSize.value=new THREE.Vector2(e,s)},changeVisibilityOfSelectedObjects:function(t){function i(i){i.isMesh&&(t?(i.visible=i.userData.oldVisible,delete i.userData.oldVisible):(i.userData.oldVisible=i.visible,i.visible=t))}for(var e=0;e<this.selectedObjects.length;e++){this.selectedObjects[e].traverse(i)}},changeVisibilityOfNonSelectedObjects:function(t){var i=[];function e(t){t.isMesh&&i.push(t)}for(var s=0;s<this.selectedObjects.length;s++){this.selectedObjects[s].traverse(e)}this.renderScene.traverse(function(e){if(e.isMesh||e.isLine||e.isSprite){for(var s=!1,n=0;n<i.length;n++)if(i[n].id===e.id){s=!0;break}if(!s){var r=e.visible;t&&!e.bVisible||(e.visible=t),e.bVisible=r}}})},updateTextureMatrix:function(){this.textureMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),this.textureMatrix.multiply(this.renderCamera.projectionMatrix),this.textureMatrix.multiply(this.renderCamera.matrixWorldInverse)},render:function(t,i,e,s,n){if(this.selectedObjects.length>0){this.oldClearColor.copy(t.getClearColor()),this.oldClearAlpha=t.getClearAlpha();var r=t.autoClear;t.autoClear=!1,n&&t.state.buffers.stencil.setTest(!1),t.setClearColor(16777215,1),this.changeVisibilityOfSelectedObjects(!1);var h=this.renderScene.background;if(this.renderScene.background=null,this.renderScene.overrideMaterial=this.depthMaterial,t.setRenderTarget(this.renderTargetDepthBuffer),t.clear(),t.render(this.renderScene,this.renderCamera),this.changeVisibilityOfSelectedObjects(!0),this.updateTextureMatrix(),this.changeVisibilityOfNonSelectedObjects(!1),this.renderScene.overrideMaterial=this.prepareMaskMaterial,this.prepareMaskMaterial.uniforms.cameraNearFar.value=new THREE.Vector2(this.renderCamera.near,this.renderCamera.far),this.prepareMaskMaterial.uniforms.depthTexture.value=this.renderTargetDepthBuffer.texture,this.prepareMaskMaterial.uniforms.textureMatrix.value=this.textureMatrix,t.setRenderTarget(this.renderTargetMaskBuffer),t.clear(),t.render(this.renderScene,this.renderCamera),this.renderScene.overrideMaterial=null,this.changeVisibilityOfNonSelectedObjects(!0),this.renderScene.background=h,this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetMaskBuffer.texture,t.setRenderTarget(this.renderTargetMaskDownSampleBuffer),t.clear(),this.fsQuad.render(t),this.tempPulseColor1.copy(this.visibleEdgeColor),this.tempPulseColor2.copy(this.hiddenEdgeColor),this.pulsePeriod>0){var a=.625+.75*Math.cos(.01*performance.now()/this.pulsePeriod)/2;this.tempPulseColor1.multiplyScalar(a),this.tempPulseColor2.multiplyScalar(a)}this.fsQuad.material=this.edgeDetectionMaterial,this.edgeDetectionMaterial.uniforms.maskTexture.value=this.renderTargetMaskDownSampleBuffer.texture,this.edgeDetectionMaterial.uniforms.texSize.value=new THREE.Vector2(this.renderTargetMaskDownSampleBuffer.width,this.renderTargetMaskDownSampleBuffer.height),this.edgeDetectionMaterial.uniforms.visibleEdgeColor.value=this.tempPulseColor1,this.edgeDetectionMaterial.uniforms.hiddenEdgeColor.value=this.tempPulseColor2,t.setRenderTarget(this.renderTargetEdgeBuffer1),t.clear(),this.fsQuad.render(t),this.fsQuad.material=this.separableBlurMaterial1,this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=c.BlurDirectionX,this.separableBlurMaterial1.uniforms.kernelRadius.value=this.edgeThickness,t.setRenderTarget(this.renderTargetBlurBuffer1),t.clear(),this.fsQuad.render(t),this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetBlurBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=c.BlurDirectionY,t.setRenderTarget(this.renderTargetEdgeBuffer1),t.clear(),this.fsQuad.render(t),this.fsQuad.material=this.separableBlurMaterial2,this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial2.uniforms.direction.value=c.BlurDirectionX,t.setRenderTarget(this.renderTargetBlurBuffer2),t.clear(),this.fsQuad.render(t),this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetBlurBuffer2.texture,this.separableBlurMaterial2.uniforms.direction.value=c.BlurDirectionY,t.setRenderTarget(this.renderTargetEdgeBuffer2),t.clear(),this.fsQuad.render(t),this.fsQuad.material=this.overlayMaterial,this.overlayMaterial.uniforms.maskTexture.value=this.renderTargetMaskBuffer.texture,this.overlayMaterial.uniforms.edgeTexture1.value=this.renderTargetEdgeBuffer1.texture,this.overlayMaterial.uniforms.edgeTexture2.value=this.renderTargetEdgeBuffer2.texture,this.overlayMaterial.uniforms.patternTexture.value=this.patternTexture,this.overlayMaterial.uniforms.edgeStrength.value=this.edgeStrength,this.overlayMaterial.uniforms.edgeGlow.value=this.edgeGlow,this.overlayMaterial.uniforms.usePatternTexture.value=this.usePatternTexture,n&&t.state.buffers.stencil.setTest(!0),t.setRenderTarget(e),this.fsQuad.render(t),t.setClearColor(this.oldClearColor,this.oldClearAlpha),t.autoClear=r}this.renderToScreen&&(this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=e.texture,t.setRenderTarget(null),this.fsQuad.render(t))},getPrepareMaskMaterial:function(){return new THREE.ShaderMaterial({uniforms:{depthTexture:{value:null},cameraNearFar:{value:new THREE.Vector2(.5,.5)},textureMatrix:{value:new THREE.Matrix4}},vertexShader:["varying vec4 projTexCoord;","varying vec4 vPosition;","uniform mat4 textureMatrix;","void main() {","\tvPosition = modelViewMatrix * vec4( position, 1.0 );","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tprojTexCoord = textureMatrix * worldPosition;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <packing>","varying vec4 vPosition;","varying vec4 projTexCoord;","uniform sampler2D depthTexture;","uniform vec2 cameraNearFar;","void main() {","\tfloat depth = unpackRGBAToDepth(texture2DProj( depthTexture, projTexCoord ));","\tfloat viewZ = - DEPTH_TO_VIEW_Z( depth, cameraNearFar.x, cameraNearFar.y );","\tfloat depthTest = (-vPosition.z > viewZ) ? 1.0 : 0.0;","\tgl_FragColor = vec4(0.0, depthTest, 1.0, 1.0);","}"].join("\n")})},getEdgeDetectionMaterial:function(){return new THREE.ShaderMaterial({uniforms:{maskTexture:{value:null},texSize:{value:new THREE.Vector2(.5,.5)},visibleEdgeColor:{value:new THREE.Vector3(1,1,1)},hiddenEdgeColor:{value:new THREE.Vector3(1,1,1)}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\t\t\t\tuniform sampler2D maskTexture;\t\t\t\tuniform vec2 texSize;\t\t\t\tuniform vec3 visibleEdgeColor;\t\t\t\tuniform vec3 hiddenEdgeColor;\t\t\t\t\t\t\t\tvoid main() {\n\t\t\t\t\tvec2 invSize = 1.0 / texSize;\t\t\t\t\tvec4 uvOffset = vec4(1.0, 0.0, 0.0, 1.0) * vec4(invSize, invSize);\t\t\t\t\tvec4 c1 = texture2D( maskTexture, vUv + uvOffset.xy);\t\t\t\t\tvec4 c2 = texture2D( maskTexture, vUv - uvOffset.xy);\t\t\t\t\tvec4 c3 = texture2D( maskTexture, vUv + uvOffset.yw);\t\t\t\t\tvec4 c4 = texture2D( maskTexture, vUv - uvOffset.yw);\t\t\t\t\tfloat diff1 = (c1.r - c2.r)*0.5;\t\t\t\t\tfloat diff2 = (c3.r - c4.r)*0.5;\t\t\t\t\tfloat d = length( vec2(diff1, diff2) );\t\t\t\t\tfloat a1 = min(c1.g, c2.g);\t\t\t\t\tfloat a2 = min(c3.g, c4.g);\t\t\t\t\tfloat visibilityFactor = min(a1, a2);\t\t\t\t\tvec3 edgeColor = 1.0 - visibilityFactor > 0.001 ? visibleEdgeColor : hiddenEdgeColor;\t\t\t\t\tgl_FragColor = vec4(edgeColor, 1.0) * vec4(d);\t\t\t\t}"})},getSeperableBlurMaterial:function(t){return new THREE.ShaderMaterial({defines:{MAX_RADIUS:t},uniforms:{colorTexture:{value:null},texSize:{value:new THREE.Vector2(.5,.5)},direction:{value:new THREE.Vector2(.5,.5)},kernelRadius:{value:1}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\t\t\t\tvarying vec2 vUv;\t\t\t\tuniform sampler2D colorTexture;\t\t\t\tuniform vec2 texSize;\t\t\t\tuniform vec2 direction;\t\t\t\tuniform float kernelRadius;\t\t\t\t\t\t\t\tfloat gaussianPdf(in float x, in float sigma) {\t\t\t\t\treturn 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\t\t\t\t}\t\t\t\tvoid main() {\t\t\t\t\tvec2 invSize = 1.0 / texSize;\t\t\t\t\tfloat weightSum = gaussianPdf(0.0, kernelRadius);\t\t\t\t\tvec4 diffuseSum = texture2D( colorTexture, vUv) * weightSum;\t\t\t\t\tvec2 delta = direction * invSize * kernelRadius/float(MAX_RADIUS);\t\t\t\t\tvec2 uvOffset = delta;\t\t\t\t\tfor( int i = 1; i <= MAX_RADIUS; i ++ ) {\t\t\t\t\t\tfloat w = gaussianPdf(uvOffset.x, kernelRadius);\t\t\t\t\t\tvec4 sample1 = texture2D( colorTexture, vUv + uvOffset);\t\t\t\t\t\tvec4 sample2 = texture2D( colorTexture, vUv - uvOffset);\t\t\t\t\t\tdiffuseSum += ((sample1 + sample2) * w);\t\t\t\t\t\tweightSum += (2.0 * w);\t\t\t\t\t\tuvOffset += delta;\t\t\t\t\t}\t\t\t\t\tgl_FragColor = diffuseSum/weightSum;\t\t\t\t}"})},getOverlayMaterial:function(){return new THREE.ShaderMaterial({uniforms:{maskTexture:{value:null},edgeTexture1:{value:null},edgeTexture2:{value:null},patternTexture:{value:null},edgeStrength:{value:1},edgeGlow:{value:1},usePatternTexture:{value:0}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\t\t\t\tuniform sampler2D maskTexture;\t\t\t\tuniform sampler2D edgeTexture1;\t\t\t\tuniform sampler2D edgeTexture2;\t\t\t\tuniform sampler2D patternTexture;\t\t\t\tuniform float edgeStrength;\t\t\t\tuniform float edgeGlow;\t\t\t\tuniform bool usePatternTexture;\t\t\t\t\t\t\t\tvoid main() {\t\t\t\t\tvec4 edgeValue1 = texture2D(edgeTexture1, vUv);\t\t\t\t\tvec4 edgeValue2 = texture2D(edgeTexture2, vUv);\t\t\t\t\tvec4 maskColor = texture2D(maskTexture, vUv);\t\t\t\t\tvec4 patternColor = texture2D(patternTexture, 6.0 * vUv);\t\t\t\t\tfloat visibilityFactor = 1.0 - maskColor.g > 0.0 ? 1.0 : 0.5;\t\t\t\t\tvec4 edgeValue = edgeValue1 + edgeValue2 * edgeGlow;\t\t\t\t\tvec4 finalColor = edgeStrength * maskColor.r * edgeValue;\t\t\t\t\tif(usePatternTexture)\t\t\t\t\t\tfinalColor += + visibilityFactor * (1.0 - maskColor.r) * (1.0 - patternColor.r);\t\t\t\t\tgl_FragColor = finalColor;\t\t\t\t}",blending:THREE.AdditiveBlending,depthTest:!1,depthWrite:!1,transparent:!0})}}),c.BlurDirectionX=new THREE.Vector2(1,0),c.BlurDirectionY=new THREE.Vector2(0,1);var d={uniforms:{tDiffuse:{value:null},resolution:{value:new THREE.Vector2(1/1024,1/512)}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["precision highp float;","","uniform sampler2D tDiffuse;","","uniform vec2 resolution;","","varying vec2 vUv;","","// FXAA 3.11 implementation by NVIDIA, ported to WebGL by Agost Biro (biro@archilogic.com)","","//----------------------------------------------------------------------------------","// File:        es3-keplerFXAAassetsshaders/FXAA_DefaultES.frag","// SDK Version: v3.00","// Email:       gameworks@nvidia.com","// Site:        http://developer.nvidia.com/","//","// Copyright (c) 2014-2015, NVIDIA CORPORATION. All rights reserved.","//","// Redistribution and use in source and binary forms, with or without","// modification, are permitted provided that the following conditions","// are met:","//  * Redistributions of source code must retain the above copyright","//    notice, this list of conditions and the following disclaimer.","//  * Redistributions in binary form must reproduce the above copyright","//    notice, this list of conditions and the following disclaimer in the","//    documentation and/or other materials provided with the distribution.","//  * Neither the name of NVIDIA CORPORATION nor the names of its","//    contributors may be used to endorse or promote products derived","//    from this software without specific prior written permission.","//","// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS ``AS IS'' AND ANY","// EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE","// IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR","// PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR","// CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,","// EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,","// PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR","// PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY","// OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT","// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE","// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.","//","//----------------------------------------------------------------------------------","","#define FXAA_PC 1","#define FXAA_GLSL_100 1","#define FXAA_QUALITY_PRESET 12","","#define FXAA_GREEN_AS_LUMA 1","","/*--------------------------------------------------------------------------*/","#ifndef FXAA_PC_CONSOLE","    //","    // The console algorithm for PC is included","    // for developers targeting really low spec machines.","    // Likely better to just run FXAA_PC, and use a really low preset.","    //","    #define FXAA_PC_CONSOLE 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GLSL_120","    #define FXAA_GLSL_120 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GLSL_130","    #define FXAA_GLSL_130 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_3","    #define FXAA_HLSL_3 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_4","    #define FXAA_HLSL_4 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_5","    #define FXAA_HLSL_5 0","#endif","/*==========================================================================*/","#ifndef FXAA_GREEN_AS_LUMA","    //","    // For those using non-linear color,","    // and either not able to get luma in alpha, or not wanting to,","    // this enables FXAA to run using green as a proxy for luma.","    // So with this enabled, no need to pack luma in alpha.","    //","    // This will turn off AA on anything which lacks some amount of green.","    // Pure red and blue or combination of only R and B, will get no AA.","    //","    // Might want to lower the settings for both,","    //    fxaaConsoleEdgeThresholdMin","    //    fxaaQualityEdgeThresholdMin","    // In order to insure AA does not get turned off on colors","    // which contain a minor amount of green.","    //","    // 1 = On.","    // 0 = Off.","    //","    #define FXAA_GREEN_AS_LUMA 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_EARLY_EXIT","    //","    // Controls algorithm's early exit path.","    // On PS3 turning this ON adds 2 cycles to the shader.","    // On 360 turning this OFF adds 10ths of a millisecond to the shader.","    // Turning this off on console will result in a more blurry image.","    // So this defaults to on.","    //","    // 1 = On.","    // 0 = Off.","    //","    #define FXAA_EARLY_EXIT 1","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_DISCARD","    //","    // Only valid for PC OpenGL currently.","    // Probably will not work when FXAA_GREEN_AS_LUMA = 1.","    //","    // 1 = Use discard on pixels which don't need AA.","    //     For APIs which enable concurrent TEX+ROP from same surface.","    // 0 = Return unchanged color on pixels which don't need AA.","    //","    #define FXAA_DISCARD 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_FAST_PIXEL_OFFSET","    //","    // Used for GLSL 120 only.","    //","    // 1 = GL API supports fast pixel offsets","    // 0 = do not use fast pixel offsets","    //","    #ifdef GL_EXT_gpu_shader4","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifdef GL_NV_gpu_shader5","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifdef GL_ARB_gpu_shader5","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifndef FXAA_FAST_PIXEL_OFFSET","        #define FXAA_FAST_PIXEL_OFFSET 0","    #endif","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GATHER4_ALPHA","    //","    // 1 = API supports gather4 on alpha channel.","    // 0 = API does not support gather4 on alpha channel.","    //","    #if (FXAA_HLSL_5 == 1)","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifdef GL_ARB_gpu_shader5","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifdef GL_NV_gpu_shader5","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifndef FXAA_GATHER4_ALPHA","        #define FXAA_GATHER4_ALPHA 0","    #endif","#endif","","","/*============================================================================","                        FXAA QUALITY - TUNING KNOBS","------------------------------------------------------------------------------","NOTE the other tuning knobs are now in the shader function inputs!","============================================================================*/","#ifndef FXAA_QUALITY_PRESET","    //","    // Choose the quality preset.","    // This needs to be compiled into the shader as it effects code.","    // Best option to include multiple presets is to","    // in each shader define the preset, then include this file.","    //","    // OPTIONS","    // -----------------------------------------------------------------------","    // 10 to 15 - default medium dither (10=fastest, 15=highest quality)","    // 20 to 29 - less dither, more expensive (20=fastest, 29=highest quality)","    // 39       - no dither, very expensive","    //","    // NOTES","    // -----------------------------------------------------------------------","    // 12 = slightly faster then FXAA 3.9 and higher edge quality (default)","    // 13 = about same speed as FXAA 3.9 and better than 12","    // 23 = closest to FXAA 3.9 visually and performance wise","    //  _ = the lowest digit is directly related to performance","    // _  = the highest digit is directly related to style","    //","    #define FXAA_QUALITY_PRESET 12","#endif","","","/*============================================================================","","                           FXAA QUALITY - PRESETS","","============================================================================*/","","/*============================================================================","                     FXAA QUALITY - MEDIUM DITHER PRESETS","============================================================================*/","#if (FXAA_QUALITY_PRESET == 10)","    #define FXAA_QUALITY_PS 3","    #define FXAA_QUALITY_P0 1.5","    #define FXAA_QUALITY_P1 3.0","    #define FXAA_QUALITY_P2 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 11)","    #define FXAA_QUALITY_PS 4","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 3.0","    #define FXAA_QUALITY_P3 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 12)","    #define FXAA_QUALITY_PS 5","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 4.0","    #define FXAA_QUALITY_P4 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 13)","    #define FXAA_QUALITY_PS 6","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 4.0","    #define FXAA_QUALITY_P5 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 14)","    #define FXAA_QUALITY_PS 7","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 4.0","    #define FXAA_QUALITY_P6 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 15)","    #define FXAA_QUALITY_PS 8","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 4.0","    #define FXAA_QUALITY_P7 12.0","#endif","","/*============================================================================","                     FXAA QUALITY - LOW DITHER PRESETS","============================================================================*/","#if (FXAA_QUALITY_PRESET == 20)","    #define FXAA_QUALITY_PS 3","    #define FXAA_QUALITY_P0 1.5","    #define FXAA_QUALITY_P1 2.0","    #define FXAA_QUALITY_P2 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 21)","    #define FXAA_QUALITY_PS 4","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 22)","    #define FXAA_QUALITY_PS 5","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 23)","    #define FXAA_QUALITY_PS 6","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 24)","    #define FXAA_QUALITY_PS 7","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 3.0","    #define FXAA_QUALITY_P6 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 25)","    #define FXAA_QUALITY_PS 8","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 4.0","    #define FXAA_QUALITY_P7 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 26)","    #define FXAA_QUALITY_PS 9","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 4.0","    #define FXAA_QUALITY_P8 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 27)","    #define FXAA_QUALITY_PS 10","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 4.0","    #define FXAA_QUALITY_P9 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 28)","    #define FXAA_QUALITY_PS 11","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 4.0","    #define FXAA_QUALITY_P10 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 29)","    #define FXAA_QUALITY_PS 12","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 2.0","    #define FXAA_QUALITY_P10 4.0","    #define FXAA_QUALITY_P11 8.0","#endif","","/*============================================================================","                     FXAA QUALITY - EXTREME QUALITY","============================================================================*/","#if (FXAA_QUALITY_PRESET == 39)","    #define FXAA_QUALITY_PS 12","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.0","    #define FXAA_QUALITY_P2 1.0","    #define FXAA_QUALITY_P3 1.0","    #define FXAA_QUALITY_P4 1.0","    #define FXAA_QUALITY_P5 1.5","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 2.0","    #define FXAA_QUALITY_P10 4.0","    #define FXAA_QUALITY_P11 8.0","#endif","","","","/*============================================================================","","                                API PORTING","","============================================================================*/","#if (FXAA_GLSL_100 == 1) || (FXAA_GLSL_120 == 1) || (FXAA_GLSL_130 == 1)","    #define FxaaBool bool","    #define FxaaDiscard discard","    #define FxaaFloat float","    #define FxaaFloat2 vec2","    #define FxaaFloat3 vec3","    #define FxaaFloat4 vec4","    #define FxaaHalf float","    #define FxaaHalf2 vec2","    #define FxaaHalf3 vec3","    #define FxaaHalf4 vec4","    #define FxaaInt2 ivec2","    #define FxaaSat(x) clamp(x, 0.0, 1.0)","    #define FxaaTex sampler2D","#else","    #define FxaaBool bool","    #define FxaaDiscard clip(-1)","    #define FxaaFloat float","    #define FxaaFloat2 float2","    #define FxaaFloat3 float3","    #define FxaaFloat4 float4","    #define FxaaHalf half","    #define FxaaHalf2 half2","    #define FxaaHalf3 half3","    #define FxaaHalf4 half4","    #define FxaaSat(x) saturate(x)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_100 == 1)","  #define FxaaTexTop(t, p) texture2D(t, p, 0.0)","  #define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r), 0.0)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_120 == 1)","    // Requires,","    //  #version 120","    // And at least,","    //  #extension GL_EXT_gpu_shader4 : enable","    //  (or set FXAA_FAST_PIXEL_OFFSET 1 to work like DX9)","    #define FxaaTexTop(t, p) texture2DLod(t, p, 0.0)","    #if (FXAA_FAST_PIXEL_OFFSET == 1)","        #define FxaaTexOff(t, p, o, r) texture2DLodOffset(t, p, 0.0, o)","    #else","        #define FxaaTexOff(t, p, o, r) texture2DLod(t, p + (o * r), 0.0)","    #endif","    #if (FXAA_GATHER4_ALPHA == 1)","        // use #extension GL_ARB_gpu_shader5 : enable","        #define FxaaTexAlpha4(t, p) textureGather(t, p, 3)","        #define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)","        #define FxaaTexGreen4(t, p) textureGather(t, p, 1)","        #define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)","    #endif","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_130 == 1)",'    // Requires "#version 130" or better',"    #define FxaaTexTop(t, p) textureLod(t, p, 0.0)","    #define FxaaTexOff(t, p, o, r) textureLodOffset(t, p, 0.0, o)","    #if (FXAA_GATHER4_ALPHA == 1)","        // use #extension GL_ARB_gpu_shader5 : enable","        #define FxaaTexAlpha4(t, p) textureGather(t, p, 3)","        #define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)","        #define FxaaTexGreen4(t, p) textureGather(t, p, 1)","        #define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)","    #endif","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_3 == 1)","    #define FxaaInt2 float2","    #define FxaaTex sampler2D","    #define FxaaTexTop(t, p) tex2Dlod(t, float4(p, 0.0, 0.0))","    #define FxaaTexOff(t, p, o, r) tex2Dlod(t, float4(p + (o * r), 0, 0))","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_4 == 1)","    #define FxaaInt2 int2","    struct FxaaTex { SamplerState smpl; Texture2D tex; };","    #define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)","    #define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_5 == 1)","    #define FxaaInt2 int2","    struct FxaaTex { SamplerState smpl; Texture2D tex; };","    #define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)","    #define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)","    #define FxaaTexAlpha4(t, p) t.tex.GatherAlpha(t.smpl, p)","    #define FxaaTexOffAlpha4(t, p, o) t.tex.GatherAlpha(t.smpl, p, o)","    #define FxaaTexGreen4(t, p) t.tex.GatherGreen(t.smpl, p)","    #define FxaaTexOffGreen4(t, p, o) t.tex.GatherGreen(t.smpl, p, o)","#endif","","","/*============================================================================","                   GREEN AS LUMA OPTION SUPPORT FUNCTION","============================================================================*/","#if (FXAA_GREEN_AS_LUMA == 0)","    FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.w; }","#else","    FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.y; }","#endif","","","","","/*============================================================================","","                             FXAA3 QUALITY - PC","","============================================================================*/","#if (FXAA_PC == 1)","/*--------------------------------------------------------------------------*/","FxaaFloat4 FxaaPixelShader(","    //","    // Use noperspective interpolation here (turn off perspective interpolation).","    // {xy} = center of pixel","    FxaaFloat2 pos,","    //","    // Used only for FXAA Console, and not used on the 360 version.","    // Use noperspective interpolation here (turn off perspective interpolation).","    // {xy_} = upper left of pixel","    // {_zw} = lower right of pixel","    FxaaFloat4 fxaaConsolePosPos,","    //","    // Input color texture.","    // {rgb_} = color in linear or perceptual color space","    // if (FXAA_GREEN_AS_LUMA == 0)","    //     {__a} = luma in perceptual color space (not linear)","    FxaaTex tex,","    //","    // Only used on the optimized 360 version of FXAA Console.",'    // For everything but 360, just use the same input here as for "tex".',"    // For 360, same texture, just alias with a 2nd sampler.","    // This sampler needs to have an exponent bias of -1.","    FxaaTex fxaaConsole360TexExpBiasNegOne,","    //","    // Only used on the optimized 360 version of FXAA Console.",'    // For everything but 360, just use the same input here as for "tex".',"    // For 360, same texture, just alias with a 3nd sampler.","    // This sampler needs to have an exponent bias of -2.","    FxaaTex fxaaConsole360TexExpBiasNegTwo,","    //","    // Only used on FXAA Quality.","    // This must be from a constant/uniform.","    // {x_} = 1.0/screenWidthInPixels","    // {_y} = 1.0/screenHeightInPixels","    FxaaFloat2 fxaaQualityRcpFrame,","    //","    // Only used on FXAA Console.","    // This must be from a constant/uniform.","    // This effects sub-pixel AA quality and inversely sharpness.","    //   Where N ranges between,","    //     N = 0.50 (default)","    //     N = 0.33 (sharper)","    // {x__} = -N/screenWidthInPixels","    // {_y_} = -N/screenHeightInPixels","    // {_z_} =  N/screenWidthInPixels","    // {__w} =  N/screenHeightInPixels","    FxaaFloat4 fxaaConsoleRcpFrameOpt,","    //","    // Only used on FXAA Console.","    // Not used on 360, but used on PS3 and PC.","    // This must be from a constant/uniform.","    // {x__} = -2.0/screenWidthInPixels","    // {_y_} = -2.0/screenHeightInPixels","    // {_z_} =  2.0/screenWidthInPixels","    // {__w} =  2.0/screenHeightInPixels","    FxaaFloat4 fxaaConsoleRcpFrameOpt2,","    //","    // Only used on FXAA Console.","    // Only used on 360 in place of fxaaConsoleRcpFrameOpt2.","    // This must be from a constant/uniform.","    // {x__} =  8.0/screenWidthInPixels","    // {_y_} =  8.0/screenHeightInPixels","    // {_z_} = -4.0/screenWidthInPixels","    // {__w} = -4.0/screenHeightInPixels","    FxaaFloat4 fxaaConsole360RcpFrameOpt2,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_SUBPIX define.","    // It is here now to allow easier tuning.","    // Choose the amount of sub-pixel aliasing removal.","    // This can effect sharpness.","    //   1.00 - upper limit (softer)","    //   0.75 - default amount of filtering","    //   0.50 - lower limit (sharper, less sub-pixel aliasing removal)","    //   0.25 - almost off","    //   0.00 - completely off","    FxaaFloat fxaaQualitySubpix,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD define.","    // It is here now to allow easier tuning.","    // The minimum amount of local contrast required to apply algorithm.","    //   0.333 - too little (faster)","    //   0.250 - low quality","    //   0.166 - default","    //   0.125 - high quality","    //   0.063 - overkill (slower)","    FxaaFloat fxaaQualityEdgeThreshold,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD_MIN define.","    // It is here now to allow easier tuning.","    // Trims the algorithm from processing darks.","    //   0.0833 - upper limit (default, the start of visible unfiltered edges)","    //   0.0625 - high quality (faster)","    //   0.0312 - visible limit (slower)","    // Special notes when using FXAA_GREEN_AS_LUMA,","    //   Likely want to set this to zero.","    //   As colors that are mostly not-green","    //   will appear very dark in the green channel!","    //   Tune by looking at mostly non-green content,","    //   then start at zero and increase until aliasing is a problem.","    FxaaFloat fxaaQualityEdgeThresholdMin,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_SHARPNESS define.","    // It is here now to allow easier tuning.","    // This does not effect PS3, as this needs to be compiled in.","    //   Use FXAA_CONSOLE_PS3_EDGE_SHARPNESS for PS3.","    //   Due to the PS3 being ALU bound,","    //   there are only three safe values here: 2 and 4 and 8.","    //   These options use the shaders ability to a free *|/ by 2|4|8.","    // For all other platforms can be a non-power of two.","    //   8.0 is sharper (default!!!)","    //   4.0 is softer","    //   2.0 is really soft (good only for vector graphics inputs)","    FxaaFloat fxaaConsoleEdgeSharpness,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_THRESHOLD define.","    // It is here now to allow easier tuning.","    // This does not effect PS3, as this needs to be compiled in.","    //   Use FXAA_CONSOLE_PS3_EDGE_THRESHOLD for PS3.","    //   Due to the PS3 being ALU bound,","    //   there are only two safe values here: 1/4 and 1/8.","    //   These options use the shaders ability to a free *|/ by 2|4|8.","    // The console setting has a different mapping than the quality setting.","    // Other platforms can use other values.","    //   0.125 leaves less aliasing, but is softer (default!!!)","    //   0.25 leaves more aliasing, and is sharper","    FxaaFloat fxaaConsoleEdgeThreshold,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_THRESHOLD_MIN define.","    // It is here now to allow easier tuning.","    // Trims the algorithm from processing darks.","    // The console setting has a different mapping than the quality setting.","    // This only applies when FXAA_EARLY_EXIT is 1.","    // This does not apply to PS3,","    // PS3 was simplified to avoid more shader instructions.","    //   0.06 - faster but more aliasing in darks","    //   0.05 - default","    //   0.04 - slower and less aliasing in darks","    // Special notes when using FXAA_GREEN_AS_LUMA,","    //   Likely want to set this to zero.","    //   As colors that are mostly not-green","    //   will appear very dark in the green channel!","    //   Tune by looking at mostly non-green content,","    //   then start at zero and increase until aliasing is a problem.","    FxaaFloat fxaaConsoleEdgeThresholdMin,","    //","    // Extra constants for 360 FXAA Console only.","    // Use zeros or anything else for other platforms.","    // These must be in physical constant registers and NOT immediates.","    // Immediates will result in compiler un-optimizing.","    // {xyzw} = float4(1.0, -1.0, 0.25, -0.25)","    FxaaFloat4 fxaaConsole360ConstDir",") {","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posM;","    posM.x = pos.x;","    posM.y = pos.y;","    #if (FXAA_GATHER4_ALPHA == 1)","        #if (FXAA_DISCARD == 0)","            FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);","            #if (FXAA_GREEN_AS_LUMA == 0)","                #define lumaM rgbyM.w","            #else","                #define lumaM rgbyM.y","            #endif","        #endif","        #if (FXAA_GREEN_AS_LUMA == 0)","            FxaaFloat4 luma4A = FxaaTexAlpha4(tex, posM);","            FxaaFloat4 luma4B = FxaaTexOffAlpha4(tex, posM, FxaaInt2(-1, -1));","        #else","            FxaaFloat4 luma4A = FxaaTexGreen4(tex, posM);","            FxaaFloat4 luma4B = FxaaTexOffGreen4(tex, posM, FxaaInt2(-1, -1));","        #endif","        #if (FXAA_DISCARD == 1)","            #define lumaM luma4A.w","        #endif","        #define lumaE luma4A.z","        #define lumaS luma4A.x","        #define lumaSE luma4A.y","        #define lumaNW luma4B.w","        #define lumaN luma4B.z","        #define lumaW luma4B.x","    #else","        FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);","        #if (FXAA_GREEN_AS_LUMA == 0)","            #define lumaM rgbyM.w","        #else","            #define lumaM rgbyM.y","        #endif","        #if (FXAA_GLSL_100 == 1)","          FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0, 1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 0.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 0.0), fxaaQualityRcpFrame.xy));","        #else","          FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0, 1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 0), fxaaQualityRcpFrame.xy));","        #endif","    #endif","/*--------------------------------------------------------------------------*/","    FxaaFloat maxSM = max(lumaS, lumaM);","    FxaaFloat minSM = min(lumaS, lumaM);","    FxaaFloat maxESM = max(lumaE, maxSM);","    FxaaFloat minESM = min(lumaE, minSM);","    FxaaFloat maxWN = max(lumaN, lumaW);","    FxaaFloat minWN = min(lumaN, lumaW);","    FxaaFloat rangeMax = max(maxWN, maxESM);","    FxaaFloat rangeMin = min(minWN, minESM);","    FxaaFloat rangeMaxScaled = rangeMax * fxaaQualityEdgeThreshold;","    FxaaFloat range = rangeMax - rangeMin;","    FxaaFloat rangeMaxClamped = max(fxaaQualityEdgeThresholdMin, rangeMaxScaled);","    FxaaBool earlyExit = range < rangeMaxClamped;","/*--------------------------------------------------------------------------*/","    if(earlyExit)","        #if (FXAA_DISCARD == 1)","            FxaaDiscard;","        #else","            return rgbyM;","        #endif","/*--------------------------------------------------------------------------*/","    #if (FXAA_GATHER4_ALPHA == 0)","        #if (FXAA_GLSL_100 == 1)","          FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 1.0), fxaaQualityRcpFrame.xy));","        #else","          FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));","        #endif","    #else","        FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(1, -1), fxaaQualityRcpFrame.xy));","        FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));","    #endif","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNS = lumaN + lumaS;","    FxaaFloat lumaWE = lumaW + lumaE;","    FxaaFloat subpixRcpRange = 1.0/range;","    FxaaFloat subpixNSWE = lumaNS + lumaWE;","    FxaaFloat edgeHorz1 = (-2.0 * lumaM) + lumaNS;","    FxaaFloat edgeVert1 = (-2.0 * lumaM) + lumaWE;","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNESE = lumaNE + lumaSE;","    FxaaFloat lumaNWNE = lumaNW + lumaNE;","    FxaaFloat edgeHorz2 = (-2.0 * lumaE) + lumaNESE;","    FxaaFloat edgeVert2 = (-2.0 * lumaN) + lumaNWNE;","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNWSW = lumaNW + lumaSW;","    FxaaFloat lumaSWSE = lumaSW + lumaSE;","    FxaaFloat edgeHorz4 = (abs(edgeHorz1) * 2.0) + abs(edgeHorz2);","    FxaaFloat edgeVert4 = (abs(edgeVert1) * 2.0) + abs(edgeVert2);","    FxaaFloat edgeHorz3 = (-2.0 * lumaW) + lumaNWSW;","    FxaaFloat edgeVert3 = (-2.0 * lumaS) + lumaSWSE;","    FxaaFloat edgeHorz = abs(edgeHorz3) + edgeHorz4;","    FxaaFloat edgeVert = abs(edgeVert3) + edgeVert4;","/*--------------------------------------------------------------------------*/","    FxaaFloat subpixNWSWNESE = lumaNWSW + lumaNESE;","    FxaaFloat lengthSign = fxaaQualityRcpFrame.x;","    FxaaBool horzSpan = edgeHorz >= edgeVert;","    FxaaFloat subpixA = subpixNSWE * 2.0 + subpixNWSWNESE;","/*--------------------------------------------------------------------------*/","    if(!horzSpan) lumaN = lumaW;","    if(!horzSpan) lumaS = lumaE;","    if(horzSpan) lengthSign = fxaaQualityRcpFrame.y;","    FxaaFloat subpixB = (subpixA * (1.0/12.0)) - lumaM;","/*--------------------------------------------------------------------------*/","    FxaaFloat gradientN = lumaN - lumaM;","    FxaaFloat gradientS = lumaS - lumaM;","    FxaaFloat lumaNN = lumaN + lumaM;","    FxaaFloat lumaSS = lumaS + lumaM;","    FxaaBool pairN = abs(gradientN) >= abs(gradientS);","    FxaaFloat gradient = max(abs(gradientN), abs(gradientS));","    if(pairN) lengthSign = -lengthSign;","    FxaaFloat subpixC = FxaaSat(abs(subpixB) * subpixRcpRange);","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posB;","    posB.x = posM.x;","    posB.y = posM.y;","    FxaaFloat2 offNP;","    offNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;","    offNP.y = ( horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;","    if(!horzSpan) posB.x += lengthSign * 0.5;","    if( horzSpan) posB.y += lengthSign * 0.5;","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posN;","    posN.x = posB.x - offNP.x * FXAA_QUALITY_P0;","    posN.y = posB.y - offNP.y * FXAA_QUALITY_P0;","    FxaaFloat2 posP;","    posP.x = posB.x + offNP.x * FXAA_QUALITY_P0;","    posP.y = posB.y + offNP.y * FXAA_QUALITY_P0;","    FxaaFloat subpixD = ((-2.0)*subpixC) + 3.0;","    FxaaFloat lumaEndN = FxaaLuma(FxaaTexTop(tex, posN));","    FxaaFloat subpixE = subpixC * subpixC;","    FxaaFloat lumaEndP = FxaaLuma(FxaaTexTop(tex, posP));","/*--------------------------------------------------------------------------*/","    if(!pairN) lumaNN = lumaSS;","    FxaaFloat gradientScaled = gradient * 1.0/4.0;","    FxaaFloat lumaMM = lumaM - lumaNN * 0.5;","    FxaaFloat subpixF = subpixD * subpixE;","    FxaaBool lumaMLTZero = lumaMM < 0.0;","/*--------------------------------------------------------------------------*/","    lumaEndN -= lumaNN * 0.5;","    lumaEndP -= lumaNN * 0.5;","    FxaaBool doneN = abs(lumaEndN) >= gradientScaled;","    FxaaBool doneP = abs(lumaEndP) >= gradientScaled;","    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P1;","    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P1;","    FxaaBool doneNP = (!doneN) || (!doneP);","    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P1;","    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P1;","/*--------------------------------------------------------------------------*/","    if(doneNP) {","        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","        doneN = abs(lumaEndN) >= gradientScaled;","        doneP = abs(lumaEndP) >= gradientScaled;","        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P2;","        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P2;","        doneNP = (!doneN) || (!doneP);","        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P2;","        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P2;","/*--------------------------------------------------------------------------*/","        #if (FXAA_QUALITY_PS > 3)","        if(doneNP) {","            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","            doneN = abs(lumaEndN) >= gradientScaled;","            doneP = abs(lumaEndP) >= gradientScaled;","            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P3;","            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P3;","            doneNP = (!doneN) || (!doneP);","            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P3;","            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P3;","/*--------------------------------------------------------------------------*/","            #if (FXAA_QUALITY_PS > 4)","            if(doneNP) {","                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                doneN = abs(lumaEndN) >= gradientScaled;","                doneP = abs(lumaEndP) >= gradientScaled;","                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P4;","                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P4;","                doneNP = (!doneN) || (!doneP);","                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P4;","                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P4;","/*--------------------------------------------------------------------------*/","                #if (FXAA_QUALITY_PS > 5)","                if(doneNP) {","                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                    doneN = abs(lumaEndN) >= gradientScaled;","                    doneP = abs(lumaEndP) >= gradientScaled;","                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P5;","                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P5;","                    doneNP = (!doneN) || (!doneP);","                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P5;","                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P5;","/*--------------------------------------------------------------------------*/","                    #if (FXAA_QUALITY_PS > 6)","                    if(doneNP) {","                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                        doneN = abs(lumaEndN) >= gradientScaled;","                        doneP = abs(lumaEndP) >= gradientScaled;","                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P6;","                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P6;","                        doneNP = (!doneN) || (!doneP);","                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P6;","                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P6;","/*--------------------------------------------------------------------------*/","                        #if (FXAA_QUALITY_PS > 7)","                        if(doneNP) {","                            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                            doneN = abs(lumaEndN) >= gradientScaled;","                            doneP = abs(lumaEndP) >= gradientScaled;","                            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P7;","                            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P7;","                            doneNP = (!doneN) || (!doneP);","                            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P7;","                            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P7;","/*--------------------------------------------------------------------------*/","    #if (FXAA_QUALITY_PS > 8)","    if(doneNP) {","        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","        doneN = abs(lumaEndN) >= gradientScaled;","        doneP = abs(lumaEndP) >= gradientScaled;","        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P8;","        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P8;","        doneNP = (!doneN) || (!doneP);","        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P8;","        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P8;","/*--------------------------------------------------------------------------*/","        #if (FXAA_QUALITY_PS > 9)","        if(doneNP) {","            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","            doneN = abs(lumaEndN) >= gradientScaled;","            doneP = abs(lumaEndP) >= gradientScaled;","            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P9;","            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P9;","            doneNP = (!doneN) || (!doneP);","            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P9;","            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P9;","/*--------------------------------------------------------------------------*/","            #if (FXAA_QUALITY_PS > 10)","            if(doneNP) {","                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                doneN = abs(lumaEndN) >= gradientScaled;","                doneP = abs(lumaEndP) >= gradientScaled;","                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P10;","                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P10;","                doneNP = (!doneN) || (!doneP);","                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P10;","                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P10;","/*--------------------------------------------------------------------------*/","                #if (FXAA_QUALITY_PS > 11)","                if(doneNP) {","                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                    doneN = abs(lumaEndN) >= gradientScaled;","                    doneP = abs(lumaEndP) >= gradientScaled;","                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P11;","                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P11;","                    doneNP = (!doneN) || (!doneP);","                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P11;","                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P11;","/*--------------------------------------------------------------------------*/","                    #if (FXAA_QUALITY_PS > 12)","                    if(doneNP) {","                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                        doneN = abs(lumaEndN) >= gradientScaled;","                        doneP = abs(lumaEndP) >= gradientScaled;","                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P12;","                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P12;","                        doneNP = (!doneN) || (!doneP);","                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P12;","                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P12;","/*--------------------------------------------------------------------------*/","                    }","                    #endif","/*--------------------------------------------------------------------------*/","                }","                #endif","/*--------------------------------------------------------------------------*/","            }","            #endif","/*--------------------------------------------------------------------------*/","        }","        #endif","/*--------------------------------------------------------------------------*/","    }","    #endif","/*--------------------------------------------------------------------------*/","                        }","                        #endif","/*--------------------------------------------------------------------------*/","                    }","                    #endif","/*--------------------------------------------------------------------------*/","                }","                #endif","/*--------------------------------------------------------------------------*/","            }","            #endif","/*--------------------------------------------------------------------------*/","        }","        #endif","/*--------------------------------------------------------------------------*/","    }","/*--------------------------------------------------------------------------*/","    FxaaFloat dstN = posM.x - posN.x;","    FxaaFloat dstP = posP.x - posM.x;","    if(!horzSpan) dstN = posM.y - posN.y;","    if(!horzSpan) dstP = posP.y - posM.y;","/*--------------------------------------------------------------------------*/","    FxaaBool goodSpanN = (lumaEndN < 0.0) != lumaMLTZero;","    FxaaFloat spanLength = (dstP + dstN);","    FxaaBool goodSpanP = (lumaEndP < 0.0) != lumaMLTZero;","    FxaaFloat spanLengthRcp = 1.0/spanLength;","/*--------------------------------------------------------------------------*/","    FxaaBool directionN = dstN < dstP;","    FxaaFloat dst = min(dstN, dstP);","    FxaaBool goodSpan = directionN ? goodSpanN : goodSpanP;","    FxaaFloat subpixG = subpixF * subpixF;","    FxaaFloat pixelOffset = (dst * (-spanLengthRcp)) + 0.5;","    FxaaFloat subpixH = subpixG * fxaaQualitySubpix;","/*--------------------------------------------------------------------------*/","    FxaaFloat pixelOffsetGood = goodSpan ? pixelOffset : 0.0;","    FxaaFloat pixelOffsetSubpix = max(pixelOffsetGood, subpixH);","    if(!horzSpan) posM.x += pixelOffsetSubpix * lengthSign;","    if( horzSpan) posM.y += pixelOffsetSubpix * lengthSign;","    #if (FXAA_DISCARD == 1)","        return FxaaTexTop(tex, posM);","    #else","        return FxaaFloat4(FxaaTexTop(tex, posM).xyz, lumaM);","    #endif","}","/*==========================================================================*/","#endif","","void main() {","  gl_FragColor = FxaaPixelShader(","    vUv,","    vec4(0.0),","    tDiffuse,","    tDiffuse,","    tDiffuse,","    resolution,","    vec4(0.0),","    vec4(0.0),","    vec4(0.0),","    0.75,","    0.166,","    0.0833,","    0.0,","    0.0,","    0.0,","    vec4(0.0)","  );","","  // TODO avoid querying texture twice for same texel","  gl_FragColor.a = texture2D(tDiffuse, vUv).a;","}"].join("\n")};e.d(i,"a",function(){return p});class p{constructor(t,i){this._width=100,this._height=100,this.visi3D=t,this._active=!1,this._edgeStrength=3,this._edgeGlow=0,this._edgeThickness=1,this._pulsePeriod=0,this._visibleEdgeColor="#ffffff",this._hiddenEdgeColor="#190a05",this._boolTextur=!1,this._linkTextur="null";var e=new o(t.renderer),s=new l(t.scene,t.camera);e.addPass(s);var n=new c(new THREE.Vector2(window.innerWidth,window.innerHeight),t.scene,t.camera);e.addPass(n),this.outlinePass=n;var r=new a(d);r.uniforms.resolution.value.set(1/window.innerWidth,1/window.innerHeight),e.addPass(r),this.outlinePass.edgeStrength=this._edgeStrength,this.outlinePass.edgeGlow=this._edgeGlow,this.outlinePass.edgeThickness=this._edgeThickness,this.outlinePass.pulsePeriod=this._pulsePeriod,this.outlinePass.visibleEdgeColor.set(this._visibleEdgeColor),this.outlinePass.hiddenEdgeColor.set(this._hiddenEdgeColor),this._visibleEdgeColor="#ffffff",this._hiddenEdgeColor="#190a05",this.dragLink=function(){(new THREE.TextureLoader).load(this._linkTextur,function(i){n.patternTexture=i,i.wrapS=THREE.RepeatWrapping,i.wrapT=THREE.RepeatWrapping,t.intRend=1})},this.sizeWindow=function(t,i){this._width=t,this._height=i,r.uniforms.resolution.value.set(1/t,1/i),e.setSize(t,i)},this.render=function(){return 0==this._active?this._active:(e.render(),!0)},this.setValue=function(t){1!=Array.isArray(t)?n.selectedObjects=null!=t||null!=t?[t]:[]:n.selectedObjects=t}}set active(t){this._active!=t&&(this._active=t,this.visi3D.intRend=1)}get active(){return this._active}set edgeStrength(t){this._edgeStrength!=t&&(this._edgeStrength=t,this.outlinePass.edgeStrength=this._edgeStrength)}get edgeStrength(){return this._edgeStrength}set edgeGlow(t){this._edgeGlow!=t&&(this._edgeGlow=t,this.outlinePass.edgeGlow=this._edgeGlow)}get edgeGlow(){return this._edgeGlow}set pulsePeriod(t){this._pulsePeriod!=t&&(this._pulsePeriod=t,this.outlinePass.pulsePeriod=this._pulsePeriod)}get pulsePeriod(){return this._pulsePeriod}set linkTextur(t){this._linkTextur!=t&&(this._linkTextur=t,"null"==this._linkTextur?this.outlinePass.usePatternTexture=!1:(this.outlinePass.usePatternTexture=!0,this.dragLink()))}get linkTextur(){return this._linkTextur}set edgeStrength(t){this._edgeStrength!=t&&(this._edgeStrength=t,this.outlinePass.edgeStrength=this._edgeStrength)}get edgeStrength(){return this._edgeStrength}set visibleEdgeColor(t){this._visibleEdgeColor!=t&&(this._visibleEdgeColor=t,this.outlinePass.visibleEdgeColor.set(this._visibleEdgeColor))}get visibleEdgeColor(){return this._visibleEdgeColor}set hiddenEdgeColor(t){this._hiddenEdgeColor!=t&&(this._hiddenEdgeColor=t,this.outlinePass.hiddenEdgeColor.set(this._hiddenEdgeColor))}get hiddenEdgeColor(){return this._hiddenEdgeColor}}},function(t,i,e){"use strict";function s(){this.event=void 0,this.arrSobName=["up","down","move","out","over","wheel"],this.arrSob=[[],[],[],[],[],[]],this.pozSob=void 0,this.dispatcherEvent=function(t,i){for(var e=0;e<this.arrSobName.length;e++)if(this.arrSobName[e]==t){i&&(i.type=t);for(var s=0;s<this.arrSob[e].length;s++)this.arrSob[e][s](i)}},this.removeEvent=function(t,i){for(var e=0;e<this.arrSobName.length;e++)if(this.arrSobName[e]==t)for(var s=0;s<this.arrSob[e].length;s++)this.arrSob[e][s]==i&&this.arrSob[e].splice(s,1)},this.addEvent=function(t,i){for(var e=0;e<this.arrSobName.length;e++)this.arrSobName[e]==t&&this.arrSob[e].push(i)}}function n(){this.target=void 0,this.face=void 0,this.point=void 0,this.faceIndex=void 0,this.type=void 0,this.uv=void 0,this.originalEvent=void 0,this.copy=function(){var t=new n;return t.target=this.target,t.face=this.face,t.point=this.point,t.faceIndex=this.faceIndex,t.type=this.type,t.uv=this.uv,t.originalEvent=this.originalEvent,t}}function r(t,i,e,r){this.parent=t,this.par=t;var h,a,o=this;this.camera=i,this.raycaster=new THREE.Raycaster,this.intersects,this.devas=t.devas,this.point=new THREE.Vector2(0,0),this.pointWH=new THREE.Vector2(0,0),this.arrChild=[],this.uuid="nullMy",this.obj3d,this.eventSob=new s,this.event3D=new n,this.xzNull="xzNull",this.poiskName="xzPoisk",this.tokoName="null",this._activ=!0,this.rect={x:0,y:0,width:100,height:100},this.cont=void 0,this.div=void 0,this.setRect=function(t,i,e,s){this.rect.x=t,this.rect.y=i,this.rect.width=e,this.rect.height=s},this.removeChild=function(t){h=null;for(var i=0;i<this.arrChild.length;i++)t.uuid==this.arrChild[i].uuid&&(h=this.arrChild.splice(i,1),(i-=1)<0&&(i=0));return h},this.addChild=function(t){this.removeChild(t),this.arrChild.push(t)},this.boolNum=-1,this.boolNumOld=-1,this.event,this.mouseRay=function(){0!=this._activ&&(this.rayPusk(),this.boolNum=this.getGoodParam(),-1==this.boolNum?"nullMy"!=this.uuid&&(o.dragAllE3d("out",this.event3D),this.eventSob.dispatcherEvent("out",this.event3D),this.uuid="nullMy"):"nullMy"!=this.uuid?this.uuid!=this.intersects[this.boolNum].object.uuid?(o.dragAllE3d("out",this.event3D),this.eventSob.dispatcherEvent("out",this.event3D),this.uuid=this.intersects[this.boolNum].object.uuid,this.event3D.target=this.intersects[this.boolNum].object,this.event3D.face=this.intersects[this.boolNum].face,this.event3D.point=this.intersects[this.boolNum].point,this.event3D.faceIndex=this.intersects[this.boolNum].faceIndex,this.event3D.uv=this.intersects[this.boolNum].uv,this.event3D.originalEvent=o.event,o.dragAllE3d("over",this.event3D),this.eventSob.dispatcherEvent("over",this.event3D)):(this.event3D.face=this.intersects[this.boolNum].face,this.event3D.point=this.intersects[this.boolNum].point,this.event3D.faceIndex=this.intersects[this.boolNum].faceIndex,this.event3D.uv=this.intersects[this.boolNum].uv,this.event3D.originalEvent=o.event,o.dragAllE3d("move",this.event3D),this.eventSob.dispatcherEvent("move",this.event3D)):(this.uuid=this.intersects[this.boolNum].object.uuid,this.event3D.target=this.intersects[this.boolNum].object,this.event3D.face=this.intersects[this.boolNum].face,this.event3D.point=this.intersects[this.boolNum].point,this.event3D.faceIndex=this.intersects[this.boolNum].faceIndex,this.event3D.uv=this.intersects[this.boolNum].uv,this.event3D.originalEvent=o.event,o.dragAllE3d("over",this.event3D),this.eventSob.dispatcherEvent("over",this.event3D)),this.boolNumOld=this.boolNum)},this.getPosition=function(t){var i=this.poiskName;if(this.poiskName=null!=t?t:"xzPoisk",this.restartPoint(),this.rayPusk(),this.poiskName=i,0!=this.intersects.length){var e=this.intersects.length-1;return-1==e&&(e=0),this.intersects[e]}return null};var l=new n;this.getNameEvent=function(t){if(this.restartPoint(),this.rayPusk(),0!=this.intersects.length)for(var i=0;i<this.intersects.length;i++)if(null!=this.intersects[i].object.parent&&this.intersects[i].object.name==t)return l.target=this.intersects[this.boolNum].object,l.face=this.intersects[this.boolNum].face,l.point=this.intersects[this.boolNum].point,l.faceIndex=this.intersects[this.boolNum].faceIndex,l.uv=this.intersects[this.boolNum].uv,l.originalEvent=o.event,l;return null},this.testVisiParam=function(t){return 0!=t.visible&&(!t.notEvent&&(null!=t.parent?this.testVisiParam(t.parent):"Scene"==t.type))},this.getGoodParam=function(){if(0!=this.intersects.length){var t;for(t=0;t<this.intersects.length;t++)0!=this.testVisiParam(this.intersects[t].object)&&null!=this.intersects[t].object.notActiv&&(this.intersects.splice(t,1),t=0);if(0==this.intersects.length)return-1;for(t=0;t<this.intersects.length;t++)if(0!=this.testVisiParam(this.intersects[t].object)&&this.intersects[t].object.name==this.poiskName)return t;for(t=0;t<this.intersects.length;t++)if(0!=this.testVisiParam(this.intersects[t].object)&&this.intersects[t].object.name!=this.xzNull)return t}return-1},this.rayPusk=function(){(a=new THREE.Vector3).setFromMatrixPosition(this.camera.matrixWorld),this.raycaster.ray.origin.copy(a),this.raycaster.ray.direction.set(this.point.x,this.point.y,.5).unproject(this.camera).sub(a).normalize(),this.intersects=this.raycaster.intersectObjects(this.arrChild,!0)},this.naCont=!1,this.mousemove=function(t){0==o.devas&&0==o.naCont||(null!=t.data?o.event=t.data.originalEvent:o.event=t,0!=o._activ&&(o.restartPoint(t),o.mouseRay(),o.intersects.length&&0==o.devas&&o.event.preventDefault()))},this.zdvigX=0,this.scale=1,this.pV=new THREE.Vector2(0,0);var u={x:0,y:0};this.restartPoint=function(t){t&&t.target&&(u=o.par.contentHTML.getBoundingClientRect()),0==o.devas?(o.pV.x=t.clientX,o.pV.y=t.clientY):(o.pV.x=t.touches[0].clientX,o.pV.y=t.touches[0].clientY),o.pV.x-=u.x,o.pV.y-=u.y,1==o.isRect(o.pV)?(o.point.x=-(this.rect.x-o.pV.x)/this.rect.width*2-1,o.point.y=-(-(this.rect.y-o.pV.y)/this.rect.height*2-1)):99999!=o.point.x&&(o.point.x=99999)},this.isRect=function(t){return t.x>=this.rect.x&&t.x<=this.rect.x+this.rect.width&&t.y>=this.rect.y&&t.y<=this.rect.y+this.rect.height},this.mouseup=function(t){null!=t.data?o.event=t.data.originalEvent:o.event=t,o.intersects&&0!=o._activ&&(0==o.devas?(-1==o.boolNumOld?(o.event3D.target=null,o.event3D.originalEvent=o.event,o.dragAllE3d("up",o.event3D),o.eventSob.dispatcherEvent("up",o.event3D)):(o.event3D.originalEvent=o.event,o.dragAllE3d("up",o.event3D),o.eventSob.dispatcherEvent("up",o.event3D)),o.intersects.length&&o.event.preventDefault()):(o.mouseRay(),-1==o.boolNumOld?(o.event3D.target=null,o.event3D.originalEvent=o.event,o.dragAllE3d("up",o.event3D),o.eventSob.dispatcherEvent("up",o.event3D)):(o.event3D.originalEvent=o.event,o.dragAllE3d("up",o.event3D),o.eventSob.dispatcherEvent("up",o.event3D),o.uuid="nullMy")))},this.mousedown=function(t){null!=t.data?o.event=t.data.originalEvent:o.event=t,o.restartPoint(t),0!=o._activ&&(0==o.devas?(-1==o.boolNumOld?(o.event3D.target=null,o.event3D.originalEvent=o.event,o.dragAllE3d("down",o.event3D),o.eventSob.dispatcherEvent("down",o.event3D)):(o.event3D.originalEvent=o.event,o.dragAllE3d("down",o.event3D),o.eventSob.dispatcherEvent("down",o.event3D)),o.intersects.length&&o.event.preventDefault()):(o.mouseRay(),-1==o.boolNumOld?(o.event3D.target=null,o.event3D.originalEvent=o.event,o.dragAllE3d("down",o.event3D),o.eventSob.dispatcherEvent("down",o.event3D)):(o.event3D.originalEvent=o.event,o.dragAllE3d("down",o.event3D),o.eventSob.dispatcherEvent("down",o.event3D))))},this.mouseout=function(t){o.naCont=!1,o.restartPoint(t),o.point.x=99999,o.mouseRay()},this.mouseover=function(t){o.naCont=!0,o.restartPoint(t),o.mouseRay()},this.touchend=function(t){},this.mousewheel=function(t){null!=t.data?o.event=t.data.originalEvent:o.event=t,o.restartPoint(t),0!=o._activ&&(-1==o.boolNumOld?(o.dragAllE3d("down",null),o.eventSob.dispatcherEvent("down",null)):(o.event3D.originalEvent=o.event,o.dragAllE3d("wheel",o.event3D),o.eventSob.dispatcherEvent("wheel",o.event3D)))},this.addDragEvent=function(t,i){this.cont=t,this.div=i,0==o.devas?(window.addEventListener("mouseup",o.mouseup),i.addEventListener("mousedown",o.mousedown),i.addEventListener("mouseout",o.mouseout),i.addEventListener("mouseover",o.mouseover)):(window.addEventListener("touchend",o.mouseup),i.addEventListener("touchstart",o.mousedown))},this.dragE3d=void 0,this.dragAllE3d=function(t,i){void 0!==o.dragE3d&&o.dragE3d(t,i)},this.sizeWindow=function(t,i){this.pointWH.x=t,this.pointWH.y=i}}e.d(i,"a",function(){return r}),r.prototype={set activ(t){this._activ!=t&&(this._activ=t)},get activ(){return this._activ}}},function(t,i,e){"use strict";e.r(i),function(t){var s=e(2);e.d(i,"Main",function(){return s.a}),t.Main=s.a}.call(this,e(12))},function(t,i){var e;e=function(){return this}();try{e=e||new Function("return this")()}catch(t){"object"==typeof window&&(e=window)}t.exports=e}]);